---
uid: mvc/overview/older-versions/using-oauth-providers-with-mvc
title: Usando provedores OAuth com o MVC 4 | Microsoft Docs
author: tfitzmac
description: Este tutorial mostra como criar um aplicativo web ASP.NET MVC 4 que permite que os usuários façam logon com credenciais de um provedor externo, como Facebo...
ms.author: riande
ms.date: 06/19/2013
ms.assetid: 7a87f16f-0e19-4f15-a88a-094ae866c4a2
msc.legacyurl: /mvc/overview/older-versions/using-oauth-providers-with-mvc
msc.type: authoredcontent
ms.openlocfilehash: 9b0db2775db5c74762bdc55328ad44ef7ebe75ce
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/16/2018
ms.locfileid: "41831646"
---
<a name="using-oauth-providers-with-mvc-4"></a><span data-ttu-id="5dcb9-103">Usando provedores OAuth com o MVC 4</span><span class="sxs-lookup"><span data-stu-id="5dcb9-103">Using OAuth Providers with MVC 4</span></span>
====================
<span data-ttu-id="5dcb9-104">por [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="5dcb9-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="5dcb9-105">Este tutorial mostra como criar um aplicativo web ASP.NET MVC 4 que permite aos usuários fazer logon com credenciais de um provedor externo, como o Facebook, Twitter, Microsoft ou Google e, em seguida, integre algumas das funcionalidades desses provedores em seu aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-105">This tutorial shows you how to build an ASP.NET MVC 4 web application that enables users to log in with credentials from an external provider, such as Facebook, Twitter, Microsoft, or Google, and then integrate some of the functionality from those providers into your web application.</span></span> <span data-ttu-id="5dcb9-106">Para simplificar, este tutorial concentra-se sobre como trabalhar com as credenciais do Facebook.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-106">For simplicity, this tutorial focuses on working with credentials from Facebook.</span></span>
> 
> <span data-ttu-id="5dcb9-107">Para usar credenciais externas em um aplicativo ASP.NET MVC 5, consulte [criar um aplicativo do ASP.NET MVC 5 com o Facebook e Google OAuth2 e OpenID Sign-on](../security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="5dcb9-107">To use external credentials in an ASP.NET MVC 5 web application, see [Create an ASP.NET MVC 5 App with Facebook and Google OAuth2 and OpenID Sign-on](../security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
> 
> <span data-ttu-id="5dcb9-108">Habilitar essas credenciais em sites da web fornece uma vantagem significativa porque milhões de usuários já têm contas com esses provedores externos.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-108">Enabling these credentials in your web sites provides a significant advantage because millions of users already have accounts with these external providers.</span></span> <span data-ttu-id="5dcb9-109">Esses usuários podem ser mais decididos a se inscrever para seu site se eles não precisam criar e lembrar de um novo conjunto de credenciais.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-109">These users may be more inclined to sign up for your site if they do not have to create and remember a new set of credentials.</span></span> <span data-ttu-id="5dcb9-110">Além disso, depois que um usuário tiver conectado por meio de um desses provedores, você pode incorporar operações sociais do provedor.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-110">Also, after a user has logged in through one of these providers, you can incorporate social operations from the provider.</span></span>


## <a name="what-youll-build"></a><span data-ttu-id="5dcb9-111">O que você vai criar</span><span class="sxs-lookup"><span data-stu-id="5dcb9-111">What you'll build</span></span>

<span data-ttu-id="5dcb9-112">Há duas metas principais neste tutorial:</span><span class="sxs-lookup"><span data-stu-id="5dcb9-112">There are two main goals in this tutorial:</span></span>

1. <span data-ttu-id="5dcb9-113">Permitir que um usuário fazer logon com credenciais de um provedor de OAuth.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-113">Enable a user to log in with credentials from an OAuth provider.</span></span>
2. <span data-ttu-id="5dcb9-114">Recuperar informações da conta do provedor e integrar essas informações com o registro de conta para seu site.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-114">Retrieve account information from the provider and integrate that information with the account registration for your site.</span></span>

<span data-ttu-id="5dcb9-115">Embora os exemplos neste tutorial se concentrar em usando o Facebook como provedor de autenticação, você pode modificar o código para usar qualquer um dos provedores.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-115">Although the examples in this tutorial focus on using Facebook as the authentication provider, you can modify the code to use any of the providers.</span></span> <span data-ttu-id="5dcb9-116">As etapas para implementar qualquer provedor são muito semelhantes às etapas que você verá neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-116">The steps to implement any provider are very similar to the steps you will see in this tutorial.</span></span> <span data-ttu-id="5dcb9-117">Você só verá diferenças significativas ao fazer chamadas diretas para a API do provedor definida.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-117">You will only notice significant differences when making direct calls to the provider's API set.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="5dcb9-118">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="5dcb9-118">Prerequisites</span></span>

- <span data-ttu-id="5dcb9-119">[Microsoft Visual Studio 2012](https://www.microsoft.com/visualstudio/eng/downloads#vs) ou [Microsoft Visual Studio Express 2012 para Web](https://www.microsoft.com/visualstudio/eng/downloads#d-2012-express)</span><span class="sxs-lookup"><span data-stu-id="5dcb9-119">[Microsoft Visual Studio 2012](https://www.microsoft.com/visualstudio/eng/downloads#vs) or [Microsoft Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/eng/downloads#d-2012-express)</span></span>

<span data-ttu-id="5dcb9-120">Ou</span><span class="sxs-lookup"><span data-stu-id="5dcb9-120">Or</span></span>

- <span data-ttu-id="5dcb9-121">Microsoft Visual Studio 2010 SP1 ou [Visual Web Developer Express 2010 SP1](https://www.microsoft.com/visualstudio/eng/downloads#d-2010-express)</span><span class="sxs-lookup"><span data-stu-id="5dcb9-121">Microsoft Visual Studio 2010 SP1 or [Visual Web Developer Express 2010 SP1](https://www.microsoft.com/visualstudio/eng/downloads#d-2010-express)</span></span>
- [<span data-ttu-id="5dcb9-122">ASP.NET MVC 4</span><span class="sxs-lookup"><span data-stu-id="5dcb9-122">ASP.NET MVC 4</span></span>](https://go.microsoft.com/fwlink/?LinkId=243392)

<span data-ttu-id="5dcb9-123">Além disso, este tópico pressupõe que você tenha um conhecimento básico sobre o ASP.NET MVC e o Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-123">Furthermore, this topic assumes you have basic knowledge about ASP.NET MVC and Visual Studio.</span></span> <span data-ttu-id="5dcb9-124">Se você precisar de uma introdução ao ASP.NET MVC 4, consulte [Introdução ao ASP.NET MVC 4](getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4.md).</span><span class="sxs-lookup"><span data-stu-id="5dcb9-124">If you need an introduction to ASP.NET MVC 4, see [Intro to ASP.NET MVC 4](getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4.md).</span></span>

## <a name="create-the-project"></a><span data-ttu-id="5dcb9-125">Criar o projeto</span><span class="sxs-lookup"><span data-stu-id="5dcb9-125">Create the project</span></span>

<span data-ttu-id="5dcb9-126">No Visual Studio, crie um novo aplicativo ASP.NET MVC 4 da Web e nomeie- &quot;OAuthMVC&quot;.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-126">In Visual Studio, create a new ASP.NET MVC 4 Web Application, and name it &quot;OAuthMVC&quot;.</span></span> <span data-ttu-id="5dcb9-127">Você pode direcionar o .NET Framework 4.5 ou 4.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-127">You can target either .NET Framework 4.5 or 4.</span></span>

![Criar projeto](using-oauth-providers-with-mvc/_static/image1.png)

<span data-ttu-id="5dcb9-129">Na janela novo projeto ASP.NET MVC 4, selecione **aplicativo de Internet** e deixe **Razor** como o mecanismo de exibição.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-129">In the New ASP.NET MVC 4 Project window, select **Internet Application** and leave **Razor** as the view engine.</span></span>

![Selecione o aplicativo de Internet](using-oauth-providers-with-mvc/_static/image2.png)

## <a name="enable-a-provider"></a><span data-ttu-id="5dcb9-131">Habilite um provedor</span><span class="sxs-lookup"><span data-stu-id="5dcb9-131">Enable a provider</span></span>

<span data-ttu-id="5dcb9-132">Quando você cria um aplicativo web MVC 4 com o modelo de aplicativo de Internet, o projeto é criado com um arquivo chamado AuthConfig.cs no aplicativo\_pasta inicial.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-132">When you create an MVC 4 web application with the Internet Application template, the project is created with a file named AuthConfig.cs in the App\_Start folder.</span></span>

![Arquivo AuthConfig](using-oauth-providers-with-mvc/_static/image3.png)

<span data-ttu-id="5dcb9-134">O arquivo AuthConfig contém código para registrar clientes para provedores de autenticação externa.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-134">The AuthConfig file contains code to register clients for external authentication providers.</span></span> <span data-ttu-id="5dcb9-135">Por padrão, esse código é comentado, portanto, nenhum dos provedores externos estão habilitados.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-135">By default, this code is commented out, so none of the external providers are enabled.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample1.cs)]

<span data-ttu-id="5dcb9-136">Você deve remover o comentário este código para usar o cliente de autenticação externa.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-136">You must uncomment this code to use the external authentication client.</span></span> <span data-ttu-id="5dcb9-137">Remova o comentário do somente os provedores que você deseja incluir em seu site.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-137">You uncomment only the providers you want to include in your site.</span></span> <span data-ttu-id="5dcb9-138">Para este tutorial, você habilitará apenas as credenciais do Facebook.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-138">For this tutorial, you will only enable the Facebook credentials.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample2.cs)]

<span data-ttu-id="5dcb9-139">Observe no exemplo acima que o método inclui cadeias de caracteres vazias para os parâmetros de registro.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-139">Notice in the above example that the method includes empty strings for the registration parameters.</span></span> <span data-ttu-id="5dcb9-140">Se você tentar executar o aplicativo agora, o aplicativo gerará uma exceção de argumento, como cadeias de caracteres vazias não são permitidas para os parâmetros.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-140">If you try to run the application now, the application throws an argument exception because empty strings are not allowed for the parameters.</span></span> <span data-ttu-id="5dcb9-141">Para fornecer valores válidos, você deve registrar seu site da web com provedores externos, conforme mostrado na próxima seção.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-141">To provide valid values, you must register your web site with the external providers, as shown in the next section.</span></span>

## <a name="registering-with-an-external-provider"></a><span data-ttu-id="5dcb9-142">Registrando um provedor externo</span><span class="sxs-lookup"><span data-stu-id="5dcb9-142">Registering with an external provider</span></span>

<span data-ttu-id="5dcb9-143">Para autenticar usuários com credenciais de um provedor externo, você deve registrar seu site da web com o provedor.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-143">To authenticate users with credentials from an external provider, you must register your web site with the provider.</span></span> <span data-ttu-id="5dcb9-144">Quando você registra seu site, você receberá os parâmetros (como chave ou id e segredo) para incluir ao registrar o cliente.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-144">When you register your site, you will receive the parameters (such as key or id, and secret) to include when registering the client.</span></span> <span data-ttu-id="5dcb9-145">Você deve ter uma conta com os provedores que você deseja usar.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-145">You must have an account with the providers you wish to use.</span></span>

<span data-ttu-id="5dcb9-146">Este tutorial não mostra todas as etapas que você deve executar para registrar com esses provedores.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-146">This tutorial does not show all of the steps you must perform to register with these providers.</span></span> <span data-ttu-id="5dcb9-147">Normalmente, as etapas não são difíceis.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-147">The steps are typically not difficult.</span></span> <span data-ttu-id="5dcb9-148">Para registrar o seu site com êxito, siga as instruções fornecidas nesses sites.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-148">To successfully register your site, follow the instructions provided on those sites.</span></span> <span data-ttu-id="5dcb9-149">Para começar a registrar seu site, consulte o site de desenvolvedor para:</span><span class="sxs-lookup"><span data-stu-id="5dcb9-149">To get started with registering your site, see the developer site for:</span></span>

- [<span data-ttu-id="5dcb9-150">Facebook</span><span class="sxs-lookup"><span data-stu-id="5dcb9-150">Facebook</span></span>](https://developers.facebook.com/)
- [<span data-ttu-id="5dcb9-151">Google</span><span class="sxs-lookup"><span data-stu-id="5dcb9-151">Google</span></span>](https://developers.google.com/)
- [<span data-ttu-id="5dcb9-152">Microsoft</span><span class="sxs-lookup"><span data-stu-id="5dcb9-152">Microsoft</span></span>](http://manage.dev.live.com/)
- [<span data-ttu-id="5dcb9-153">Twitter</span><span class="sxs-lookup"><span data-stu-id="5dcb9-153">Twitter</span></span>](https://dev.twitter.com/)

<span data-ttu-id="5dcb9-154">Ao registrar o seu site com o Facebook, você pode fornecer &quot;localhost&quot; para o domínio do site e `&quot;http://localhost/&quot;` para a URL, conforme mostrado na imagem abaixo.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-154">When registering your site with Facebook, you can provide &quot;localhost&quot; for the site domain and `&quot;http://localhost/&quot;` for the URL, as shown in the image below.</span></span> <span data-ttu-id="5dcb9-155">Usando localhost funciona com a maioria dos provedores, mas atualmente não funciona com o provedor Microsoft.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-155">Using localhost works with most providers, but currently does not work with the Microsoft provider.</span></span> <span data-ttu-id="5dcb9-156">Para o provedor da Microsoft, você deve incluir uma URL de site válido.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-156">For the Microsoft provider, you must include a valid web site URL.</span></span>

![Registre o site](using-oauth-providers-with-mvc/_static/image4.png)

<span data-ttu-id="5dcb9-158">Na imagem anterior, os valores para a id do aplicativo, o segredo do aplicativo e o email de contato foram removidos.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-158">In the previous image, the values for the app id, app secret, and contact email have been removed.</span></span> <span data-ttu-id="5dcb9-159">Ao registrar o seu site na verdade, esses valores estará presentes.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-159">When you actually register your site, those values will be present.</span></span> <span data-ttu-id="5dcb9-160">Você desejará observar os valores de id do aplicativo e segredo do aplicativo porque você os adicionará ao seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-160">You will want to note the values for app id and app secret because you will add them to your application.</span></span>

## <a name="creating-test-users"></a><span data-ttu-id="5dcb9-161">Criar usuários de teste</span><span class="sxs-lookup"><span data-stu-id="5dcb9-161">Creating test users</span></span>

<span data-ttu-id="5dcb9-162">Se você não se importar usando uma conta existente do Facebook para testar seu site, você pode ignorar esta seção.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-162">If you do not mind using an existing Facebook account to test your site, you can skip this section.</span></span>

<span data-ttu-id="5dcb9-163">Você pode criar facilmente os usuários de teste para seu aplicativo na página de gerenciamento de aplicativo do Facebook.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-163">You can easily create test users for your application within the Facebook app management page.</span></span> <span data-ttu-id="5dcb9-164">Você pode usar essas contas para fazer logon em seu site de teste.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-164">You can use these test accounts to log in to your site.</span></span> <span data-ttu-id="5dcb9-165">Criar usuários de teste clicando o **funções** link no painel de navegação esquerdo e clicando o **criar** link.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-165">You create test users by clicking the **Roles** link in the left navigation pane and the clicking the **Create** link.</span></span>

![criar usuários de teste](using-oauth-providers-with-mvc/_static/image5.png)

<span data-ttu-id="5dcb9-167">O site do Facebook cria automaticamente o número de contas de teste que você solicitar.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-167">The Facebook site automatically creates the number of test accounts that you request.</span></span>

## <a name="adding-application-id-and-secret-from-the-provider"></a><span data-ttu-id="5dcb9-168">Adicionando a id do aplicativo e o segredo do provedor</span><span class="sxs-lookup"><span data-stu-id="5dcb9-168">Adding application id and secret from the provider</span></span>

<span data-ttu-id="5dcb9-169">Agora que você recebeu o segredo e id do Facebook, volte para o arquivo AuthConfig e adicioná-los como os valores de parâmetro.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-169">Now that you have received the id and secret from Facebook, go back to the AuthConfig file and add them as the parameter values.</span></span> <span data-ttu-id="5dcb9-170">Os valores mostrados abaixo não são valores reais.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-170">The values shown below are not real values.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample3.cs)]

## <a name="log-in-with-external-credentials"></a><span data-ttu-id="5dcb9-171">Faça logon com credenciais externas</span><span class="sxs-lookup"><span data-stu-id="5dcb9-171">Log in with external credentials</span></span>

<span data-ttu-id="5dcb9-172">Isso é tudo o que você precisa fazer para habilitar credenciais externas no seu site.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-172">That is all you have to do to enable external credentials in your site.</span></span> <span data-ttu-id="5dcb9-173">Execute seu aplicativo e clique no link de logon no canto superior direito.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-173">Run your application and click the login link in the upper right corner.</span></span> <span data-ttu-id="5dcb9-174">O modelo reconhece automaticamente que você registrou o Facebook como um provedor e inclui um botão para o provedor.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-174">The template automatically recognizes that you have registered Facebook as a provider and includes a button for the provider.</span></span> <span data-ttu-id="5dcb9-175">Se você registrar vários provedores, um botão para cada uma delas é incluído automaticamente.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-175">If you register multiple providers, a button for each one is automatically included.</span></span>

![logon externo](using-oauth-providers-with-mvc/_static/image6.png)

<span data-ttu-id="5dcb9-177">Este tutorial não abrange como personalizar o log em botões para provedores externos.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-177">This tutorial does not cover how to customize the log in buttons for the external providers.</span></span> <span data-ttu-id="5dcb9-178">Para obter essas informações, consulte [Personalizando o interface do usuário de logon ao usar OAuth/OpenID](https://blogs.msdn.com/b/pranav_rastogi/archive/2012/08/24/customizing-the-login-ui-when-using-oauth-openid.aspx).</span><span class="sxs-lookup"><span data-stu-id="5dcb9-178">For that information, see [Customizing the login UI when using OAuth/OpenID](https://blogs.msdn.com/b/pranav_rastogi/archive/2012/08/24/customizing-the-login-ui-when-using-oauth-openid.aspx).</span></span>

<span data-ttu-id="5dcb9-179">Clique no botão Facebook para fazer logon com as credenciais do Facebook.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-179">Click on the Facebook button to log in with Facebook credentials.</span></span> <span data-ttu-id="5dcb9-180">Quando você seleciona um dos provedores externos, você é redirecionado para o site e solicitado por esse serviço a fazer logon.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-180">When you select one of the external providers, you are redirected to that site and prompted by that service to log in.</span></span>

<span data-ttu-id="5dcb9-181">A imagem a seguir mostra a tela de logon do Facebook.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-181">The following image shows the login screen for Facebook.</span></span> <span data-ttu-id="5dcb9-182">Ele observa que você estiver usando sua conta do Facebook para fazer logon em um site chamado oauthmvcexample.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-182">It notes that you are using your Facebook account to log in to a site named oauthmvcexample.</span></span>

![autenticação do Facebook](using-oauth-providers-with-mvc/_static/image7.png)

<span data-ttu-id="5dcb9-184">Depois de fazer logon com as credenciais do Facebook, uma página informa ao usuário que o site terá acesso a informações básicas.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-184">After logging in with Facebook credentials, a page informs the user that the site will have access to basic information.</span></span>

![solicitar permissão](using-oauth-providers-with-mvc/_static/image8.png)

<span data-ttu-id="5dcb9-186">Depois de selecionar **ir para o aplicativo**, o usuário deve se registrar para o site.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-186">After selecting **Go to App**, the user must register for the site.</span></span> <span data-ttu-id="5dcb9-187">A imagem a seguir mostra a página de registro depois que um usuário fez logon com as credenciais do Facebook.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-187">The following image shows the registration page after a user has logged in with Facebook credentials.</span></span> <span data-ttu-id="5dcb9-188">O nome de usuário é normalmente previamente preenchido com um nome do provedor.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-188">The user name is typically pre-filled with a name from the provider.</span></span>

![register](using-oauth-providers-with-mvc/_static/image9.png)

<span data-ttu-id="5dcb9-190">Clique em **registrar** para concluir o registro.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-190">Click **Register** to complete registration.</span></span> <span data-ttu-id="5dcb9-191">Feche o navegador.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-191">Close the browser.</span></span>

<span data-ttu-id="5dcb9-192">Você pode ver que a nova conta foi adicionada ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-192">You can see that the new account has been added to your database.</span></span> <span data-ttu-id="5dcb9-193">No Gerenciador de servidores, abra o **DefaultConnection** do banco de dados e abra o **tabelas** pasta.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-193">In Server Explorer, open the **DefaultConnection** database and open the **Tables** folder.</span></span>

![tabelas de banco de dados](using-oauth-providers-with-mvc/_static/image10.png)

<span data-ttu-id="5dcb9-195">Clique com botão direito do **UserProfile** de tabela e selecione **Mostrar dados da tabela**.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-195">Right-click the **UserProfile** table and select **Show Table Data**.</span></span>

![Mostrar dados](using-oauth-providers-with-mvc/_static/image11.png)

<span data-ttu-id="5dcb9-197">Você verá a nova conta que você adicionou.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-197">You will see the new account you added.</span></span> <span data-ttu-id="5dcb9-198">Examinar os dados no **página da Web\_OAuthMembership** tabela.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-198">Look at the data in **webpage\_OAuthMembership** table.</span></span> <span data-ttu-id="5dcb9-199">Você verá mais dados relacionados ao provedor externo para a conta que você acabou de adicionar.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-199">You will see more data related to the external provider for the account you just added.</span></span>

<span data-ttu-id="5dcb9-200">Se você quiser habilitar autenticação externa, você terminar.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-200">If you only want to enable external authentication, you are done.</span></span> <span data-ttu-id="5dcb9-201">No entanto, você pode integrar ainda mais informações do provedor ao novo processo de registro do usuário, conforme mostrado nas seções a seguir.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-201">However, you can further integrate information from the provider into the new user registration process, as shown in the following sections.</span></span>

## <a name="create-models-for-additional-user-information"></a><span data-ttu-id="5dcb9-202">Criar modelos para informações adicionais do usuário</span><span class="sxs-lookup"><span data-stu-id="5dcb9-202">Create models for additional user information</span></span>

<span data-ttu-id="5dcb9-203">Como observado nas seções anteriores, você não precisará recuperar quaisquer informações adicionais para o registro de conta interna trabalhar.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-203">As you noticed in the previous sections, you do not need to retrieve any additional information for the built-in account registration to work.</span></span> <span data-ttu-id="5dcb9-204">No entanto, os provedores externos mais passam informações adicionais sobre o usuário.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-204">However, most external providers pass back additional information about the user.</span></span> <span data-ttu-id="5dcb9-205">As seções a seguir mostram como reter essa informação e salvá-lo em um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-205">The following sections show how to retain that information and save it to a database.</span></span> <span data-ttu-id="5dcb9-206">Especificamente, você manterá os valores para nome completo do usuário, o URI da página de web pessoal do usuário e um valor que indica se o Facebook confirmou a conta.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-206">Specifically, you will retain values for the user's full name, the URI of the user's personal web page, and a value that indicates whether Facebook has verified the account.</span></span>

<span data-ttu-id="5dcb9-207">Você usará [migrações do Code First](https://msdn.microsoft.com/data/jj591621) para adicionar uma tabela para armazenar informações adicionais do usuário.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-207">You will use [Code First Migrations](https://msdn.microsoft.com/data/jj591621) to add a table for storing additional user information.</span></span> <span data-ttu-id="5dcb9-208">Você está adicionando a tabela ao banco de dados existente, portanto, primeiro você precisará criar um instantâneo do banco de dados atual.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-208">You are adding the table to an existing database, so you will first need to create a snapshot of the current database.</span></span> <span data-ttu-id="5dcb9-209">Criando um instantâneo do banco de dados atual, você pode criar posteriormente uma migração que contém somente a nova tabela.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-209">By creating a snapshot of the current database, you can later create a migration that contains only the new table.</span></span> <span data-ttu-id="5dcb9-210">Para criar um instantâneo do banco de dados atual:</span><span class="sxs-lookup"><span data-stu-id="5dcb9-210">To create a snapshot of the current database:</span></span>

1. <span data-ttu-id="5dcb9-211">Abra o **Package Manager Console**</span><span class="sxs-lookup"><span data-stu-id="5dcb9-211">Open the **Package Manager Console**</span></span>
2. <span data-ttu-id="5dcb9-212">Execute o comando **enable-migrations**</span><span class="sxs-lookup"><span data-stu-id="5dcb9-212">Run the command **enable-migrations**</span></span>
3. <span data-ttu-id="5dcb9-213">Execute o comando **adicionar – migração inicial – IgnoreChanges**</span><span class="sxs-lookup"><span data-stu-id="5dcb9-213">Run the command **add-migration initial –IgnoreChanges**</span></span>
4. <span data-ttu-id="5dcb9-214">Execute o comando **Atualizar banco de dados**</span><span class="sxs-lookup"><span data-stu-id="5dcb9-214">Run the command **update-database**</span></span>

<span data-ttu-id="5dcb9-215">Agora, você adicionará as novas propriedades.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-215">Now, you will add the new properties.</span></span> <span data-ttu-id="5dcb9-216">Na pasta modelos, abra o arquivo AccountModels.cs e localizar a classe RegisterExternalLoginModel.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-216">In the Models folder, open the AccountModels.cs file, and find the RegisterExternalLoginModel class.</span></span> <span data-ttu-id="5dcb9-217">A classe RegisterExternalLoginModel contém os valores retornados do provedor de autenticação.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-217">The RegisterExternalLoginModel class holds values that come back from the authentication provider.</span></span> <span data-ttu-id="5dcb9-218">Adicione propriedades chamadas FullName e o Link, como destacado abaixo.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-218">Add properties named FullName and Link, as highlighted below.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample4.cs?highlight=9-13)]

<span data-ttu-id="5dcb9-219">Também no AccountModels.cs, adicione uma nova classe chamada ExtraUserInformation.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-219">Also in AccountModels.cs, add a new class called ExtraUserInformation.</span></span> <span data-ttu-id="5dcb9-220">Essa classe representa a nova tabela que será criada no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-220">This class represents the new table which will be created in the database.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample5.cs)]

<span data-ttu-id="5dcb9-221">Na classe UsersContext, adicione o código realçado abaixo para criar uma propriedade DbSet para a nova classe.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-221">In the UsersContext class, add the highlighted code below to create a DbSet property for the new class.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample6.cs?highlight=9)]

<span data-ttu-id="5dcb9-222">Agora você está pronto para criar uma nova tabela.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-222">You are now ready to create the new table.</span></span> <span data-ttu-id="5dcb9-223">Abra o Console do Gerenciador de pacotes novamente e, desta vez:</span><span class="sxs-lookup"><span data-stu-id="5dcb9-223">Open the Package Manager Console again and this time:</span></span>

1. <span data-ttu-id="5dcb9-224">Execute o comando **AddExtraUserInformation adicionar-migração**</span><span class="sxs-lookup"><span data-stu-id="5dcb9-224">Run the command **add-migration AddExtraUserInformation**</span></span>
2. <span data-ttu-id="5dcb9-225">Execute o comando **Atualizar banco de dados**</span><span class="sxs-lookup"><span data-stu-id="5dcb9-225">Run the command **update-database**</span></span>

<span data-ttu-id="5dcb9-226">Agora existe a nova tabela no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-226">The new table now exists in the database.</span></span>

## <a name="retrieve-the-additional-data"></a><span data-ttu-id="5dcb9-227">Recuperar os dados adicionais</span><span class="sxs-lookup"><span data-stu-id="5dcb9-227">Retrieve the additional data</span></span>

<span data-ttu-id="5dcb9-228">Há duas maneiras de recuperar dados de usuário adicionais.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-228">There are two ways to retrieve additional user data.</span></span> <span data-ttu-id="5dcb9-229">A primeira maneira é manter os dados de usuário que são passados de volta, por padrão, durante a solicitação de autenticação.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-229">The first way is to retain user data that is passed back, by default, during the authentication request.</span></span> <span data-ttu-id="5dcb9-230">A segunda maneira é chamar a API de provedor especificamente e solicitar mais informações.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-230">The second way is to specifically call the provider API and request more information.</span></span> <span data-ttu-id="5dcb9-231">Valores de FullName e Link são passados automaticamente volta pelo Facebook.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-231">Values for FullName and Link are automatically passed back by Facebook.</span></span> <span data-ttu-id="5dcb9-232">Um valor que indica se o Facebook confirmou a conta é recuperado por meio de uma chamada à API do Facebook.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-232">A value that indicates whether Facebook has verified the account is retrieved through a call to the Facebook API.</span></span> <span data-ttu-id="5dcb9-233">Primeiro, você preencherá os valores de FullName e o Link e, em seguida, posteriormente, você obterá o valor verificado.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-233">First, you will populate values for FullName and Link, and then later, you will get the verified value.</span></span>

<span data-ttu-id="5dcb9-234">Para recuperar os dados de usuário adicional, abra o **AccountController.cs** arquivo na **controladores** pasta.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-234">To retrieve the additional user data, open the **AccountController.cs** file in the **Controllers** folder.</span></span>

<span data-ttu-id="5dcb9-235">Esse arquivo contém a lógica para registro em log, registrar e gerenciar contas.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-235">This file contains the logic for logging, registering, and managing accounts.</span></span> <span data-ttu-id="5dcb9-236">Em particular, observe os métodos chamados **ExternalLoginCallback** e **ExternalLoginConfirmation**.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-236">In particular, notice the methods called **ExternalLoginCallback** and **ExternalLoginConfirmation**.</span></span> <span data-ttu-id="5dcb9-237">Dentro desses métodos, você pode adicionar código para personalizar as operações de logon externo para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-237">Within these methods, you can add code to customize external login operations for your application.</span></span> <span data-ttu-id="5dcb9-238">A primeira linha do **ExternalLoginCallback** método contém:</span><span class="sxs-lookup"><span data-stu-id="5dcb9-238">The first line of the **ExternalLoginCallback** method contains:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample7.cs)]

<span data-ttu-id="5dcb9-239">Dados adicionais do usuário são repassados na **ExtraData** propriedade do **AuthenticationResult** objeto que é retornado o **VerifyAuthentication** método.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-239">Additional user data is passed back in the **ExtraData** property of the **AuthenticationResult** object that is returned from the **VerifyAuthentication** method.</span></span> <span data-ttu-id="5dcb9-240">O cliente do Facebook contém os seguintes valores na **ExtraData** propriedade:</span><span class="sxs-lookup"><span data-stu-id="5dcb9-240">The Facebook client contains the following values in the **ExtraData** property:</span></span>

- <span data-ttu-id="5dcb9-241">id</span><span class="sxs-lookup"><span data-stu-id="5dcb9-241">id</span></span>
- <span data-ttu-id="5dcb9-242">name</span><span class="sxs-lookup"><span data-stu-id="5dcb9-242">name</span></span>
- <span data-ttu-id="5dcb9-243">link</span><span class="sxs-lookup"><span data-stu-id="5dcb9-243">link</span></span>
- <span data-ttu-id="5dcb9-244">sexo</span><span class="sxs-lookup"><span data-stu-id="5dcb9-244">gender</span></span>
- <span data-ttu-id="5dcb9-245">accesstoken</span><span class="sxs-lookup"><span data-stu-id="5dcb9-245">accesstoken</span></span>

<span data-ttu-id="5dcb9-246">Outros provedores terá dados semelhantes, mas ligeiramente diferentes na propriedade ExtraData.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-246">Other providers will have similar but slightly different data in the ExtraData property.</span></span>

<span data-ttu-id="5dcb9-247">Se o usuário é novo no seu site, você recuperar alguns dados adicionais e passá-los para o modo de exibição de confirmação.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-247">If the user is new to your site, you will retrieve some the additional data and pass that data to the confirmation view.</span></span> <span data-ttu-id="5dcb9-248">O último bloco de código no método é executado somente se o usuário é novo no seu site.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-248">The last block of code in the method is run only if the user is new to your site.</span></span> <span data-ttu-id="5dcb9-249">Substitua a linha a seguir:</span><span class="sxs-lookup"><span data-stu-id="5dcb9-249">Replace the following line:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample8.cs)]

<span data-ttu-id="5dcb9-250">Com esta linha:</span><span class="sxs-lookup"><span data-stu-id="5dcb9-250">With this line:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample9.cs)]

<span data-ttu-id="5dcb9-251">Essa alteração simplesmente inclui valores para as propriedades de FullName e Link.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-251">This change merely includes values for the FullName and Link properties.</span></span>

<span data-ttu-id="5dcb9-252">No **ExternalLoginConfirmation** método, modifique o código conforme realçado abaixo para salvar as informações de usuário adicionais.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-252">In the **ExternalLoginConfirmation** method, modify the code as highlighted below to save the additional user information.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample10.cs?highlight=4,7-13)]

## <a name="adjusting-the-view"></a><span data-ttu-id="5dcb9-253">Ajustando o modo de exibição</span><span class="sxs-lookup"><span data-stu-id="5dcb9-253">Adjusting the view</span></span>

<span data-ttu-id="5dcb9-254">Os dados de usuário adicionais que podem ser recuperadas do provedor aparecerão na página de registro.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-254">The additional user data that you retrieve from the provider will be displayed in the registration page.</span></span>

<span data-ttu-id="5dcb9-255">No **modos de exibição**/**conta** pasta, abra **ExternalLoginConfirmation.cshtml**.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-255">In the **Views**/**Account** folder, open **ExternalLoginConfirmation.cshtml**.</span></span> <span data-ttu-id="5dcb9-256">Abaixo do campo existente para o nome de usuário, adicione campos para FullName, Link e PictureLink.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-256">Below the existing field for user name, add fields for FullName, Link, and PictureLink.</span></span>

[!code-cshtml[Main](using-oauth-providers-with-mvc/samples/sample11.cshtml)]

<span data-ttu-id="5dcb9-257">Agora você está quase pronto para executar o aplicativo e registrar um novo usuário com as informações adicionais salvas.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-257">You are now almost ready to run the application and register a new user with the additional information saved.</span></span> <span data-ttu-id="5dcb9-258">Você deve ter uma conta que já não está registrada com o site.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-258">You must have an account that is not already registered with the site.</span></span> <span data-ttu-id="5dcb9-259">Você pode usar uma conta de teste diferente ou exclui as linhas as **UserProfile** e **páginas da Web\_OAuthMembership** tabelas para a conta que você deseja reutilizar.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-259">You can either use a different test account, or delete the rows in the **UserProfile** and **webpages\_OAuthMembership** tables for the account you wish to reuse.</span></span> <span data-ttu-id="5dcb9-260">Excluindo as linhas, você terá de garantir que a conta está registrada novamente.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-260">By deleting those rows, you will ensure that the account is registered again.</span></span>

<span data-ttu-id="5dcb9-261">Execute o aplicativo e registrar o novo usuário.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-261">Run the application and register the new user.</span></span> <span data-ttu-id="5dcb9-262">Observe que dessa vez a página de confirmação contém mais valores.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-262">Notice that this time the confirmation page contains more values.</span></span>

![register](using-oauth-providers-with-mvc/_static/image12.png)

<span data-ttu-id="5dcb9-264">Depois de concluir o registro, feche o navegador.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-264">After completing registration, close the browser.</span></span> <span data-ttu-id="5dcb9-265">Examinar o banco de dados, observe os novos valores na **ExtraUserInformation** tabela.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-265">Look in the database to notice the new values in the **ExtraUserInformation** table.</span></span>

## <a name="install-nuget-package-for-facebook-api"></a><span data-ttu-id="5dcb9-266">Instalar o pacote do NuGet para a API do Facebook</span><span class="sxs-lookup"><span data-stu-id="5dcb9-266">Install NuGet package for Facebook API</span></span>

<span data-ttu-id="5dcb9-267">O Facebook fornece um [API](https://developers.facebook.com/docs/reference/apis/) que você pode chamar para executar operações.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-267">Facebook provides an [API](https://developers.facebook.com/docs/reference/apis/) that you can call to perform operations.</span></span> <span data-ttu-id="5dcb9-268">Você pode chamar a API do Facebook, direcionando a enviar solicitações HTTP ou usando a instalação de um pacote do NuGet que facilita o envio dessas solicitações.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-268">You can call the Facebook API either by directing sending HTTP requests, or by using installing a NuGet package that facilitates sending those requests.</span></span> <span data-ttu-id="5dcb9-269">Usar um pacote do NuGet é mostrado neste tutorial, mas instalar o NuGet pacote não é essencial.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-269">Using a NuGet package is shown in this tutorial, but installing NuGet package is not essential.</span></span> <span data-ttu-id="5dcb9-270">Este tutorial mostra como usar o pacote C# SDK do Facebook.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-270">This tutorial shows how to use the Facebook C# SDK package.</span></span> <span data-ttu-id="5dcb9-271">Há outros pacotes do NuGet que ajudam com a chamada da API do Facebook.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-271">There are other NuGet packages that assist with calling the Facebook API.</span></span>

<span data-ttu-id="5dcb9-272">Dos **gerenciar pacotes NuGet** windows, selecione o pacote C# SDK do Facebook.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-272">From the **Manage NuGet Packages** windows, select the Facebook C# SDK package.</span></span>

![Instalar pacote](using-oauth-providers-with-mvc/_static/image13.png)

<span data-ttu-id="5dcb9-274">Você usará o SDK do Facebook C# para chamar uma operação que exige o token de acesso do usuário.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-274">You will use the Facebook C# SDK to call an operation that requires the access token for the user.</span></span> <span data-ttu-id="5dcb9-275">A próxima seção mostra como obter o token de acesso.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-275">The next section shows how to get the access token.</span></span>

## <a name="retrieve-access-token"></a><span data-ttu-id="5dcb9-276">Recuperar o token de acesso</span><span class="sxs-lookup"><span data-stu-id="5dcb9-276">Retrieve access token</span></span>

<span data-ttu-id="5dcb9-277">Provedores externos mais passam de volta um token de acesso depois que as credenciais do usuário são verificadas.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-277">Most external providers pass back an access token after the user's credentials are verified.</span></span> <span data-ttu-id="5dcb9-278">Esse token de acesso é muito importante porque permite que você chame as operações que estão disponíveis somente para usuários autenticados.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-278">This access token is very important because it enables you to call operations that are only available to authenticated users.</span></span> <span data-ttu-id="5dcb9-279">Portanto, recuperar e armazenar o token de acesso é essencial quando você deseja fornecer mais funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-279">Therefore, retrieving and storing the access token is essential when you want to provide more functionality.</span></span>

<span data-ttu-id="5dcb9-280">Dependendo do provedor externo, o token de acesso pode ser válido para apenas uma quantidade limitada de tempo.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-280">Depending on the external provider, the access token may be valid for only a limited amount of time.</span></span> <span data-ttu-id="5dcb9-281">Para garantir que você tenha um token de acesso válido, você irá recuperá-lo sempre que o usuário fizer logon e armazená-lo como um valor de sessão em vez de salvá-lo em um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-281">To ensure that you have a valid access token, you will retrieve it each time the user logs in, and store it as a session value rather than save it to a database.</span></span>

<span data-ttu-id="5dcb9-282">No **ExternalLoginCallback** método, o token de acesso também é repassado na **ExtraData** propriedade do **AuthenticationResult** objeto.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-282">In the **ExternalLoginCallback** method, the access token is also passed back in the **ExtraData** property of the **AuthenticationResult** object.</span></span> <span data-ttu-id="5dcb9-283">Adicione o código realçado ao **ExternalLoginCallback** para salvar o token de acesso na **sessão** objeto.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-283">Add the highlighted code to **ExternalLoginCallback** to save the access token in the **Session** object.</span></span> <span data-ttu-id="5dcb9-284">Esse código é executado sempre que o usuário faz logon com uma conta do Facebook.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-284">This code is run every time the user logs in with a Facebook account.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample12.cs?highlight=11-14)]

<span data-ttu-id="5dcb9-285">Embora este exemplo recupera um token de acesso do Facebook, você pode recuperar o token de acesso de qualquer provedor externo por meio da mesma chave nomeada &quot;accesstoken&quot;.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-285">Although this example retrieves an access token from Facebook, you can retrieve the access token from any external provider through the same key named &quot;accesstoken&quot;.</span></span>

## <a name="logging-off"></a><span data-ttu-id="5dcb9-286">Logoff</span><span class="sxs-lookup"><span data-stu-id="5dcb9-286">Logging off</span></span>

<span data-ttu-id="5dcb9-287">O padrão **LogOff** método registra o usuário do seu aplicativo, mas não registra o usuário do provedor externo.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-287">The default **LogOff** method logs the user out of your application, but does not log the user out of the external provider.</span></span> <span data-ttu-id="5dcb9-288">Para fazer logon do usuário do Facebook e impedir que o token de persistência depois que o usuário fez logoff, você pode adicionar o seguinte código realçado para o **LogOff** método no controlador.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-288">To log the user out of Facebook, and prevent the token from persisting after the user has logged off, you can add the following highlighted code to the **LogOff** method in the AccountController.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample13.cs?highlight=6-14)]

<span data-ttu-id="5dcb9-289">O valor que você fornece no `next` parâmetro é a URL a ser usada depois que o usuário tiver feito fora do Facebook.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-289">The value you provide in the `next` parameter is the URL to use after the user has logged out of Facebook.</span></span> <span data-ttu-id="5dcb9-290">Durante o teste no computador local, você forneceria o número de porta correto para seu site local.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-290">When testing on your local computer, you would provide the correct port number for your local site.</span></span> <span data-ttu-id="5dcb9-291">Em produção, você forneceria uma página padrão, como contoso.com.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-291">In production, you would provide a default page, such as contoso.com.</span></span>

## <a name="retrieve-user-information-that-requires-the-access-token"></a><span data-ttu-id="5dcb9-292">Recuperar informações do usuário que requer o token de acesso</span><span class="sxs-lookup"><span data-stu-id="5dcb9-292">Retrieve user information that requires the access token</span></span>

<span data-ttu-id="5dcb9-293">Agora que você tiver armazenado o token de acesso e o pacote do Facebook C# SDK instalado, você pode usá-los juntos para solicitar informações adicionais do usuário do Facebook.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-293">Now that you have stored the access token and installed the Facebook C# SDK package, you can use them together to request additional user information from Facebook.</span></span> <span data-ttu-id="5dcb9-294">No **ExternalLoginConfirmation** método, crie uma instância das **FacebookClient** classe, passando o valor do token de acesso.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-294">In the **ExternalLoginConfirmation** method, create an instance of the **FacebookClient** class by passing the value of the access token.</span></span> <span data-ttu-id="5dcb9-295">O valor de solicitação a **verificado** propriedade para o usuário atual autenticado.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-295">Request the value of the **verified** property for the current, authenticated user.</span></span> <span data-ttu-id="5dcb9-296">O **verificado** propriedade indica se o Facebook validou a conta por outros meios, como enviar uma mensagem para um telefone celular.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-296">The **verified** property indicates whether Facebook has validated the account through some other means, such as sending a message to a cell phone.</span></span> <span data-ttu-id="5dcb9-297">Salve esse valor no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-297">Save this value in the database.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample14.cs?highlight=7-18,25)]

<span data-ttu-id="5dcb9-298">Novamente, você precisará excluir os registros no banco de dados para o usuário, ou usar uma conta diferente do Facebook.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-298">You will again need to either delete the records in the database for the user, or use a different Facebook account.</span></span>

<span data-ttu-id="5dcb9-299">Execute o aplicativo e registrar o novo usuário.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-299">Run the application, and register the new user.</span></span> <span data-ttu-id="5dcb9-300">Examine os **ExtraUserInformation** tabela para ver o valor da propriedade verificado.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-300">Look at the **ExtraUserInformation** table to see the value for the Verified property.</span></span>

## <a name="conclusion"></a><span data-ttu-id="5dcb9-301">Conclusão</span><span class="sxs-lookup"><span data-stu-id="5dcb9-301">Conclusion</span></span>

<span data-ttu-id="5dcb9-302">Neste tutorial, você criou um site que esteja integrado com o Facebook para autenticação de usuário e dados de registro.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-302">In this tutorial, you created a site that is integrated with Facebook for user authentication and registration data.</span></span> <span data-ttu-id="5dcb9-303">Você aprendeu sobre o comportamento padrão que é configurado para o aplicativo web MVC 4 e como personalizar o comportamento padrão.</span><span class="sxs-lookup"><span data-stu-id="5dcb9-303">You learned about the default behavior that is set up for MVC 4 web application, and how to customize that default behavior.</span></span>

## <a name="related-topics"></a><span data-ttu-id="5dcb9-304">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="5dcb9-304">Related topics</span></span>

- [<span data-ttu-id="5dcb9-305">Criar um aplicativo ASP.NET MVC com autenticação e o banco de dados SQL e implantar no serviço de aplicativo do Azure</span><span class="sxs-lookup"><span data-stu-id="5dcb9-305">Create an ASP.NET MVC app with auth and SQL DB and deploy to Azure App Service</span></span>](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data)
