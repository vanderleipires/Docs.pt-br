---
uid: mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
title: 'Iteração #5 – criar testes de unidade (c#) | Microsoft Docs'
author: microsoft
description: Na quinta iteração, podemos tornar nosso aplicativo mais fácil de manter e modificar adicionando testes de unidade. Vamos simular a nossas classes de modelo de dados e criar testes de unidade para o...
ms.author: riande
ms.date: 02/20/2009
ms.assetid: 28ad8f80-b8a5-444e-b478-8b15a846060c
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
msc.type: authoredcontent
ms.openlocfilehash: 68d0ae15db115685b3e1a44f8b3b5b7e33674a8b
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/16/2018
ms.locfileid: "41834094"
---
<a name="iteration-5--create-unit-tests-c"></a><span data-ttu-id="e5616-104">Iteração #5 – criar testes de unidade (c#)</span><span class="sxs-lookup"><span data-stu-id="e5616-104">Iteration #5 – Create unit tests (C#)</span></span>
====================
<span data-ttu-id="e5616-105">por [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="e5616-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="e5616-106">Baixar o código</span><span class="sxs-lookup"><span data-stu-id="e5616-106">Download Code</span></span>](iteration-5-create-unit-tests-cs/_static/contactmanager_5_cs1.zip)

> <span data-ttu-id="e5616-107">Na quinta iteração, podemos tornar nosso aplicativo mais fácil de manter e modificar adicionando testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="e5616-107">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="e5616-108">Vamos simular a nossas classes de modelo de dados e criar testes de unidade para nossos controladores e lógica de validação.</span><span class="sxs-lookup"><span data-stu-id="e5616-108">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>


## <a name="building-a-contact-management-aspnet-mvc-application-c"></a><span data-ttu-id="e5616-109">Criando um aplicativo ASP.NET MVC de gerenciamento de contatos (c#)</span><span class="sxs-lookup"><span data-stu-id="e5616-109">Building a Contact Management ASP.NET MVC Application (C#)</span></span>

<span data-ttu-id="e5616-110">Esta série de tutoriais, vamos criar um aplicativo de gerenciamento de contatos inteiro do início ao fim.</span><span class="sxs-lookup"><span data-stu-id="e5616-110">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="e5616-111">O aplicativo Gerenciador de contatos permite que você armazene informações de contato - nomes, números de telefone e endereços de email - para obter uma lista de pessoas.</span><span class="sxs-lookup"><span data-stu-id="e5616-111">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="e5616-112">Criamos o aplicativo ao longo de várias iterações.</span><span class="sxs-lookup"><span data-stu-id="e5616-112">We build the application over multiple iterations.</span></span> <span data-ttu-id="e5616-113">Com cada iteração, podemos melhorar gradualmente o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e5616-113">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="e5616-114">A meta dessa abordagem de iteração vários é que você possa entender o motivo para cada alteração.</span><span class="sxs-lookup"><span data-stu-id="e5616-114">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="e5616-115">Iteração #1 - criar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e5616-115">Iteration #1 - Create the application.</span></span> <span data-ttu-id="e5616-116">A primeira iteração, podemos criar o Gerenciador de contatos da maneira mais simples possível.</span><span class="sxs-lookup"><span data-stu-id="e5616-116">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="e5616-117">Adicionamos suporte para operações de banco de dados básico: criar, ler, atualizar e excluir (CRUD).</span><span class="sxs-lookup"><span data-stu-id="e5616-117">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="e5616-118">Iteração #2 - tornar o aplicativo interessante.</span><span class="sxs-lookup"><span data-stu-id="e5616-118">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="e5616-119">Nesta iteração, podemos melhorar a aparência do aplicativo modificando a página mestra do ASP.NET MVC exibição padrão e em cascata de folha de estilos.</span><span class="sxs-lookup"><span data-stu-id="e5616-119">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="e5616-120">Iteração #3 - adicionar validação de formulário.</span><span class="sxs-lookup"><span data-stu-id="e5616-120">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="e5616-121">Na terceira iteração, podemos adicionar validação de formulário básico.</span><span class="sxs-lookup"><span data-stu-id="e5616-121">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="e5616-122">Podemos impedir que pessoas enviando um formulário sem preencher os campos obrigatórios do formulário.</span><span class="sxs-lookup"><span data-stu-id="e5616-122">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="e5616-123">Podemos também validar endereços de email e números de telefone.</span><span class="sxs-lookup"><span data-stu-id="e5616-123">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="e5616-124">Iteração #4 – tornar o aplicativo fracamente acoplado.</span><span class="sxs-lookup"><span data-stu-id="e5616-124">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="e5616-125">Nesta quarta iteração, podemos tirar proveito dos diversos padrões de design de software para facilitar a manutenção e modificar o aplicativo Gerenciador de contatos.</span><span class="sxs-lookup"><span data-stu-id="e5616-125">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="e5616-126">Por exemplo, podemos refatorar nosso aplicativo para usar o padrão de repositório e o padrão de injeção de dependência.</span><span class="sxs-lookup"><span data-stu-id="e5616-126">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="e5616-127">Iteração #5 - criar testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="e5616-127">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="e5616-128">Na quinta iteração, podemos tornar nosso aplicativo mais fácil de manter e modificar adicionando testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="e5616-128">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="e5616-129">Vamos simular a nossas classes de modelo de dados e criar testes de unidade para nossos controladores e lógica de validação.</span><span class="sxs-lookup"><span data-stu-id="e5616-129">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="e5616-130">Iteração #6 – usar desenvolvimento controlado por teste.</span><span class="sxs-lookup"><span data-stu-id="e5616-130">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="e5616-131">Essa iteração sexta, adicionamos novas funcionalidades ao nosso aplicativo escrevendo testes de unidade pela primeira vez e escrever código contra os testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="e5616-131">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="e5616-132">Essa iteração, adicionamos os grupos de contatos.</span><span class="sxs-lookup"><span data-stu-id="e5616-132">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="e5616-133">Iteração #7 - adicionar a funcionalidade do Ajax.</span><span class="sxs-lookup"><span data-stu-id="e5616-133">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="e5616-134">A sétima iteração, podemos melhorar a capacidade de resposta e o desempenho do nosso aplicativo, adicionando suporte para Ajax.</span><span class="sxs-lookup"><span data-stu-id="e5616-134">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>


## <a name="this-iteration"></a><span data-ttu-id="e5616-135">Essa iteração</span><span class="sxs-lookup"><span data-stu-id="e5616-135">This Iteration</span></span>

<span data-ttu-id="e5616-136">Na iteração anterior do aplicativo Contact Manager, podemos refatorar o aplicativo para ser acoplamento mais flexível.</span><span class="sxs-lookup"><span data-stu-id="e5616-136">In the previous iteration of the Contact Manager application, we refactored the application to be more loosely coupled.</span></span> <span data-ttu-id="e5616-137">Separamos o aplicativo em controlador distinto, serviço e camadas de repositório.</span><span class="sxs-lookup"><span data-stu-id="e5616-137">We separated the application into distinct controller, service, and repository layers.</span></span> <span data-ttu-id="e5616-138">Cada camada interage com a camada abaixo dela, por meio de interfaces.</span><span class="sxs-lookup"><span data-stu-id="e5616-138">Each layer interacts with the layer beneath it through interfaces.</span></span>

<span data-ttu-id="e5616-139">Podemos refatorar o aplicativo para tornar o aplicativo mais fácil de manter e modificar.</span><span class="sxs-lookup"><span data-stu-id="e5616-139">We refactored the application to make the application easier to maintain and modify.</span></span> <span data-ttu-id="e5616-140">Por exemplo, se é necessário usar uma nova tecnologia de acesso de dados, podemos simplesmente alterar a camada de repositório sem tocar o controlador ou a camada de serviço.</span><span class="sxs-lookup"><span data-stu-id="e5616-140">For example, if we need to use a new data access technology, we can simply change the repository layer without touching the controller or service layer.</span></span> <span data-ttu-id="e5616-141">Fazendo o Gerenciador de contatos acoplamento menos rígido, podemos ve tornei o aplicativo mais resiliente a alterar.</span><span class="sxs-lookup"><span data-stu-id="e5616-141">By making the Contact Manager loosely coupled, we ve made the application more resilient to change.</span></span>

<span data-ttu-id="e5616-142">Mas, o que acontece quando precisamos adicionar um novo recurso para o aplicativo Contact Manager?</span><span class="sxs-lookup"><span data-stu-id="e5616-142">But, what happens when we need to add a new feature to the Contact Manager application?</span></span> <span data-ttu-id="e5616-143">Ou então, o que acontece quando podemos corrigir um bug?</span><span class="sxs-lookup"><span data-stu-id="e5616-143">Or, what happens when we fix a bug?</span></span> <span data-ttu-id="e5616-144">Uma verdade triste, mas também comprovada de escrever código é que, sempre que você tocar o código que você cria o risco de introduzir novos bugs.</span><span class="sxs-lookup"><span data-stu-id="e5616-144">A sad, but well proven, truth of writing code is that whenever you touch code you create the risk of introducing new bugs.</span></span>

<span data-ttu-id="e5616-145">Por exemplo, um dia BOM, seu gerente pode solicitar que você adicionar um novo recurso ao Gerenciador de contatos.</span><span class="sxs-lookup"><span data-stu-id="e5616-145">For example, one fine day, your manager might ask you to add a new feature to the Contact Manager.</span></span> <span data-ttu-id="e5616-146">Ela quer que você adicionar suporte para grupos de contatos.</span><span class="sxs-lookup"><span data-stu-id="e5616-146">She wants you to add support for Contact Groups.</span></span> <span data-ttu-id="e5616-147">Ela quer que você permitir que os usuários organizar seus contatos em grupos como amigos, negócios e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="e5616-147">She wants you to enable users to organize their contacts into groups such as Friends, Business, and so on.</span></span>

<span data-ttu-id="e5616-148">Para implementar esse novo recurso, você precisará modificar todas as três camadas do aplicativo Gerenciador de contatos.</span><span class="sxs-lookup"><span data-stu-id="e5616-148">In order to implement this new feature, you'll need to modify all three layers of the Contact Manager application.</span></span> <span data-ttu-id="e5616-149">Você precisará adicionar uma nova funcionalidade para os controladores, a camada de serviço e o repositório.</span><span class="sxs-lookup"><span data-stu-id="e5616-149">You'll need to add new functionality to the controllers, the service layer, and the repository.</span></span> <span data-ttu-id="e5616-150">Assim que você comece a modificar o código, você corre o risco de interromper a funcionalidade que funcionavam antes.</span><span class="sxs-lookup"><span data-stu-id="e5616-150">As soon as you start modifying code, you risk breaking functionality that worked before.</span></span>

<span data-ttu-id="e5616-151">Refatoração de nosso aplicativo em camadas separadas, como fizemos na iteração anterior, era uma coisa boa.</span><span class="sxs-lookup"><span data-stu-id="e5616-151">Refactoring our application into separate layers, as we did in the previous iteration, was a good thing.</span></span> <span data-ttu-id="e5616-152">Era uma coisa boa porque ela nos permite fazer alterações em camadas inteiras sem tocar no resto do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e5616-152">It was a good thing because it enables us to make changes to entire layers without touching the rest of the application.</span></span> <span data-ttu-id="e5616-153">No entanto, se você quiser facilitar a manutenção e modificar o código dentro de uma camada, você precisará criar testes de unidade para o código.</span><span class="sxs-lookup"><span data-stu-id="e5616-153">However, if you want to make the code within a layer easier to maintain and modify, you need to create unit tests for the code.</span></span>

<span data-ttu-id="e5616-154">Você use uma unidade de teste para testar uma unidade de código individual.</span><span class="sxs-lookup"><span data-stu-id="e5616-154">You use a unit test to test an individual unit of code.</span></span> <span data-ttu-id="e5616-155">Essas unidades de código são menores do que as camadas de aplicativo inteiro.</span><span class="sxs-lookup"><span data-stu-id="e5616-155">These units of code are smaller than entire application layers.</span></span> <span data-ttu-id="e5616-156">Normalmente, você deve usar um teste de unidade para verificar se um método específico em seu código se comporta da maneira que você espera.</span><span class="sxs-lookup"><span data-stu-id="e5616-156">Typically, you use a unit test to verify whether a particular method in your code behaves in the way that you expect.</span></span> <span data-ttu-id="e5616-157">Por exemplo, você criaria um teste de unidade para o método CreateContact() exposto pela classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="e5616-157">For example, you would create a unit test for the CreateContact() method exposed by the ContactManagerService class.</span></span>

<span data-ttu-id="e5616-158">Os testes de unidade para um trabalho de aplicativo apenas como uma rede de segurança.</span><span class="sxs-lookup"><span data-stu-id="e5616-158">The unit tests for an application work just like a safety net.</span></span> <span data-ttu-id="e5616-159">Sempre que modificar o código em um aplicativo, você pode executar um conjunto de testes de unidade para verificar se a modificação interrompe a funcionalidade existente.</span><span class="sxs-lookup"><span data-stu-id="e5616-159">Whenever you modify code in an application, you can run a set of unit tests to check whether the modification breaks existing functionality.</span></span> <span data-ttu-id="e5616-160">Testes de unidade tornam seu código seguro modificar.</span><span class="sxs-lookup"><span data-stu-id="e5616-160">Unit tests make your code safe to modify.</span></span> <span data-ttu-id="e5616-161">Testes de unidade fazer todo o código em seu aplicativo mais resiliente a alterar.</span><span class="sxs-lookup"><span data-stu-id="e5616-161">Unit tests make all of the code in your application more resilient to change.</span></span>

<span data-ttu-id="e5616-162">Essa iteração, adicionamos testes de unidade para nosso aplicativo Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="e5616-162">In this iteration, we add unit tests to our Contact Manager application.</span></span> <span data-ttu-id="e5616-163">Dessa forma, na próxima iteração, podemos adicionar grupos de contato para o nosso aplicativo sem se preocupar sobre como interromper a funcionalidade existente.</span><span class="sxs-lookup"><span data-stu-id="e5616-163">That way, in the next iteration, we can add Contact Groups to our application without worrying about breaking existing functionality.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="e5616-164">Há uma variedade de estruturas, incluindo o MbUnit, xUnit.net e NUnit de teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="e5616-164">There are a variety of unit testing frameworks including NUnit, xUnit.net, and MbUnit.</span></span> <span data-ttu-id="e5616-165">Neste tutorial, usamos o unit testing framework incluído com o Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="e5616-165">In this tutorial, we use the unit testing framework included with Visual Studio.</span></span> <span data-ttu-id="e5616-166">No entanto, você pode facilmente usar uma dessas estruturas alternativas.</span><span class="sxs-lookup"><span data-stu-id="e5616-166">However, you could just as easily use one of these alternative frameworks.</span></span>


## <a name="what-gets-tested"></a><span data-ttu-id="e5616-167">O que é testado</span><span class="sxs-lookup"><span data-stu-id="e5616-167">What Gets Tested</span></span>

<span data-ttu-id="e5616-168">No mundo perfeito, todo o código deve ser coberto por testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="e5616-168">In the perfect world, all of your code would be covered by unit tests.</span></span> <span data-ttu-id="e5616-169">No mundo perfeito, você teria de rede perfeita de segurança.</span><span class="sxs-lookup"><span data-stu-id="e5616-169">In the perfect world, you would have the perfect safety net.</span></span> <span data-ttu-id="e5616-170">Você seria capaz de modificar qualquer linha de código em seu aplicativo e saiba instantaneamente, executando os testes de unidade, se a alteração interrompeu a funcionalidade existente.</span><span class="sxs-lookup"><span data-stu-id="e5616-170">You would be able to modify any line of code in your application and know instantly, by executing your unit tests, whether the change broke existing functionality.</span></span>

<span data-ttu-id="e5616-171">No entanto, podemos don t ao vivo em um mundo perfeito.</span><span class="sxs-lookup"><span data-stu-id="e5616-171">However, we don t live in a perfect world.</span></span> <span data-ttu-id="e5616-172">Na prática, ao escrever testes de unidade, você se concentrar em escrever testes para sua lógica de negócios (por exemplo, a lógica de validação).</span><span class="sxs-lookup"><span data-stu-id="e5616-172">In practice, when writing unit tests, you concentrate on writing tests for your business logic (for example, validation logic).</span></span> <span data-ttu-id="e5616-173">Em particular, você *não* escrever testes de unidade para seus dados de acesso lógico ou sua lógica de exibição.</span><span class="sxs-lookup"><span data-stu-id="e5616-173">In particular, you *do not* write unit tests for your data access logic or your view logic.</span></span>

<span data-ttu-id="e5616-174">Para ser útil, testes de unidade devem ser executadas muito rapidamente.</span><span class="sxs-lookup"><span data-stu-id="e5616-174">To be useful, unit tests must execute very quickly.</span></span> <span data-ttu-id="e5616-175">Você facilmente pode acumular centenas (ou até mesmo milhares) de testes de unidade para um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e5616-175">You easily can accumulate hundreds (or even thousands) of unit tests for an application.</span></span> <span data-ttu-id="e5616-176">Se os testes de unidade demoram muito para ser executado, você evitará a executá-los.</span><span class="sxs-lookup"><span data-stu-id="e5616-176">If the unit tests take a long time to run then you'll avoid executing them.</span></span> <span data-ttu-id="e5616-177">Em outras palavras, testes de unidade de longa execução são inúteis para propósitos de codificação do dia a dia.</span><span class="sxs-lookup"><span data-stu-id="e5616-177">In other words, long running unit tests are useless for day to day coding purposes.</span></span>

<span data-ttu-id="e5616-178">Por esse motivo, você normalmente não escrever testes de unidade para código que interage com um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e5616-178">For this reason, you typically do not write unit tests for code that interacts with a database.</span></span> <span data-ttu-id="e5616-179">Execução de centenas de testes de unidade em relação a um banco de dados ao vivo seria muito lento.</span><span class="sxs-lookup"><span data-stu-id="e5616-179">Running hundreds of unit tests against a live database would be too slow.</span></span> <span data-ttu-id="e5616-180">Em vez disso, você pode simular seu banco de dados e escreve código que interage com o banco de dados fictício (discutiremos a simulação de um banco de dados abaixo).</span><span class="sxs-lookup"><span data-stu-id="e5616-180">Instead, you mock your database and write code that interacts with the mock database (we discuss mocking a database below).</span></span>

<span data-ttu-id="e5616-181">Pelo mesmo motivo, você normalmente não escrever testes de unidade para modos de exibição.</span><span class="sxs-lookup"><span data-stu-id="e5616-181">For a similar reason, you typically do not write unit tests for views.</span></span> <span data-ttu-id="e5616-182">Para testar um modo de exibição, você deve criar um servidor web.</span><span class="sxs-lookup"><span data-stu-id="e5616-182">In order to test a view, you must spin up a web server.</span></span> <span data-ttu-id="e5616-183">Como bagunçar um servidor web é um processo relativamente lento, não é recomendável criar testes de unidade para seus modos de exibição.</span><span class="sxs-lookup"><span data-stu-id="e5616-183">Because spinning up a web server is a relatively slow process, creating unit tests for your views is not recommended.</span></span>

<span data-ttu-id="e5616-184">Se o modo de exibição contiver a lógica complicada, em seguida, considere mover a lógica para métodos auxiliares.</span><span class="sxs-lookup"><span data-stu-id="e5616-184">If your view contains complicated logic then you should consider moving the logic into Helper methods.</span></span> <span data-ttu-id="e5616-185">Você pode escrever testes de unidade para métodos auxiliares que execute sem bagunçar um servidor web.</span><span class="sxs-lookup"><span data-stu-id="e5616-185">You can write unit tests for Helper methods that execute without spinning up a web server.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="e5616-186">Embora escrever testes para lógica de acesso a dados ou lógica de exibição não é uma boa ideia ao escrever testes de unidade, esses testes podem ser muito valiosos quando os testes de integração ou construção funcional.</span><span class="sxs-lookup"><span data-stu-id="e5616-186">While writing tests for data access logic or view logic is not a good idea when writing unit tests, these tests can be very valuable when building functional or integration tests.</span></span>


> [!NOTE] 
> 
> <span data-ttu-id="e5616-187">ASP.NET MVC é o mecanismo de exibição de formulários da Web.</span><span class="sxs-lookup"><span data-stu-id="e5616-187">ASP.NET MVC is the Web Forms View Engine.</span></span> <span data-ttu-id="e5616-188">Enquanto o mecanismo de exibição de formulários da Web é dependente de um servidor web, outros mecanismos de exibição podem não ser.</span><span class="sxs-lookup"><span data-stu-id="e5616-188">While the Web Forms View Engine is dependent on a web server, other view engines might not be.</span></span>


## <a name="using-a-mock-object-framework"></a><span data-ttu-id="e5616-189">Usando uma estrutura de objeto</span><span class="sxs-lookup"><span data-stu-id="e5616-189">Using a Mock Object Framework</span></span>

<span data-ttu-id="e5616-190">Ao criar testes de unidade, quase sempre você precisa tirar proveito de uma estrutura de objetos fictícios.</span><span class="sxs-lookup"><span data-stu-id="e5616-190">When building unit tests, you almost always need to take advantage of a Mock Object framework.</span></span> <span data-ttu-id="e5616-191">Uma estrutura de simulação de objetos permite que você crie simulações e stubs para as classes em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e5616-191">A Mock Object framework enables you to create mocks and stubs for the classes in your application.</span></span>

<span data-ttu-id="e5616-192">Por exemplo, você pode usar uma estrutura de objetos fictícios para gerar uma versão fictícia de sua classe de repositório.</span><span class="sxs-lookup"><span data-stu-id="e5616-192">For example, you can use a Mock Object framework to generate a mock version of your repository class.</span></span> <span data-ttu-id="e5616-193">Dessa forma, você pode usar a classe de repositório fictício em vez da classe de repositório reais nos testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="e5616-193">That way, you can use the mock repository class instead of the real repository class in your unit tests.</span></span> <span data-ttu-id="e5616-194">Usar o repositório fictício permite que você evite a execução de código do banco de dados ao executar um teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="e5616-194">Using the mock repository enables you to avoid executing database code when executing a unit test.</span></span>

<span data-ttu-id="e5616-195">Visual Studio não inclui uma estrutura de objetos fictícios.</span><span class="sxs-lookup"><span data-stu-id="e5616-195">Visual Studio does not include a Mock Object framework.</span></span> <span data-ttu-id="e5616-196">No entanto, há várias estruturas de objeto de simulação de software livre e comercial disponível para o .NET framework:</span><span class="sxs-lookup"><span data-stu-id="e5616-196">However, there are several commercial and open source Mock Object frameworks available for the .NET framework:</span></span>

1. <span data-ttu-id="e5616-197">Moq - essa estrutura está disponível sob a licença BSD de código-fonte aberto.</span><span class="sxs-lookup"><span data-stu-id="e5616-197">Moq - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="e5616-198">Você pode baixar o Moq partir [ https://code.google.com/p/moq/ ](https://code.google.com/p/moq/).</span><span class="sxs-lookup"><span data-stu-id="e5616-198">You can download Moq from [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span></span>
2. <span data-ttu-id="e5616-199">Rhino Mocks - essa estrutura está disponível sob a licença BSD de código-fonte aberto.</span><span class="sxs-lookup"><span data-stu-id="e5616-199">Rhino Mocks - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="e5616-200">Você pode baixar a Rhino Mocks partir [ http://ayende.com/projects/rhino-mocks.aspx ](http://ayende.com/projects/rhino-mocks.aspx).</span><span class="sxs-lookup"><span data-stu-id="e5616-200">You can download Rhino Mocks from [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span></span>
3. <span data-ttu-id="e5616-201">Typemock Isolator - isso é uma estrutura comercial.</span><span class="sxs-lookup"><span data-stu-id="e5616-201">Typemock Isolator - This is a commercial framework.</span></span> <span data-ttu-id="e5616-202">Você pode baixar uma versão de avaliação [ http://www.typemock.com/ ](http://www.typemock.com/).</span><span class="sxs-lookup"><span data-stu-id="e5616-202">You can download a trial version from [http://www.typemock.com/](http://www.typemock.com/).</span></span>

<span data-ttu-id="e5616-203">Neste tutorial, decidi usar Moq.</span><span class="sxs-lookup"><span data-stu-id="e5616-203">In this tutorial, I decided to use Moq.</span></span> <span data-ttu-id="e5616-204">No entanto, você poderia usar facilmente a Rhino Mocks ou Typemock Isolator para criar a simulação de objetos para o aplicativo Gerenciador de contatos.</span><span class="sxs-lookup"><span data-stu-id="e5616-204">However, you could just as easily use Rhino Mocks or Typemock Isolator to create the Mock objects for the Contact Manager application.</span></span>

<span data-ttu-id="e5616-205">Antes de usar Moq, você precisará concluir as etapas a seguir:</span><span class="sxs-lookup"><span data-stu-id="e5616-205">Before you can use Moq, you need to complete the following steps:</span></span>

1. <span data-ttu-id="e5616-206">.</span><span class="sxs-lookup"><span data-stu-id="e5616-206">.</span></span>
2. <span data-ttu-id="e5616-207">Antes que o download é descompactado, certifique-se de que o arquivo com o botão direito e clique no botão rotulado **Unblock** (veja a Figura 1).</span><span class="sxs-lookup"><span data-stu-id="e5616-207">Before you unzip the download, make sure that you right-click the file and click the button labeled **Unblock** (see Figure 1).</span></span>
3. <span data-ttu-id="e5616-208">Descompacte o download.</span><span class="sxs-lookup"><span data-stu-id="e5616-208">Unzip the download.</span></span>
4. <span data-ttu-id="e5616-209">Adicione uma referência ao assembly Moq clicando duas vezes na pasta referências no projeto ContactManager.Tests e selecionando **adicionar referência**.</span><span class="sxs-lookup"><span data-stu-id="e5616-209">Add a reference to the Moq assembly by right-clicking the References folder in the ContactManager.Tests project and selecting **Add Reference**.</span></span> <span data-ttu-id="e5616-210">Na guia Procurar, navegue até a pasta onde você descompactou o Moq e selecione o assembly de Moq.dll.</span><span class="sxs-lookup"><span data-stu-id="e5616-210">Under the Browse tab, browse to the folder where you unzipped Moq and select the Moq.dll assembly.</span></span> <span data-ttu-id="e5616-211">Clique o **Okey** botão.</span><span class="sxs-lookup"><span data-stu-id="e5616-211">Click the **OK** button.</span></span>
5. <span data-ttu-id="e5616-212">Depois de concluir essas etapas, sua pasta de referências deve ser semelhante a Figura 2.</span><span class="sxs-lookup"><span data-stu-id="e5616-212">After you complete these steps, your References folder should look like Figure 2.</span></span>


<span data-ttu-id="e5616-213">[![Como desbloquear Moq](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e5616-213">[![Unblocking Moq](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span></span>

<span data-ttu-id="e5616-214">**Figura 01**: Moq desbloqueio ([clique para exibir a imagem em tamanho normal](iteration-5-create-unit-tests-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="e5616-214">**Figure 01**: Unblocking Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image2.png))</span></span>


<span data-ttu-id="e5616-215">[![Referências depois de adicionar o Moq](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="e5616-215">[![References after adding Moq](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span></span>

<span data-ttu-id="e5616-216">**Figura 02**: referências depois de adicionar o Moq ([clique para exibir a imagem em tamanho normal](iteration-5-create-unit-tests-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="e5616-216">**Figure 02**: References after adding Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image4.png))</span></span>


## <a name="creating-unit-tests-for-the-service-layer"></a><span data-ttu-id="e5616-217">Criando testes de unidade para a camada de serviço</span><span class="sxs-lookup"><span data-stu-id="e5616-217">Creating Unit Tests for the Service Layer</span></span>

<span data-ttu-id="e5616-218">Deixe o s começar criando um conjunto de testes de unidade para nossa camada de serviço do Gerenciador de contatos aplicativo s.</span><span class="sxs-lookup"><span data-stu-id="e5616-218">Let s start by creating a set of unit tests for our Contact Manager application s service layer.</span></span> <span data-ttu-id="e5616-219">Vamos usar esses testes para verificar nossa lógica de validação.</span><span class="sxs-lookup"><span data-stu-id="e5616-219">We'll use these tests to verify our validation logic.</span></span>

<span data-ttu-id="e5616-220">Crie uma nova pasta chamada modelos no projeto ContactManager.Tests.</span><span class="sxs-lookup"><span data-stu-id="e5616-220">Create a new folder named Models in the ContactManager.Tests project.</span></span> <span data-ttu-id="e5616-221">Em seguida, clique com botão direito na pasta modelos e selecione **Add, o novo teste**.</span><span class="sxs-lookup"><span data-stu-id="e5616-221">Next, right-click the Models folder and select **Add, New Test**.</span></span> <span data-ttu-id="e5616-222">O **Add New Test** aparece da caixa de diálogo mostrada na Figura 3.</span><span class="sxs-lookup"><span data-stu-id="e5616-222">The **Add New Test** dialog shown in Figure 3 appears.</span></span> <span data-ttu-id="e5616-223">Selecione o **de teste de unidade** modelo e nomeie seu novo teste ContactManagerServiceTest.cs.</span><span class="sxs-lookup"><span data-stu-id="e5616-223">Select the **Unit Test** template and name your new test ContactManagerServiceTest.cs.</span></span> <span data-ttu-id="e5616-224">Clique o **Okey** botão para adicionar seu novo teste ao seu projeto de teste.</span><span class="sxs-lookup"><span data-stu-id="e5616-224">Click the **OK** button to add your new test to your Test Project.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="e5616-225">Em geral, você deseja que a estrutura de pastas do seu projeto de teste para coincidir com a estrutura de pastas do seu projeto ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="e5616-225">In general, you want the folder structure of your Test Project to match the folder structure of your ASP.NET MVC project.</span></span> <span data-ttu-id="e5616-226">Por exemplo, você pode colocar o controlador de testes em uma pasta de controladores, testes de modelo em uma pasta de modelos e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="e5616-226">For example, you place controller tests in a Controllers folder, model tests in a Models folder, and so on.</span></span>


<span data-ttu-id="e5616-227">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="e5616-227">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span></span>

<span data-ttu-id="e5616-228">**Figura 03**: Models\ContactManagerServiceTest.cs ([clique para exibir a imagem em tamanho normal](iteration-5-create-unit-tests-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="e5616-228">**Figure 03**: Models\ContactManagerServiceTest.cs([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image6.png))</span></span>


<span data-ttu-id="e5616-229">Inicialmente, queremos testar o método CreateContact() exposto pela classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="e5616-229">Initially, we want to test the CreateContact() method exposed by the ContactManagerService class.</span></span> <span data-ttu-id="e5616-230">Criaremos os cinco testes a seguir:</span><span class="sxs-lookup"><span data-stu-id="e5616-230">We'll create the following five tests:</span></span>

- <span data-ttu-id="e5616-231">CreateContact() - testes que CreateContact() retorna o valor true quando um contato válido é passado para o método.</span><span class="sxs-lookup"><span data-stu-id="e5616-231">CreateContact() - Tests that CreateContact() returns the value true when a valid Contact is passed to the method.</span></span>
- <span data-ttu-id="e5616-232">CreateContactRequiredFirstName() - testes que uma mensagem de erro é adicionada ao estado de modelo quando um contato com um nome ausente é passado para o método CreateContact().</span><span class="sxs-lookup"><span data-stu-id="e5616-232">CreateContactRequiredFirstName() - Tests that an error message is added to model state when a Contact with a missing first name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="e5616-233">CreateContactRequredLastName() - testes que uma mensagem de erro é adicionada ao estado de modelo quando um contato com um sobrenome ausente é passado para o método CreateContact().</span><span class="sxs-lookup"><span data-stu-id="e5616-233">CreateContactRequredLastName() - Tests that an error message is added to model state when a Contact with a missing last name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="e5616-234">CreateContactInvalidPhone() - testes que uma mensagem de erro é adicionada ao estado de modelo quando um contato com um número de telefone inválido é passado para o método CreateContact().</span><span class="sxs-lookup"><span data-stu-id="e5616-234">CreateContactInvalidPhone() - Tests that an error message is added to model state when a Contact with an invalid phone number is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="e5616-235">CreateContactInvalidEmail() - testes que uma mensagem de erro é adicionada ao estado de modelo quando um contato com um endereço de email inválido é passado para o método CreateContact()...</span><span class="sxs-lookup"><span data-stu-id="e5616-235">CreateContactInvalidEmail() - Tests that an error message is added to model state when a Contact with an invalid email address is passed to the CreateContact() method..</span></span>

<span data-ttu-id="e5616-236">O primeiro teste verifica se um contato válido não gera um erro de validação.</span><span class="sxs-lookup"><span data-stu-id="e5616-236">The first test verifies that a valid Contact does not generate a validation error.</span></span> <span data-ttu-id="e5616-237">Os testes restantes verificam cada das regras de validação.</span><span class="sxs-lookup"><span data-stu-id="e5616-237">The remaining tests check each of the validation rules.</span></span>

<span data-ttu-id="e5616-238">O código para esses testes está contido na listagem 1.</span><span class="sxs-lookup"><span data-stu-id="e5616-238">The code for these tests is contained in Listing 1.</span></span>

<span data-ttu-id="e5616-239">**Listagem 1 - Models\ContactManagerServiceTest.cs**</span><span class="sxs-lookup"><span data-stu-id="e5616-239">**Listing 1 - Models\ContactManagerServiceTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample1.cs)]


<span data-ttu-id="e5616-240">Como usamos a classe de contato na listagem 1, precisamos adicionar uma referência para o Entity Framework da Microsoft ao nosso projeto de teste.</span><span class="sxs-lookup"><span data-stu-id="e5616-240">Because we use the Contact class in Listing 1, we need to add a reference to the Microsoft Entity Framework to our Test project.</span></span> <span data-ttu-id="e5616-241">Adicione uma referência ao assembly System.</span><span class="sxs-lookup"><span data-stu-id="e5616-241">Add a reference to the System.Data.Entity assembly.</span></span>


<span data-ttu-id="e5616-242">Listagem 1 contém um método chamado Initialize () que é decorada com o atributo [TestInitialize].</span><span class="sxs-lookup"><span data-stu-id="e5616-242">Listing 1 contains a method named Initialize() that is decorated with the [TestInitialize] attribute.</span></span> <span data-ttu-id="e5616-243">Esse método é chamado automaticamente antes de cada um dos testes de unidade é executada (ele é chamado 5 vezes antes de cada um dos testes de unidade).</span><span class="sxs-lookup"><span data-stu-id="e5616-243">This method is called automatically before each of the unit tests is run (it is called 5 times right before each of the unit tests).</span></span> <span data-ttu-id="e5616-244">O método Initialize () cria um repositório fictício com a seguinte linha de código:</span><span class="sxs-lookup"><span data-stu-id="e5616-244">The Initialize() method creates a mock repository with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample2.cs)]

<span data-ttu-id="e5616-245">Esta linha de código usa a estrutura de Moq para gerar um repositório fictício da interface IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="e5616-245">This line of code uses the Moq framework to generate a mock repository from the IContactManagerRepository interface.</span></span> <span data-ttu-id="e5616-246">O repositório fictício é usado em vez do EntityContactManagerRepository real para evitar a acessar o banco de dados quando cada teste de unidade é executado.</span><span class="sxs-lookup"><span data-stu-id="e5616-246">The mock repository is used instead of the actual EntityContactManagerRepository to avoid accessing the database when each unit test is run.</span></span> <span data-ttu-id="e5616-247">O repositório fictício implementa os métodos da interface IContactManagerRepository, mas o métodos don t, na verdade, fazer nada.</span><span class="sxs-lookup"><span data-stu-id="e5616-247">The mock repository implements the methods of the IContactManagerRepository interface, but the methods don t actually do anything.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="e5616-248">Ao usar a estrutura Moq, há uma distinção entre \_mockRepository e \_mockRepository.Object.</span><span class="sxs-lookup"><span data-stu-id="e5616-248">When using the Moq framework, there is a distinction between \_mockRepository and \_mockRepository.Object.</span></span> <span data-ttu-id="e5616-249">O primeiro refere-se para a simulação&lt;IContactManagerRepository&gt; classe que contém métodos para especificar como o repositório fictício irá se comportar.</span><span class="sxs-lookup"><span data-stu-id="e5616-249">The former refers to the Mock&lt;IContactManagerRepository&gt; class that contains methods for specifying how the mock repository will behave.</span></span> <span data-ttu-id="e5616-250">O último se refere ao repositório fictício real que implementa a interface IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="e5616-250">The latter refers to the actual mock repository that implements the IContactManagerRepository interface.</span></span>


<span data-ttu-id="e5616-251">O repositório fictício é usado no método Initialize () ao criar uma instância da classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="e5616-251">The mock repository is used in the Initialize() method when creating an instance of the ContactManagerService class.</span></span> <span data-ttu-id="e5616-252">Todos os testes de unidade individuais usam essa instância da classe ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="e5616-252">All of the individual unit tests use this instance of the ContactManagerService class.</span></span>

<span data-ttu-id="e5616-253">Listagem 1 contém cinco métodos que correspondem a cada um dos testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="e5616-253">Listing 1 contains five methods that correspond to each of the unit tests.</span></span> <span data-ttu-id="e5616-254">Cada um desses métodos é decorada com o atributo [TestMethod].</span><span class="sxs-lookup"><span data-stu-id="e5616-254">Each of these methods is decorated with the [TestMethod] attribute.</span></span> <span data-ttu-id="e5616-255">Quando você executa os testes de unidade, qualquer método que tem esse atributo é chamado.</span><span class="sxs-lookup"><span data-stu-id="e5616-255">When you run the unit tests, any method that has this attribute is called.</span></span> <span data-ttu-id="e5616-256">Em outras palavras, qualquer método que está decorado com o atributo [TestMethod] é um teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="e5616-256">In other words, any method that is decorated with the [TestMethod] attribute is a unit test.</span></span>

<span data-ttu-id="e5616-257">O primeiro teste de unidade, chamado CreateContact(), verifica que chamar CreateContact() retorna o valor true quando uma instância válida da classe contato é passada para o método.</span><span class="sxs-lookup"><span data-stu-id="e5616-257">The first unit test, named CreateContact(), verifies that calling CreateContact() returns the value true when a valid instance of the Contact class is passed to the method.</span></span> <span data-ttu-id="e5616-258">O teste cria uma instância da classe Contact, chama o método CreateContact() e verifica CreateContact() retorna o valor true.</span><span class="sxs-lookup"><span data-stu-id="e5616-258">The test creates an instance of the Contact class, calls the CreateContact() method, and verifies that CreateContact() returns the value true.</span></span>

<span data-ttu-id="e5616-259">Verifique se os testes restantes que quando o método CreateContact() é chamado com um contato inválido, em seguida, o método retornará false e a mensagem de erro de validação esperado é adicionada ao estado do modelo.</span><span class="sxs-lookup"><span data-stu-id="e5616-259">The remaining tests verify that when the CreateContact() method is called with an invalid Contact then the method returns false and the expected validation error message is added to model state.</span></span> <span data-ttu-id="e5616-260">Por exemplo, o teste CreateContactRequiredFirstName() cria uma instância da classe Contact com uma cadeia de caracteres vazia para sua propriedade FirstName.</span><span class="sxs-lookup"><span data-stu-id="e5616-260">For example, the CreateContactRequiredFirstName() test creates an instance of the Contact class with an empty string for its FirstName property.</span></span> <span data-ttu-id="e5616-261">Em seguida, o método CreateContact() é chamado com o contato inválido.</span><span class="sxs-lookup"><span data-stu-id="e5616-261">Next, the CreateContact() method is called with the invalid Contact.</span></span> <span data-ttu-id="e5616-262">Por fim, o teste verifica que CreateContact() retorna false e o estado do modelo contém a mensagem de erro de validação esperado "nome é obrigatório."</span><span class="sxs-lookup"><span data-stu-id="e5616-262">Finally, the test verifies that CreateContact() returns false and that model state contains the expected validation error message "First name is required."</span></span>

<span data-ttu-id="e5616-263">Você pode executar os testes de unidade na listagem 1, selecionando a opção de menu **teste, execute todos os testes na solução (CTRL + R, um)**.</span><span class="sxs-lookup"><span data-stu-id="e5616-263">You can run the unit tests in Listing 1 by selecting the menu option **Test, Run, All Tests in Solution (CTRL+R, A)**.</span></span> <span data-ttu-id="e5616-264">Os resultados dos testes são exibidos na janela de resultados de teste (veja a Figura 4).</span><span class="sxs-lookup"><span data-stu-id="e5616-264">The results of the tests are displayed in the Test Results window (see Figure 4).</span></span>


<span data-ttu-id="e5616-265">[![Resultados de teste](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e5616-265">[![Test Results](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span></span>

<span data-ttu-id="e5616-266">**Figura 04**: resultados de teste ([clique para exibir a imagem em tamanho normal](iteration-5-create-unit-tests-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="e5616-266">**Figure 04**: Test Results ([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image8.png))</span></span>


## <a name="creating-unit-tests-for-controllers"></a><span data-ttu-id="e5616-267">Criando testes de unidade para controladores</span><span class="sxs-lookup"><span data-stu-id="e5616-267">Creating Unit Tests for Controllers</span></span>

<span data-ttu-id="e5616-268">Aplicativo ASP.NETMVC controlam o fluxo de interação do usuário.</span><span class="sxs-lookup"><span data-stu-id="e5616-268">ASP.NETMVC application control the flow of user interaction.</span></span> <span data-ttu-id="e5616-269">Quando um controlador de teste, você deseja testar se o controlador retorna os dados de resultado e o modo de exibição de ação à direita.</span><span class="sxs-lookup"><span data-stu-id="e5616-269">When testing a controller, you want to test whether the controller returns the right action result and view data.</span></span> <span data-ttu-id="e5616-270">Também convém testar se um controlador interage com as classes de modelo da maneira esperada.</span><span class="sxs-lookup"><span data-stu-id="e5616-270">You also might want to test whether a controller interacts with model classes in the manner expected.</span></span>

<span data-ttu-id="e5616-271">Por exemplo, a listagem 2 contém dois testes de unidade para o método Create () do controlador de contato.</span><span class="sxs-lookup"><span data-stu-id="e5616-271">For example, Listing 2 contains two unit tests for the Contact controller Create() method.</span></span> <span data-ttu-id="e5616-272">O teste de unidade primeiro verifica se a quando um contato válido é passado para o método Create (), em seguida, o método Create () redireciona para a ação de índice.</span><span class="sxs-lookup"><span data-stu-id="e5616-272">The first unit test verifies that when a valid Contact is passed to the Create() method then the Create() method redirects to the Index action.</span></span> <span data-ttu-id="e5616-273">Em outras palavras, quando passado um contato válido, o método Create () deve retornar um RedirectToRouteResult que representa a ação de índice.</span><span class="sxs-lookup"><span data-stu-id="e5616-273">In other words, when passed a valid Contact, the Create() method should return a RedirectToRouteResult that represents the Index action.</span></span>

<span data-ttu-id="e5616-274">Podemos don t deseja testar a camada de serviço ContactManager quando estamos testando a camada de controlador.</span><span class="sxs-lookup"><span data-stu-id="e5616-274">We don t want to test the ContactManager service layer when we are testing the controller layer.</span></span> <span data-ttu-id="e5616-275">Portanto, vamos simular a camada de serviço com o seguinte código no método de inicialização:</span><span class="sxs-lookup"><span data-stu-id="e5616-275">Therefore, we mock the service layer with the following code in the Initialize method:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample3.cs)]

<span data-ttu-id="e5616-276">No teste de unidade CreateValidContact(), podemos simule o comportamento de chamar a método CreateContact() com a seguinte linha de código da camada de serviço:</span><span class="sxs-lookup"><span data-stu-id="e5616-276">In the CreateValidContact() unit test, we mock the behavior of calling the service layer CreateContact() method with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample4.cs)]

<span data-ttu-id="e5616-277">Esta linha de código faz com que o serviço ContactManager fictício retornar o valor true quando seu método CreateContact() é chamado.</span><span class="sxs-lookup"><span data-stu-id="e5616-277">This line of code causes the mock ContactManager service to return the value true when its CreateContact() method is called.</span></span> <span data-ttu-id="e5616-278">Por que a camada de serviço de simulação, podemos testar o comportamento do nosso controlador sem a necessidade de executar qualquer código na camada de serviço.</span><span class="sxs-lookup"><span data-stu-id="e5616-278">By mocking the service layer, we can test the behavior of our controller without needing to execute any code in the service layer.</span></span>

<span data-ttu-id="e5616-279">O segundo teste de unidade verifica que a ação Create () retorna o modo de exibição criar quando um contato inválido é passado para o método.</span><span class="sxs-lookup"><span data-stu-id="e5616-279">The second unit test verifies that the Create() action returns the Create view when an invalid contact is passed to the method.</span></span> <span data-ttu-id="e5616-280">Podemos fazer com que a camada de serviço CreateContact() método para retornar o valor false com a seguinte linha de código:</span><span class="sxs-lookup"><span data-stu-id="e5616-280">We cause the service layer CreateContact() method to return the value false with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample5.cs)]

<span data-ttu-id="e5616-281">Se o método Create () se comporta conforme esperado, em seguida, ele deverá retornar o modo de exibição criar quando a camada de serviço retorna o valor false.</span><span class="sxs-lookup"><span data-stu-id="e5616-281">If the Create() method behaves as we expect then it should return the Create view when the service layer returns the value false.</span></span> <span data-ttu-id="e5616-282">Dessa forma, o controlador pode exibir as mensagens de erro de validação no modo de exibição criar e o usuário tem a oportunidade de corrigir esse propriedades inválidas do contato.</span><span class="sxs-lookup"><span data-stu-id="e5616-282">That way, the controller can display the validation error messages in the Create view and the user has a chance to correct that invalid Contact properties.</span></span>


<span data-ttu-id="e5616-283">Se você planeja criar testes de unidade para seus controladores, em seguida, você precisará retornar nomes de exibição explícita de ações do controlador.</span><span class="sxs-lookup"><span data-stu-id="e5616-283">If you plan to build unit tests for your controllers then you need to return explicit view names from your controller actions.</span></span> <span data-ttu-id="e5616-284">Por exemplo, não retornam um modo de exibição como esta:</span><span class="sxs-lookup"><span data-stu-id="e5616-284">For example, do not return a view like this:</span></span>

<span data-ttu-id="e5616-285">retornar View();</span><span class="sxs-lookup"><span data-stu-id="e5616-285">return View();</span></span>

<span data-ttu-id="e5616-286">Nesse caso, devolva o modo de exibição como esta:</span><span class="sxs-lookup"><span data-stu-id="e5616-286">Instead, return the view like this:</span></span>

<span data-ttu-id="e5616-287">retornar View("Create");</span><span class="sxs-lookup"><span data-stu-id="e5616-287">return View("Create");</span></span>

<span data-ttu-id="e5616-288">Se você não explícita ao retornar que uma exibição, em seguida, a propriedade ViewResult.ViewName retorna uma cadeia de caracteres vazia.</span><span class="sxs-lookup"><span data-stu-id="e5616-288">If you are not explicit when returning a view then the ViewResult.ViewName property returns an empty string.</span></span>


<span data-ttu-id="e5616-289">**Listagem 2 - Controllers\ContactControllerTest.cs**</span><span class="sxs-lookup"><span data-stu-id="e5616-289">**Listing 2 - Controllers\ContactControllerTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample6.cs)]

## <a name="summary"></a><span data-ttu-id="e5616-290">Resumo</span><span class="sxs-lookup"><span data-stu-id="e5616-290">Summary</span></span>

<span data-ttu-id="e5616-291">Essa iteração, criamos testes de unidade para nosso aplicativo Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="e5616-291">In this iteration, we created unit tests for our Contact Manager application.</span></span> <span data-ttu-id="e5616-292">Podemos executar esses testes de unidade a qualquer momento para verificar que nosso aplicativo ainda se comporta da maneira que esperamos.</span><span class="sxs-lookup"><span data-stu-id="e5616-292">We can run these unit tests at any time to verify that our application still behaves in the manner that we expect.</span></span> <span data-ttu-id="e5616-293">Os testes de unidade atuam como uma rede de segurança para nosso aplicativo que nos permite modificar com segurança nosso aplicativo no futuro.</span><span class="sxs-lookup"><span data-stu-id="e5616-293">The unit tests act as a safety net for our application enabling us to safely modify our application in the future.</span></span>

<span data-ttu-id="e5616-294">Nós criamos dois conjuntos de testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="e5616-294">We created two sets of unit tests.</span></span> <span data-ttu-id="e5616-295">Primeiro, testamos nossa lógica de validação, criando testes de unidade para nossa camada de serviço.</span><span class="sxs-lookup"><span data-stu-id="e5616-295">First, we tested our validation logic by creating unit tests for our service layer.</span></span> <span data-ttu-id="e5616-296">Em seguida, testamos nossa lógica de controle de fluxo, criando testes de unidade para nossa camada de controlador.</span><span class="sxs-lookup"><span data-stu-id="e5616-296">Next, we tested our flow control logic by creating unit tests for our controller layer.</span></span> <span data-ttu-id="e5616-297">Ao testar nossa camada de serviço, podemos isolado nossos testes para nossa camada de serviço da nossa camada de repositório por nossa camada de repositório de simulação.</span><span class="sxs-lookup"><span data-stu-id="e5616-297">When testing our service layer, we isolated our tests for our service layer from our repository layer by mocking our repository layer.</span></span> <span data-ttu-id="e5616-298">Quando a camada de controlador de teste, podemos isolado nossos testes para nossa camada de controlador pela camada de serviço de simulação.</span><span class="sxs-lookup"><span data-stu-id="e5616-298">When testing the controller layer, we isolated our tests for our controller layer by mocking the service layer.</span></span>

<span data-ttu-id="e5616-299">A próxima iteração, modificamos o aplicativo Gerenciador de contatos para que ele oferece suporte a grupos de contato.</span><span class="sxs-lookup"><span data-stu-id="e5616-299">In the next iteration, we modify the Contact Manager application so that it supports Contact Groups.</span></span> <span data-ttu-id="e5616-300">Vamos adicionar essa nova funcionalidade ao nosso aplicativo usando um processo de design de software chamado desenvolvimento controlado por teste.</span><span class="sxs-lookup"><span data-stu-id="e5616-300">We'll add this new functionality to our application using a software design process called test-driven development.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e5616-301">[Anterior](iteration-4-make-the-application-loosely-coupled-cs.md)
> [Próximo](iteration-6-use-test-driven-development-cs.md)</span><span class="sxs-lookup"><span data-stu-id="e5616-301">[Previous](iteration-4-make-the-application-loosely-coupled-cs.md)
[Next](iteration-6-use-test-driven-development-cs.md)</span></span>
