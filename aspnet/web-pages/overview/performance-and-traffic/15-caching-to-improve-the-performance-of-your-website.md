---
uid: web-pages/overview/performance-and-traffic/15-caching-to-improve-the-performance-of-your-website
title: Cache de dados em uma Web do ASP.NET (Razor) sites de páginas para melhorar o desempenho | Microsoft Docs
author: tfitzmac
description: Você pode acelerar seu site fazendo com que ele armazenar - ou seja, cache - os resultados de dados que normalmente levaria um tempo considerável para recuperar ou processar um...
ms.author: riande
ms.date: 02/14/2014
ms.assetid: 961e525b-7700-469e-8a68-d7010b6fb68c
msc.legacyurl: /web-pages/overview/performance-and-traffic/15-caching-to-improve-the-performance-of-your-website
msc.type: authoredcontent
ms.openlocfilehash: 53a3f38c23dc20479ddf231fe24a200d823d0345
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/16/2018
ms.locfileid: "41834175"
---
<a name="caching-data-in-an-aspnet-web-pages-razor-site-for-better-performance"></a><span data-ttu-id="ebef0-103">Cache de dados em um Site do ASP.NET Web Pages (Razor) para melhorar o desempenho</span><span class="sxs-lookup"><span data-stu-id="ebef0-103">Caching Data in an ASP.NET Web Pages (Razor) Site for Better Performance</span></span>
====================
<span data-ttu-id="ebef0-104">por [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="ebef0-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="ebef0-105">Este artigo explica como usar um auxiliar de informações em cache para melhorar o desempenho em um site de páginas da Web do ASP.NET (Razor).</span><span class="sxs-lookup"><span data-stu-id="ebef0-105">This article explains how to use a helper to cache information for faster performance in an ASP.NET Web Pages (Razor) website.</span></span> <span data-ttu-id="ebef0-106">Você pode acelerar o seu site, fazendo com que ele armazenar &#8212; ou seja, armazenar em cache &#8212; dos resultados de dados que normalmente levaria um tempo considerável para recuperar ou processar e que não é alterada com frequência.</span><span class="sxs-lookup"><span data-stu-id="ebef0-106">You can speed up your website by having it store &#8212; that is, cache &#8212; the results of data that ordinarily would take considerable time to retrieve or process and that does not change often.</span></span>
> 
> <span data-ttu-id="ebef0-107">**O que você aprenderá:**</span><span class="sxs-lookup"><span data-stu-id="ebef0-107">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="ebef0-108">Como usar o cache para melhorar a capacidade de resposta do seu site.</span><span class="sxs-lookup"><span data-stu-id="ebef0-108">How to use caching to improve the responsiveness of your website.</span></span>
> 
> <span data-ttu-id="ebef0-109">Estes são os recursos do ASP.NET introduzidos no artigo:</span><span class="sxs-lookup"><span data-stu-id="ebef0-109">These are the ASP.NET features introduced in the article:</span></span>
> 
> - <span data-ttu-id="ebef0-110">O `WebCache` auxiliar.</span><span class="sxs-lookup"><span data-stu-id="ebef0-110">The `WebCache` helper.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="ebef0-111">Versões de software usadas no tutorial</span><span class="sxs-lookup"><span data-stu-id="ebef0-111">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="ebef0-112">Páginas da Web do ASP.NET (Razor) 3</span><span class="sxs-lookup"><span data-stu-id="ebef0-112">ASP.NET Web Pages (Razor) 3</span></span>
>   
> 
> <span data-ttu-id="ebef0-113">Este tutorial também funciona com ASP.NET Web Pages 2.</span><span class="sxs-lookup"><span data-stu-id="ebef0-113">This tutorial also works with ASP.NET Web Pages 2.</span></span>


<span data-ttu-id="ebef0-114">Sempre que alguém solicita uma página do seu site, o servidor web tem que fazer algum trabalho para atender à solicitação.</span><span class="sxs-lookup"><span data-stu-id="ebef0-114">Every time someone requests a page from your site, the web server has to do some work in order to fulfill the request.</span></span> <span data-ttu-id="ebef0-115">Para algumas das suas páginas, o servidor talvez precise executar tarefas que demoram (comparativamente), como recuperar dados de um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="ebef0-115">For some of your pages, the server might have to perform tasks that take a (comparatively) long time, such as retrieving data from a database.</span></span> <span data-ttu-id="ebef0-116">Mesmo que essas tarefas não tirar longo em termos absolutos, se seu site experimentar muito tráfego, uma série inteira de solicitações individuais que fazem com que o servidor web executar a tarefa complicada ou lenta pode adicionar até muito trabalho.</span><span class="sxs-lookup"><span data-stu-id="ebef0-116">Even if these tasks don't take long in absolute terms, if your site experiences a lot of traffic, a whole series of individual requests that cause the web server to perform the complicated or slow task can add up to a lot of work.</span></span> <span data-ttu-id="ebef0-117">Por fim, isso pode afetar o desempenho do site.</span><span class="sxs-lookup"><span data-stu-id="ebef0-117">This can ultimately affect the performance of the site.</span></span>

<span data-ttu-id="ebef0-118">Uma maneira de melhorar o desempenho do seu site em circunstâncias como isso é armazenar dados em cache.</span><span class="sxs-lookup"><span data-stu-id="ebef0-118">One way to improve the performance of your website in circumstances like this is to cache data.</span></span> <span data-ttu-id="ebef0-119">Se seu site obtém solicitações repetidas para as mesmas informações e as informações não precisam ser modificados para cada pessoa e não é tempo confidenciais, em vez de buscar novamente ou recalcular a ele, você pode buscar os dados uma vez e, em seguida, armazenar os resultados.</span><span class="sxs-lookup"><span data-stu-id="ebef0-119">If your site gets repeated requests for the same information, and the information does not need to be modified for each person, and it's not time sensitive, instead of re-fetching or recalculating it, you can fetch the data once and then store the results.</span></span> <span data-ttu-id="ebef0-120">Na próxima vez que uma solicitação chega para que informações, você simplesmente obtê-lo fora do cache.</span><span class="sxs-lookup"><span data-stu-id="ebef0-120">The next time a request comes in for that information, you just get it out of the cache.</span></span>

<span data-ttu-id="ebef0-121">Em geral, você armazenar em cache informações que não são alterados com frequência.</span><span class="sxs-lookup"><span data-stu-id="ebef0-121">In general, you cache information that doesn't change frequently.</span></span> <span data-ttu-id="ebef0-122">Quando você coloca informações no cache, ele é armazenado na memória no servidor web.</span><span class="sxs-lookup"><span data-stu-id="ebef0-122">When you put information in the cache, it's stored in memory on the web server.</span></span> <span data-ttu-id="ebef0-123">Você pode especificar quanto tempo ele deve ser armazenado em cache, de segundos para dias.</span><span class="sxs-lookup"><span data-stu-id="ebef0-123">You can specify how long it should be cached, from seconds to days.</span></span> <span data-ttu-id="ebef0-124">Quando expira o período de cache, as informações são automaticamente removidas do cache.</span><span class="sxs-lookup"><span data-stu-id="ebef0-124">When the caching period expires, the information is automatically removed from the cache.</span></span>

> [!NOTE]
> <span data-ttu-id="ebef0-125">Entradas no cache podem ser removidas por motivos diferente de que elas tiverem expirado.</span><span class="sxs-lookup"><span data-stu-id="ebef0-125">Entries in the cache might be removed for reasons other than that they've expired.</span></span> <span data-ttu-id="ebef0-126">Por exemplo, o servidor web pode temporariamente esgotamento da memória e uma maneira que ele pode recuperar memória está lançando entradas do cache do.</span><span class="sxs-lookup"><span data-stu-id="ebef0-126">For example, the web server might temporarily run low on memory, and one way it can reclaim memory is by throwing entries out of the cache.</span></span> <span data-ttu-id="ebef0-127">Como você verá, mesmo se você tiver colocado informações no cache, você precisa Certifique-se de que ele ainda está lá quando necessário.</span><span class="sxs-lookup"><span data-stu-id="ebef0-127">As you'll see, even if you've put information into the cache, you have to check to be sure it's still there when you need it.</span></span>


<span data-ttu-id="ebef0-128">Imagine que seu site tem uma página que exibe a temperatura atual e a previsão do tempo.</span><span class="sxs-lookup"><span data-stu-id="ebef0-128">Imagine your website has a page that displays the current temperature and weather forecast.</span></span> <span data-ttu-id="ebef0-129">Para obter esse tipo de informação, você pode enviar uma solicitação para um serviço externo.</span><span class="sxs-lookup"><span data-stu-id="ebef0-129">To get this type of information, you might send a request to an external service.</span></span> <span data-ttu-id="ebef0-130">Como essas informações não mudará muito (dentro de um período de tempo de duas horas, por exemplo) e como chamadas externas exigem tempo e largura de banda, é um bom candidato para armazenar em cache.</span><span class="sxs-lookup"><span data-stu-id="ebef0-130">Since this information doesn't change much (within a two-hour time period, for example) and since external calls require time and bandwidth, it's a good candidate for caching.</span></span>

## <a name="adding-caching-to-a-page"></a><span data-ttu-id="ebef0-131">Adicionando o cache para uma página</span><span class="sxs-lookup"><span data-stu-id="ebef0-131">Adding Caching to a Page</span></span>

<span data-ttu-id="ebef0-132">O ASP.NET inclui um `WebCache` auxiliar que torna mais fácil adicionar cache ao seu site e adicionar dados ao cache.</span><span class="sxs-lookup"><span data-stu-id="ebef0-132">ASP.NET includes a `WebCache` helper that makes it easy to add caching to your site and add data to the cache.</span></span> <span data-ttu-id="ebef0-133">Neste procedimento, você criará uma página que armazena em cache a hora atual.</span><span class="sxs-lookup"><span data-stu-id="ebef0-133">In this procedure, you'll create a page that caches the current time.</span></span> <span data-ttu-id="ebef0-134">Isso não é um exemplo do mundo real, como a hora atual é algo que for alterado com frequência e que Além disso não é complexa para calcular.</span><span class="sxs-lookup"><span data-stu-id="ebef0-134">This isn't a real-world example, since the current time is something that does change often, and that moreover isn't complex to calculate.</span></span> <span data-ttu-id="ebef0-135">No entanto, é uma boa maneira de ilustrar o cache em funcionamento.</span><span class="sxs-lookup"><span data-stu-id="ebef0-135">However, it's a good way to illustrate caching in action.</span></span>

1. <span data-ttu-id="ebef0-136">Adicionar uma nova página chamada *WebCache.cshtml* para o site.</span><span class="sxs-lookup"><span data-stu-id="ebef0-136">Add a new page named *WebCache.cshtml* to the website.</span></span>
2. <span data-ttu-id="ebef0-137">Adicione o seguinte código e marcação à página:</span><span class="sxs-lookup"><span data-stu-id="ebef0-137">Add the following code and markup to the page:</span></span>

    [!code-cshtml[Main](15-caching-to-improve-the-performance-of-your-website/samples/sample1.cshtml)]

    <span data-ttu-id="ebef0-138">Quando você armazenar dados em cache, você colocá-lo no cache usando um nome isso é exclusivo em todo o site.</span><span class="sxs-lookup"><span data-stu-id="ebef0-138">When you cache data, you put it into the cache using a name this is unique across the website.</span></span> <span data-ttu-id="ebef0-139">Nesse caso, você usará uma entrada de cache nomeada `CachedTime`.</span><span class="sxs-lookup"><span data-stu-id="ebef0-139">In this case, you'll use a cache entry named `CachedTime`.</span></span> <span data-ttu-id="ebef0-140">Esse é o `cacheItemKey` mostrado no exemplo de código.</span><span class="sxs-lookup"><span data-stu-id="ebef0-140">This is the `cacheItemKey` shown in the code example.</span></span>

    <span data-ttu-id="ebef0-141">O código lê primeiro os `CachedTime` entrada de cache.</span><span class="sxs-lookup"><span data-stu-id="ebef0-141">The code first reads the `CachedTime` cache entry.</span></span> <span data-ttu-id="ebef0-142">Se um valor é retornado (ou seja, se a entrada de cache não for nula), o código simplesmente define o valor da variável de tempo para os dados do cache.</span><span class="sxs-lookup"><span data-stu-id="ebef0-142">If a value is returned (that is, if the cache entry isn't null), the code just sets the value of the time variable to the cache data.</span></span>

    <span data-ttu-id="ebef0-143">No entanto, se a entrada de cache não existe (ou seja, é nulo), o código define o valor de tempo, adiciona-o ao cache e define um valor de expiração para um minuto.</span><span class="sxs-lookup"><span data-stu-id="ebef0-143">However, if the cache entry doesn't exist (that is, it's null), the code sets the time value, adds it to the cache, and sets an expiration value to one minute.</span></span> <span data-ttu-id="ebef0-144">Após um minuto, a entrada de cache é descartada.</span><span class="sxs-lookup"><span data-stu-id="ebef0-144">After one minute, the cache entry is discarded.</span></span> <span data-ttu-id="ebef0-145">(O valor de expiração padrão para um item em cache é de 20 minutos.) O comando `WebCache.Set(cacheItemKey, time, 1, false)` mostra como adicionar o valor de tempo atual ao cache e definir a expiração para 1 minuto.</span><span class="sxs-lookup"><span data-stu-id="ebef0-145">(The default expiration value for an item in the cache is 20 minutes.) The command `WebCache.Set(cacheItemKey, time, 1, false)` shows how to add the current time value to the cache and set its expiration to 1 minute.</span></span> <span data-ttu-id="ebef0-146">Definindo o *slidingExpiration* parâmetro `false` significa que o tempo de expiração não for renovado a cada vez que forem solicitados.</span><span class="sxs-lookup"><span data-stu-id="ebef0-146">Setting the *slidingExpiration* parameter to `false` means the expiration time is not renewed each time it is requested.</span></span> <span data-ttu-id="ebef0-147">Ela expirará exatamente 1 minuto depois que ele foi originalmente adicionado ao cache.</span><span class="sxs-lookup"><span data-stu-id="ebef0-147">It will expire exactly 1 minute after it was originally added to the cache.</span></span> <span data-ttu-id="ebef0-148">Se você definir esse valor como `true` o tempo de expiração de 1 minuto é redefinido cada vez que o valor é solicitado do cache.</span><span class="sxs-lookup"><span data-stu-id="ebef0-148">If you set this value to `true` the 1 minute expiration time is reset each time the value is requested from the cache.</span></span>

    <span data-ttu-id="ebef0-149">Esse código ilustra o padrão que você sempre deve usar quando você armazena dados em cache.</span><span class="sxs-lookup"><span data-stu-id="ebef0-149">This code illustrates the pattern you should always use when you cache data.</span></span> <span data-ttu-id="ebef0-150">Antes de você obtém algo fora do cache, sempre verifique primeiro se o `WebCache.Get` método retornou nulo.</span><span class="sxs-lookup"><span data-stu-id="ebef0-150">Before you get something out of the cache, always check first whether the `WebCache.Get` method has returned null.</span></span> <span data-ttu-id="ebef0-151">Lembre-se de que a entrada de cache pode ter expirado ou pode ter sido removida por algum outro motivo, portanto, qualquer entrada fornecida nunca é garantida para ser no cache.</span><span class="sxs-lookup"><span data-stu-id="ebef0-151">Remember that the cache entry might have expired or might have been removed for some other reason, so any given entry is never guaranteed to be in the cache.</span></span>
3. <span data-ttu-id="ebef0-152">Execute *WebCache.cshtml* em um navegador.</span><span class="sxs-lookup"><span data-stu-id="ebef0-152">Run *WebCache.cshtml* in a browser.</span></span> <span data-ttu-id="ebef0-153">(Certifique-se de que a página está selecionada na **arquivos** espaço de trabalho antes de executá-lo.) Na primeira vez que você solicite a página, os dados de tempo não estiverem no cache, e o código tem de adicionar o valor de tempo para o cache.</span><span class="sxs-lookup"><span data-stu-id="ebef0-153">(Make sure the page is selected in the **Files** workspace before you run it.) The first time you request the page, the time data isn't in the cache, and the code has to add the time value to the cache.</span></span>

    ![cache-1](15-caching-to-improve-the-performance-of-your-website/_static/image1.jpg)
4. <span data-ttu-id="ebef0-155">Atualize *WebCache.cshtml* no navegador.</span><span class="sxs-lookup"><span data-stu-id="ebef0-155">Refresh *WebCache.cshtml* in the browser.</span></span> <span data-ttu-id="ebef0-156">Neste momento, os dados de tempo estão no cache.</span><span class="sxs-lookup"><span data-stu-id="ebef0-156">This time, the time data is in the cache.</span></span> <span data-ttu-id="ebef0-157">Observe que o tempo não foi alterado desde a última vez em que você exibiu a página.</span><span class="sxs-lookup"><span data-stu-id="ebef0-157">Notice that the time hasn't changed since the last time you viewed the page.</span></span>

    ![cache 2](15-caching-to-improve-the-performance-of-your-website/_static/image2.jpg)
5. <span data-ttu-id="ebef0-159">Aguarde um minuto para que o cache ser esvaziado e, em seguida, atualize a página.</span><span class="sxs-lookup"><span data-stu-id="ebef0-159">Wait one minute for the cache to be emptied, and then refresh the page.</span></span> <span data-ttu-id="ebef0-160">A página novamente indica que os dados de tempo não foi encontrados no cache e a hora da atualização é adicionada ao cache.</span><span class="sxs-lookup"><span data-stu-id="ebef0-160">The page again indicates that the time data wasn't found in the cache, and the updated time is added to the cache.</span></span>

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a><span data-ttu-id="ebef0-161">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="ebef0-161">Additional Resources</span></span>


- [<span data-ttu-id="ebef0-162">Exibindo dados em um gráfico</span><span class="sxs-lookup"><span data-stu-id="ebef0-162">Displaying Data in a Chart</span></span>](https://go.microsoft.com/fwlink/?LinkId=202895)
- <span data-ttu-id="ebef0-163">[Referência da API do WebCache](https://msdn.microsoft.com/library/system.web.helpers.webcache(v=vs.99).aspx) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="ebef0-163">[WebCache API reference](https://msdn.microsoft.com/library/system.web.helpers.webcache(v=vs.99).aspx) (MSDN)</span></span>
