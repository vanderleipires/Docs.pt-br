---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs
title: Processamento de exceções sem tratamento (c#) | Microsoft Docs
author: rick-anderson
description: Quando ocorre um erro de tempo de execução em um aplicativo web em produção é importante para notificar um desenvolvedor e para registrar o erro, de modo que podem ser diagnosticado na la...
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/09/2009
ms.topic: article
ms.assetid: 5bc1afd5-2484-4528-b158-ab218ba150e8
ms.technology: dotnet-webforms
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs
msc.type: authoredcontent
ms.openlocfilehash: 784290f1390668518ad88df9d38b60c0179a5923
ms.sourcegitcommit: 953ff9ea4369f154d6fd0239599279ddd3280009
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/03/2018
ms.locfileid: "37371850"
---
<a name="processing-unhandled-exceptions-c"></a><span data-ttu-id="f1a3c-103">Processamento de exceções sem tratamento (c#)</span><span class="sxs-lookup"><span data-stu-id="f1a3c-103">Processing Unhandled Exceptions (C#)</span></span>
====================
<span data-ttu-id="f1a3c-104">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="f1a3c-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="f1a3c-105">[Exibir ou baixar código de exemplo](https://github.com/aspnet/Docs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs/samples) ([como baixar](/aspnet/core/tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="f1a3c-105">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs/samples) ([how to download](/aspnet/core/tutorials/index#how-to-download-a-sample))</span></span>

> <span data-ttu-id="f1a3c-106">Quando ocorre um erro de tempo de execução em um aplicativo web em produção é importante para notificar um desenvolvedor e para registrar o erro, de modo que podem ser diagnosticado em um momento posterior no tempo.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-106">When a runtime error occurs on a web application in production it is important to notify a developer and to log the error so that it may be diagnosed at a later point in time.</span></span> <span data-ttu-id="f1a3c-107">Este tutorial fornece uma visão geral de como o ASP.NET processa os erros de tempo de execução e examina uma maneira de ter o código personalizado executado sempre que um bolhas de exceção sem tratamento até o tempo de execução do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-107">This tutorial provides an overview of how ASP.NET processes runtime errors and looks at one way to have custom code execute whenever an unhandled exception bubbles up to the ASP.NET runtime.</span></span>


## <a name="introduction"></a><span data-ttu-id="f1a3c-108">Introdução</span><span class="sxs-lookup"><span data-stu-id="f1a3c-108">Introduction</span></span>

<span data-ttu-id="f1a3c-109">Quando ocorre uma exceção sem tratamento em um aplicativo ASP.NET, ele propaga-se até o tempo de execução do ASP.NET, que gera o `Error` eventos e exibe a página de erro apropriada.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-109">When an unhandled exception occurs in an ASP.NET application, it bubbles up to the ASP.NET runtime, which raises the `Error` event and displays the appropriate error page.</span></span> <span data-ttu-id="f1a3c-110">Há três tipos diferentes de páginas de erro: o tempo de execução erro amarelo tela de morte (YSOD); os detalhes da exceção YSOD; e páginas de erro personalizadas.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-110">There are three different types of error pages: the Runtime Error Yellow Screen of Death (YSOD); the Exception Details YSOD; and custom error pages.</span></span> <span data-ttu-id="f1a3c-111">No [tutorial anterior](displaying-a-custom-error-page-cs.md) configuramos o aplicativo para usar uma página de erro personalizada para usuários remotos e o YSOD de detalhes de exceção para usuários que visitam localmente.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-111">In the [preceding tutorial](displaying-a-custom-error-page-cs.md) we configured the application to use a custom error page for remote users and the Exception Details YSOD for users visiting locally.</span></span>

<span data-ttu-id="f1a3c-112">Usando uma página de erro personalizado de amigável a humanos que corresponda a aparência do site é preferencial para o padrão YSOD de erro de tempo de execução, mas exibindo uma página de erro personalizada é apenas uma parte de uma solução de tratamento de erros abrangente.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-112">Using a human-friendly custom error page that matches the look and feel of the site is preferred to the default Runtime Error YSOD, but displaying a custom error page is only one part of a comprehensive error handling solution.</span></span> <span data-ttu-id="f1a3c-113">Quando ocorre um erro em um aplicativo em produção, é importante que os desenvolvedores são notificados sobre o erro para que eles podem revelar a causa da exceção e tratá-lo.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-113">When an error occurs in an application in production, it is important that the developers are notified of the error so that they can unearth the cause of the exception and address it.</span></span> <span data-ttu-id="f1a3c-114">Além disso, os detalhes do erro devem ser registrados para que o erro pode ser examinado e diagnosticado em um momento posterior no tempo.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-114">Furthermore, the error's details should be logged so that the error can be examined and diagnosed at a later point in time.</span></span>

<span data-ttu-id="f1a3c-115">Este tutorial mostra como acessar os detalhes de uma exceção sem tratamento para que eles podem ser registradas em log e um desenvolvedor notificado.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-115">This tutorial shows how to access the details of an unhandled exception so that they can be logged and a developer notified.</span></span> <span data-ttu-id="f1a3c-116">Os dois tutoriais seguindo este exploram bibliotecas de log de erro que, após um pouco de configuração, serão automaticamente notificam os desenvolvedores de erros de tempo de execução e seus detalhes de log.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-116">The two tutorials following this one explore error logging libraries that, after a bit of configuration, will automatically notify developers of runtime errors and log their details.</span></span>

> [!NOTE]
> <span data-ttu-id="f1a3c-117">As informações examinadas neste tutorial são mais útil se você precisar processar exceções não manipuladas de alguma maneira exclusiva ou personalizada.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-117">The information examined in this tutorial is most useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="f1a3c-118">Em casos em que você só precisa registrar a exceção e notificar um desenvolvedor, usando uma biblioteca de registro em log de erro é a melhor opção.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-118">In cases where you only need to log the exception and notify a developer, using an error logging library is the way to go.</span></span> <span data-ttu-id="f1a3c-119">Os próximos dois tutoriais fornecem uma visão geral dos dois essas bibliotecas.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-119">The next two tutorials provide an overview of two such libraries.</span></span>


## <a name="executing-code-when-theerrorevent-is-raised"></a><span data-ttu-id="f1a3c-120">Executar código quando o`Error`é gerado</span><span class="sxs-lookup"><span data-stu-id="f1a3c-120">Executing Code When The`Error`Event Is Raised</span></span>

<span data-ttu-id="f1a3c-121">Eventos fornecem um mecanismo para sinalizar que algo interessante ocorreu e para outro objeto para executar código em resposta de um objeto.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-121">Events provide an object a mechanism for signaling that something interesting has occurred, and for another object to execute code in response.</span></span> <span data-ttu-id="f1a3c-122">Como desenvolvedor ASP.NET, você está acostumado a pensar em termos de eventos.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-122">As an ASP.NET developer you are accustomed to thinking in terms of events.</span></span> <span data-ttu-id="f1a3c-123">Se você quiser executar um código quando o visitante clica em um botão específico, crie um manipulador de eventos para esse botão `Click` eventos e colocar seu código lá.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-123">If you want to run some code when the visitor clicks a particular Button, you create an event handler for that Button's `Click` event and put your code there.</span></span> <span data-ttu-id="f1a3c-124">Considerando que o tempo de execução do ASP.NET gera sua [ `Error` evento](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) sempre que ocorrer uma exceção sem tratamento, ele segue o código para registrar em log os detalhes do erro iria em um manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-124">Given that the ASP.NET runtime raises its [`Error` event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) whenever an unhandled exception occurs, it follows that the code for logging the error's details would go in an event handler.</span></span> <span data-ttu-id="f1a3c-125">Mas como você cria um manipulador de eventos para o `Error` evento?</span><span class="sxs-lookup"><span data-stu-id="f1a3c-125">But how do you create an event handler for the `Error` event?</span></span>

<span data-ttu-id="f1a3c-126">O `Error` evento é um dos muitos eventos em de [ `HttpApplication` classe](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) que são gerados em determinados estágios no pipeline HTTP durante o tempo de vida de uma solicitação.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-126">The `Error` event is one of many events in the [`HttpApplication` class](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) that are raised at certain stages in the HTTP pipeline during the lifetime of a request.</span></span> <span data-ttu-id="f1a3c-127">Por exemplo, o `HttpApplication` da classe [ `BeginRequest` evento](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) é gerado no início de cada solicitação; seu [ `AuthenticateRequest` evento](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) é gerado quando um módulo de segurança identificou o solicitante.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-127">For example, the `HttpApplication` class's [`BeginRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) is raised at the start of every request; its [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) is raised when a security module has identified the requestor.</span></span> <span data-ttu-id="f1a3c-128">Eles `HttpApplication` eventos oferecem ao desenvolvedor da página um meio para executar a lógica personalizada em vários pontos no tempo de vida de uma solicitação.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-128">These `HttpApplication` events give the page developer a means to execute custom logic at the various points in the lifetime of a request.</span></span>

<span data-ttu-id="f1a3c-129">Manipuladores de eventos para o `HttpApplication` eventos podem ser colocados em um arquivo especial chamado `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-129">Event handlers for the `HttpApplication` events can be placed in a special file named `Global.asax`.</span></span> <span data-ttu-id="f1a3c-130">Para criar esse arquivo no seu site, adicione um novo item para a raiz do seu site usando o modelo de classe de aplicativo Global com o nome `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-130">To create this file in your website, add a new item to the root of your website using the Global Application Class template with the name `Global.asax`.</span></span>

[![](processing-unhandled-exceptions-cs/_static/image2.png)](processing-unhandled-exceptions-cs/_static/image1.png)

<span data-ttu-id="f1a3c-131">**Figura 1**: adicionar `Global.asax` ao seu aplicativo Web</span><span class="sxs-lookup"><span data-stu-id="f1a3c-131">**Figure 1**: Add `Global.asax` To Your Web Application</span></span>  
<span data-ttu-id="f1a3c-132">([Clique para exibir a imagem em tamanho normal](processing-unhandled-exceptions-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="f1a3c-132">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image3.png))</span></span>

<span data-ttu-id="f1a3c-133">O conteúdo e a estrutura do `Global.asax` arquivo criado pelo Visual Studio pode diferir um pouco dependendo se você estiver usando um projeto de aplicativo da Web (WAP) ou um projeto de Site da Web (WSP).</span><span class="sxs-lookup"><span data-stu-id="f1a3c-133">The contents and structure of the `Global.asax` file created by Visual Studio differ slightly based on whether you are using a Web Application Project (WAP) or Web Site Project (WSP).</span></span> <span data-ttu-id="f1a3c-134">Com um WAP, o `Global.asax` é implementada como dois arquivos separados - `Global.asax` e `Global.asax.cs`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-134">With a WAP, the `Global.asax` is implemented as two separate files - `Global.asax` and `Global.asax.cs`.</span></span> <span data-ttu-id="f1a3c-135">O `Global.asax` arquivo não contém nada, mas uma `@Application` diretiva que faz referência a `.cs` arquivo; o evento de manipuladores de interesse são definidos no `Global.asax.cs` arquivo.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-135">The `Global.asax` file contains nothing but an `@Application` directive that references the `.cs` file; the event handlers of interest are defined in the `Global.asax.cs` file.</span></span> <span data-ttu-id="f1a3c-136">Para WSPs, apenas um único arquivo é criado, `Global.asax`, e os manipuladores de eventos são definidos em um `<script runat="server">` bloco.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-136">For WSPs, only a single file is created, `Global.asax`, and the event handlers are defined in a `<script runat="server">` block.</span></span>

<span data-ttu-id="f1a3c-137">O `Global.asax` arquivo criado em um WAP pelo modelo de classe de aplicativo Global do Visual Studio inclui manipuladores de eventos nomeados `Application_BeginRequest`, `Application_AuthenticateRequest`, e `Application_Error`, que são os manipuladores de eventos para o `HttpApplication` eventos `BeginRequest`, `AuthenticateRequest`, e `Error`, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-137">The `Global.asax` file created in a WAP by Visual Studio's Global Application Class template includes event handlers named `Application_BeginRequest`, `Application_AuthenticateRequest`, and `Application_Error`, which are event handlers for the `HttpApplication` events `BeginRequest`, `AuthenticateRequest`, and `Error`, respectively.</span></span> <span data-ttu-id="f1a3c-138">Também há manipuladores de eventos nomeados `Application_Start`, `Session_Start`, `Application_End`, e `Session_End`, que são os manipuladores de eventos que são acionados quando o aplicativo web é iniciado, quando começa uma nova sessão, quando o aplicativo termina, e quando uma sessão é encerrada, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-138">There are also event handlers named `Application_Start`, `Session_Start`, `Application_End`, and `Session_End`, which are event handlers that fire when the web application starts, when a new session starts, when the application ends, and when a session ends, respectively.</span></span> <span data-ttu-id="f1a3c-139">O `Global.asax` arquivo criado em um WSP pelo Visual Studio contém apenas o `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, e `Session_End` manipuladores de eventos.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-139">The `Global.asax` file created in a WSP by Visual Studio contains just the `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, and `Session_End` event handlers.</span></span>

> [!NOTE]
> <span data-ttu-id="f1a3c-140">Ao implantar o aplicativo ASP.NET, você precisa copiar o `Global.asax` arquivo para o ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-140">When deploying the ASP.NET application you need to copy the `Global.asax` file to the production environment.</span></span> <span data-ttu-id="f1a3c-141">O `Global.asax.cs` arquivo, que é criado no WAP, não precisam ser copiados para a produção porque esse código é compilado no assembly do projeto.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-141">The `Global.asax.cs` file, which is created in the WAP, does not need to be copied to production because this code is compiled into the project's assembly.</span></span>


<span data-ttu-id="f1a3c-142">Os manipuladores de eventos criados pelo modelo de classe de aplicativo Global do Visual Studio não são exaustivos.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-142">The event handlers created by Visual Studio's Global Application Class template are not exhaustive.</span></span> <span data-ttu-id="f1a3c-143">Você pode adicionar um manipulador de eventos para qualquer `HttpApplication` evento ao nomear o manipulador de eventos `Application_EventName`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-143">You can add an event handler for any `HttpApplication` event by naming the event handler `Application_EventName`.</span></span> <span data-ttu-id="f1a3c-144">Por exemplo, você poderia adicionar o código a seguir para o `Global.asax` arquivo para criar um manipulador de eventos para o [ `AuthorizeRequest` evento](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span><span class="sxs-lookup"><span data-stu-id="f1a3c-144">For example, you could add the following code to the `Global.asax` file to create an event handler for the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span></span>

[!code-cs[Main](processing-unhandled-exceptions-cs/samples/sample1.cs)]

<span data-ttu-id="f1a3c-145">Da mesma forma, você pode remover quaisquer manipuladores de eventos criados pelo modelo de classe de aplicativo Global que não são necessários.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-145">Likewise, you can remove any event handlers created by the Global Application Class template that are not needed.</span></span> <span data-ttu-id="f1a3c-146">Para este tutorial apenas exigimos um manipulador de eventos para o `Error` evento; sinta-se livre para remover os outros manipuladores de eventos do `Global.asax` arquivo.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-146">For this tutorial we only require an event handler for the `Error` event; feel free to remove the other event handlers from the `Global.asax` file.</span></span>

> [!NOTE]
> <span data-ttu-id="f1a3c-147">*Módulos HTTP* oferecem outra maneira de definir manipuladores de eventos para `HttpApplication` eventos.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-147">*HTTP Modules* offer another way to define event handlers for `HttpApplication` events.</span></span> <span data-ttu-id="f1a3c-148">Módulos HTTP são criados como um arquivo de classe que pode ser colocado diretamente dentro do projeto de aplicativo web ou separado em uma biblioteca de classe separada.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-148">HTTP Modules are created as a class file that can be placed directly within the web application project or separated out into a separate class library.</span></span> <span data-ttu-id="f1a3c-149">Porque eles podem ser separados em uma biblioteca de classes, módulos HTTP oferecem um modelo mais flexível e reutilizável para a criação de `HttpApplication` manipuladores de eventos.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-149">Because they can be separated out into a class library, HTTP Modules offer a more flexible and reusable model for creating `HttpApplication` event handlers.</span></span> <span data-ttu-id="f1a3c-150">Enquanto o `Global.asax` arquivo é específico ao aplicativo web onde eles residem, módulos HTTP podem ser compilados em assemblies, no ponto em que adicionar o módulo HTTP para um site da Web é tão simple quanto soltando o assembly `Bin` pasta e registrando o Módulo no `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-150">Whereas the `Global.asax` file is specific to the web application where it resides, HTTP Modules can be compiled into assemblies, at which point adding the HTTP Module to a website is as simple as dropping the assembly in the `Bin` folder and registering the Module in `Web.config`.</span></span> <span data-ttu-id="f1a3c-151">Este tutorial não é afetada de criação e uso de módulos HTTP, mas as bibliotecas de log de erros de dois usadas nos dois tutoriais a seguir são implementadas como módulos HTTP.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-151">This tutorial does not look at creating and using HTTP Modules, but the two error logging libraries used in the following two tutorials are implemented as HTTP Modules.</span></span> <span data-ttu-id="f1a3c-152">Para obter mais informações sobre os benefícios dos módulos HTTP, consulte [usando módulos e manipuladores HTTP para criar componentes do ASP.NET conectáveis](https://msdn.microsoft.com/library/aa479332.aspx).</span><span class="sxs-lookup"><span data-stu-id="f1a3c-152">For more background on the benefits of HTTP Modules refer to [Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components](https://msdn.microsoft.com/library/aa479332.aspx).</span></span>


## <a name="retrieving-information-about-the-unhandled-exception"></a><span data-ttu-id="f1a3c-153">Recuperando informações sobre a exceção sem tratamento</span><span class="sxs-lookup"><span data-stu-id="f1a3c-153">Retrieving Information About the Unhandled Exception</span></span>

<span data-ttu-id="f1a3c-154">Neste ponto, temos um arquivo global. asax com um `Application_Error` manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-154">At this point we have a Global.asax file with an `Application_Error` event handler.</span></span> <span data-ttu-id="f1a3c-155">Quando esse manipulador de eventos é executado, é necessário notificar um desenvolvedor do erro e seus detalhes de log.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-155">When this event handler executes we need to notify a developer of the error and log its details.</span></span> <span data-ttu-id="f1a3c-156">Para realizar essas tarefas, primeiro precisamos determinar os detalhes da exceção que foi gerado.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-156">To accomplish these tasks we first need to determine the details of the exception that was raised.</span></span> <span data-ttu-id="f1a3c-157">Usar o objeto de servidor [ `GetLastError` método](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) para recuperar os detalhes da exceção sem tratamento que causou o `Error` evento seja acionado.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-157">Use the Server object's [`GetLastError` method](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) to retrieve details of the unhandled exception that caused the `Error` event to fire.</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample2.cs)]

<span data-ttu-id="f1a3c-158">O `GetLastError` método retorna um objeto do tipo `Exception`, que é o tipo base para todas as exceções no .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-158">The `GetLastError` method returns an object of type `Exception`, which is the base type for all exceptions in the .NET Framework.</span></span> <span data-ttu-id="f1a3c-159">No entanto, no código acima eu estou convertendo o objeto de exceção retornado pelo `GetLastError` em um `HttpException` objeto.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-159">However, in the code above I am casting the Exception object returned by `GetLastError` into an `HttpException` object.</span></span> <span data-ttu-id="f1a3c-160">Se o `Error` evento está sendo disparado porque ocorreu uma exceção durante o processamento de um recurso do ASP.NET e em seguida, a exceção foi gerada é encapsulada dentro de um `HttpException`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-160">If the `Error` event is being fired because an exception was thrown during the processing of an ASP.NET resource then the exception that was thrown is wrapped within an `HttpException`.</span></span> <span data-ttu-id="f1a3c-161">Para obter a exceção que originou o uso de eventos de erro realmente o `InnerException` propriedade.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-161">To get the actual exception that precipitated the Error event use the `InnerException` property.</span></span> <span data-ttu-id="f1a3c-162">Se o `Error` evento foi gerado devido a uma exceção com base em HTTP, como uma solicitação para uma página inexistente, um `HttpException` for lançada, mas não tem uma exceção interna.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-162">If the `Error` event was raised because of an HTTP-based exception, such as a request for a non-existent page, an `HttpException` is thrown, but it does not have an inner exception.</span></span>

<span data-ttu-id="f1a3c-163">O código a seguir usa o `GetLastErrormessage` para recuperar informações sobre a exceção que disparou a `Error` evento, armazenando os `HttpException` em uma variável chamada `lastErrorWrapper`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-163">The following code uses the `GetLastErrormessage` to retrieve information about the exception that triggered the `Error` event, storing the `HttpException` in a variable named `lastErrorWrapper`.</span></span> <span data-ttu-id="f1a3c-164">Em seguida, armazena o tipo, a mensagem e o rastreamento de pilha da exceção original em três variáveis de cadeia de caracteres, verificando se o `lastErrorWrapper` é a exceção real que disparou o `Error` evento (no caso de exceções com base em HTTP) ou se ele é meramente um wrapper para uma exceção foi acionada ao processar a solicitação.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-164">It then stores the type, message, and stack trace of the originating exception in three string variables, checking to see if the `lastErrorWrapper` is the actual exception that triggered the `Error` event (in the case of HTTP-based exceptions) or if it's merely a wrapper for an exception that was thrown while processing the request.</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample3.cs)]

<span data-ttu-id="f1a3c-165">Neste ponto, você tem todas as informações que você precisa escrever código que registrará em log os detalhes da exceção para uma tabela de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-165">At this point you have all the information you need to write code that will log the exception's details to a database table.</span></span> <span data-ttu-id="f1a3c-166">Você pode criar uma tabela de banco de dados com colunas para cada um dos detalhes do erro de interesse - o tipo, a mensagem, o rastreamento de pilha e assim por diante - juntamente com outras informações úteis, como a URL da página solicitada e o nome do usuário conectado no momento.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-166">You could create a database table with columns for each of the error details of interest - the type, the message, the stack trace, and so on - along with other useful pieces of information, such as the URL of the requested page and the name of the currently logged on user.</span></span> <span data-ttu-id="f1a3c-167">No `Application_Error` manipulador de eventos, em seguida, você se conectar ao banco de dados e inserir um registro na tabela.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-167">In the `Application_Error` event handler you would then connect to the database and insert a record into the table.</span></span> <span data-ttu-id="f1a3c-168">Da mesma forma, você poderia adicionar código para um desenvolvedor do erro por meio de email de alerta.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-168">Likewise, you could add code to alert a developer of the error via email.</span></span>

<span data-ttu-id="f1a3c-169">As bibliotecas de registro em log de erros examinadas nos próximos dois tutoriais fornecem essa funcionalidade de imediato, portanto, não há nenhuma necessidade de criar este registro em log o erro e notificação por conta própria.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-169">The error logging libraries examined in the next two tutorials provide such functionality out of the box, so there's no need to build this error logging and notification yourself.</span></span> <span data-ttu-id="f1a3c-170">No entanto, para ilustrar que o `Error` evento está sendo gerado e que o `Application_Error` manipulador de eventos pode ser usado para registrar em log os detalhes de erro e notificar um desenvolvedor, vamos adicionar código que notifica um desenvolvedor quando ocorre um erro.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-170">However, to illustrate that the `Error` event is being raised and that the `Application_Error` event handler can be used to log error details and notify a developer, let's add code that notifies a developer when an error occurs.</span></span>

## <a name="notifying-a-developer-when-an-unhandled-exception-occurs"></a><span data-ttu-id="f1a3c-171">Notificando um desenvolvedor quando ocorre uma exceção sem tratamento</span><span class="sxs-lookup"><span data-stu-id="f1a3c-171">Notifying a Developer When an Unhandled Exception Occurs</span></span>

<span data-ttu-id="f1a3c-172">Quando uma exceção sem tratamento ocorre no ambiente de produção é importante alertar a equipe de desenvolvimento para que eles possam avaliar o erro e determinar quais ações precisam ser tomadas.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-172">When an unhandled exception occurs in the production environment it is important to alert the development team so that they can assess the error and determine what actions need to be taken.</span></span> <span data-ttu-id="f1a3c-173">Por exemplo, se houver um erro ao conectar-se ao banco de dados, você precisará duplas Verifique sua cadeia de conexão e, talvez, abra um tíquete de suporte com a empresa de hospedagem.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-173">For example, if there is an error in connecting to the database then you'll need to double check your connection string and, perhaps, open a support ticket with your web hosting company.</span></span> <span data-ttu-id="f1a3c-174">Se a exceção ocorreu devido a um erro de programação, código ou lógica de validação talvez precise ser adicionado para evitar esses erros no futuro.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-174">If the exception occurred because of a programming error, additional code or validation logic may need to be added to prevent such errors in the future.</span></span>

<span data-ttu-id="f1a3c-175">As classes .NET Framework na [ `System.Net.Mail` namespace](https://msdn.microsoft.com/library/system.net.mail.aspx) tornam mais fácil de enviar um email.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-175">The .NET Framework classes in the [`System.Net.Mail` namespace](https://msdn.microsoft.com/library/system.net.mail.aspx) make it easy to send an email.</span></span> <span data-ttu-id="f1a3c-176">O [ `MailMessage` classe](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) representa uma mensagem de email e tem propriedades como `To`, `From`, `Subject`, `Body`, e `Attachments`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-176">The [`MailMessage` class](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) represents an email message and has properties like `To`, `From`, `Subject`, `Body`, and `Attachments`.</span></span> <span data-ttu-id="f1a3c-177">O `SmtpClass` é usado para enviar uma `MailMessage` usando um servidor SMTP especificado do objeto; as configurações do servidor SMTP podem ser especificadas de forma declarativa ou programaticamente na [ `<system.net>` elemento](https://msdn.microsoft.com/library/6484zdc1.aspx) no `Web.config file`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-177">The `SmtpClass` is used to send a `MailMessage` object using a specified SMTP server; the SMTP server settings can be specified programmatically or declaratively in the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx) in the `Web.config file`.</span></span> <span data-ttu-id="f1a3c-178">Para obter mais informações sobre o envio de email mensagens em um aplicativo ASP.NET Confira meu artigo [envio de Email no ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)e o [perguntas frequentes sobre o mail](http://systemnetmail.com/).</span><span class="sxs-lookup"><span data-stu-id="f1a3c-178">For more information on sending email messages in an ASP.NET application check out my article, [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx), and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>

> [!NOTE]
> <span data-ttu-id="f1a3c-179">O `<system.net>` elemento contém as configurações do servidor SMTP usadas pelo `SmtpClient` ao enviar um email de classe.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-179">The `<system.net>` element contains the SMTP server settings used by the `SmtpClient` class when sending an email.</span></span> <span data-ttu-id="f1a3c-180">Hospedagem da empresa provavelmente tem um servidor SMTP que você pode usar para enviar o email do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-180">Your web hosting company likely has an SMTP server that you can use to send email from your application.</span></span> <span data-ttu-id="f1a3c-181">Consulte a seção de suporte do host da web para obter informações sobre configurações do servidor SMTP, que você deve usar em seu aplicativo web.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-181">Consult your web host's support section for information on the SMTP server settings you should use in your web application.</span></span>


<span data-ttu-id="f1a3c-182">Adicione o seguinte código para o `Application_Error` manipulador de eventos para enviar um email de um desenvolvedor quando ocorre um erro:</span><span class="sxs-lookup"><span data-stu-id="f1a3c-182">Add the following code to the `Application_Error` event handler to send a developer an email when an error occurs:</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample4.cs)]

<span data-ttu-id="f1a3c-183">Enquanto o código acima é muito longo, a maior parte dele cria o HTML que aparece no email enviado para o desenvolvedor.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-183">While the above code is quite lengthy, the bulk of it creates the HTML that appears in the email sent to the developer.</span></span> <span data-ttu-id="f1a3c-184">O código começa fazendo referência a `HttpException` retornado pela `GetLastError` método (`lastErrorWrapper`).</span><span class="sxs-lookup"><span data-stu-id="f1a3c-184">The code starts by referencing the `HttpException` returned by the `GetLastError` method (`lastErrorWrapper`).</span></span> <span data-ttu-id="f1a3c-185">A exceção que foi gerada pela solicitação realmente é recuperada via `lastErrorWrapper.InnerException` e é atribuído à variável `lastError`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-185">The actual exception that was raised by the request is retrieved via `lastErrorWrapper.InnerException` and is assigned to the variable `lastError`.</span></span> <span data-ttu-id="f1a3c-186">O tipo, a mensagem e a pilha de informações de rastreamento são recuperadas do `lastError` e armazenados em três variáveis de cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-186">The type, message, and stack trace information is retrieved from `lastError` and stored in three string variables.</span></span>

<span data-ttu-id="f1a3c-187">Em seguida, uma `MailMessage` objeto chamado `mm` é criado.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-187">Next, a `MailMessage` object named `mm` is created.</span></span> <span data-ttu-id="f1a3c-188">O corpo do email é formatado em HTML e exibe a URL da página solicitada, o nome do usuário conectado no momento e informações sobre a exceção (o tipo de mensagem e rastreamento de pilha).</span><span class="sxs-lookup"><span data-stu-id="f1a3c-188">The email body is HTML formatted and displays the URL of the requested page, the name of the currently logged on user, and information about the exception (the type, message, and stack trace).</span></span> <span data-ttu-id="f1a3c-189">Uma das coisas legais sobre o `HttpException` classe é que você pode gerar o HTML usado para criar a exceção detalhes amarelo tela de morte (YSOD) chamando o [GetHtmlErrorMessage método](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span><span class="sxs-lookup"><span data-stu-id="f1a3c-189">One of the cool things about the `HttpException` class is that you can generate the HTML used to create the Exception Details Yellow Screen of Death (YSOD) by calling the [GetHtmlErrorMessage method](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span></span> <span data-ttu-id="f1a3c-190">Esse método é usado aqui para recuperar a marcação YSOD de detalhes da exceção e adicioná-lo para o email como um anexo.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-190">This method is used here to retrieve the Exception Details YSOD markup and add it to the email as an attachment.</span></span> <span data-ttu-id="f1a3c-191">Um aviso de cuidado: se a exceção que disparou a `Error` evento foi uma exceção com base em HTTP (por exemplo, uma solicitação para uma página inexistente) e em seguida, o `GetHtmlErrorMessage` método retornará `null`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-191">One word of caution: if the exception that triggered the `Error` event was an HTTP-based exception (such as a request for a non-existent page) then the `GetHtmlErrorMessage` method will return `null`.</span></span>

<span data-ttu-id="f1a3c-192">A etapa final é enviar o `MailMessage`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-192">The final step is to send the `MailMessage`.</span></span> <span data-ttu-id="f1a3c-193">Isso é feito criando um novo `SmtpClient` método e chamar seu `Send` método.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-193">This is done by creating a new `SmtpClient` method and calling its `Send` method.</span></span>

> [!NOTE]
> <span data-ttu-id="f1a3c-194">Antes de usar esse código em seu aplicativo web você desejará alterar os valores na `ToAddress` e `FromAddress` constantes da support@example.com a qualquer email endereço de email de notificação de erro devem ser enviados para e originam.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-194">Before using this code in your web application you'll want to change the values in the `ToAddress` and `FromAddress` constants from support@example.com to whatever email address the error notification email should be sent to and originate from.</span></span> <span data-ttu-id="f1a3c-195">Você também precisará especificar as configurações do servidor SMTP na `<system.net>` seção `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-195">You'll also need to specify SMTP server settings in the `<system.net>` section in `Web.config`.</span></span> <span data-ttu-id="f1a3c-196">Consulte seu provedor de host da web para determinar as configurações do servidor SMTP para usar.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-196">Consult your web host provider to determine the SMTP server settings to use.</span></span>


<span data-ttu-id="f1a3c-197">Com este código em lugar sempre que houver um erro, o desenvolvedor é enviado uma mensagem de email que resume o erro e inclui o YSOD.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-197">With this code in place anytime there's an error the developer is sent an email message that summarizes the error and includes the YSOD.</span></span> <span data-ttu-id="f1a3c-198">No tutorial anterior, demonstramos um erro de tempo de execução visitando Genre.aspx e passando um inválido `ID` de valor por meio da cadeia de consulta, como `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-198">In the preceding tutorial we demonstrated a runtime error by visiting Genre.aspx and passing in an invalid `ID` value through the querystring, like `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="f1a3c-199">Visitar a página com o `Global.asax` arquivo in-loco produz a mesma experiência de usuário, como no tutorial anterior - no ambiente de desenvolvimento você continuará vendo a exceção detalhes amarelo tela de morte, enquanto no ambiente de produção, você vai Consulte a página de erro personalizada.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-199">Visiting the page with the `Global.asax` file in place produces the same user experience as in the preceding tutorial - in the development environment you'll continue to see the Exception Details Yellow Screen of Death, while in the production environment you'll see the custom error page.</span></span> <span data-ttu-id="f1a3c-200">Além desse comportamento existente, o desenvolvedor é enviado um email.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-200">In addition to this existing behavior, the developer is sent an email.</span></span>

<span data-ttu-id="f1a3c-201">**Figura 2** mostra as mensagens de email recebidas quando visitar `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-201">**Figure 2** shows the email received when visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="f1a3c-202">O corpo do email resume as informações de exceção, enquanto o `YSOD.htm` anexo exibe o conteúdo que é mostrado na YSOD de detalhes de exceção (consulte **Figura3**).</span><span class="sxs-lookup"><span data-stu-id="f1a3c-202">The email body summarizes the exception information, while the `YSOD.htm` attachment displays the content that is shown in the Exception Details YSOD (see **Figure 3**).</span></span>

[![](processing-unhandled-exceptions-cs/_static/image5.png)](processing-unhandled-exceptions-cs/_static/image4.png)

<span data-ttu-id="f1a3c-203">**Figura 2**: O desenvolvedor é enviado uma notificação por Email sempre que houver uma exceção sem tratamento</span><span class="sxs-lookup"><span data-stu-id="f1a3c-203">**Figure 2**: The Developer Is Sent An Email Notification Whenever There's An Unhandled Exception</span></span>  
<span data-ttu-id="f1a3c-204">([Clique para exibir a imagem em tamanho normal](processing-unhandled-exceptions-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="f1a3c-204">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image6.png))</span></span>

[![](processing-unhandled-exceptions-cs/_static/image8.png)](processing-unhandled-exceptions-cs/_static/image7.png)

<span data-ttu-id="f1a3c-205">**Figura 3**: A notificação por Email inclui os detalhes da exceção YSOD como um anexo</span><span class="sxs-lookup"><span data-stu-id="f1a3c-205">**Figure 3**: The Email Notification Includes the Exception Details YSOD As An Attachment</span></span>  
<span data-ttu-id="f1a3c-206">([Clique para exibir a imagem em tamanho normal](processing-unhandled-exceptions-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="f1a3c-206">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image9.png))</span></span>

## <a name="what-about-using-the-custom-error-page"></a><span data-ttu-id="f1a3c-207">E quanto a usar a página de erro personalizada?</span><span class="sxs-lookup"><span data-stu-id="f1a3c-207">What About Using the Custom Error Page?</span></span>

<span data-ttu-id="f1a3c-208">Este tutorial mostrou como usar `Global.asax` e o `Application_Error` manipulador de eventos para executar código quando ocorre uma exceção sem tratamento.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-208">This tutorial showed how to use `Global.asax` and the `Application_Error` event handler to execute code when an unhandled exception occurs.</span></span> <span data-ttu-id="f1a3c-209">Especificamente, usamos este manipulador de eventos para notificar um desenvolvedor de um erro; Poderíamos ampliar para também registrar os detalhes do erro em um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-209">Specifically, we used this event handler to notify a developer of an error; we could extend it to also log the error details in a database.</span></span> <span data-ttu-id="f1a3c-210">A presença do `Application_Error` manipulador de eventos não afeta a experiência do usuário final.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-210">The presence of the `Application_Error` event handler does not affect the end user's experience.</span></span> <span data-ttu-id="f1a3c-211">Eles ainda veem a página de erro configurado, seja o YSOD de detalhes do erro, o YSOD de erro de tempo de execução ou a página de erro personalizada.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-211">They still see the configured error page, be it the Error Details YSOD, the Runtime Error YSOD, or the custom error page.</span></span>

<span data-ttu-id="f1a3c-212">É natural se preocupar se o `Global.asax` arquivo e `Application_Error` evento é necessário ao usar uma página de erro personalizada.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-212">It's natural to wonder whether the `Global.asax` file and `Application_Error` event is necessary when using a custom error page.</span></span> <span data-ttu-id="f1a3c-213">Quando ocorre um erro de usuário é mostrado a página de erro personalizada então por que não é possível colocamos o código para notificar o desenvolvedor e os detalhes do erro de log para a classe code-behind da página de erro personalizada?</span><span class="sxs-lookup"><span data-stu-id="f1a3c-213">When an error occurs the user is shown the custom error page so why can't we put the code to notify the developer and log the error details into the code-behind class of the custom error page?</span></span> <span data-ttu-id="f1a3c-214">Embora, certamente, você pode adicionar código à classe de code-behind da página de erro personalizadas não possuem acesso aos detalhes da exceção que disparou o `Error` evento ao usar a técnica que exploramos no tutorial anterior.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-214">While you can certainly add code to the custom error page's code-behind class you do not have access to the details of the exception that triggered the `Error` event when using the technique we explored in the preceding tutorial.</span></span> <span data-ttu-id="f1a3c-215">Chamar o `GetLastError` método de página de erro personalizada retorna `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-215">Calling the `GetLastError` method from the custom error page returns `Nothing`.</span></span>

<span data-ttu-id="f1a3c-216">O motivo para esse comportamento é porque a página de erro personalizada é alcançada por meio de um redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-216">The reason for this behavior is because the custom error page is reached via a redirect.</span></span> <span data-ttu-id="f1a3c-217">Quando uma exceção sem tratamento atinge o tempo de execução do ASP.NET pelo mecanismo ASP.NET gera sua `Error` evento (que executa o `Application_Error` manipulador de eventos) e, em seguida *redireciona* o usuário para a página de erro personalizada, emitindo um `Response.Redirect(customErrorPageUrl)`.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-217">When an unhandled exception reaches the ASP.NET runtime the ASP.NET engine raises its `Error` event (which executes the `Application_Error` event handler) and then *redirects* the user to the custom error page by issuing a `Response.Redirect(customErrorPageUrl)`.</span></span> <span data-ttu-id="f1a3c-218">O `Response.Redirect` método envia uma resposta ao cliente com um código de status HTTP 302, instruindo o navegador para solicitar uma nova URL, ou seja, a página de erro personalizada.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-218">The `Response.Redirect` method sends a response to the client with an HTTP 302 status code, instructing the browser to request a new URL, namely the custom error page.</span></span> <span data-ttu-id="f1a3c-219">O navegador solicita automaticamente essa nova página.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-219">The browser then automatically requests this new page.</span></span> <span data-ttu-id="f1a3c-220">Você pode dizer que a página de erro personalizada foi solicitada separadamente da página em que o erro foi originado porque a barra de endereços do navegador muda para a URL da página de erro personalizada (consulte **Figura 4**).</span><span class="sxs-lookup"><span data-stu-id="f1a3c-220">You can tell that the custom error page was requested separately from the page where the error originated because the browser's Address bar changes to the custom error page URL (see **Figure 4**).</span></span>

[![](processing-unhandled-exceptions-cs/_static/image11.png)](processing-unhandled-exceptions-cs/_static/image10.png)

<span data-ttu-id="f1a3c-221">**Figura 4**: quando ocorre um erro de navegador é redirecionado para a URL da página de erro personalizada</span><span class="sxs-lookup"><span data-stu-id="f1a3c-221">**Figure 4**: When an Error Occurs the Browser Gets Redirected to the Custom Error Page URL</span></span>  
<span data-ttu-id="f1a3c-222">([Clique para exibir a imagem em tamanho normal](processing-unhandled-exceptions-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="f1a3c-222">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image12.png))</span></span>

<span data-ttu-id="f1a3c-223">O efeito líquido é que a solicitação onde ocorreu a exceção sem tratamento termina quando o servidor responde com o redirecionamento HTTP 302.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-223">The net effect is that the request where the unhandled exception occurred ends when the server responds with the HTTP 302 redirect.</span></span> <span data-ttu-id="f1a3c-224">A solicitação subsequente para a página de erro personalizada é uma nova solicitação; Neste ponto, o ASP.NET mecanismo descartou as informações de erro e, além disso, não tem nenhuma maneira de associar a exceção sem tratamento na solicitação anterior com a nova solicitação para a página de erro personalizada.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-224">The subsequent request to the custom error page is a brand new request; by this point the ASP.NET engine has discarded the error information and, moreover, has no way to associate the unhandled exception in the previous request with the new request for the custom error page.</span></span> <span data-ttu-id="f1a3c-225">É por isso `GetLastError` retorna `null` quando chamado a partir da página de erro personalizada.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-225">This is why `GetLastError` returns `null` when called from the custom error page.</span></span>

<span data-ttu-id="f1a3c-226">No entanto, é possível fazer com que a página de erro personalizado executada durante a mesma solicitação que causou o erro.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-226">However, it is possible to have the custom error page executed during the same request that caused the error.</span></span> <span data-ttu-id="f1a3c-227">O [ `Server.Transfer(url)` ](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) método transfere a execução para a URL especificada e processa-os dentro da mesma solicitação.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-227">The [`Server.Transfer(url)`](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) method transfers execution to the specified URL and processes it within the same request.</span></span> <span data-ttu-id="f1a3c-228">Você pode mover o código na `Application_Error` manipulador de eventos à classe de code-behind da página de erro personalizada, substituindo-o no `Global.asax` com o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="f1a3c-228">You could move the code in the `Application_Error` event handler to the custom error page's code-behind class, replacing it in `Global.asax` with the following code:</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample5.cs)]

<span data-ttu-id="f1a3c-229">Agora quando ocorre uma exceção sem tratamento a `Application_Error` manipulador de eventos transfere o controle para a página de erro personalizado apropriado com base no código de status HTTP.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-229">Now when an unhandled exception occurs the `Application_Error` event handler transfers control to the appropriate custom error page based on the HTTP status code.</span></span> <span data-ttu-id="f1a3c-230">Como o controle foi transferido, a página de erro personalizado tem acesso às informações de exceção sem tratamento por meio de `Server.GetLastError` e podem notificar um desenvolvedor do erro e seus detalhes de log.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-230">Because control was transferred, the custom error page has access to the unhandled exception information via `Server.GetLastError` and can notify a developer of the error and log its details.</span></span> <span data-ttu-id="f1a3c-231">O `Server.Transfer` chamada interrompe o mecanismo do ASP.NET de redirecionar o usuário para a página de erro personalizada.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-231">The `Server.Transfer` call stops the ASP.NET engine from redirecting the user to the custom error page.</span></span> <span data-ttu-id="f1a3c-232">Em vez disso, o conteúdo da página de erro personalizada é retornado como a resposta para a página que gerou o erro.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-232">Instead, the custom error page's content is returned as the response to the page that generated the error.</span></span>

## <a name="summary"></a><span data-ttu-id="f1a3c-233">Resumo</span><span class="sxs-lookup"><span data-stu-id="f1a3c-233">Summary</span></span>

<span data-ttu-id="f1a3c-234">Quando ocorrer uma exceção sem tratamento em um aplicativo web ASP.NET o tempo de execução do ASP.NET gera o `Error` eventos e exibe a página de erro configurado.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-234">When an unhandled exception occurs in an ASP.NET web application the ASP.NET runtime raises the `Error` event and displays the configured error page.</span></span> <span data-ttu-id="f1a3c-235">Podemos pode notificar o desenvolvedor do erro, seus detalhes de log ou processá-lo de alguma outra forma, criando um manipulador de eventos para o evento de erro.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-235">We can notify the developer of the error, log its details, or process it in some other fashion, by creating an event handler for the Error event.</span></span> <span data-ttu-id="f1a3c-236">Há duas maneiras de criar um manipulador de eventos `HttpApplication` eventos como `Error`: no `Global.asax` arquivo ou de um módulo HTTP.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-236">There are two ways to create an event handler for `HttpApplication` events like `Error`: in the `Global.asax` file or from an HTTP Module.</span></span> <span data-ttu-id="f1a3c-237">Este tutorial mostrou como criar uma `Error` manipulador de eventos no `Global.asax` arquivo que notifica os desenvolvedores de um erro por meio de uma mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-237">This tutorial showed how to create an `Error` event handler in the `Global.asax` file that notifies developers of an error by means of an email message.</span></span>

<span data-ttu-id="f1a3c-238">Criando um `Error` manipulador de eventos é útil se você precisar processar exceções não tratadas de alguma maneira exclusiva ou personalizada.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-238">Creating an `Error` event handler is useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="f1a3c-239">No entanto, criar seu próprio `Error` manipulador de eventos para registrar a exceção ou para notificar um desenvolvedor não é o uso mais eficiente do seu tempo, pois já existem bibliotecas de registro em log de erro gratuito e fácil de usar que podem ser configurados em questão de minutos.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-239">However, creating your own `Error` event handler to log the exception or to notify a developer is not the most efficient use of your time as there already exist free and easy to use error logging libraries that can be setup in a matter of minutes.</span></span> <span data-ttu-id="f1a3c-240">Os próximos dois tutoriais examinam dois essas bibliotecas.</span><span class="sxs-lookup"><span data-stu-id="f1a3c-240">The next two tutorials examine two such libraries.</span></span>

<span data-ttu-id="f1a3c-241">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="f1a3c-241">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="f1a3c-242">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="f1a3c-242">Further Reading</span></span>

<span data-ttu-id="f1a3c-243">Para obter mais informações sobre os tópicos abordados neste tutorial, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="f1a3c-243">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="f1a3c-244">Módulos HTTP do ASP.NET e visão geral de manipuladores HTTP</span><span class="sxs-lookup"><span data-stu-id="f1a3c-244">ASP.NET HTTP Modules and HTTP Handlers Overview</span></span>](https://support.microsoft.com/kb/307985)
- [<span data-ttu-id="f1a3c-245">Normalmente, responder a exceções sem tratamento - processamento de exceções sem tratamento</span><span class="sxs-lookup"><span data-stu-id="f1a3c-245">Gracefully Responding to Unhandled Exceptions - Processing Unhandled Exceptions</span></span>](http://aspnet.4guysfromrolla.com/articles/091306-1.aspx)
- [<span data-ttu-id="f1a3c-246">`HttpApplication` Classe e o objeto de aplicativo do ASP.NET</span><span class="sxs-lookup"><span data-stu-id="f1a3c-246">`HttpApplication` Class and the ASP.NET Application Object</span></span>](http://www.eggheadcafe.com/articles/20030211.asp)
- [<span data-ttu-id="f1a3c-247">Manipuladores HTTP e módulos HTTP no ASP.NET</span><span class="sxs-lookup"><span data-stu-id="f1a3c-247">HTTP Handlers and HTTP Modules in ASP.NET</span></span>](http://www.15seconds.com/Issue/020417.htm)
- [<span data-ttu-id="f1a3c-248">Envio de Email no ASP.NET</span><span class="sxs-lookup"><span data-stu-id="f1a3c-248">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="f1a3c-249">Noções básicas sobre o `Global.asax` arquivo</span><span class="sxs-lookup"><span data-stu-id="f1a3c-249">Understanding the `Global.asax` File</span></span>](http://aspalliance.com/1114_Understanding_the_Globalasax_file.all)
- [<span data-ttu-id="f1a3c-250">Usando manipuladores e módulos HTTP para criar componentes ASP.NET conectáveis</span><span class="sxs-lookup"><span data-stu-id="f1a3c-250">Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components</span></span>](https://msdn.microsoft.com/library/aa479332.aspx)
- [<span data-ttu-id="f1a3c-251">Trabalhando com o ASP.NET `Global.asax` arquivo</span><span class="sxs-lookup"><span data-stu-id="f1a3c-251">Working with the ASP.NET `Global.asax` File</span></span>](http://articles.techrepublic.com.com/5100-10878_11-5771721.html)
- [<span data-ttu-id="f1a3c-252">Trabalhando com `HttpApplication` instâncias</span><span class="sxs-lookup"><span data-stu-id="f1a3c-252">Working with `HttpApplication` Instances</span></span>](https://msdn.microsoft.com/library/a0xez8f2.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="f1a3c-253">[Anterior](displaying-a-custom-error-page-cs.md)
> [Próximo](logging-error-details-with-asp-net-health-monitoring-cs.md)</span><span class="sxs-lookup"><span data-stu-id="f1a3c-253">[Previous](displaying-a-custom-error-page-cs.md)
[Next](logging-error-details-with-asp-net-health-monitoring-cs.md)</span></span>
