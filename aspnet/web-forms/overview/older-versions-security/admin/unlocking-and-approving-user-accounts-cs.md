---
uid: web-forms/overview/older-versions-security/admin/unlocking-and-approving-user-accounts-cs
title: Desbloqueio e aprovação de contas de usuário (c#) | Microsoft Docs
author: rick-anderson
description: Este tutorial mostra como criar uma página da web para os administradores gerenciarem bloqueada e aprovado o status dos usuários. Também veremos como aprovar o novo de usuários...
ms.author: riande
ms.date: 04/01/2008
ms.assetid: 5346aab1-9974-489f-a065-ae3883b8a350
msc.legacyurl: /web-forms/overview/older-versions-security/admin/unlocking-and-approving-user-accounts-cs
msc.type: authoredcontent
ms.openlocfilehash: 1a8373f62833c3a76d2e7f96193e5ecbe2d9c593
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/16/2018
ms.locfileid: "41833687"
---
<a name="unlocking-and-approving-user-accounts-c"></a><span data-ttu-id="02f24-104">Contas de usuário de desbloqueio e aprovação (c#)</span><span class="sxs-lookup"><span data-stu-id="02f24-104">Unlocking and Approving User Accounts (C#)</span></span>
====================
<span data-ttu-id="02f24-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="02f24-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="02f24-106">[Baixar o código](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.14.zip) ou [baixar PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial14_UnlockAndApprove_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="02f24-106">[Download Code](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.14.zip) or [Download PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial14_UnlockAndApprove_cs.pdf)</span></span>

> <span data-ttu-id="02f24-107">Este tutorial mostra como criar uma página da web para os administradores gerenciarem bloqueada e aprovado o status dos usuários.</span><span class="sxs-lookup"><span data-stu-id="02f24-107">This tutorial shows how to build a web page for administrators to manage users' locked out and approved statuses.</span></span> <span data-ttu-id="02f24-108">Também veremos como aprovar novos usuários somente depois que eles confirmaram seu endereço de email.</span><span class="sxs-lookup"><span data-stu-id="02f24-108">We will also see how to approve new users only after they have verified their email address.</span></span>


## <a name="introduction"></a><span data-ttu-id="02f24-109">Introdução</span><span class="sxs-lookup"><span data-stu-id="02f24-109">Introduction</span></span>

<span data-ttu-id="02f24-110">Junto com um nome de usuário, senha e email, cada conta de usuário tem dois campos de status que determinam se o usuário pode fazer logon no site: bloqueada e aprovada.</span><span class="sxs-lookup"><span data-stu-id="02f24-110">Along with a username, password, and email, each user account has two status fields that dictate whether the user can log into the site: locked out and approved.</span></span> <span data-ttu-id="02f24-111">Um usuário está bloqueado automaticamente se eles fornecem credenciais inválidas, um número especificado de vezes dentro de um número especificado de minutos (as configurações padrão bloquearem um usuário após 5 tentativas de logon inválidas dentro de 10 minutos).</span><span class="sxs-lookup"><span data-stu-id="02f24-111">A user is automatically locked out if they provide invalid credentials a specified number of times within a specified number of minutes (the default settings lock a user out after 5 invalid login attempts within 10 minutes).</span></span> <span data-ttu-id="02f24-112">O status aprovado é útil em cenários em que alguma ação deve ocorrer antes que um novo usuário é capaz de fazer logon site.</span><span class="sxs-lookup"><span data-stu-id="02f24-112">The approved status is useful in scenarios where some action must transpire before a new user is able to log on to the site.</span></span> <span data-ttu-id="02f24-113">Por exemplo, um usuário talvez precise primeiro verificar seu endereço de email ou ser aprovada por um administrador antes de poder fazer logon.</span><span class="sxs-lookup"><span data-stu-id="02f24-113">For example, a user might need to first verify their email address or be approved by an administrator before being able to login.</span></span>

<span data-ttu-id="02f24-114">Porque um bloqueados fora ou não aprovado o usuário não pode fazer logon, é natural apenas para estar se perguntando como esses status podem ser redefinidas.</span><span class="sxs-lookup"><span data-stu-id="02f24-114">Because a locked out or unapproved user cannot login, it's only natural to wonder how these statuses can be reset.</span></span> <span data-ttu-id="02f24-115">ASP.NET não inclui nenhuma funcionalidade interna ou controles da Web para o gerenciamento de usuários bloqueados e aprovada status, em parte porque essas decisões que precisam ser manipulados em uma base de site a site.</span><span class="sxs-lookup"><span data-stu-id="02f24-115">ASP.NET does not include any built-in functionality or Web controls for managing users' locked out and approved statuses, in part because these decisions need to be handled on a site-by-site basis.</span></span> <span data-ttu-id="02f24-116">Alguns sites podem aprovar automaticamente todas as novas contas de usuário (o comportamento padrão).</span><span class="sxs-lookup"><span data-stu-id="02f24-116">Some sites might automatically approve all new user accounts (the default behavior).</span></span> <span data-ttu-id="02f24-117">Outros têm um administrador aprove novas contas ou não aprovar os usuários até que eles visitam um link enviado para o endereço de email fornecido ao se inscrever.</span><span class="sxs-lookup"><span data-stu-id="02f24-117">Others have an administrator approve new accounts or do not approve users until they visit a link sent to the email address provided when they signed up.</span></span> <span data-ttu-id="02f24-118">Da mesma forma, alguns sites podem bloquear os usuários até que um administrador redefine seu status, enquanto outros sites envie um email para o usuário bloqueado com uma URL que eles podem visitar para desbloquear sua conta.</span><span class="sxs-lookup"><span data-stu-id="02f24-118">Likewise, some sites may lock out users until an administrator resets their status, while other sites send an email to the locked out user with a URL they can visit to unlock their account.</span></span>

<span data-ttu-id="02f24-119">Este tutorial mostra como criar uma página da web para os administradores gerenciarem bloqueada e aprovado o status dos usuários.</span><span class="sxs-lookup"><span data-stu-id="02f24-119">This tutorial shows how to build a web page for administrators to manage users' locked out and approved statuses.</span></span> <span data-ttu-id="02f24-120">Também veremos como aprovar novos usuários somente depois que eles confirmaram seu endereço de email.</span><span class="sxs-lookup"><span data-stu-id="02f24-120">We will also see how to approve new users only after they have verified their email address.</span></span>

## <a name="step-1-managing-users-locked-out-and-approved-statuses"></a><span data-ttu-id="02f24-121">Etapa 1: Gerenciar usuários bloqueada e status de aprovação</span><span class="sxs-lookup"><span data-stu-id="02f24-121">Step 1: Managing Users' Locked Out and Approved Statuses</span></span>

<span data-ttu-id="02f24-122">No <a id="Tutorial12"> </a> [ *criação de uma Interface para selecionar uma conta de usuário de muitos* ](building-an-interface-to-select-one-user-account-from-many-cs.md) tutorial, nós criamos uma página que listada cada conta de usuário no paginada, filtrados GridView.</span><span class="sxs-lookup"><span data-stu-id="02f24-122">In the <a id="Tutorial12"></a>[*Building an Interface to Select One User Account from Many*](building-an-interface-to-select-one-user-account-from-many-cs.md) tutorial we constructed a page that listed each user account in a paged, filtered GridView.</span></span> <span data-ttu-id="02f24-123">A grade lista o nome de cada usuário e email, seus status aprovados e bloqueadas, se eles estão online no momento e quaisquer comentários sobre o usuário.</span><span class="sxs-lookup"><span data-stu-id="02f24-123">The grid lists each user's name and email, their approved and locked out statuses, whether they're currently online, and any comments about the user.</span></span> <span data-ttu-id="02f24-124">Para gerenciar usuários aprovados e bloqueada status, poderíamos tornar essa grade editável.</span><span class="sxs-lookup"><span data-stu-id="02f24-124">To manage users' approved and locked out statuses, we could make this grid editable.</span></span> <span data-ttu-id="02f24-125">Para alterar o status de um usuário aprovado, o administrador teria primeiro localize a conta de usuário e, em seguida, edite a linha correspondente do GridView, marcando ou desmarcando a caixa de seleção aprovada.</span><span class="sxs-lookup"><span data-stu-id="02f24-125">To change a user's approved status, the administrator would first locate the user account and then edit the corresponding GridView row, checking or unchecking the approved checkbox.</span></span> <span data-ttu-id="02f24-126">Como alternativa, podemos pode gerenciar os status aprovados e bloqueados por meio de uma página separada do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="02f24-126">Alternatively, we could manage the approved and locked out statuses through a separate ASP.NET page.</span></span>

<span data-ttu-id="02f24-127">Para este tutorial vamos usar duas páginas do ASP.NET: `ManageUsers.aspx` e `UserInformation.aspx`.</span><span class="sxs-lookup"><span data-stu-id="02f24-127">For this tutorial let's use two ASP.NET pages: `ManageUsers.aspx` and `UserInformation.aspx`.</span></span> <span data-ttu-id="02f24-128">A ideia aqui é que `ManageUsers.aspx` lista as contas de usuário no sistema, enquanto `UserInformation.aspx` permite que o administrador gerencie os status aprovados e bloqueados para um usuário específico.</span><span class="sxs-lookup"><span data-stu-id="02f24-128">The idea here is that `ManageUsers.aspx` lists the user accounts in the system, while `UserInformation.aspx` enables the administrator to manage the approved and locked out statuses for a specific user.</span></span> <span data-ttu-id="02f24-129">Nossa tarefa prioritária é aumentar o GridView no `ManageUsers.aspx` para incluir um HyperLinkField, que é renderizado como uma coluna de links.</span><span class="sxs-lookup"><span data-stu-id="02f24-129">Our first order of business is to augment the GridView in `ManageUsers.aspx` to include a HyperLinkField, which renders as a column of links.</span></span> <span data-ttu-id="02f24-130">Queremos que cada link para apontar para `UserInformation.aspx?user=UserName`, onde *nome de usuário* é o nome do usuário para editar.</span><span class="sxs-lookup"><span data-stu-id="02f24-130">We want each link to point to `UserInformation.aspx?user=UserName`, where *UserName* is the name of the user to edit.</span></span>

> [!NOTE]
> <span data-ttu-id="02f24-131">Se você baixou o código para o <a id="Tutorial13"> </a> [ *Recovering e alterar as senhas* ](recovering-and-changing-passwords-cs.md) tutorial, você deve ter observado que o `ManageUsers.aspx` página já contém um conjunto de " Gerenciar"links e o `UserInformation.aspx` página fornece uma interface para alterar a senha do usuário selecionado.</span><span class="sxs-lookup"><span data-stu-id="02f24-131">If you downloaded the code for the <a id="Tutorial13"></a>[*Recovering and Changing Passwords*](recovering-and-changing-passwords-cs.md) tutorial you may have noticed that the `ManageUsers.aspx` page already contains a set of "Manage" links and the `UserInformation.aspx` page provides an interface for changing the selected user's password.</span></span> <span data-ttu-id="02f24-132">Decidi não replicar essa funcionalidade no código associado com este tutorial porque funcionou, evitando a API Membership e operar diretamente com o banco de dados do SQL Server para alterar a senha do usuário.</span><span class="sxs-lookup"><span data-stu-id="02f24-132">I decided not to replicate that functionality in the code associated with this tutorial because it worked by circumventing the Membership API and operating directly with the SQL Server database to change a user's password.</span></span> <span data-ttu-id="02f24-133">Este tutorial começa do zero com o `UserInformation.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="02f24-133">This tutorial starts from scratch with the `UserInformation.aspx` page.</span></span>


### <a name="adding-manage-links-to-theuseraccountsgridview"></a><span data-ttu-id="02f24-134">Adicionando "gerenciar" Links para o`UserAccounts`GridView</span><span class="sxs-lookup"><span data-stu-id="02f24-134">Adding "Manage" Links to the`UserAccounts`GridView</span></span>

<span data-ttu-id="02f24-135">Abra o `ManageUsers.aspx` da página e adicionar um HyperLinkField para o `UserAccounts` GridView.</span><span class="sxs-lookup"><span data-stu-id="02f24-135">Open the `ManageUsers.aspx` page and add a HyperLinkField to the `UserAccounts` GridView.</span></span> <span data-ttu-id="02f24-136">Defina o HyperLinkField `Text` propriedade para "Gerenciar" e seu `DataNavigateUrlFields` e `DataNavigateUrlFormatString` propriedades a serem `UserName` e "UserInformation.aspx?user={0}", respectivamente.</span><span class="sxs-lookup"><span data-stu-id="02f24-136">Set the HyperLinkField's `Text` property to "Manage" and its `DataNavigateUrlFields` and `DataNavigateUrlFormatString` properties to `UserName` and "UserInformation.aspx?user={0}", respectively.</span></span> <span data-ttu-id="02f24-137">Essas configurações definem o HyperLinkField, de modo que todos os hiperlinks exibem o texto "Gerenciar", mas cada link passa no respectivo *nome de usuário* valor na cadeia de consulta.</span><span class="sxs-lookup"><span data-stu-id="02f24-137">These settings configure the HyperLinkField such that all of the hyperlinks display the text "Manage", but each link passes in the appropriate *UserName* value into the querystring.</span></span>

<span data-ttu-id="02f24-138">Depois de adicionar o HyperLinkField a GridView, reserve um tempo para exibir o `ManageUsers.aspx` página por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="02f24-138">After adding the HyperLinkField to the GridView, take a moment to view the `ManageUsers.aspx` page through a browser.</span></span> <span data-ttu-id="02f24-139">Como mostra a Figura 1, cada linha de GridView agora inclui um link "Gerenciar".</span><span class="sxs-lookup"><span data-stu-id="02f24-139">As Figure 1 shows, each GridView row now includes a "Manage" link.</span></span> <span data-ttu-id="02f24-140">O link "Gerenciar" para Bruce aponta para `UserInformation.aspx?user=Bruce`, enquanto que o link "Gerenciar" de Dave aponta para `UserInformation.aspx?user=Dave`.</span><span class="sxs-lookup"><span data-stu-id="02f24-140">The "Manage" link for Bruce points to `UserInformation.aspx?user=Bruce`, whereas the "Manage" link for Dave points to `UserInformation.aspx?user=Dave`.</span></span>


<span data-ttu-id="02f24-141">[![Adiciona o HyperLinkField um](unlocking-and-approving-user-accounts-cs/_static/image2.png)](unlocking-and-approving-user-accounts-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="02f24-141">[![The HyperLinkField Adds a](unlocking-and-approving-user-accounts-cs/_static/image2.png)](unlocking-and-approving-user-accounts-cs/_static/image1.png)</span></span>

<span data-ttu-id="02f24-142">**Figura 1**: O HyperLinkField adiciona um Link "Gerenciar" para cada conta de usuário ([clique para exibir a imagem em tamanho normal](unlocking-and-approving-user-accounts-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="02f24-142">**Figure 1**: The HyperLinkField Adds a "Manage" Link for Each User Account  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image3.png))</span></span>


<span data-ttu-id="02f24-143">Criaremos a interface do usuário e de código para o `UserInformation.aspx` página em um momento, mas primeiro vamos falar sobre como alterar programaticamente um usuário do bloqueada e status de aprovação.</span><span class="sxs-lookup"><span data-stu-id="02f24-143">We will create the user interface and code for the `UserInformation.aspx` page in a moment, but first let's talk about how to programmatically change a user's locked out and approved statuses.</span></span> <span data-ttu-id="02f24-144">O [ `MembershipUser` classe](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) tem [ `IsLockedOut` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx) e [ `IsApproved` propriedades](https://msdn.microsoft.com/library/system.web.security.membershipuser.isapproved.aspx).</span><span class="sxs-lookup"><span data-stu-id="02f24-144">The [`MembershipUser` class](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) has [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx) and [`IsApproved` properties](https://msdn.microsoft.com/library/system.web.security.membershipuser.isapproved.aspx).</span></span> <span data-ttu-id="02f24-145">A propriedade `IsLockedOut` é somente leitura.</span><span class="sxs-lookup"><span data-stu-id="02f24-145">The `IsLockedOut` property is read-only.</span></span> <span data-ttu-id="02f24-146">Não há nenhum mecanismo para bloquear um usuário; por meio de programação para desbloquear um usuário, use o `MembershipUser` da classe [ `UnlockUser` método](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span><span class="sxs-lookup"><span data-stu-id="02f24-146">There is no mechanism to programmatically lock out a user; to unlock a user, use the `MembershipUser` class's [`UnlockUser` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span></span> <span data-ttu-id="02f24-147">O `IsApproved` propriedade é legível e gravável.</span><span class="sxs-lookup"><span data-stu-id="02f24-147">The `IsApproved` property is readable and writeable.</span></span> <span data-ttu-id="02f24-148">Para salvar as alterações a essa propriedade, precisamos chamar o `Membership` da classe [ `UpdateUser` método](https://msdn.microsoft.com/library/system.web.security.membership.updateuser.aspx), passando o modificado `MembershipUser` objeto.</span><span class="sxs-lookup"><span data-stu-id="02f24-148">To save any changes to this property, we need to call the `Membership` class's [`UpdateUser` method](https://msdn.microsoft.com/library/system.web.security.membership.updateuser.aspx), passing in the modified `MembershipUser` object.</span></span>

<span data-ttu-id="02f24-149">Porque o `IsApproved` é legível e gravável, um controle de caixa de seleção é provavelmente o melhor elemento de interface do usuário para configurar essa propriedade.</span><span class="sxs-lookup"><span data-stu-id="02f24-149">Because the `IsApproved` property is readable and writeable, a CheckBox control is probably the best user interface element for configuring this property.</span></span> <span data-ttu-id="02f24-150">No entanto, uma caixa de seleção não funcionará para o `IsLockedOut` propriedade porque um administrador não é possível bloquear um usuário, ela só poderá desbloquear um usuário.</span><span class="sxs-lookup"><span data-stu-id="02f24-150">However, a CheckBox will not work for the `IsLockedOut` property because an administrator cannot lock out a user, she may only unlock a user.</span></span> <span data-ttu-id="02f24-151">Uma interface de usuário adequados para o `IsLockedOut` propriedade é um botão que, quando clicado, desbloqueia a conta de usuário.</span><span class="sxs-lookup"><span data-stu-id="02f24-151">A suitable user interface for the `IsLockedOut` property is a Button that, when clicked, unlocks the user account.</span></span> <span data-ttu-id="02f24-152">Esse botão só deve ser habilitado se o usuário está bloqueado.</span><span class="sxs-lookup"><span data-stu-id="02f24-152">This Button should only be enabled if the user is locked out.</span></span>

### <a name="creating-theuserinformationaspxpage"></a><span data-ttu-id="02f24-153">Criando o`UserInformation.aspx`página</span><span class="sxs-lookup"><span data-stu-id="02f24-153">Creating the`UserInformation.aspx`Page</span></span>

<span data-ttu-id="02f24-154">Agora estamos prontos para implementar a interface do usuário em `UserInformation.aspx`.</span><span class="sxs-lookup"><span data-stu-id="02f24-154">We are now ready to implement the user interface in `UserInformation.aspx`.</span></span> <span data-ttu-id="02f24-155">Abrir essa página e adicione os seguintes controles da Web:</span><span class="sxs-lookup"><span data-stu-id="02f24-155">Open this page and add the following Web controls:</span></span>

- <span data-ttu-id="02f24-156">Controlar um hiperlink que, quando clicado, retorna ao administrador o `ManageUsers.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="02f24-156">A HyperLink control that, when clicked, returns the administrator to the `ManageUsers.aspx` page.</span></span>
- <span data-ttu-id="02f24-157">Um controle de Web de rótulo para exibir o nome do usuário selecionado.</span><span class="sxs-lookup"><span data-stu-id="02f24-157">A Label Web control for displaying the selected user's name.</span></span> <span data-ttu-id="02f24-158">Definir este rótulo `ID` à `UserNameLabel` e limpe seu `Text` propriedade.</span><span class="sxs-lookup"><span data-stu-id="02f24-158">Set this Label's `ID` to `UserNameLabel` and clear out its `Text` property.</span></span>
- <span data-ttu-id="02f24-159">Um controle de caixa de seleção denominado `IsApproved`.</span><span class="sxs-lookup"><span data-stu-id="02f24-159">A CheckBox control named `IsApproved`.</span></span> <span data-ttu-id="02f24-160">Defina suas `AutoPostBack` propriedade para `true`.</span><span class="sxs-lookup"><span data-stu-id="02f24-160">Set its `AutoPostBack` property to `true`.</span></span>
- <span data-ttu-id="02f24-161">Um controle de rótulo para exibir o usuário do bloqueado pela última data.</span><span class="sxs-lookup"><span data-stu-id="02f24-161">A Label control for displaying the user's last locked out date.</span></span> <span data-ttu-id="02f24-162">Nomeie este rótulo `LastLockedOutDateLabel` e limpe seu `Text` propriedade.</span><span class="sxs-lookup"><span data-stu-id="02f24-162">Name this Label `LastLockedOutDateLabel` and clear out its `Text` property.</span></span>
- <span data-ttu-id="02f24-163">Um botão para desbloquear o usuário.</span><span class="sxs-lookup"><span data-stu-id="02f24-163">A Button for unlocking the user.</span></span> <span data-ttu-id="02f24-164">Nomeie esse botão `UnlockUserButton` e defina seu `Text` propriedade para "Desbloquear usuário".</span><span class="sxs-lookup"><span data-stu-id="02f24-164">Name this Button `UnlockUserButton` and set its `Text` property to "Unlock User".</span></span>
- <span data-ttu-id="02f24-165">Um controle de rótulo para exibir mensagens de status, como, "o status do usuário aprovado foi atualizado."</span><span class="sxs-lookup"><span data-stu-id="02f24-165">A Label control for displaying status messages, such as, "The user's approved status has been updated."</span></span> <span data-ttu-id="02f24-166">Nomeie esse controle `StatusMessage`, desmarque out seus `Text` propriedade e defina seu `CssClass` propriedade para `Important`.</span><span class="sxs-lookup"><span data-stu-id="02f24-166">Name this control `StatusMessage`, clear out its `Text` property, and set its `CssClass` property to `Important`.</span></span> <span data-ttu-id="02f24-167">(O `Important` classe CSS é definida no `Styles.css` arquivo de folha de estilos; ele exibe o texto correspondente em uma fonte grande, vermelha.)</span><span class="sxs-lookup"><span data-stu-id="02f24-167">(The `Important` CSS class is defined in the `Styles.css` stylesheet file; it displays the corresponding text in a large, red font.)</span></span>

<span data-ttu-id="02f24-168">Depois de adicionar esses controles, o modo de exibição de Design no Visual Studio deve ser semelhante para a tela na Figura 2.</span><span class="sxs-lookup"><span data-stu-id="02f24-168">After adding these controls, the Design view in Visual Studio should look similar to the screen shot in Figure 2.</span></span>


<span data-ttu-id="02f24-169">[![Criar a Interface do usuário para UserInformation.aspx](unlocking-and-approving-user-accounts-cs/_static/image5.png)](unlocking-and-approving-user-accounts-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="02f24-169">[![Create the User Interface for UserInformation.aspx](unlocking-and-approving-user-accounts-cs/_static/image5.png)](unlocking-and-approving-user-accounts-cs/_static/image4.png)</span></span>

<span data-ttu-id="02f24-170">**Figura 2**: criar a Interface do usuário para `UserInformation.aspx` ([clique para exibir a imagem em tamanho normal](unlocking-and-approving-user-accounts-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="02f24-170">**Figure 2**: Create the User Interface for `UserInformation.aspx` ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image6.png))</span></span>


<span data-ttu-id="02f24-171">Com a interface de usuário completa, nossa próxima tarefa é definir o `IsApproved` caixa de seleção e outros controles com base nas informações do usuário selecionado.</span><span class="sxs-lookup"><span data-stu-id="02f24-171">With the user interface complete, our next task is to set the `IsApproved` CheckBox and other controls based on the selected user's information.</span></span> <span data-ttu-id="02f24-172">Criar um manipulador de eventos para a página `Load` eventos e adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="02f24-172">Create an event handler for the page's `Load` event and add the following code:</span></span>

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample1.cs)]

<span data-ttu-id="02f24-173">O código acima inicia, garantindo que se trata de primeira visita a página e não um postback subsequente.</span><span class="sxs-lookup"><span data-stu-id="02f24-173">The above code starts by ensuring that this is the first visit to the page and not a subsequent postback.</span></span> <span data-ttu-id="02f24-174">Em seguida, lê o nome de usuário passado a `user` campo querystring e recupera informações sobre essa conta de usuário por meio de `Membership.GetUser(username)` método.</span><span class="sxs-lookup"><span data-stu-id="02f24-174">It then reads the username passed through the `user` querystring field and retrieves information about that user account via the `Membership.GetUser(username)` method.</span></span> <span data-ttu-id="02f24-175">Se nenhum nome de usuário foi fornecido por meio da cadeia de consulta, ou se o usuário especificado não pôde ser encontrado, o administrador é enviado de volta ao `ManageUsers.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="02f24-175">If no username was supplied through the querystring, or if the specified user could not be found, the administrator is sent back to the `ManageUsers.aspx` page.</span></span>

<span data-ttu-id="02f24-176">O `MembershipUser` do objeto `UserName` valor, em seguida, é exibido na `UserNameLabel` e o `IsApproved` caixa de seleção é marcada com base no `IsApproved` valor da propriedade.</span><span class="sxs-lookup"><span data-stu-id="02f24-176">The `MembershipUser` object's `UserName` value is then displayed in the `UserNameLabel` and the `IsApproved` CheckBox is checked based on the `IsApproved` property value.</span></span>

<span data-ttu-id="02f24-177">O `MembershipUser` do objeto [ `LastLockoutDate` propriedade](https://msdn.microsoft.com/library/system.web.security.membershipuser.lastlockoutdate.aspx) retorna um `DateTime` valor que indica quando o usuário foi bloqueada. Se o usuário nunca foi bloqueado, o valor retornado depende do provedor de associação.</span><span class="sxs-lookup"><span data-stu-id="02f24-177">The `MembershipUser` object's [`LastLockoutDate` property](https://msdn.microsoft.com/library/system.web.security.membershipuser.lastlockoutdate.aspx) returns a `DateTime` value indicating when the user was last locked out. If the user has never been locked out, the value returned depends on the Membership provider.</span></span> <span data-ttu-id="02f24-178">Quando uma nova conta é criada, o `SqlMembershipProvider` define o `aspnet_Membership` da tabela `LastLockoutDate` campo `1754-01-01 12:00:00 AM`.</span><span class="sxs-lookup"><span data-stu-id="02f24-178">When a new account is created, the `SqlMembershipProvider` sets the `aspnet_Membership` table's `LastLockoutDate` field to `1754-01-01 12:00:00 AM`.</span></span> <span data-ttu-id="02f24-179">O código acima exibe uma cadeia de caracteres vazia do `LastLockoutDateLabel` se o `LastLockoutDate` propriedade ocorre antes do ano 2000; caso contrário, a parte de data a `LastLockoutDate` propriedade é exibida no rótulo.</span><span class="sxs-lookup"><span data-stu-id="02f24-179">The above code displays an empty string in the `LastLockoutDateLabel` if the `LastLockoutDate` property occurs before year 2000; otherwise, the date portion of the `LastLockoutDate` property is displayed in the Label.</span></span> <span data-ttu-id="02f24-180">O `UnlockUserButton'` s `Enabled` propriedade é definida para o usuário bloqueado status, que significa que esse botão só será habilitado se o usuário está bloqueado.</span><span class="sxs-lookup"><span data-stu-id="02f24-180">The `UnlockUserButton'` s `Enabled` property is set to the user's locked out status, meaning that this Button will only be enabled if the user is locked out.</span></span>

<span data-ttu-id="02f24-181">Reserve um tempo para testar o `UserInformation.aspx` página por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="02f24-181">Take a moment to test the `UserInformation.aspx` page through a browser.</span></span> <span data-ttu-id="02f24-182">Você, certamente, precisará iniciar em `ManageUsers.aspx` e selecione uma conta de usuário para gerenciar.</span><span class="sxs-lookup"><span data-stu-id="02f24-182">You will, of course, need to start at `ManageUsers.aspx` and select a user account to manage.</span></span> <span data-ttu-id="02f24-183">Ao chegar `UserInformation.aspx`, observe que o `IsApproved` caixa de seleção é verificada apenas se o usuário for aprovado.</span><span class="sxs-lookup"><span data-stu-id="02f24-183">Upon arriving at `UserInformation.aspx`, note that the `IsApproved` CheckBox is only checked if the user is approved.</span></span> <span data-ttu-id="02f24-184">Se o usuário já foi bloqueado, seu último bloqueado data é exibido.</span><span class="sxs-lookup"><span data-stu-id="02f24-184">If the user has ever been locked out, their last locked out date is displayed.</span></span> <span data-ttu-id="02f24-185">O botão Desbloquear usuário é habilitado apenas se o usuário está bloqueado no momento. Marcando ou desmarcando a `IsApproved` caixa de seleção ou clicando no botão Desbloquear usuário causa um postback, mas sem modificações são feitas para a conta de usuário porque ainda não encontramos criar manipuladores de eventos para esses eventos.</span><span class="sxs-lookup"><span data-stu-id="02f24-185">The Unlock User button is enabled only if the user is currently locked out. Checking or unchecking the `IsApproved` CheckBox or clicking the Unlock User button causes a postback, but no modifications are made to the user account because we've yet to create event handlers for these events.</span></span>

<span data-ttu-id="02f24-186">Retorne ao Visual Studio e criar manipuladores de eventos para o `IsApproved` da caixa de seleção `CheckedChanged` evento e o `UnlockUser` do botão `Click` eventos.</span><span class="sxs-lookup"><span data-stu-id="02f24-186">Return to Visual Studio and create event handlers for the `IsApproved` CheckBox's `CheckedChanged` event and the `UnlockUser` Button's `Click` event.</span></span> <span data-ttu-id="02f24-187">No `CheckedChanged` manipulador de eventos, defina o usuário `IsApproved` propriedade para o `Checked` propriedade da caixa de seleção e, em seguida, salve as alterações por meio de uma chamada para `Membership.UpdateUser`.</span><span class="sxs-lookup"><span data-stu-id="02f24-187">In the `CheckedChanged` event handler, set the user's `IsApproved` property to the `Checked` property of the CheckBox and then save the changes via a call to `Membership.UpdateUser`.</span></span> <span data-ttu-id="02f24-188">No `Click` manipulador de eventos, simplesmente a chamada a `MembershipUser` do objeto `UnlockUser` método.</span><span class="sxs-lookup"><span data-stu-id="02f24-188">In the `Click` event handler, simply call the `MembershipUser` object's `UnlockUser` method.</span></span> <span data-ttu-id="02f24-189">Em ambos os manipuladores de eventos, exiba uma mensagem adequada no `StatusMessage` rótulo.</span><span class="sxs-lookup"><span data-stu-id="02f24-189">In both event handlers, display a suitable message in the `StatusMessage` Label.</span></span>

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample2.cs)]

### <a name="testing-theuserinformationaspxpage"></a><span data-ttu-id="02f24-190">Testando o`UserInformation.aspx`página</span><span class="sxs-lookup"><span data-stu-id="02f24-190">Testing the`UserInformation.aspx`Page</span></span>

<span data-ttu-id="02f24-191">Com esses manipuladores de eventos em vigor, revisita a página aprovadas e um usuário.</span><span class="sxs-lookup"><span data-stu-id="02f24-191">With these event handlers in place, revisit the page and unapproved a user.</span></span> <span data-ttu-id="02f24-192">Como mostra a Figura 3, você deverá ver um resumo da mensagem na página indicando que o usuário `IsApproved` propriedade foi modificada com êxito.</span><span class="sxs-lookup"><span data-stu-id="02f24-192">As Figure 3 shows, you should see a brief message on the page indicating that the user's `IsApproved` property was successfully modified.</span></span>


<span data-ttu-id="02f24-193">[![Chris foi reprovado](unlocking-and-approving-user-accounts-cs/_static/image8.png)](unlocking-and-approving-user-accounts-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="02f24-193">[![Chris has been Unapproved](unlocking-and-approving-user-accounts-cs/_static/image8.png)](unlocking-and-approving-user-accounts-cs/_static/image7.png)</span></span>

<span data-ttu-id="02f24-194">**Figura 3**: Chris foi reprovado ([clique para exibir a imagem em tamanho normal](unlocking-and-approving-user-accounts-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="02f24-194">**Figure 3**: Chris has been Unapproved  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image9.png))</span></span>


<span data-ttu-id="02f24-195">Em seguida, logout e tente fazer logon como o usuário cuja conta foi apenas não aprovados.</span><span class="sxs-lookup"><span data-stu-id="02f24-195">Next, logout and try to login as the user whose account was just unapproved.</span></span> <span data-ttu-id="02f24-196">Porque o usuário não for aprovado, eles não podem fazer logon.</span><span class="sxs-lookup"><span data-stu-id="02f24-196">Because the user is not approved, they cannot login.</span></span> <span data-ttu-id="02f24-197">Por padrão, o controle de logon exibe a mesma mensagem se o usuário não pode fazer logon, independentemente do motivo.</span><span class="sxs-lookup"><span data-stu-id="02f24-197">By default, the Login control displays the same message if the user cannot login, regardless of the reason.</span></span> <span data-ttu-id="02f24-198">Mas no <a id="Tutorial6"> </a> [ *Validar usuário as credenciais contra a associação de usuário Store* ](../membership/validating-user-credentials-against-the-membership-user-store-cs.md) tutorial vimos aprimorando o controle de logon para exibir uma mensagem mais apropriada.</span><span class="sxs-lookup"><span data-stu-id="02f24-198">But in the <a id="Tutorial6"></a>[*Validating User Credentials Against the Membership User Store*](../membership/validating-user-credentials-against-the-membership-user-store-cs.md) tutorial we looked at enhancing the Login control to display a more appropriate message.</span></span> <span data-ttu-id="02f24-199">Como mostra a Figura 4, Chris é mostrado uma mensagem explicando o que ele não pode fazer logon porque sua conta ainda não foi aprovada.</span><span class="sxs-lookup"><span data-stu-id="02f24-199">As Figure 4 shows, Chris is shown a message explaining that he cannot login because his account is not yet approved.</span></span>


<span data-ttu-id="02f24-200">[![Chris não é possível porque o His conta de logon é reprovado](unlocking-and-approving-user-accounts-cs/_static/image11.png)](unlocking-and-approving-user-accounts-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="02f24-200">[![Chris Cannot Login Because His Account is Unapproved](unlocking-and-approving-user-accounts-cs/_static/image11.png)](unlocking-and-approving-user-accounts-cs/_static/image10.png)</span></span>

<span data-ttu-id="02f24-201">**Figura 4**: Chris não é possível porque o His conta de logon é reprovado ([clique para exibir a imagem em tamanho normal](unlocking-and-approving-user-accounts-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="02f24-201">**Figure 4**: Chris Cannot Login Because His Account is Unapproved  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image12.png))</span></span>


<span data-ttu-id="02f24-202">Para testar a funcionalidade bloqueada, tente fazer logon como um usuário aprovado, mas usar uma senha incorreta.</span><span class="sxs-lookup"><span data-stu-id="02f24-202">To test the locked out functionality, attempt to login as an approved user, but use an incorrect password.</span></span> <span data-ttu-id="02f24-203">Repita esse processo, o número necessário de vezes até que a conta do usuário foi bloqueada. O controle de logon também foi atualizado para mostrar um personalizado de mensagem se a tentativa de logon em uma conta bloqueada.</span><span class="sxs-lookup"><span data-stu-id="02f24-203">Repeat this process the necessary number of times until the user's account has been locked out. The Login control was also updated to show a custom message if attempting to login from a locked out account.</span></span> <span data-ttu-id="02f24-204">Você sabe que uma conta foi bloqueada depois que você começar a ver a seguinte mensagem na página de logon: "sua conta foi bloqueada devido a muitas tentativas de logon inválido.</span><span class="sxs-lookup"><span data-stu-id="02f24-204">You know that an account has been locked out once you start seeing the following message at the login page: "Your account has been locked out because of too many invalid login attempts.</span></span> <span data-ttu-id="02f24-205">Entre em contato com o administrador para configurar o desbloqueio da conta."</span><span class="sxs-lookup"><span data-stu-id="02f24-205">Please contact the administrator to have your account unlocked."</span></span>

<span data-ttu-id="02f24-206">Volte para o `ManageUsers.aspx` da página e clique no link Gerenciar para o usuário bloqueado.</span><span class="sxs-lookup"><span data-stu-id="02f24-206">Return to the `ManageUsers.aspx` page and click the Manage link for the locked out user.</span></span> <span data-ttu-id="02f24-207">Como mostra a Figura 5, você deverá ver um valor no `LastLockedOutDateLabel` botão Desbloquear o usuário deve ser habilitado.</span><span class="sxs-lookup"><span data-stu-id="02f24-207">As Figure 5 shows, you should see a value in the `LastLockedOutDateLabel` the Unlock User button should be enabled.</span></span> <span data-ttu-id="02f24-208">Clique no botão Desbloquear usuário para desbloquear a conta de usuário.</span><span class="sxs-lookup"><span data-stu-id="02f24-208">Click the Unlock User button to unlock the user account.</span></span> <span data-ttu-id="02f24-209">Depois que você conquistou o usuário, eles poderão fazer logon novamente.</span><span class="sxs-lookup"><span data-stu-id="02f24-209">Once you have unlocked the user, they will be able to login again.</span></span>


<span data-ttu-id="02f24-210">[![Dave foi bloqueado para o sistema](unlocking-and-approving-user-accounts-cs/_static/image14.png)](unlocking-and-approving-user-accounts-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="02f24-210">[![Dave Has Been Locked Out of the System](unlocking-and-approving-user-accounts-cs/_static/image14.png)](unlocking-and-approving-user-accounts-cs/_static/image13.png)</span></span>

<span data-ttu-id="02f24-211">**Figura 5**: Dave tem foram bloqueados fora do sistema ([clique para exibir a imagem em tamanho normal](unlocking-and-approving-user-accounts-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="02f24-211">**Figure 5**: Dave Has Been Locked Out of the System  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image15.png))</span></span>


## <a name="step-2-specifying-new-users-approved-status"></a><span data-ttu-id="02f24-212">Etapa 2: Especificar novos usuários aprovados Status</span><span class="sxs-lookup"><span data-stu-id="02f24-212">Step 2: Specifying New Users' Approved Status</span></span>

<span data-ttu-id="02f24-213">O status aprovado é útil em cenários em que você deseja que alguma ação a ser executada antes de um novo usuário é capaz de fazer logon e acessar os recursos específicos do usuário do site.</span><span class="sxs-lookup"><span data-stu-id="02f24-213">The approved status is useful in scenarios where you want some action to be performed before a new user is able to login and access the user-specific features of the site.</span></span> <span data-ttu-id="02f24-214">Por exemplo, você pode estar executando um site privado onde todas as páginas, exceto para as páginas de logon e inscrição, são acessíveis somente para usuários autenticados.</span><span class="sxs-lookup"><span data-stu-id="02f24-214">For example, you may be running a private website where all pages, except for the login and signup pages, are accessible only to authenticated users.</span></span> <span data-ttu-id="02f24-215">Mas o que acontece se um estranho atingir seu site, localiza a página de inscrição e cria uma conta?</span><span class="sxs-lookup"><span data-stu-id="02f24-215">But what happens if a stranger reaches your website, finds the signup page, and creates an account?</span></span> <span data-ttu-id="02f24-216">Para evitar que isso aconteça, você pode mover a página de inscrição para uma `Administration` pasta e exigem que um administrador crie manualmente cada conta.</span><span class="sxs-lookup"><span data-stu-id="02f24-216">To prevent this from happening you could move the signup page to an `Administration` folder, and require that an administrator manually create each account.</span></span> <span data-ttu-id="02f24-217">Como alternativa, você pode permitir que qualquer pessoa para a inscrição, mas proibir o acesso de site até que o administrador aprova a conta de usuário.</span><span class="sxs-lookup"><span data-stu-id="02f24-217">Alternatively, you could allow anyone to signup, but prohibit site access until an administrator approves the user account.</span></span>

<span data-ttu-id="02f24-218">Por padrão, o controle CreateUserWizard aprova novas contas.</span><span class="sxs-lookup"><span data-stu-id="02f24-218">By default, the CreateUserWizard control approves new accounts.</span></span> <span data-ttu-id="02f24-219">Você pode configurar esse comportamento usando o controle [ `DisableCreatedUser` propriedade](https://msdn.microsoft.com/en-gb/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx).</span><span class="sxs-lookup"><span data-stu-id="02f24-219">You can configure this behavior using the control's [`DisableCreatedUser` property](https://msdn.microsoft.com/en-gb/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx).</span></span> <span data-ttu-id="02f24-220">Defina essa propriedade como `true` por não aprovar as novas contas de usuário.</span><span class="sxs-lookup"><span data-stu-id="02f24-220">Set this property to `true` to not approve new user accounts.</span></span>

> [!NOTE]
> <span data-ttu-id="02f24-221">Por padrão o controle CreateUserWizard registra automaticamente na nova conta de usuário.</span><span class="sxs-lookup"><span data-stu-id="02f24-221">By default the CreateUserWizard control automatically logs on the new user account.</span></span> <span data-ttu-id="02f24-222">Esse comportamento é determinado pelo controle [ `LoginCreatedUser` propriedade](https://msdn.microsoft.com/en-gb/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx).</span><span class="sxs-lookup"><span data-stu-id="02f24-222">This behavior is dictated by the control's [`LoginCreatedUser` property](https://msdn.microsoft.com/en-gb/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx).</span></span> <span data-ttu-id="02f24-223">Porque não aprovados que os usuários não podem fazer logon no site, quando `DisableCreatedUser` é `true` nova conta de usuário não está conectada ao site, independentemente do valor de `LoginCreatedUser` propriedade.</span><span class="sxs-lookup"><span data-stu-id="02f24-223">Because unapproved users cannot login to the site, when `DisableCreatedUser` is `true` the new user account is not logged into the site, regardless of the value of the `LoginCreatedUser` property.</span></span>


<span data-ttu-id="02f24-224">Se você estiver criando programaticamente novas contas de usuário por meio de `Membership.CreateUser` método para criar uma conta de usuário não aprovados usam uma das sobrecargas que aceitam o novo usuário `IsApproved` valor da propriedade como um parâmetro de entrada.</span><span class="sxs-lookup"><span data-stu-id="02f24-224">If you are programmatically creating new user accounts via the `Membership.CreateUser` method, to create an unapproved user account use one of the overloads that accept the new user's `IsApproved` property value as an input parameter.</span></span>

## <a name="step-3-approving-users-by-verifying-their-email-address"></a><span data-ttu-id="02f24-225">Etapa 3: Aprovar os usuários, verificando seu endereço de Email</span><span class="sxs-lookup"><span data-stu-id="02f24-225">Step 3: Approving Users By Verifying their Email Address</span></span>

<span data-ttu-id="02f24-226">Muitos sites que dão suporte a contas de usuário não aprovem novos usuários até que eles Verifique se eles fornecidos ao registrar o endereço de email.</span><span class="sxs-lookup"><span data-stu-id="02f24-226">Many websites that support user accounts do not approve new users until they verify the email address they supplied when registering.</span></span> <span data-ttu-id="02f24-227">Esse processo de verificação normalmente é usado para impedir que outros os vigaristas, os remetentes de spam e bots conforme ele requer um endereço de email exclusivo, verificado e adiciona uma etapa extra no processo de inscrição.</span><span class="sxs-lookup"><span data-stu-id="02f24-227">This verification process is commonly used to thwart bots, spammers, and other ne'er-do-wells as it requires a unique, verified email address and adds an extra step in the signup process.</span></span> <span data-ttu-id="02f24-228">Com esse modelo, quando um novo usuário se inscreve, elas são enviadas uma mensagem de email que inclui um link para uma página de verificação.</span><span class="sxs-lookup"><span data-stu-id="02f24-228">With this model, when a new user signs up they are sent an email message that includes a link to a verification page.</span></span> <span data-ttu-id="02f24-229">Ao visitar o link o usuário tem comprovado que receberam o email e, portanto, o que o endereço de email fornecido é válido.</span><span class="sxs-lookup"><span data-stu-id="02f24-229">By visiting the link the user has proven that they received the email and, therefore, that the email address provided is valid.</span></span> <span data-ttu-id="02f24-230">A página de verificação é responsável pela aprovação do usuário.</span><span class="sxs-lookup"><span data-stu-id="02f24-230">The verification page is responsible for approving the user.</span></span> <span data-ttu-id="02f24-231">Isso pode ocorrer automaticamente, aprovação, portanto, qualquer usuário que atinge nessa página, ou somente depois que o usuário fornece informações adicionais, como uma [CAPTCHA](http://en.wikipedia.org/wiki/Captcha).</span><span class="sxs-lookup"><span data-stu-id="02f24-231">This may happen automatically, thereby approving any user who reaches this page, or only after the user provides some additional information, such as a [CAPTCHA](http://en.wikipedia.org/wiki/Captcha).</span></span>

<span data-ttu-id="02f24-232">Para acomodar esse fluxo de trabalho, é necessário primeiro atualizar a página de criação de conta para que os novos usuários não aprovados.</span><span class="sxs-lookup"><span data-stu-id="02f24-232">To accommodate this workflow, we need to first update the account creation page so that new users are unapproved.</span></span> <span data-ttu-id="02f24-233">Abra o `EnhancedCreateUserWizard.aspx` página o `Membership` pasta e defina o controle CreateUserWizard `DisableCreatedUser` propriedade para `true`.</span><span class="sxs-lookup"><span data-stu-id="02f24-233">Open the `EnhancedCreateUserWizard.aspx` page in the `Membership` folder and set the CreateUserWizard control's `DisableCreatedUser` property to `true`.</span></span>

<span data-ttu-id="02f24-234">Em seguida, precisamos configurar o controle CreateUserWizard para enviar um email para o novo usuário com instruções sobre como verificar sua conta.</span><span class="sxs-lookup"><span data-stu-id="02f24-234">Next, we need to configure the CreateUserWizard control to send an email to the new user with instructions on how to verify their account.</span></span> <span data-ttu-id="02f24-235">Em particular, estamos incluirá um link no email para o `Verification.aspx` página (que ainda não encontramos criar), passando o novo usuário `UserId` por meio da cadeia de consulta.</span><span class="sxs-lookup"><span data-stu-id="02f24-235">In particular, we will include a link in the email to the `Verification.aspx` page (which we've yet to create), passing in the new user's `UserId` through the querystring.</span></span> <span data-ttu-id="02f24-236">O `Verification.aspx` página irá pesquisar o usuário especificado e marcá-los aprovada.</span><span class="sxs-lookup"><span data-stu-id="02f24-236">The `Verification.aspx` page will lookup the specified user and mark them approved.</span></span>

### <a name="sending-a-verification-email-to-new-users"></a><span data-ttu-id="02f24-237">Enviar um Email de verificação para novos usuários</span><span class="sxs-lookup"><span data-stu-id="02f24-237">Sending a Verification Email to New Users</span></span>

<span data-ttu-id="02f24-238">Para enviar um email do controle CreateUserWizard, configure seu `MailDefinition` propriedade adequadamente.</span><span class="sxs-lookup"><span data-stu-id="02f24-238">To send an email from the CreateUserWizard control, configure its `MailDefinition` property appropriately.</span></span> <span data-ttu-id="02f24-239">Conforme discutido na <a id="Tutorial13"> </a> [tutorial anterior](recovering-and-changing-passwords-cs.md), os controles ChangePassword e PasswordRecovery incluem uma [ `MailDefinition` propriedade](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) que funciona da mesma maneira como do controle CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="02f24-239">As discussed in the <a id="Tutorial13"></a>[previous tutorial](recovering-and-changing-passwords-cs.md), the ChangePassword and PasswordRecovery controls include a [`MailDefinition` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) that works in the same manner as the CreateUserWizard control's.</span></span>

> [!NOTE]
> <span data-ttu-id="02f24-240">Para usar o `MailDefinition` opções de propriedade que você precisa para especificar a entrega de email no `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="02f24-240">To use the `MailDefinition` property you need to specify mail delivery options in `Web.config`.</span></span> <span data-ttu-id="02f24-241">Para obter mais informações, consulte [envio de Email no ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="02f24-241">For more information, refer to [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).</span></span>


<span data-ttu-id="02f24-242">Comece criando um novo modelo de email chamado `CreateUserWizard.txt` no `EmailTemplates` pasta.</span><span class="sxs-lookup"><span data-stu-id="02f24-242">Start by creating a new email template named `CreateUserWizard.txt` in the `EmailTemplates` folder.</span></span> <span data-ttu-id="02f24-243">Use o seguinte texto para o modelo:</span><span class="sxs-lookup"><span data-stu-id="02f24-243">Use the following text for the template:</span></span>

[!code-aspx[Main](unlocking-and-approving-user-accounts-cs/samples/sample3.aspx)]

<span data-ttu-id="02f24-244">Defina a `MailDefinition'` s `BodyFileName` propriedade como "~ / EmailTemplates/CreateUserWizard.txt" e seu `Subject` propriedade como "Bem-vindo ao meu site!</span><span class="sxs-lookup"><span data-stu-id="02f24-244">Set the `MailDefinition'` s `BodyFileName` property to "~/EmailTemplates/CreateUserWizard.txt" and its `Subject` property to "Welcome to My Website!</span></span> <span data-ttu-id="02f24-245">Ative sua conta".</span><span class="sxs-lookup"><span data-stu-id="02f24-245">Please activate your account."</span></span>

<span data-ttu-id="02f24-246">Observe que o `CreateUserWizard.txt` modelo de email inclui um `<%VerificationUrl%>` espaço reservado.</span><span class="sxs-lookup"><span data-stu-id="02f24-246">Note that the `CreateUserWizard.txt` email template includes a `<%VerificationUrl%>` placeholder.</span></span> <span data-ttu-id="02f24-247">É aí que a URL para o `Verification.aspx` página será colocada.</span><span class="sxs-lookup"><span data-stu-id="02f24-247">This is where the URL for the `Verification.aspx` page will be placed.</span></span> <span data-ttu-id="02f24-248">O CreateUserWizard substitui automaticamente o `<%UserName%>` e `<%Password%>` espaços reservados pelo nome de usuário e a senha, a nova conta, mas não há nenhum interno `<%VerificationUrl%>` espaço reservado.</span><span class="sxs-lookup"><span data-stu-id="02f24-248">The CreateUserWizard automatically replaces the `<%UserName%>` and `<%Password%>` placeholders with the new account's username and password, but there is no built-in `<%VerificationUrl%>` placeholder.</span></span> <span data-ttu-id="02f24-249">Precisamos substitui-lo manualmente com a URL de verificação apropriadas.</span><span class="sxs-lookup"><span data-stu-id="02f24-249">We need to manually replace it with the appropriate verification URL.</span></span>

<span data-ttu-id="02f24-250">Para fazer isso, crie um manipulador de eventos para o CreateUserWizard [ `SendingMail` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.sendingmail.aspx) e adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="02f24-250">To accomplish this, create an event handler for the CreateUserWizard's [`SendingMail` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.sendingmail.aspx) and add the following code:</span></span>

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample4.cs)]

<span data-ttu-id="02f24-251">O `SendingMail` evento é acionado depois que o `CreatedUser` evento, o que significa que no momento em que o manipulador de eventos acima executa o novo usuário de conta já foi criada.</span><span class="sxs-lookup"><span data-stu-id="02f24-251">The `SendingMail` event fires after the `CreatedUser` event, meaning that by the time the above event handler executes the new user account has already been created.</span></span> <span data-ttu-id="02f24-252">Podemos acessar o novo usuário `UserId` valor chamando o `Membership.GetUser` método, passando o `UserName` inseridos no controle CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="02f24-252">We can access the new user's `UserId` value by calling the `Membership.GetUser` method, passing in the `UserName` entered into the CreateUserWizard control.</span></span> <span data-ttu-id="02f24-253">Em seguida, a URL de verificação é formada.</span><span class="sxs-lookup"><span data-stu-id="02f24-253">Next, the verification URL is formed.</span></span> <span data-ttu-id="02f24-254">A instrução `Request.Url.GetLeftPart(UriPartial.Authority)` retorna o `http://yourserver.com` parte da URL; `Request.ApplicationPath` caminho retorna em que o aplicativo está enraizado.</span><span class="sxs-lookup"><span data-stu-id="02f24-254">The statement `Request.Url.GetLeftPart(UriPartial.Authority)` returns the `http://yourserver.com` portion of the URL; `Request.ApplicationPath` returns path where the application is rooted.</span></span> <span data-ttu-id="02f24-255">A verificação de URL, em seguida, é definido como `Verification.aspx?ID=userId`.</span><span class="sxs-lookup"><span data-stu-id="02f24-255">The verification URL is then defined as `Verification.aspx?ID=userId`.</span></span> <span data-ttu-id="02f24-256">Essas duas cadeias de caracteres, em seguida, são concatenadas para formar a URL completa.</span><span class="sxs-lookup"><span data-stu-id="02f24-256">These two strings are then concatenated to form the complete URL.</span></span> <span data-ttu-id="02f24-257">Por fim, o corpo da mensagem de email (`e.Message.Body`) tem todas as ocorrências de `<%VerificationUrl%>` substituído com a URL completa.</span><span class="sxs-lookup"><span data-stu-id="02f24-257">Finally, the email message body (`e.Message.Body`) has all occurrences of `<%VerificationUrl%>` replaced with the full URL.</span></span>

<span data-ttu-id="02f24-258">O efeito líquido é que novos usuários são não aprovados, o que significa que eles não podem fazer logon no site.</span><span class="sxs-lookup"><span data-stu-id="02f24-258">The net effect is that new users are unapproved, meaning that they cannot log into the site.</span></span> <span data-ttu-id="02f24-259">Além disso, elas são enviadas automaticamente um email com um link para a URL de verificação (veja a Figura 6).</span><span class="sxs-lookup"><span data-stu-id="02f24-259">Furthermore, they are automatically sent an email with a link to the verification URL (see Figure 6).</span></span>


<span data-ttu-id="02f24-260">[![O novo usuário recebe um Email com um Link para a URL de verificação](unlocking-and-approving-user-accounts-cs/_static/image17.png)](unlocking-and-approving-user-accounts-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="02f24-260">[![The New User Receives an Email with a Link to the Verification URL](unlocking-and-approving-user-accounts-cs/_static/image17.png)](unlocking-and-approving-user-accounts-cs/_static/image16.png)</span></span>

<span data-ttu-id="02f24-261">**Figura 6**: O novo usuário recebe um Email com um Link para a URL de verificação ([clique para exibir a imagem em tamanho normal](unlocking-and-approving-user-accounts-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="02f24-261">**Figure 6**: The New User Receives an Email with a Link to the Verification URL  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image18.png))</span></span>


> [!NOTE]
> <span data-ttu-id="02f24-262">Etapa de CreateUserWizard padrão do controle CreateUserWizard exibe uma mensagem informando ao usuário sua conta foi criada e exibe um botão continuar.</span><span class="sxs-lookup"><span data-stu-id="02f24-262">The CreateUserWizard control's default CreateUserWizard step displays a message informing the user their account has been created and displays a Continue button.</span></span> <span data-ttu-id="02f24-263">Se você clicar nesta leva o usuário para a URL especificada pelo controle de `ContinueDestinationPageUrl` propriedade.</span><span class="sxs-lookup"><span data-stu-id="02f24-263">Clicking this takes the user to the URL specified by the control's `ContinueDestinationPageUrl` property.</span></span> <span data-ttu-id="02f24-264">O CreateUserWizard na `EnhancedCreateUserWizard.aspx` está configurado para enviar os novos usuários a `~/Membership/AdditionalUserInfo.aspx`, que solicita ao usuário sua cidade natal, a URL da home page e a assinatura.</span><span class="sxs-lookup"><span data-stu-id="02f24-264">The CreateUserWizard in `EnhancedCreateUserWizard.aspx` is configured to send new users to the `~/Membership/AdditionalUserInfo.aspx`, which prompts the user for their hometown, homepage URL, and signature.</span></span> <span data-ttu-id="02f24-265">Como essas informações só podem ser adicionadas por usuários conectados, faz sentido para atualizar essa propriedade para enviar aos usuários para a home page do site (`~/Default.aspx`).</span><span class="sxs-lookup"><span data-stu-id="02f24-265">Because this information can only be added by logged on users, it makes sense to update this property to send users back to the site's homepage (`~/Default.aspx`).</span></span> <span data-ttu-id="02f24-266">Além disso, o `EnhancedCreateUserWizard.aspx` página ou a etapa CreateUserWizard deve ser aumentada para informar ao usuário que eles receberam um email de verificação e sua conta não será ativada até que eles sigam as instruções neste email.</span><span class="sxs-lookup"><span data-stu-id="02f24-266">Moreover, the `EnhancedCreateUserWizard.aspx` page or the CreateUserWizard step should be augmented to inform the user that they have been sent a verification email and their account won't be activated until they follow the instructions in this email.</span></span> <span data-ttu-id="02f24-267">Vou deixar essas modificações como um exercício para o leitor.</span><span class="sxs-lookup"><span data-stu-id="02f24-267">I leave these modifications as an exercise for the reader.</span></span>


### <a name="creating-the-verification-page"></a><span data-ttu-id="02f24-268">Criando a página de verificação</span><span class="sxs-lookup"><span data-stu-id="02f24-268">Creating the Verification Page</span></span>

<span data-ttu-id="02f24-269">Nossa tarefa final é criar o `Verification.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="02f24-269">Our final task is to create the `Verification.aspx` page.</span></span> <span data-ttu-id="02f24-270">Adicione esta página para a pasta raiz, associando-o `Site.master` página mestra.</span><span class="sxs-lookup"><span data-stu-id="02f24-270">Add this page to the root folder, associating it with the `Site.master` master page.</span></span> <span data-ttu-id="02f24-271">Assim como fizemos com a maioria das páginas de conteúdo anteriores adicionadas ao site, remova o controle de conteúdo que faz referência a `LoginContent` ContentPlaceHolder para que a página de conteúdo usa a página mestra padrão conteúdo.</span><span class="sxs-lookup"><span data-stu-id="02f24-271">As we've done with most of the previous content pages added to the site, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the content page uses the master page's default content.</span></span>

<span data-ttu-id="02f24-272">Adicionar um controle de Web de rótulo para o `Verification.aspx` , defina sua `ID` para `StatusMessage` e limpar sua propriedade text.</span><span class="sxs-lookup"><span data-stu-id="02f24-272">Add a Label Web control to the `Verification.aspx` page, set its `ID` to `StatusMessage` and clear out its text property.</span></span> <span data-ttu-id="02f24-273">Em seguida, crie o `Page_Load` manipulador de eventos e adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="02f24-273">Next, create the `Page_Load` event handler and add the following code:</span></span>

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample5.cs)]

<span data-ttu-id="02f24-274">A maior parte do código acima verifica se o `UserId` fornecido por meio de querystring existe, que é válido `Guid` valor e que ela faz referência a uma conta de usuário.</span><span class="sxs-lookup"><span data-stu-id="02f24-274">The bulk of the above code verifies that the `UserId` supplied through the querystring exists, that it is a valid `Guid` value, and that it references an existing user account.</span></span> <span data-ttu-id="02f24-275">Se todas essas verificações passarem, a conta de usuário for aprovada; Caso contrário, será exibida uma mensagem de status adequado.</span><span class="sxs-lookup"><span data-stu-id="02f24-275">If all of these checks pass, the user account is approved; otherwise, a suitable status message is displayed.</span></span>

<span data-ttu-id="02f24-276">A Figura 7 mostra o `Verification.aspx` página quando acessadas por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="02f24-276">Figure 7 shows the `Verification.aspx` page when visited through a browser.</span></span>


<span data-ttu-id="02f24-277">[![A nova conta de usuário é agora aprovadas](unlocking-and-approving-user-accounts-cs/_static/image20.png)](unlocking-and-approving-user-accounts-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="02f24-277">[![The New User's Account is Now Approved](unlocking-and-approving-user-accounts-cs/_static/image20.png)](unlocking-and-approving-user-accounts-cs/_static/image19.png)</span></span>

<span data-ttu-id="02f24-278">**Figura 7**: conta de usuário nova a é agora aprovadas ([clique para exibir a imagem em tamanho normal](unlocking-and-approving-user-accounts-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="02f24-278">**Figure 7**: The New User's Account is Now Approved  ([Click to view full-size image](unlocking-and-approving-user-accounts-cs/_static/image21.png))</span></span>


## <a name="summary"></a><span data-ttu-id="02f24-279">Resumo</span><span class="sxs-lookup"><span data-stu-id="02f24-279">Summary</span></span>

<span data-ttu-id="02f24-280">Todas as contas de usuário de associação tem dois status que determinam se o usuário pode fazer logon no site: `IsLockedOut` e `IsApproved`.</span><span class="sxs-lookup"><span data-stu-id="02f24-280">All Membership user accounts have two statuses that determine whether the user can log into the site: `IsLockedOut` and `IsApproved`.</span></span> <span data-ttu-id="02f24-281">Ambas as propriedades devem ser `true` para o usuário faça logon.</span><span class="sxs-lookup"><span data-stu-id="02f24-281">Both of these properties must be `true` for the user to login.</span></span>

<span data-ttu-id="02f24-282">O usuário do bloqueado status é usado como uma medida de segurança para reduzir a probabilidade de um hacker invadir um site por meio de métodos de força bruta.</span><span class="sxs-lookup"><span data-stu-id="02f24-282">The user's locked out status is used as a security measure to reduce the likelihood of a hacker breaking into a site through brute force methods.</span></span> <span data-ttu-id="02f24-283">Especificamente, um usuário é bloqueado se houver um determinado número de tentativas inválidas de logon dentro de um determinado intervalo de tempo.</span><span class="sxs-lookup"><span data-stu-id="02f24-283">Specifically, a user is locked out if there are a certain number of invalid login attempts within a certain window of time.</span></span> <span data-ttu-id="02f24-284">Esses limites são configuráveis por meio das configurações de provedor de associação no `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="02f24-284">These bounds are configurable through the Membership provider settings in `Web.config`.</span></span>

<span data-ttu-id="02f24-285">O status aprovado normalmente é usado como um meio para impedir que novos usuários de fazer logon até que alguma ação ocorreu.</span><span class="sxs-lookup"><span data-stu-id="02f24-285">The approved status is commonly used as a means to prohibit new users from logging in until some action has transpired.</span></span> <span data-ttu-id="02f24-286">Talvez o site requer que novas contas primeiro sejam aprovadas pelo administrador ou, como vimos na etapa 3, verificando seu endereço de email.</span><span class="sxs-lookup"><span data-stu-id="02f24-286">Perhaps the site requires that new accounts first be approved by the administrator or, as we saw in Step 3, by verifying their email address.</span></span>

<span data-ttu-id="02f24-287">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="02f24-287">Happy Programming!</span></span>

### <a name="about-the-author"></a><span data-ttu-id="02f24-288">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="02f24-288">About the Author</span></span>

<span data-ttu-id="02f24-289">Scott Mitchell, autor de vários livros sobre ASP/ASP.NET e fundador da 4GuysFromRolla.com, trabalha com tecnologias Web Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="02f24-289">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="02f24-290">Scott funciona como um consultor independente, instrutor e escritor.</span><span class="sxs-lookup"><span data-stu-id="02f24-290">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="02f24-291">Seu livro mais recente é  *[Sams Teach por conta própria ASP.NET 2.0 em 24 horas](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="02f24-291">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="02f24-292">Scott pode ser contatado pelo [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) ou por meio de seu blog em [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="02f24-292">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="02f24-293">Agradecimentos especiais a...</span><span class="sxs-lookup"><span data-stu-id="02f24-293">Special Thanks To…</span></span>

<span data-ttu-id="02f24-294">Esta série de tutoriais foi revisada por muitos revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="02f24-294">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="02f24-295">Você está interessado na revisão Meus próximos artigos do MSDN?</span><span class="sxs-lookup"><span data-stu-id="02f24-295">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="02f24-296">Nesse caso, escreva-me em [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="02f24-296">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="02f24-297">[Anterior](recovering-and-changing-passwords-cs.md)
> [Próximo](building-an-interface-to-select-one-user-account-from-many-vb.md)</span><span class="sxs-lookup"><span data-stu-id="02f24-297">[Previous](recovering-and-changing-passwords-cs.md)
[Next](building-an-interface-to-select-one-user-account-from-many-vb.md)</span></span>
