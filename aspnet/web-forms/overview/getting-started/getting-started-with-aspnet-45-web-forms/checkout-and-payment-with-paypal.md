---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal
title: Check-out e pagamento com o PayPal | Microsoft Docs
author: Erikre
description: Esta série de tutoriais ensinará os conceitos básicos da criação de um aplicativo de Web Forms do ASP.NET usando o ASP.NET 4.5 e do Microsoft Visual Studio Express 2013 para nós...
ms.author: aspnetcontent
manager: wpickett
ms.date: 09/08/2014
ms.topic: article
ms.assetid: 664ec95e-b0c9-4f43-a39f-798d0f2a7e08
ms.technology: dotnet-webforms
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal
msc.type: authoredcontent
ms.openlocfilehash: e516bcccdecce72d4fa6c705b0227ce873429e3c
ms.sourcegitcommit: 953ff9ea4369f154d6fd0239599279ddd3280009
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/03/2018
ms.locfileid: "37386652"
---
<a name="checkout-and-payment-with-paypal"></a><span data-ttu-id="3f1a4-103">Check-out e pagamento com o PayPal</span><span class="sxs-lookup"><span data-stu-id="3f1a4-103">Checkout and Payment with PayPal</span></span>
====================
<span data-ttu-id="3f1a4-104">por [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="3f1a4-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

<span data-ttu-id="3f1a4-105">[Baixe o projeto de exemplo do Wingtip Toys (c#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) ou [Baixe o livro eletrônico (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span><span class="sxs-lookup"><span data-stu-id="3f1a4-105">[Download Wingtip Toys Sample Project (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) or [Download E-book (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span></span>

> <span data-ttu-id="3f1a4-106">Esta série de tutoriais ensinará os conceitos básicos da criação de um aplicativo de Web Forms do ASP.NET usando o ASP.NET 4.5 e do Microsoft Visual Studio Express 2013 para Web.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-106">This tutorial series will teach you the basics of building an ASP.NET Web Forms application using ASP.NET 4.5 and Microsoft Visual Studio Express 2013 for Web.</span></span> <span data-ttu-id="3f1a4-107">Um Visual Studio 2013 [projeto com código-fonte c#](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) está disponível para acompanhar esta série de tutoriais.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-107">A Visual Studio 2013 [project with C# source code](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) is available to accompany this tutorial series.</span></span>


<span data-ttu-id="3f1a4-108">Este tutorial descreve como modificar o aplicativo de exemplo Wingtip Toys para incluir a autorização do usuário, registro e pagamento usando PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-108">This tutorial describes how to modify the Wingtip Toys sample application to include user authorization, registration, and payment using PayPal.</span></span> <span data-ttu-id="3f1a4-109">Somente os usuários que estão conectados no terá autorização para adquirir produtos.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-109">Only users who are logged in will have authorization to purchase products.</span></span> <span data-ttu-id="3f1a4-110">Funcionalidade de registro de usuário internas do modelo de projeto Web Forms do ASP.NET 4.5 já inclui muito o que você precisa.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-110">The ASP.NET 4.5 Web Forms project template's built-in user registration functionality already includes much of what you need.</span></span> <span data-ttu-id="3f1a4-111">Você adicionará a funcionalidade de check-out PayPal Express.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-111">You will add PayPal Express Checkout functionality.</span></span> <span data-ttu-id="3f1a4-112">Neste tutorial você estar usando o desenvolvedor PayPal ambiente, de teste para que nenhum fundos reais serão transferidos.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-112">In this tutorial you be using the PayPal developer testing environment, so no actual funds will be transferred.</span></span> <span data-ttu-id="3f1a4-113">No final do tutorial, você testará o aplicativo, selecionando os produtos para adicionar ao carrinho de compras, clicando no botão de check-out e transferir dados para o site de teste do PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-113">At the end of the tutorial, you will test the application by selecting products to add to the shopping cart, clicking the checkout button, and transferring data to the PayPal testing web site.</span></span> <span data-ttu-id="3f1a4-114">No site de web de teste do PayPal, você confirmar suas informações de envio e de pagamento e, em seguida, retornar ao aplicativo de exemplo Wingtip Toys local para confirmar e concluir a compra.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-114">On the PayPal testing web site, you will confirm your shipping and payment information and then return to the local Wingtip Toys sample application to confirm and complete the purchase.</span></span>

<span data-ttu-id="3f1a4-115">Há vários processadores de pagamento de terceiros experientes especializados em compras online, essa segurança e escalabilidade do endereço.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-115">There are several experienced third-party payment processors that specialize in online shopping that address scalability and security.</span></span> <span data-ttu-id="3f1a4-116">Os desenvolvedores ASP.NET devem considerar as vantagens de utilização de uma solução de pagamento de terceiros antes de implementar um processo de compras e comprar a solução.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-116">ASP.NET developers should consider the advantages of utilizing a third party payment solution before implementing a shopping and purchasing solution.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="3f1a4-117">O aplicativo de exemplo Wingtip Toys foi projetado para mostrado conceitos específicos do ASP.NET e os recursos disponíveis para os desenvolvedores da web do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-117">The Wingtip Toys sample application was designed to shown specific ASP.NET concepts and features available to ASP.NET web developers.</span></span> <span data-ttu-id="3f1a4-118">Este aplicativo de exemplo não estava otimizado para todas as circunstâncias possíveis em relação à segurança e escalabilidade.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-118">This sample application was not optimized for all possible circumstances in regard to scalability and security.</span></span>


## <a name="what-youll-learn"></a><span data-ttu-id="3f1a4-119">O que você aprenderá:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-119">What you'll learn:</span></span>

- <span data-ttu-id="3f1a4-120">Como restringir o acesso a páginas específicas em uma pasta.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-120">How to restrict access to specific pages in a folder.</span></span>
- <span data-ttu-id="3f1a4-121">Como criar um carrinho de compras conhecido de um carrinho de compras anônimo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-121">How to create a known shopping cart from an anonymous shopping cart.</span></span>
- <span data-ttu-id="3f1a4-122">Como habilitar o SSL para o projeto.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-122">How to enable SSL for the project.</span></span>
- <span data-ttu-id="3f1a4-123">Como adicionar um provedor de OAuth para o projeto.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-123">How to add an OAuth provider to the project.</span></span>
- <span data-ttu-id="3f1a4-124">Como usar o PayPal para comprar produtos usando o ambiente de teste do PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-124">How to use PayPal to purchase products using the PayPal testing environment.</span></span>
- <span data-ttu-id="3f1a4-125">Como exibir detalhes do PayPal em uma **DetailsView** controle.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-125">How to display details from PayPal in a **DetailsView** control.</span></span>
- <span data-ttu-id="3f1a4-126">Como atualizar o banco de dados do aplicativo Wingtip Toys com detalhes obtidos do PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-126">How to update the database of the Wingtip Toys application with details obtained from PayPal.</span></span>

## <a name="adding-order-tracking"></a><span data-ttu-id="3f1a4-127">Adicionando o acompanhamento de pedidos</span><span class="sxs-lookup"><span data-stu-id="3f1a4-127">Adding Order Tracking</span></span>

<span data-ttu-id="3f1a4-128">Neste tutorial, você criará duas novas classes para controlar os dados da ordem de que um usuário criou.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-128">In this tutorial, you'll create two new classes to track data from the order a user has created.</span></span> <span data-ttu-id="3f1a4-129">As classes irá controlar dados relativos a informações de envio, total de compra e confirmação de pagamento.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-129">The classes will track data regarding shipping information, purchase total, and payment confirmation.</span></span>

### <a name="add-the-order-and-orderdetail-model-classes"></a><span data-ttu-id="3f1a4-130">Adicionar a ordem e as Classes de modelo de OrderDetail</span><span class="sxs-lookup"><span data-stu-id="3f1a4-130">Add the Order and OrderDetail Model Classes</span></span>

<span data-ttu-id="3f1a4-131">Anteriormente nessa série de tutoriais, você definiu o esquema para categorias de produtos, e itens de carrinho de compras, criando os `Category`, `Product`, e `CartItem` classes no *modelos* pasta.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-131">Earlier in this tutorial series, you defined the schema for categories, products, and shopping cart items by creating the `Category`, `Product`, and `CartItem` classes in the *Models* folder.</span></span> <span data-ttu-id="3f1a4-132">Agora, você adicionará duas novas classes para definir o esquema para a ordem de produto e os detalhes do pedido.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-132">Now you will add two new classes to define the schema for the product order and the details of the order.</span></span>

1. <span data-ttu-id="3f1a4-133">No **modelos** pasta, adicione uma nova classe chamada *{1&gt;Order.CS&lt;1*.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-133">In the **Models** folder, add a new class named *Order.cs*.</span></span>   
   <span data-ttu-id="3f1a4-134">O novo arquivo de classe é exibido no editor.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-134">The new class file is displayed in the editor.</span></span>
2. <span data-ttu-id="3f1a4-135">Substitua o código padrão pelo seguinte:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-135">Replace the default code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample1.cs)]
3. <span data-ttu-id="3f1a4-136">Adicionar um *OrderDetail.cs* de classe para o *modelos* pasta.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-136">Add an *OrderDetail.cs* class to the *Models* folder.</span></span>
4. <span data-ttu-id="3f1a4-137">Substitua o código padrão pelo código a seguir:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-137">Replace the default code with the following code:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample2.cs)]

<span data-ttu-id="3f1a4-138">O `Order` e `OrderDetail` classes contêm o esquema para definir as informações de ordem usadas para compras e envio.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-138">The `Order` and `OrderDetail` classes contain the schema to define the order information used for purchasing and shipping.</span></span>

<span data-ttu-id="3f1a4-139">Além disso, você precisará atualizar a classe de contexto do banco de dados que gerencia as classes de entidade e que fornece acesso a dados no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-139">In addition, you will need to update the database context class that manages the entity classes and that provides data access to the database.</span></span> <span data-ttu-id="3f1a4-140">Para fazer isso, você adicionará o pedido recentemente criado e `OrderDetail` classes de modelo `ProductContext` classe.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-140">To do this, you will add the newly created Order and `OrderDetail` model classes to `ProductContext` class.</span></span>

1. <span data-ttu-id="3f1a4-141">Na **Gerenciador de soluções**, encontre e abra o *ProductContext.cs* arquivo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-141">In **Solution Explorer**, find and open the *ProductContext.cs* file.</span></span>
2. <span data-ttu-id="3f1a4-142">Adicione o código realçado para o *ProductContext.cs* arquivo conforme mostrado abaixo:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-142">Add the highlighted code to the *ProductContext.cs* file as shown below:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample3.cs?highlight=14-15)]

<span data-ttu-id="3f1a4-143">Conforme mencionado anteriormente nessa série de tutoriais, o código a *ProductContext.cs* arquivo adiciona o `System.Data.Entity` namespace para que você tenha acesso a toda a funcionalidade de núcleo do Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-143">As mentioned previously in this tutorial series, the code in the *ProductContext.cs* file adds the `System.Data.Entity` namespace so that you have access to all the core functionality of the Entity Framework.</span></span> <span data-ttu-id="3f1a4-144">Essa funcionalidade inclui a capacidade de consultar, inserir, atualizar e excluir dados trabalhando com objetos com rigidez de tipos.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-144">This functionality includes the capability to query, insert, update, and delete data by working with strongly typed objects.</span></span> <span data-ttu-id="3f1a4-145">O código acima na `ProductContext` classe adiciona o acesso do Entity Framework o recém-adicionado `Order` e `OrderDetail` classes.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-145">The above code in the `ProductContext` class adds Entity Framework access to the newly added `Order` and `OrderDetail` classes.</span></span>

## <a name="adding-checkout-access"></a><span data-ttu-id="3f1a4-146">Adicionar acesso de check-out</span><span class="sxs-lookup"><span data-stu-id="3f1a4-146">Adding Checkout Access</span></span>

<span data-ttu-id="3f1a4-147">O aplicativo de exemplo Wingtip Toys permite que usuários anônimos revisar e adicionar produtos a um carrinho de compras.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-147">The Wingtip Toys sample application allows anonymous users to review and add products to a shopping cart.</span></span> <span data-ttu-id="3f1a4-148">No entanto, quando os usuários anônimos optarem por adquirir os produtos que eles adicionados ao carrinho de compras, ele devem fazer logon no site.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-148">However, when anonymous users choose to purchase the products they added to the shopping cart, they must log on to the site.</span></span> <span data-ttu-id="3f1a4-149">Depois que eles fizeram logon, eles podem acessar as páginas restritas do aplicativo Web que lidar com o check-out e o processo de compra.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-149">Once they have logged on, they can access the restricted pages of the Web application that handle the checkout and purchase process.</span></span> <span data-ttu-id="3f1a4-150">Essas páginas restritas estão contidas na *check-out* pasta do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-150">These restricted pages are contained in the *Checkout* folder of the application.</span></span>

### <a name="add-a-checkout-folder-and-pages"></a><span data-ttu-id="3f1a4-151">Adicione uma pasta de check-out e páginas</span><span class="sxs-lookup"><span data-stu-id="3f1a4-151">Add a Checkout Folder and Pages</span></span>

<span data-ttu-id="3f1a4-152">Agora você criará a *check-out* pasta e as páginas que o cliente verá durante o processo de check-out.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-152">You will now create the *Checkout* folder and the pages in it that the customer will see during the checkout process.</span></span> <span data-ttu-id="3f1a4-153">Você irá atualizá-las posteriormente no tutorial.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-153">You will update these pages later in this tutorial.</span></span>

1. <span data-ttu-id="3f1a4-154">Clique com botão direito no nome do projeto (**Wingtip Toys**) em **Gerenciador de soluções** e selecione **adicionar uma nova pasta**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-154">Right-click the project name (**Wingtip Toys**) in **Solution Explorer** and select **Add a New Folder**.</span></span> 

    ![Check-out e pagamento com o PayPal - nova pasta](checkout-and-payment-with-paypal/_static/image1.png)
2. <span data-ttu-id="3f1a4-156">Nomeie a nova pasta *check-out*.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-156">Name the new folder *Checkout*.</span></span>
3. <span data-ttu-id="3f1a4-157">Clique com botão direito do *check-out* pasta e, em seguida, selecione **Add**-&gt;**Novo Item**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-157">Right-click the *Checkout* folder and then select **Add**-&gt;**New Item**.</span></span> 

    ![Check-out e pagamento com o PayPal - Novo Item](checkout-and-payment-with-paypal/_static/image2.png)
4. <span data-ttu-id="3f1a4-159">A caixa de diálogo **Adicionar Novo Item** é exibida.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-159">The **Add New Item** dialog box is displayed.</span></span>
5. <span data-ttu-id="3f1a4-160">Selecione o **Visual c#**  - &gt; **Web** grupo de modelos à esquerda.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-160">Select the **Visual C#** -&gt; **Web** templates group on the left.</span></span> <span data-ttu-id="3f1a4-161">Em seguida, no painel central, selecione **Web Form com página mestra**e nomeie-o *CheckoutStart.aspx*.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-161">Then, from the middle pane, select **Web Form with Master Page**and name it *CheckoutStart.aspx*.</span></span> 

    ![Check-out e pagamento com o PayPal - diálogo Adicionar Novo Item](checkout-and-payment-with-paypal/_static/image3.png)
6. <span data-ttu-id="3f1a4-163">Como antes, selecione a *Master* arquivo como a página mestra.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-163">As before, select the *Site.Master* file as the master page.</span></span>
7. <span data-ttu-id="3f1a4-164">Adicione as seguintes páginas adicionais para o *check-out* pasta usando as mesmas etapas acima:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-164">Add the following additional pages to the *Checkout* folder using the same steps above:</span></span>   

    - <span data-ttu-id="3f1a4-165">CheckoutReview.aspx</span><span class="sxs-lookup"><span data-stu-id="3f1a4-165">CheckoutReview.aspx</span></span>
    - <span data-ttu-id="3f1a4-166">CheckoutComplete.aspx</span><span class="sxs-lookup"><span data-stu-id="3f1a4-166">CheckoutComplete.aspx</span></span>
    - <span data-ttu-id="3f1a4-167">CheckoutCancel.aspx</span><span class="sxs-lookup"><span data-stu-id="3f1a4-167">CheckoutCancel.aspx</span></span>
    - <span data-ttu-id="3f1a4-168">CheckoutError.aspx</span><span class="sxs-lookup"><span data-stu-id="3f1a4-168">CheckoutError.aspx</span></span>

### <a name="add-a-webconfig-file"></a><span data-ttu-id="3f1a4-169">Adicionar um arquivo Web. config</span><span class="sxs-lookup"><span data-stu-id="3f1a4-169">Add a Web.config File</span></span>

<span data-ttu-id="3f1a4-170">Adicionando um novo *Web. config* do arquivo para o *check-out* pasta, você poderá restringir o acesso a todas as páginas contidas na pasta.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-170">By adding a new *Web.config* file to the *Checkout* folder, you will be able to restrict access to all the pages contained in the folder.</span></span>

1. <span data-ttu-id="3f1a4-171">Clique com botão direito do *check-out* pasta e selecione **Add**  - &gt; **Novo Item**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-171">Right-click the *Checkout* folder and select **Add** -&gt; **New Item**.</span></span>  
   <span data-ttu-id="3f1a4-172">A caixa de diálogo **Adicionar Novo Item** é exibida.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-172">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="3f1a4-173">Selecione o **Visual c#**  - &gt; **Web** grupo de modelos à esquerda.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-173">Select the **Visual C#** -&gt; **Web** templates group on the left.</span></span> <span data-ttu-id="3f1a4-174">Em seguida, no painel central, selecione **arquivo de configuração Web**, aceite o nome padrão de *Web. config*e, em seguida, selecione **adicionar**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-174">Then, from the middle pane, select **Web Configuration File**, accept the default name of *Web.config*, and then select **Add**.</span></span>
3. <span data-ttu-id="3f1a4-175">Substitua o conteúdo em XML existente a *Web. config* arquivo com o seguinte:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-175">Replace the existing XML content in the *Web.config* file with the following:</span></span>  

    [!code-xml[Main](checkout-and-payment-with-paypal/samples/sample4.xml)]
4. <span data-ttu-id="3f1a4-176">Salvar a *Web. config* arquivo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-176">Save the *Web.config* file.</span></span>

<span data-ttu-id="3f1a4-177">O *Web. config* arquivo Especifica que todos os usuários desconhecidos do aplicativo Web devem ser acesso negados às páginas contidos na *check-out* pasta.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-177">The *Web.config* file specifies that all unknown users of the Web application must be denied access to the pages contained in the *Checkout* folder.</span></span> <span data-ttu-id="3f1a4-178">No entanto, se o usuário tiver registrado com uma conta e fizer logon, eles será um usuário conhecido e terão acesso às páginas do *check-out* pasta.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-178">However, if the user has registered an account and is logged on, they will be a known user and will have access to the pages in the *Checkout* folder.</span></span>

<span data-ttu-id="3f1a4-179">É importante observar que a configuração do ASP.NET segue uma hierarquia, onde cada *Web. config* arquivo aplica-se as definições de configuração para a pasta em que ele e todos os diretórios filho abaixo dele.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-179">It's important to note that ASP.NET configuration follows a hierarchy, where each *Web.config* file applies configuration settings to the folder that it is in and to all of the child directories below it.</span></span>

<a id="SSLWebForms"></a>
## <a name="enable-ssl-for-the-project"></a><span data-ttu-id="3f1a4-180">Habilitar o SSL para o projeto</span><span class="sxs-lookup"><span data-stu-id="3f1a4-180">Enable SSL for the Project</span></span>

 <span data-ttu-id="3f1a4-181">Seguro SSL (Sockets Layer) é um protocolo definido para permitir que servidores Web e clientes Web para se comunicar de forma mais segura com o uso de criptografia.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-181">Secure Sockets Layer (SSL) is a protocol defined to allow Web servers and Web clients to communicate more securely through the use of encryption.</span></span> <span data-ttu-id="3f1a4-182">Quando o SSL não é usado, os dados enviados entre o cliente e servidor são abertos a detecção de pacotes por qualquer pessoa com acesso físico à rede.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-182">When SSL is not used, data sent between the client and server is open to packet sniffing by anyone with physical access to the network.</span></span> <span data-ttu-id="3f1a4-183">Além disso, vários esquemas de autenticação comuns não são seguras por HTTP simples.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-183">Additionally, several common authentication schemes are not secure over plain HTTP.</span></span> <span data-ttu-id="3f1a4-184">Em particular, a autenticação básica e autenticação de formulários enviam credenciais sem criptografia.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-184">In particular, Basic authentication and forms authentication send unencrypted credentials.</span></span> <span data-ttu-id="3f1a4-185">Para ser seguro, esses esquemas de autenticação devem usar SSL.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-185">To be secure, these authentication schemes must use SSL.</span></span> 

1. <span data-ttu-id="3f1a4-186">Na **Gerenciador de soluções**, clique no **WingtipToys** do projeto e, em seguida, pressione **F4** para exibir o **propriedades** janela.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-186">In **Solution Explorer**, click the **WingtipToys** project, then press **F4** to display the **Properties** window.</span></span>
2. <span data-ttu-id="3f1a4-187">Alteração **SSL habilitado** para `true`.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-187">Change **SSL Enabled** to `true`.</span></span>
3. <span data-ttu-id="3f1a4-188">Cópia de **URL do SSL** para que você pode usá-lo mais tarde.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-188">Copy the **SSL URL** so you can use it later.</span></span>   
 <span data-ttu-id="3f1a4-189">A URL do SSL será `https://localhost:44300/` , a menos que você tenha criado Sites da Web SSL anteriormente (conforme mostrado abaixo).</span><span class="sxs-lookup"><span data-stu-id="3f1a4-189">The SSL URL will be `https://localhost:44300/` unless you've previously created SSL Web Sites (as shown below).</span></span>   
    <span data-ttu-id="3f1a4-190">![Propriedades de projeto](checkout-and-payment-with-paypal/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="3f1a4-190">![Project Properties](checkout-and-payment-with-paypal/_static/image4.png)</span></span>
4. <span data-ttu-id="3f1a4-191">Na **Gerenciador de soluções**, clique com botão direito do **WingtipToys** do projeto e clique em **propriedades**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-191">In **Solution Explorer**, right click the **WingtipToys** project and click **Properties**.</span></span>
5. <span data-ttu-id="3f1a4-192">Na guia à esquerda, clique em **Web**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-192">In the left tab, click **Web**.</span></span>
6. <span data-ttu-id="3f1a4-193">Alterar o **Url do projeto** usar o **URL do SSL** que você salvou anteriormente.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-193">Change the **Project Url** to use the **SSL URL** that you saved earlier.</span></span>   
    <span data-ttu-id="3f1a4-194">![Propriedades do projeto da Web](checkout-and-payment-with-paypal/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="3f1a4-194">![Project Web Properties](checkout-and-payment-with-paypal/_static/image5.png)</span></span>
7. <span data-ttu-id="3f1a4-195">Salve a página pressionando **CTRL + S**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-195">Save the page by pressing **CTRL+S**.</span></span>
8. <span data-ttu-id="3f1a4-196">Pressione **CTRL+F5** para executar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-196">Press **Ctrl+F5** to run the application.</span></span> <span data-ttu-id="3f1a4-197">Visual Studio exibirá uma opção para que você possa evitar avisos de SSL.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-197">Visual Studio will display an option to allow you to avoid SSL warnings.</span></span>
9. <span data-ttu-id="3f1a4-198">Clique em **Sim** para confiar no certificado SSL do IIS Express e continuar.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-198">Click **Yes** to trust the IIS Express SSL certificate and continue.</span></span>   
    <span data-ttu-id="3f1a4-199">![Detalhes do certificado SSL do IIS Express](checkout-and-payment-with-paypal/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="3f1a4-199">![IIS Express SSL certificate details](checkout-and-payment-with-paypal/_static/image6.png)</span></span>  
 <span data-ttu-id="3f1a4-200">É exibido um aviso de segurança.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-200">A Security Warning is displayed.</span></span>
10. <span data-ttu-id="3f1a4-201">Clique em **Sim** para instalar o certificado em seu localhost.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-201">Click **Yes** to install the certificate to your localhost.</span></span>   
    <span data-ttu-id="3f1a4-202">![Caixa de diálogo de aviso de segurança](checkout-and-payment-with-paypal/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="3f1a4-202">![Security Warning dialog box](checkout-and-payment-with-paypal/_static/image7.png)</span></span>  
 <span data-ttu-id="3f1a4-203">A janela do navegador será exibida.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-203">The browser window will be displayed.</span></span>

<span data-ttu-id="3f1a4-204">Agora você pode testar facilmente seu aplicativo Web localmente usando SSL.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-204">You can now easily test your Web application locally using SSL.</span></span>

<a id="OAuthWebForms"></a>
## <a name="add-an-oauth-20-provider"></a><span data-ttu-id="3f1a4-205">Adicionar um provedor OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="3f1a4-205">Add an OAuth 2.0 Provider</span></span>

<span data-ttu-id="3f1a4-206">Web Forms do ASP.NET oferecem opções aprimoradas de associação e autenticação.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-206">ASP.NET Web Forms provides enhanced options for membership and authentication.</span></span> <span data-ttu-id="3f1a4-207">Esses aprimoramentos incluem OAuth.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-207">These enhancements include OAuth.</span></span> <span data-ttu-id="3f1a4-208">OAuth é um protocolo aberto que permite autorização segura em um método simple e padrão da web, aplicativos móveis e da área de trabalho.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-208">OAuth is an open protocol that allows secure authorization in a simple and standard method from web, mobile, and desktop applications.</span></span> <span data-ttu-id="3f1a4-209">O modelo de Web Forms do ASP.NET usa OAuth para expor o Facebook, Twitter, Google e Microsoft como provedores de autenticação.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-209">The ASP.NET Web Forms template uses OAuth to expose Facebook, Twitter, Google and Microsoft as authentication providers.</span></span> <span data-ttu-id="3f1a4-210">Embora este tutorial usa apenas o Google como o provedor de autenticação, você pode facilmente modificar o código para usar qualquer um dos provedores.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-210">Although this tutorial uses only Google as the authentication provider, you can easily modify the code to use any of the providers.</span></span> <span data-ttu-id="3f1a4-211">As etapas para implementar outros provedores são muito semelhantes às etapas que você verá neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-211">The steps to implement other providers are very similar to the steps you will see in this tutorial.</span></span>

<span data-ttu-id="3f1a4-212">Além da autenticação, o tutorial também usará funções para implementar a autorização.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-212">In addition to authentication, the tutorial will also use roles to implement authorization.</span></span> <span data-ttu-id="3f1a4-213">Somente os usuários que você adicionar ao `canEdit` função será capaz de alterar dados (criar, editar ou excluir contatos).</span><span class="sxs-lookup"><span data-stu-id="3f1a4-213">Only those users you add to the `canEdit` role will be able to change data (create, edit, or delete contacts).</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="3f1a4-214">Aplicativos do Windows Live só aceitam uma URL ao vivo para um site de trabalho, portanto você não pode usar uma URL do site local para logons de teste.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-214">Windows Live applications only accept a live URL for a working website, so you cannot use a local website URL for testing logins.</span></span>


<span data-ttu-id="3f1a4-215">As etapas a seguir permitirá que você adicionar um provedor de autenticação do Google.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-215">The following steps will allow you to add a Google authentication provider.</span></span>

1. <span data-ttu-id="3f1a4-216">Abra o *App\_Start\Startup.Auth.cs* arquivo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-216">Open the *App\_Start\Startup.Auth.cs* file.</span></span>
2. <span data-ttu-id="3f1a4-217">Remova os caracteres de comentário do `app.UseGoogleAuthentication()` método para que o método é exibido como segue:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-217">Remove the comment characters from the `app.UseGoogleAuthentication()` method so that the method appears as follows:</span></span> 

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample5.cs)]
3. <span data-ttu-id="3f1a4-218">Navegue até a [Console de desenvolvedores do Google](https://console.developers.google.com/).</span><span class="sxs-lookup"><span data-stu-id="3f1a4-218">Navigate to the [Google Developers Console](https://console.developers.google.com/).</span></span> <span data-ttu-id="3f1a4-219">Você também precisará entrar com sua conta de email de desenvolvedor do Google (gmail.com).</span><span class="sxs-lookup"><span data-stu-id="3f1a4-219">You will also need to sign-in with your Google developer email account (gmail.com).</span></span> <span data-ttu-id="3f1a4-220">Se você não tiver uma conta do Google, selecione a **criar uma conta** link.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-220">If you do not have a Google account, select the **Create an account** link.</span></span>   
   <span data-ttu-id="3f1a4-221">Em seguida, você verá a **Console de desenvolvedores do Google**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-221">Next, you'll see the **Google Developers Console**.</span></span>   
    <span data-ttu-id="3f1a4-222">![Console de desenvolvedores do Google](checkout-and-payment-with-paypal/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="3f1a4-222">![Google Developers Console](checkout-and-payment-with-paypal/_static/image8.png)</span></span>
4. <span data-ttu-id="3f1a4-223">Clique o **criar projeto** e digitar um nome de projeto e a ID (você pode usar os valores padrão).</span><span class="sxs-lookup"><span data-stu-id="3f1a4-223">Click the **Create Project** button and enter a project name and ID (you can use the default values).</span></span> <span data-ttu-id="3f1a4-224">Em seguida, clique o **caixa de seleção de contrato** e o **criar** botão.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-224">Then, click the **agreement checkbox** and the **Create** button.</span></span>  

    ![Google - novo projeto](checkout-and-payment-with-paypal/_static/image9.png)

   <span data-ttu-id="3f1a4-226">Em poucos segundos o novo projeto será criado e o navegador exibirá a nova página de projetos.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-226">In a few seconds the new project will be created and your browser will display the new projects page.</span></span>
5. <span data-ttu-id="3f1a4-227">Na guia à esquerda, clique em **APIs &amp; auth**e, em seguida, clique em **credenciais**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-227">In the left tab, click **APIs &amp; auth**, and then click **Credentials**.</span></span>
6. <span data-ttu-id="3f1a4-228">Clique o **criar nova ID de cliente** sob **OAuth**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-228">Click the **Create New Client ID** under **OAuth**.</span></span>   
   <span data-ttu-id="3f1a4-229">O **criar ID do cliente** caixa de diálogo será exibida.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-229">The **Create Client ID** dialog will be displayed.</span></span>   
    <span data-ttu-id="3f1a4-230">![Google - criar ID do cliente](checkout-and-payment-with-paypal/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="3f1a4-230">![Google - Create Client ID](checkout-and-payment-with-paypal/_static/image10.png)</span></span>
7. <span data-ttu-id="3f1a4-231">No **criar ID do cliente** caixa de diálogo, mantenha o padrão **aplicativo Web** para o tipo de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-231">In the **Create Client ID** dialog, keep the default **Web application** for the application type.</span></span>
8. <span data-ttu-id="3f1a4-232">Defina a **origens de JavaScript autorizadas** para a URL do SSL usado neste tutorial (`https://localhost:44300/` , a menos que você criou outros projetos SSL).</span><span class="sxs-lookup"><span data-stu-id="3f1a4-232">Set the **Authorized JavaScript Origins** to the SSL URL you used earlier in this tutorial (`https://localhost:44300/` unless you've created other SSL projects).</span></span>   
   <span data-ttu-id="3f1a4-233">Essa URL é a origem para o seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-233">This URL is the origin for your application.</span></span> <span data-ttu-id="3f1a4-234">Para este exemplo, você irá inserir apenas a URL de teste do localhost.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-234">For this sample, you will only enter the localhost test URL.</span></span> <span data-ttu-id="3f1a4-235">No entanto, você pode inserir várias URLs para levar em conta localhost e produção.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-235">However, you can enter multiple URLs to account for localhost and production.</span></span>
9. <span data-ttu-id="3f1a4-236">Defina as **URI de redirecionamento autorizado** ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-236">Set the **Authorized Redirect URI** to the following:</span></span> 

    [!code-html[Main](checkout-and-payment-with-paypal/samples/sample6.html)]

   <span data-ttu-id="3f1a4-237">Esse valor é o URI que o OAuth ASP.NET usuários para se comunicar com o servidor google OAuth.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-237">This value is the URI that ASP.NET OAuth users to communicate with the google OAuth server.</span></span> <span data-ttu-id="3f1a4-238">Lembre-se a URL do SSL usado acima ( `https://localhost:44300/` , a menos que você criou outros projetos SSL).</span><span class="sxs-lookup"><span data-stu-id="3f1a4-238">Remember the SSL URL you used above (    `https://localhost:44300/` unless you've created other SSL projects).</span></span>
10. <span data-ttu-id="3f1a4-239">Clique o **criar ID do cliente** botão.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-239">Click the **Create Client ID** button.</span></span>
11. <span data-ttu-id="3f1a4-240">No menu à esquerda do Console de desenvolvedores do Google, clique no **tela de consentimento** item de menu, em seguida, defina seu nome de produto e o endereço de email.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-240">On the left menu of the Google Developers Console, click the **Consent screen** menu item, then set your email address and product name.</span></span> <span data-ttu-id="3f1a4-241">Quando você tiver preenchido o formulário, clique em **salvar**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-241">When you have completed the form, click **Save**.</span></span>
12. <span data-ttu-id="3f1a4-242">Clique o **APIs** item de menu, role para baixo e clique no **off** lado **API do Google +**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-242">Click the **APIs** menu item, scroll down and click the **off** button next to **Google+ API**.</span></span>   
    <span data-ttu-id="3f1a4-243">Aceitar essa opção permitirá que a API do Google +.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-243">Accepting this option will enable the Google+ API.</span></span>
13. <span data-ttu-id="3f1a4-244">Você também deve atualizar o **Microsoft. owin** pacote do NuGet para a versão 3.0.0.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-244">You must also update the **Microsoft.Owin** NuGet package to version 3.0.0.</span></span>   
    <span data-ttu-id="3f1a4-245">Dos **ferramentas** menu, selecione **Gerenciador de pacotes NuGet** e, em seguida, selecione **gerenciar pacotes NuGet para solução**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-245">From the **Tools** menu, select **NuGet Package Manager** and then select **Manage NuGet Packages for Solution**.</span></span>  
    <span data-ttu-id="3f1a4-246">Dos **gerenciar pacotes NuGet** janela, localizar e atualizar o **Microsoft. owin** pacote para a versão 3.0.0.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-246">From the **Manage NuGet Packages** window, find and update the **Microsoft.Owin** package to version 3.0.0.</span></span>
14. <span data-ttu-id="3f1a4-247">No Visual Studio, atualize o `UseGoogleAuthentication` método da *Startup.Auth.cs* página Copiando e colando o **ID do cliente** e **segredo do cliente** para o método.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-247">In Visual Studio, update the `UseGoogleAuthentication` method of the *Startup.Auth.cs* page by copying and pasting the **Client ID** and **Client Secret** into the method.</span></span> <span data-ttu-id="3f1a4-248">O **ID do cliente** e **segredo do cliente** valores mostrados abaixo são exemplos e não funcionará.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-248">The **Client ID** and **Client Secret** values shown below are samples and will not work.</span></span> 

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample7.cs?highlight=64-65)]
15. <span data-ttu-id="3f1a4-249">Pressione **CTRL + F5** para compilar e executar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-249">Press **CTRL+F5** to build and run the application.</span></span> <span data-ttu-id="3f1a4-250">Clique o **faça logon no** link.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-250">Click the **Log in** link.</span></span>
16. <span data-ttu-id="3f1a4-251">Sob **usar outro serviço para fazer logon**, clique em **Google**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-251">Under **Use another service to log in**, click **Google**.</span></span>  
    <span data-ttu-id="3f1a4-252">![Iniciar sessão](checkout-and-payment-with-paypal/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="3f1a4-252">![Log in](checkout-and-payment-with-paypal/_static/image11.png)</span></span>
17. <span data-ttu-id="3f1a4-253">Se você precisar inserir suas credenciais, você será redirecionado ao site do google, onde você vai inserir suas credenciais.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-253">If you need to enter your credentials, you will be redirected to the google site where you will enter your credentials.</span></span>  
    ![Google - entrar](checkout-and-payment-with-paypal/_static/image12.png)
18. <span data-ttu-id="3f1a4-255">Depois de inserir suas credenciais, você deverá conceder permissões para o aplicativo web que você acabou de criar.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-255">After you enter your credentials, you will be prompted to give permissions to the web application you just created.</span></span>  
    ![Conta de serviço do projeto padrão](checkout-and-payment-with-paypal/_static/image13.png)
19. <span data-ttu-id="3f1a4-257">Clique em **aceitar**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-257">Click **Accept**.</span></span> <span data-ttu-id="3f1a4-258">Você será redirecionado para o **registre** página do **WingtipToys** aplicativo onde você pode registrar sua conta do Google.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-258">You will now be redirected back to the **Register** page of the **WingtipToys** application where you can register your Google account.</span></span>  
    <span data-ttu-id="3f1a4-259">![Registre-se com sua conta do Google](checkout-and-payment-with-paypal/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="3f1a4-259">![Register with your Google Account](checkout-and-payment-with-paypal/_static/image14.png)</span></span>
20. <span data-ttu-id="3f1a4-260">Você tem a opção de alterar o nome de registro de email local utilizado para sua conta do Gmail, mas você geralmente deseja manter o alias de email padrão (ou seja, aquele usado para autenticação).</span><span class="sxs-lookup"><span data-stu-id="3f1a4-260">You have the option of changing the local email registration name used for your Gmail account, but you generally want to keep the default email alias (that is, the one you used for authentication).</span></span> <span data-ttu-id="3f1a4-261">Clique em **faça logon no** conforme mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-261">Click **Log in** as shown above.</span></span>

### <a name="modifying-login-functionality"></a><span data-ttu-id="3f1a4-262">Modificar a funcionalidade de logon</span><span class="sxs-lookup"><span data-stu-id="3f1a4-262">Modifying Login Functionality</span></span>

<span data-ttu-id="3f1a4-263">Conforme mencionado anteriormente nessa série de tutoriais, grande parte da funcionalidade de registro do usuário foi incluído no modelo de Web Forms do ASP.NET por padrão.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-263">As previously mentioned in this tutorial series, much of the user registration functionality has been included in the ASP.NET Web Forms template by default.</span></span> <span data-ttu-id="3f1a4-264">Agora, você modificará o padrão *login. aspx* e *Register* páginas para chamar o `MigrateCart` método.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-264">Now you will modify the default *Login.aspx* and *Register.aspx* pages to call the `MigrateCart` method.</span></span> <span data-ttu-id="3f1a4-265">O `MigrateCart` método associa um usuário conectado recentemente um carrinho de compras anônimo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-265">The `MigrateCart` method associates a newly logged in user with an anonymous shopping cart.</span></span> <span data-ttu-id="3f1a4-266">Ao associar o usuário e o carrinho de compras, o aplicativo de exemplo Wingtip Toys será capaz de manter o carrinho de compras do usuário entre visitas.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-266">By associating the user and shopping cart, the Wingtip Toys sample application will be able to maintain the shopping cart of the user between visits.</span></span>

1. <span data-ttu-id="3f1a4-267">Na **Gerenciador de soluções**, encontre e abra o *conta* pasta.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-267">In **Solution Explorer**, find and open the *Account* folder.</span></span>
2. <span data-ttu-id="3f1a4-268">Modificar a página code-behind chamada *Login.aspx.cs* para incluir o código realçado em amarelo, para que ele apareça da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-268">Modify the code-behind page named *Login.aspx.cs* to include the code highlighted in yellow, so that it appears as follows:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample8.cs?highlight=41-43)]
3. <span data-ttu-id="3f1a4-269">Salvar a *Login.aspx.cs* arquivo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-269">Save the *Login.aspx.cs* file.</span></span>

<span data-ttu-id="3f1a4-270">Por enquanto, você pode ignorar o aviso que não há nenhuma definição para o `MigrateCart` método.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-270">For now, you can ignore the warning that there is no definition for the `MigrateCart` method.</span></span> <span data-ttu-id="3f1a4-271">Você será ser adicionando-lo um pouco mais tarde neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-271">You will be adding it a bit later in this tutorial.</span></span>

<span data-ttu-id="3f1a4-272">O *Login.aspx.cs* arquivo code-behind dá suporte a um método de logon.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-272">The *Login.aspx.cs* code-behind file supports a LogIn method.</span></span> <span data-ttu-id="3f1a4-273">Inspecionando a página de login. aspx, você verá que essa página inclui um botão "Logon" gatilhos de clique que, quando o `LogIn` manipulador no code-behind.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-273">By inspecting the Login.aspx page, you'll see that this page includes a "Log in" button that when click triggers the `LogIn` handler on the code-behind.</span></span>

<span data-ttu-id="3f1a4-274">Quando o `Login` método em de *Login.aspx.cs* é chamado, uma nova instância do carrinho de compras chamado `usersShoppingCart` é criado.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-274">When the `Login` method on the *Login.aspx.cs* is called, a new instance of the shopping cart named `usersShoppingCart` is created.</span></span> <span data-ttu-id="3f1a4-275">A ID do carrinho de compras (um GUID) é recuperada e definida como o `cartId` variável.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-275">The ID of the shopping cart (a GUID) is retrieved and set to the `cartId` variable.</span></span> <span data-ttu-id="3f1a4-276">Em seguida, o `MigrateCart` método é chamado, passando os dois o `cartId` e o nome do usuário conectado a esse método.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-276">Then, the `MigrateCart` method is called, passing both the `cartId` and the name of the logged-in user to this method.</span></span> <span data-ttu-id="3f1a4-277">Quando o carrinho de compras é migrado, o GUID usado para identificar o carrinho de compras anônimo é substituído pelo nome de usuário.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-277">When the shopping cart is migrated, the GUID used to identify the anonymous shopping cart is replaced with the user name.</span></span>

<span data-ttu-id="3f1a4-278">Além de modificar o *Login.aspx.cs* arquivo de code-behind para migrar o carrinho de compras quando o usuário fizer logon, você também deve modificar o *arquivo de code-behind Register.aspx.cs* para migrar o carrinho de compras Quando o usuário cria uma nova conta e fizer logon.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-278">In addition to modifying the *Login.aspx.cs* code-behind file to migrate the shopping cart when the user logs in, you must also modify the *Register.aspx.cs code-behind file* to migrate the shopping cart when the user creates a new account and logs in.</span></span>

1. <span data-ttu-id="3f1a4-279">No *conta* pasta, abra o arquivo code-behind chamado *Register.aspx.cs*.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-279">In the *Account* folder, open the code-behind file named *Register.aspx.cs*.</span></span>
2. <span data-ttu-id="3f1a4-280">Modifique o arquivo code-behind, incluindo o código em amarelo, para que ele apareça da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-280">Modify the code-behind file by including the code in yellow, so that it appears as follows:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample9.cs?highlight=28-32)]
3. <span data-ttu-id="3f1a4-281">Salvar a *Register.aspx.cs* arquivo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-281">Save the *Register.aspx.cs* file.</span></span> <span data-ttu-id="3f1a4-282">Mais uma vez, ignore o aviso sobre o `MigrateCart` método.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-282">Once again, ignore the warning about the `MigrateCart` method.</span></span>

<span data-ttu-id="3f1a4-283">Observe que o código usado na `CreateUser_Click` manipulador de eventos é muito semelhante ao código usado no `LogIn` método.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-283">Notice that the code you used in the `CreateUser_Click` event handler is very similar to the code you used in the `LogIn` method.</span></span> <span data-ttu-id="3f1a4-284">Quando o usuário registra ou faz logon no site, uma chamada para o `MigrateCart` método será feito.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-284">When the user registers or logs in to the site, a call to the `MigrateCart` method will be made.</span></span>

## <a name="migrating-the-shopping-cart"></a><span data-ttu-id="3f1a4-285">Migrar o carrinho de compras</span><span class="sxs-lookup"><span data-stu-id="3f1a4-285">Migrating the Shopping Cart</span></span>

<span data-ttu-id="3f1a4-286">Agora que você tem o processo de logon e registro atualizado, você pode adicionar o código para migrar o carrinho compras usando o `MigrateCart` método.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-286">Now that you have the log-in and registration process updated, you can add the code to migrate the shopping cart using the `MigrateCart` method.</span></span>

1. <span data-ttu-id="3f1a4-287">Na **Gerenciador de soluções**, localize o *lógica* pasta e abra o *ShoppingCartActions.cs* arquivo de classe.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-287">In **Solution Explorer**, find the *Logic* folder and open the *ShoppingCartActions.cs* class file.</span></span>
2. <span data-ttu-id="3f1a4-288">Adicione o código realçado em amarelo para o código existente na *ShoppingCartActions.cs* arquivo, para que o código a *ShoppingCartActions.cs* arquivo aparece da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-288">Add the code highlighted in yellow to the existing code in the *ShoppingCartActions.cs* file, so that the code in the *ShoppingCartActions.cs* file appears as follows:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample10.cs?highlight=215-224)]

<span data-ttu-id="3f1a4-289">O `MigrateCart` método usa o cartId existente para localizar o carrinho de compras do usuário.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-289">The `MigrateCart` method uses the existing cartId to find the shopping cart of the user.</span></span> <span data-ttu-id="3f1a4-290">Em seguida, o código executa um loop em todos os itens de carrinho de compras e substitui o `CartId` propriedade (conforme especificado pelo `CartItem` esquema) com o nome de usuário que fez logon.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-290">Next, the code loops through all the shopping cart items and replaces the `CartId` property (as specified by the `CartItem` schema) with the logged-in user name.</span></span>

### <a name="updating-the-database-connection"></a><span data-ttu-id="3f1a4-291">Atualizando a Conexão de banco de dados</span><span class="sxs-lookup"><span data-stu-id="3f1a4-291">Updating the Database Connection</span></span>

<span data-ttu-id="3f1a4-292">Se você estiver seguindo este tutorial usando o **predefinidos** Wingtip Toys exemplo de aplicativo, você deve recriar o banco de dados de associação padrão.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-292">If you are following this tutorial using the **prebuilt** Wingtip Toys sample application, you must recreate the default membership database.</span></span> <span data-ttu-id="3f1a4-293">Modificando a cadeia de caracteres de conexão padrão, o banco de dados de associação será criado na próxima vez que o aplicativo é executado.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-293">By modifying the default connection string, the membership database will be created the next time the application runs.</span></span>

1. <span data-ttu-id="3f1a4-294">Abra o *Web. config* arquivo na raiz do projeto.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-294">Open the *Web.config* file at the root of the project.</span></span>
2. <span data-ttu-id="3f1a4-295">Atualize a cadeia de caracteres de conexão padrão para que ele apareça da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-295">Update the default connection string so that it appears as follows:</span></span>   

    [!code-xml[Main](checkout-and-payment-with-paypal/samples/sample11.xml)]

<a id="PayPalWebForms"></a>
## <a name="integrating-paypal"></a><span data-ttu-id="3f1a4-296">A integração do PayPal</span><span class="sxs-lookup"><span data-stu-id="3f1a4-296">Integrating PayPal</span></span>

<span data-ttu-id="3f1a4-297">PayPal é uma plataforma de cobrança baseado na web que aceita os pagamentos por comerciantes online.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-297">PayPal is a web-based billing platform that accepts payments by online merchants.</span></span> <span data-ttu-id="3f1a4-298">Em seguida, este tutorial explica como integrar a funcionalidade do Express de check-out do PayPal no seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-298">This tutorial next explains how to integrate PayPal's Express Checkout functionality into your application.</span></span> <span data-ttu-id="3f1a4-299">Check-out Express permite que seus clientes para usar o PayPal para pagar para os itens que foram adicionados ao carrinho de compras.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-299">Express Checkout allows your customers to use PayPal to pay for the items they have added to their shopping cart.</span></span>

### <a name="create-paylpal-test-accounts"></a><span data-ttu-id="3f1a4-300">Criar contas de teste PaylPal</span><span class="sxs-lookup"><span data-stu-id="3f1a4-300">Create PaylPal Test Accounts</span></span>

<span data-ttu-id="3f1a4-301">Para usar o PayPal no ambiente de teste, você deve criar e verificar uma conta de teste do desenvolvedor.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-301">To use the PayPal testing environment, you must create and verify a developer test account.</span></span> <span data-ttu-id="3f1a4-302">Você usará a conta de teste do desenvolvedor para criar um comprador de conta de teste e uma conta de teste do vendedor.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-302">You will use the developer test account to create a buyer test account and a seller test account.</span></span> <span data-ttu-id="3f1a4-303">As credenciais de conta de teste do desenvolvedor também permitirá que o aplicativo de exemplo Wingtip Toys acessar o ambiente de teste do PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-303">The developer test account credentials also will allow the Wingtip Toys sample application to access the PayPal testing environment.</span></span>

1. <span data-ttu-id="3f1a4-304">Em um navegador, navegue até o site de teste do desenvolvedor PayPal:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-304">In a browser, navigate to the PayPal developer testing site:</span></span>   
    [https://developer.paypal.com](https://developer.paypal.com/)
2. <span data-ttu-id="3f1a4-305">Se você não tiver uma conta de desenvolvedor do PayPal, crie uma nova conta clicando **inscrever-se**e seguindo as etapas de inscrição.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-305">If you don't have a PayPal developer account, create a new account by clicking **Sign Up**and following the sign up steps.</span></span> <span data-ttu-id="3f1a4-306">Se você tiver uma conta existente de desenvolvedor do PayPal, entre no clicando **fazer logon**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-306">If you have an existing PayPal developer account, sign in by clicking **Log In**.</span></span> <span data-ttu-id="3f1a4-307">Você precisará de sua conta de desenvolvedor do PayPal para testar o aplicativo de exemplo Wingtip Toys mais tarde neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-307">You will need your PayPal developer account to test the Wingtip Toys sample application later in this tutorial.</span></span>
3. <span data-ttu-id="3f1a4-308">Se você apenas se inscreveram para sua conta de desenvolvedor do PayPal, você precisa verificar sua conta de desenvolvedor do PayPal com o PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-308">If you have just signed up for your PayPal developer account, you may need to verify your PayPal developer account with PayPal.</span></span> <span data-ttu-id="3f1a4-309">Você pode verificar sua conta seguindo as etapas que PayPal enviado para sua conta de email.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-309">You can verify your account by following the steps that PayPal sent to your email account.</span></span> <span data-ttu-id="3f1a4-310">Depois de verificar sua conta de desenvolvedor do PayPal, faça logon novamente no site de teste do desenvolvedor PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-310">Once you have verified your PayPal developer account, log back into the PayPal developer testing site.</span></span>
4. <span data-ttu-id="3f1a4-311">Depois que você está conectado ao site do desenvolvedor do PayPal com sua conta de desenvolvedor do PayPal que você precisa criar uma conta de teste do comprador PayPal, se você ainda não tiver uma.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-311">After you are logged in to the PayPal developer site with your PayPal developer account you need to create a PayPal buyer test account if you don't already have one.</span></span> <span data-ttu-id="3f1a4-312">Para criar uma conta de teste do comprador, o PayPal, clique em site do **aplicativos** guia e, em seguida, clique em **contas de área restrita**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-312">To create a buyer test account, on the PayPal site click the **Applications** tab and then click **Sandbox accounts**.</span></span>   
 <span data-ttu-id="3f1a4-313">O **contas de teste de área restrita** página é exibida.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-313">The **Sandbox test accounts** page is shown.</span></span>   

    > [!NOTE] 
    > 
    > <span data-ttu-id="3f1a4-314">O site do desenvolvedor do PayPal já fornece uma conta de teste comercial.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-314">The PayPal Developer site already provides a merchant test account.</span></span>

    ![Check-out e pagamento com o PayPal - contas de área restrita de teste](checkout-and-payment-with-paypal/_static/image15.png)
5. <span data-ttu-id="3f1a4-316">Na página de contas de teste de área restrita, clique em **criar conta**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-316">On the Sandbox test accounts page, click **Create Account**.</span></span>
6. <span data-ttu-id="3f1a4-317">Sobre o **criar conta de teste** página Escolha um comprador de teste de email da conta e senha de sua escolha.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-317">On the **Create test account** page choose a buyer test account email and password of your choice.</span></span>   

    > [!NOTE] 
    > 
    > <span data-ttu-id="3f1a4-318">Você precisará de endereços de email do comprador e a senha para testar o aplicativo de exemplo Wingtip Toys no final deste tutorial.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-318">You will need the buyer email addresses and password to test the Wingtip Toys sample application at the end of this tutorial.</span></span>

    ![Check-out e pagamento com o PayPal - contas de área restrita de teste](checkout-and-payment-with-paypal/_static/image16.png)
7. <span data-ttu-id="3f1a4-320">Crie a conta de comprador de teste clicando o **criar conta** botão.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-320">Create the buyer test account by clicking the **Create Account** button.</span></span>  
 <span data-ttu-id="3f1a4-321">O **contas de teste de área restrita** página é exibida.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-321">The **Sandbox Test accounts** page is displayed.</span></span> 

    ![Check-out e pagamento com o PayPal - PaylPal contas](checkout-and-payment-with-paypal/_static/image17.png)
8. <span data-ttu-id="3f1a4-323">Sobre o **contas de teste de área restrita** , clique no **facilitador** conta de email.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-323">On the **Sandbox test accounts** page, click the **facilitator** email account.</span></span>  
    <span data-ttu-id="3f1a4-324">**Perfil** e **notificação** opções são exibidas.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-324">**Profile** and **Notification** options appear.</span></span>
9. <span data-ttu-id="3f1a4-325">Selecione o **perfil** opção e, em seguida, clique em **credenciais de API** para exibir suas credenciais de API para a conta de teste comercial.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-325">Select the **Profile** option, then click **API credentials** to view your API credentials for the merchant test account.</span></span>
10. <span data-ttu-id="3f1a4-326">Copia as credenciais de API de teste para o bloco de notas.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-326">Copy the TEST API credentials to notepad.</span></span>

<span data-ttu-id="3f1a4-327">Você precisará suas credenciais de API clássica do teste exibidos (nome de usuário, senha e assinatura) para fazer chamadas à API do aplicativo de exemplo Wingtip Toys do PayPal no ambiente de teste.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-327">You will need your displayed Classic TEST API credentials (Username, Password, and Signature) to make API calls from the Wingtip Toys sample application to the PayPal testing environment.</span></span> <span data-ttu-id="3f1a4-328">Você adicionará as credenciais na próxima etapa.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-328">You will add the credentials in the next step.</span></span>

### <a name="add-paypal-class-and-api-credentials"></a><span data-ttu-id="3f1a4-329">Adicionar classe PayPal e credenciais de API</span><span class="sxs-lookup"><span data-stu-id="3f1a4-329">Add PayPal Class and API Credentials</span></span>

<span data-ttu-id="3f1a4-330">Coloque a maioria do código PayPal em uma única classe.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-330">You will place the majority of the PayPal code into a single class.</span></span> <span data-ttu-id="3f1a4-331">Essa classe contém métodos usados para se comunicar com o PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-331">This class contains the methods used to communicate with PayPal.</span></span> <span data-ttu-id="3f1a4-332">Além disso, você adicionará suas credenciais do PayPal para essa classe.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-332">Also, you will add your PayPal credentials to this class.</span></span>

1. <span data-ttu-id="3f1a4-333">No aplicativo de exemplo Wingtip Toys dentro do Visual Studio, clique com botão direito do **lógica** pasta e, em seguida, selecione **Add**  - &gt; **Novo Item**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-333">In the Wingtip Toys sample application within Visual Studio, right-click the **Logic** folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="3f1a4-334">A caixa de diálogo **Adicionar Novo Item** é exibida.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-334">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="3f1a4-335">Sob **Visual c#** da **instalado** painel à esquerda, selecione **código**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-335">Under **Visual C#** from the **Installed** pane on the left, select **Code**.</span></span>
3. <span data-ttu-id="3f1a4-336">No painel central, selecione **classe**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-336">From the middle pane, select **Class**.</span></span> <span data-ttu-id="3f1a4-337">Nomeie essa nova classe **PayPalFunctions.cs**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-337">Name this new class **PayPalFunctions.cs**.</span></span>
4. <span data-ttu-id="3f1a4-338">Clique em **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-338">Click **Add**.</span></span>  
   <span data-ttu-id="3f1a4-339">O novo arquivo de classe é exibido no editor.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-339">The new class file is displayed in the editor.</span></span>
5. <span data-ttu-id="3f1a4-340">Substitua o código padrão pelo código a seguir:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-340">Replace the default code with the following code:</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample12.cs)]
6. <span data-ttu-id="3f1a4-341">Adicione as credenciais de API do comerciante (nome de usuário, senha e assinatura) que é exibido neste tutorial, para que você possa fazer chamadas de função para o ambiente de teste do PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-341">Add the Merchant API credentials (Username, Password, and Signature) that you displayed earlier in this tutorial so that you can make function calls to the PayPal testing environment.</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample13.cs)]

> [!NOTE] 
> 
> <span data-ttu-id="3f1a4-342">Este aplicativo de exemplo simplesmente você está adicionando as credenciais para um arquivo c# (. cs).</span><span class="sxs-lookup"><span data-stu-id="3f1a4-342">In this sample application you are simply adding credentials to a C# file (.cs).</span></span> <span data-ttu-id="3f1a4-343">No entanto, em uma solução implementada, você deve considerar suas credenciais em um arquivo de configuração de criptografia.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-343">However, in a implemented solution, you should consider encrypting your credentials in a configuration file.</span></span>


<span data-ttu-id="3f1a4-344">A classe NVPAPICaller contém a maioria da funcionalidade PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-344">The NVPAPICaller class contains the majority of the PayPal functionality.</span></span> <span data-ttu-id="3f1a4-345">O código na classe fornece os métodos necessários para fazer um teste de compra do ambiente de teste do PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-345">The code in the class provides the methods needed to make a test purchase from the PayPal testing environment.</span></span> <span data-ttu-id="3f1a4-346">As três funções PayPal a seguir são usadas para fazer compras:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-346">The following three PayPal functions are used to make purchases:</span></span>

- <span data-ttu-id="3f1a4-347">`SetExpressCheckout` função</span><span class="sxs-lookup"><span data-stu-id="3f1a4-347">`SetExpressCheckout` function</span></span>
- <span data-ttu-id="3f1a4-348">`GetExpressCheckoutDetails` função</span><span class="sxs-lookup"><span data-stu-id="3f1a4-348">`GetExpressCheckoutDetails` function</span></span>
- <span data-ttu-id="3f1a4-349">`DoExpressCheckoutPayment` função</span><span class="sxs-lookup"><span data-stu-id="3f1a4-349">`DoExpressCheckoutPayment` function</span></span>

<span data-ttu-id="3f1a4-350">O `ShortcutExpressCheckout` método de coleta os detalhes de produto e informações de compra do teste do carrinho de compras e chama o `SetExpressCheckout` função PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-350">The `ShortcutExpressCheckout` method collects the test purchase information and product details from the shopping cart and calls the `SetExpressCheckout` PayPal function.</span></span> <span data-ttu-id="3f1a4-351">O `GetCheckoutDetails` método confirma os detalhes de compra e chama o `GetExpressCheckoutDetails` PayPal função antes de fazer a compra de teste.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-351">The `GetCheckoutDetails` method confirms purchase details and calls the `GetExpressCheckoutDetails` PayPal function before making the test purchase.</span></span> <span data-ttu-id="3f1a4-352">O `DoCheckoutPayment` método conclui a compra de teste do ambiente de teste, chamando o `DoExpressCheckoutPayment` função PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-352">The `DoCheckoutPayment` method completes the test purchase from the testing environment by calling the `DoExpressCheckoutPayment` PayPal function.</span></span> <span data-ttu-id="3f1a4-353">O código restante dá suporte a métodos do PayPal e o processo, como cadeias de caracteres de codificação, decodificação de cadeias de caracteres, matrizes de processamento e determinar as credenciais.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-353">The remaining code supports the PayPal methods and process, such as encoding strings, decoding strings, processing arrays, and determining credentials.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="3f1a4-354">PayPal permite que você inclua os detalhes de compra opcional com base em [especificação de API do PayPal](https://cms.paypal.com/us/cgi-bin/?cmd=_render-content&amp;content_ID=developer/e_howto_api_nvp_r_SetExpressCheckout).</span><span class="sxs-lookup"><span data-stu-id="3f1a4-354">PayPal allows you to include optional purchase details based on [PayPal's API specification](https://cms.paypal.com/us/cgi-bin/?cmd=_render-content&amp;content_ID=developer/e_howto_api_nvp_r_SetExpressCheckout).</span></span> <span data-ttu-id="3f1a4-355">Estendendo o código no aplicativo de exemplo Wingtip Toys, você pode incluir detalhes de localização, as descrições de produto, imposto, um número de serviço do cliente, bem como muitos outros campos opcionais.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-355">By extending the code in the Wingtip Toys sample application, you can include localization details, product descriptions, tax, a customer service number, as well as many other optional fields.</span></span>


<span data-ttu-id="3f1a4-356">Observe que as URLs de retorno e de cancelamento que são especificadas na **ShortcutExpressCheckout** método usar um número de porta.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-356">Notice that the return and cancel URLs that are specified in the **ShortcutExpressCheckout** method use a port number.</span></span>

[!code-html[Main](checkout-and-payment-with-paypal/samples/sample14.html)]

<span data-ttu-id="3f1a4-357">Quando o Visual Web Developer executa um projeto web usando SSL, geralmente a porta 44300 é usada para o servidor web.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-357">When Visual Web Developer runs a web project using SSL, commonly the port 44300 is used for the web server.</span></span> <span data-ttu-id="3f1a4-358">Como mostrado acima, o número da porta é 44300.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-358">As shown above, the port number is 44300.</span></span> <span data-ttu-id="3f1a4-359">Quando você executa o aplicativo, você pode ver um número de porta diferente.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-359">When you run the application, you could see a different port number.</span></span> <span data-ttu-id="3f1a4-360">Suas necessidades de número de porta seja definido corretamente no código para que você possa bem-sucedida executar o aplicativo de exemplo do Wingtip Toys no final deste tutorial.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-360">Your port number needs to be correctly set in the code so that you can successful run the Wingtip Toys sample application at the end of this tutorial.</span></span> <span data-ttu-id="3f1a4-361">A próxima seção deste tutorial explica como recuperar o número de porta do host local e atualize a classe do PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-361">The next section of this tutorial explains how to retrieve the local host port number and update the PayPal class.</span></span>

### <a name="update-the-localhost-port-number-in-the-paypal-class"></a><span data-ttu-id="3f1a4-362">Atualizar o número da porta do LocalHost na classe PayPal</span><span class="sxs-lookup"><span data-stu-id="3f1a4-362">Update the LocalHost Port Number in the PayPal Class</span></span>

<span data-ttu-id="3f1a4-363">O aplicativo de exemplo Wingtip Toys adquire produtos navegando até o site de teste do PayPal e retornar à sua instância local do aplicativo de exemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-363">The Wingtip Toys sample application purchases products by navigating to the PayPal testing site and returning to your local instance of the Wingtip Toys sample application.</span></span> <span data-ttu-id="3f1a4-364">Para que PayPal retornar para a URL correta, você precisará especificar o número da porta da execução localmente exemplo de aplicativo no código do PayPal mencionado acima.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-364">In order to have PayPal return to the correct URL, you need to specify the port number of the locally running sample application in the PayPal code mentioned above.</span></span>

1. <span data-ttu-id="3f1a4-365">Clique com botão direito no nome do projeto (**WingtipToys**) em **Gerenciador de soluções** e selecione **propriedades**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-365">Right-click the project name (**WingtipToys**) in **Solution Explorer** and select **Properties**.</span></span>
2. <span data-ttu-id="3f1a4-366">Na coluna à esquerda, selecione o **Web** guia.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-366">In the left column, select the **Web** tab.</span></span>
3. <span data-ttu-id="3f1a4-367">Recuperar o número da porta a **Url do projeto** caixa.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-367">Retrieve the port number from the **Project Url** box.</span></span>
4. <span data-ttu-id="3f1a4-368">Se necessário, atualize o `returnURL` e `cancelURL` na classe PayPal (`NVPAPICaller`) na *PayPalFunctions.cs* arquivo a ser usado o número da porta do aplicativo web:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-368">If needed, update the `returnURL` and `cancelURL` in the PayPal class (`NVPAPICaller`) in the *PayPalFunctions.cs* file to use the port number of your web application:</span></span>   

    [!code-html[Main](checkout-and-payment-with-paypal/samples/sample15.html?highlight=1-2)]

<span data-ttu-id="3f1a4-369">Agora, o código que você adicionou corresponderá a porta esperada para seu aplicativo da Web local.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-369">Now the code that you added will match the expected port for your local Web application.</span></span> <span data-ttu-id="3f1a4-370">PayPal será capaz de retornar para a URL correta em seu computador local.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-370">PayPal will be able to return to the correct URL on your local machine.</span></span>

### <a name="add-the-paypal-checkout-button"></a><span data-ttu-id="3f1a4-371">Adicionar o botão de check-out do PayPal</span><span class="sxs-lookup"><span data-stu-id="3f1a4-371">Add the PayPal Checkout Button</span></span>

<span data-ttu-id="3f1a4-372">Agora que as funções primárias do PayPal foram adicionadas ao aplicativo de exemplo, você pode começar a adicionar a marcação e o código necessário para chamar essas funções.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-372">Now that the primary PayPal functions have been added to the sample application, you can begin adding the markup and code needed to call these functions.</span></span> <span data-ttu-id="3f1a4-373">Primeiro, você deve adicionar o botão de check-out que o usuário verá na página do carrinho de compras.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-373">First, you must add the checkout button that the user will see on the shopping cart page.</span></span>

1. <span data-ttu-id="3f1a4-374">Abra o *ShoppingCart.aspx* arquivo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-374">Open the *ShoppingCart.aspx* file.</span></span>
2. <span data-ttu-id="3f1a4-375">Role até o final do arquivo e encontre o `<!--Checkout Placeholder -->` comentário.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-375">Scroll to the bottom of the file and find the `<!--Checkout Placeholder -->` comment.</span></span>
3. <span data-ttu-id="3f1a4-376">Substitua o comentário com um `ImageButton` controlar de forma que a marca de backup é substituída da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-376">Replace the comment with an `ImageButton` control so that the mark up is replaced as follows:</span></span>  

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample16.aspx)]
4. <span data-ttu-id="3f1a4-377">No *ShoppingCart.aspx.cs* do arquivo, após o `UpdateBtn_Click` manipulador de eventos perto do fim do arquivo, adicione o `CheckOutBtn_Click` manipulador de eventos:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-377">In the *ShoppingCart.aspx.cs* file, after the `UpdateBtn_Click` event handler near the end of the file, add the `CheckOutBtn_Click` event handler:</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample17.cs)]
5. <span data-ttu-id="3f1a4-378">Também na *ShoppingCart.aspx.cs* do arquivo, adicione uma referência para o `CheckoutBtn`, de modo que o novo botão de imagem é referenciado como se segue:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-378">Also in the *ShoppingCart.aspx.cs* file, add a reference to the `CheckoutBtn`, so that the new image button is referenced as follows:</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample18.cs?highlight=18)]
6. <span data-ttu-id="3f1a4-379">Salve as alterações em ambos os *ShoppingCart.aspx* arquivo e o *ShoppingCart.aspx.cs* arquivo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-379">Save your changes to both the *ShoppingCart.aspx* file and the *ShoppingCart.aspx.cs* file.</span></span>
7. <span data-ttu-id="3f1a4-380">No menu, selecione **Debug**-&gt;**Build WingtipToys**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-380">From the menu, select **Debug**-&gt;**Build WingtipToys**.</span></span>  
   <span data-ttu-id="3f1a4-381">O projeto será recriado com recém-adicionada **ImageButton** controle.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-381">The project will be rebuilt with the newly added **ImageButton** control.</span></span>

### <a name="send-purchase-details-to-paypal"></a><span data-ttu-id="3f1a4-382">Enviar detalhes de compra para PayPal</span><span class="sxs-lookup"><span data-stu-id="3f1a4-382">Send Purchase Details to PayPal</span></span>

<span data-ttu-id="3f1a4-383">Quando o usuário clica o **check-out** botão na página do carrinho de compras (*ShoppingCart.aspx*), ele começará o processo de compra.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-383">When the user clicks the **Checkout** button on the shopping cart page (*ShoppingCart.aspx*), they'll begin the purchase process.</span></span> <span data-ttu-id="3f1a4-384">O código a seguir chama a primeira função PayPal necessária comprar produtos.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-384">The following code calls the first PayPal function needed to purchase products.</span></span>

1. <span data-ttu-id="3f1a4-385">Dos *check-out* pasta, abra o arquivo code-behind chamado *CheckoutStart.aspx.cs*.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-385">From the *Checkout* folder, open the code-behind file named *CheckoutStart.aspx.cs*.</span></span>   
   <span data-ttu-id="3f1a4-386">Certifique-se de abrir o arquivo code-behind.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-386">Be sure to open the code-behind file.</span></span>
2. <span data-ttu-id="3f1a4-387">Substitua o código existente pelo seguinte:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-387">Replace the existing code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample19.cs)]

<span data-ttu-id="3f1a4-388">Quando o usuário do aplicativo clica o **check-out** botão sobre a página de carrinho de compras, o navegador vai navegar para o *CheckoutStart.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-388">When the user of the application clicks the **Checkout** button on the shopping cart page, the browser will navigate to the *CheckoutStart.aspx* page.</span></span> <span data-ttu-id="3f1a4-389">Quando o *CheckoutStart.aspx* página for carregada, o `ShortcutExpressCheckout` método é chamado.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-389">When the *CheckoutStart.aspx* page loads, the `ShortcutExpressCheckout` method is called.</span></span> <span data-ttu-id="3f1a4-390">Neste ponto, o usuário é transferido para o site de teste do PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-390">At this point, the user is transferred to the PayPal testing web site.</span></span> <span data-ttu-id="3f1a4-391">No site do PayPal, o usuário insere suas credenciais do PayPal, examina os detalhes de compra, aceitar o contrato do PayPal e retorna para o aplicativo de exemplo Wingtip Toys onde o `ShortcutExpressCheckout` método é concluído.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-391">On the PayPal site, the user enters their PayPal credentials, reviews the purchase details, accepts the PayPal agreement and returns to the Wingtip Toys sample application where the `ShortcutExpressCheckout` method completes.</span></span> <span data-ttu-id="3f1a4-392">Quando o `ShortcutExpressCheckout` método for concluído, ele redirecionará o usuário para o *CheckoutReview.aspx* página especificada no `ShortcutExpressCheckout` método.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-392">When the `ShortcutExpressCheckout` method is complete, it will redirect the user to the *CheckoutReview.aspx* page specified in the `ShortcutExpressCheckout` method.</span></span> <span data-ttu-id="3f1a4-393">Isso permite que o usuário revisar os detalhes do pedido de dentro do aplicativo de exemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-393">This allows the user to review the order details from within the Wingtip Toys sample application.</span></span>

### <a name="review-order-details"></a><span data-ttu-id="3f1a4-394">Examine os detalhes de ordem</span><span class="sxs-lookup"><span data-stu-id="3f1a4-394">Review Order Details</span></span>

<span data-ttu-id="3f1a4-395">Depois de retornar do PayPal, o *CheckoutReview.aspx* página do aplicativo de exemplo Wingtip Toys exibe os detalhes do pedido.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-395">After returning from PayPal, the *CheckoutReview.aspx* page of the Wingtip Toys sample application displays the order details.</span></span> <span data-ttu-id="3f1a4-396">Esta página permite que o usuário examine os detalhes do pedido antes de adquirir os produtos.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-396">This page allows the user to review the order details before purchasing the products.</span></span> <span data-ttu-id="3f1a4-397">O *CheckoutReview.aspx* página deve ser criada da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-397">The *CheckoutReview.aspx* page must be created as follows:</span></span>

1. <span data-ttu-id="3f1a4-398">No *check-out* pasta, abra a página chamada *CheckoutReview.aspx*.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-398">In the *Checkout* folder, open the page named *CheckoutReview.aspx*.</span></span>
2. <span data-ttu-id="3f1a4-399">Substitua a marcação existente pelo seguinte:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-399">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample20.aspx)]
3. <span data-ttu-id="3f1a4-400">Abra a página code-behind chamada *CheckoutReview.aspx.cs* e substitua o código existente pelo seguinte:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-400">Open the code-behind page named *CheckoutReview.aspx.cs* and replace the existing code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample21.cs)]

<span data-ttu-id="3f1a4-401">O **DetailsView** controle é usado para exibir os detalhes do pedido que foram retornados do PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-401">The **DetailsView** control is used to display the order details that have been returned from PayPal.</span></span> <span data-ttu-id="3f1a4-402">Além disso, o código acima salva os detalhes do pedido no banco de dados da Wingtip Toys como um `OrderDetail` objeto.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-402">Also, the above code saves the order details to the Wingtip Toys database as an `OrderDetail` object.</span></span> <span data-ttu-id="3f1a4-403">Quando o usuário clica na **ordem completo** botão, eles são redirecionados para o *CheckoutComplete.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-403">When the user clicks on the **Complete Order** button, they are redirected to the *CheckoutComplete.aspx* page.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="3f1a4-404">**Dica**</span><span class="sxs-lookup"><span data-stu-id="3f1a4-404">**Tip**</span></span>
> 
> <span data-ttu-id="3f1a4-405">Na marcação do *CheckoutReview.aspx* página, observe que o `<ItemStyle>` marca é usada para alterar o estilo dos itens dentro de **DetailsView** controle na parte inferior da página.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-405">In the markup of the *CheckoutReview.aspx* page, notice that the `<ItemStyle>` tag is used to change the style of the items within the **DetailsView** control near the bottom of the page.</span></span> <span data-ttu-id="3f1a4-406">Exibindo a página no **modo de exibição de Design** (selecionando **Design** no canto inferior esquerdo do Visual Studio), selecionando o **DetailsView** controlar e, em seguida, selecionando o  **Marca inteligente** (o ícone de seta na parte superior direita do controle), você será capaz de ver as **DetailsView tarefas**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-406">By viewing the page in **Design View** (by selecting **Design** at the lower left corner of Visual Studio), then selecting the **DetailsView** control, and selecting the **Smart Tag** (the arrow icon at the top right of the control), you will be able to see the **DetailsView Tasks**.</span></span>
> 
> ![Check-out e pagamento com o PayPal - editar campos](checkout-and-payment-with-paypal/_static/image18.png)
> 
> <span data-ttu-id="3f1a4-408">Selecionando **editar campos**, o **campos** caixa de diálogo será exibida.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-408">By selecting **Edit Fields**, the **Fields** dialog box will appear.</span></span> <span data-ttu-id="3f1a4-409">Na caixa de diálogo você pode controlar facilmente as propriedades visuais, tais como **ItemStyle**, da **DetailsView** controle.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-409">In this dialog box you can easily control the visual properties, such as **ItemStyle**, of the **DetailsView** control.</span></span>
> 
> ![Check-out e pagamento com o PayPal - caixa de diálogo campos](checkout-and-payment-with-paypal/_static/image19.png)


### <a name="complete-purchase"></a><span data-ttu-id="3f1a4-411">Finalizar compra</span><span class="sxs-lookup"><span data-stu-id="3f1a4-411">Complete Purchase</span></span>

<span data-ttu-id="3f1a4-412">*CheckoutComplete.aspx* página faz a compra do PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-412">*CheckoutComplete.aspx* page makes the purchase from PayPal.</span></span> <span data-ttu-id="3f1a4-413">Conforme mencionado acima, o usuário deve clicar na **ordem completo** botão antes do aplicativo navegará para o *CheckoutComplete.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-413">As mentioned above, the user must click on the **Complete Order** button before the application will navigate to the *CheckoutComplete.aspx* page.</span></span>

1. <span data-ttu-id="3f1a4-414">No *check-out* pasta, abra a página chamada *CheckoutComplete.aspx*.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-414">In the *Checkout* folder, open the page named *CheckoutComplete.aspx*.</span></span>
2. <span data-ttu-id="3f1a4-415">Substitua a marcação existente pelo seguinte:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-415">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample22.aspx)]
3. <span data-ttu-id="3f1a4-416">Abra a página code-behind chamada *CheckoutComplete.aspx.cs* e substitua o código existente pelo seguinte:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-416">Open the code-behind page named *CheckoutComplete.aspx.cs* and replace the existing code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample23.cs)]

<span data-ttu-id="3f1a4-417">Quando o *CheckoutComplete.aspx* página é carregada, o `DoCheckoutPayment` método é chamado.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-417">When the *CheckoutComplete.aspx* page is loaded, the `DoCheckoutPayment` method is called.</span></span> <span data-ttu-id="3f1a4-418">Como mencionado anteriormente, o `DoCheckoutPayment` método completa a compra do ambiente de teste do PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-418">As mentioned earlier, the `DoCheckoutPayment` method completes the purchase from the PayPal testing environment.</span></span> <span data-ttu-id="3f1a4-419">Depois que PayPal foi concluída a compra do pedido, o *CheckoutComplete.aspx* página exibe uma transação de pagamento `ID` ao comprador.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-419">Once PayPal has completed the purchase of the order, the *CheckoutComplete.aspx* page displays a payment transaction `ID` to the purchaser.</span></span>

### <a name="handle-cancel-purchase"></a><span data-ttu-id="3f1a4-420">Manipular o Cancelar compra</span><span class="sxs-lookup"><span data-stu-id="3f1a4-420">Handle Cancel Purchase</span></span>

<span data-ttu-id="3f1a4-421">Se o usuário decidir cancelar a compra, serão direcionados para o *CheckoutCancel.aspx* página em que eles verão sua ordem foi cancelada.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-421">If the user decides to cancel the purchase, they will be directed to the *CheckoutCancel.aspx* page where they will see that their order has been cancelled.</span></span>

1. <span data-ttu-id="3f1a4-422">Abra a página chamada *CheckoutCancel.aspx* na *check-out* pasta.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-422">Open the page named *CheckoutCancel.aspx* in the *Checkout* folder.</span></span>
2. <span data-ttu-id="3f1a4-423">Substitua a marcação existente pelo seguinte:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-423">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample24.aspx)]

### <a name="handle-purchase-errors"></a><span data-ttu-id="3f1a4-424">Tratar erros de compra</span><span class="sxs-lookup"><span data-stu-id="3f1a4-424">Handle Purchase Errors</span></span>

<span data-ttu-id="3f1a4-425">Erros durante o processo de compra serão tratados pelos *CheckoutError.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-425">Errors during the purchase process will be handled by the *CheckoutError.aspx* page.</span></span> <span data-ttu-id="3f1a4-426">O code-behind do *CheckoutStart.aspx* página, o *CheckoutReview.aspx* página e o *CheckoutComplete.aspx* cada página será redirecionada para o  *CheckoutError.aspx* página se ocorrer um erro.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-426">The code-behind of the *CheckoutStart.aspx* page, the *CheckoutReview.aspx* page, and the *CheckoutComplete.aspx* page will each redirect to the *CheckoutError.aspx* page if an error occurs.</span></span>

1. <span data-ttu-id="3f1a4-427">Abra a página chamada *CheckoutError.aspx* na *check-out* pasta.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-427">Open the page named *CheckoutError.aspx* in the *Checkout* folder.</span></span>
2. <span data-ttu-id="3f1a4-428">Substitua a marcação existente pelo seguinte:</span><span class="sxs-lookup"><span data-stu-id="3f1a4-428">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample25.aspx)]

<span data-ttu-id="3f1a4-429">O *CheckoutError.aspx* página é exibida com os detalhes do erro quando ocorre um erro durante o processo de check-out.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-429">The *CheckoutError.aspx* page is displayed with the error details when an error occurs during the checkout process.</span></span>

## <a name="running-the-application"></a><span data-ttu-id="3f1a4-430">Executando o aplicativo</span><span class="sxs-lookup"><span data-stu-id="3f1a4-430">Running the Application</span></span>

<span data-ttu-id="3f1a4-431">Execute o aplicativo para ver como comprar produtos.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-431">Run the application to see how to purchase products.</span></span> <span data-ttu-id="3f1a4-432">Observe que serão executados do PayPal ambiente de teste.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-432">Note that you will be running in the PayPal testing environment.</span></span> <span data-ttu-id="3f1a4-433">Não há dinheiro real que está sendo trocado.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-433">No actual money is being exchanged.</span></span>

1. <span data-ttu-id="3f1a4-434">Verifique se todos os arquivos são salvos no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-434">Make sure all your files are saved in Visual Studio.</span></span>
2. <span data-ttu-id="3f1a4-435">Abra um navegador da Web e navegue até [ https://developer.paypal.com ](https://developer.paypal.com/).</span><span class="sxs-lookup"><span data-stu-id="3f1a4-435">Open a Web browser and navigate to [https://developer.paypal.com](https://developer.paypal.com/).</span></span>
3. <span data-ttu-id="3f1a4-436">Faça logon com sua conta de desenvolvedor do PayPal que você criou neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-436">Login with your PayPal developer account that you created earlier in this tutorial.</span></span>  
   <span data-ttu-id="3f1a4-437">Para a área restrita do desenvolvedor do PayPal, você precisa estar conectado ao [ https://developer.paypal.com ](https://developer.paypal.com/) para testar o check-out express.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-437">For PayPal's developer sandbox, you need to be logged in at [https://developer.paypal.com](https://developer.paypal.com/) to test express checkout.</span></span> <span data-ttu-id="3f1a4-438">Isso se aplica somente à área restrita do PayPal teste, não para o ambiente ao vivo do PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-438">This only applies to PayPal's sandbox testing, not to PayPal's live environment.</span></span>
4. <span data-ttu-id="3f1a4-439">No Visual Studio, pressione **F5** para executar o aplicativo de exemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-439">In Visual Studio, press **F5** to run the Wingtip Toys sample application.</span></span>  
   <span data-ttu-id="3f1a4-440">Depois que recria o banco de dados, o navegador será aberto e mostrará os *default. aspx* página.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-440">After the database rebuilds, the browser will open and show the *Default.aspx* page.</span></span>
5. <span data-ttu-id="3f1a4-441">Adicione três produtos diferentes ao carrinho de compras selecionando a categoria de produto, como "Carros" e, em seguida, clicando em **adicionar ao carrinho** ao lado de cada produto.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-441">Add three different products to the shopping cart by selecting the product category, such as "Cars" and then clicking **Add to Cart** next to each product.</span></span>  
   <span data-ttu-id="3f1a4-442">O carrinho de compras exibirá o produto que você selecionou.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-442">The shopping cart will display the product you have selected.</span></span>
6. <span data-ttu-id="3f1a4-443">Clique o **PayPal** botão fazer check-out.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-443">Click the **PayPal** button to checkout.</span></span> 

    ![Check-out e pagamento com o PayPal - carrinho](checkout-and-payment-with-paypal/_static/image20.png)

   <span data-ttu-id="3f1a4-445">Fazendo check-out exigirá que você tenha uma conta de usuário para o aplicativo de exemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-445">Checking out will require that you have a user account for the Wingtip Toys sample application.</span></span>
7. <span data-ttu-id="3f1a4-446">Clique o **Google** link à direita da página para fazer logon com uma conta de email gmail.com existente.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-446">Click the **Google** link on the right of the page to log in with an existing gmail.com email account.</span></span>  
   <span data-ttu-id="3f1a4-447">Se você não tiver uma conta de gmail.com, você pode criar um para testes no [www.gmail.com](https://www.gmail.com/).</span><span class="sxs-lookup"><span data-stu-id="3f1a4-447">If you do not have a gmail.com account, you can create one for testing purposes at [www.gmail.com](https://www.gmail.com/).</span></span> <span data-ttu-id="3f1a4-448">Você também pode usar uma conta local padrão, clicando em "Registrar".</span><span class="sxs-lookup"><span data-stu-id="3f1a4-448">You can also use a standard local account by clicking "Register".</span></span> 

    ![Check-out e pagamento com o PayPal - faça logon no](checkout-and-payment-with-paypal/_static/image21.png)
8. <span data-ttu-id="3f1a4-450">Entre com sua conta do gmail e senha.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-450">Sign in with your gmail account and password.</span></span> 

    ![Check-out e pagamento com o PayPal - Gmail de entrada](checkout-and-payment-with-paypal/_static/image22.png)
9. <span data-ttu-id="3f1a4-452">Clique o **faça logon no** botão registrar sua conta do gmail com seu nome de usuário do aplicativo de exemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-452">Click the **Log in** button to register your gmail account with your Wingtip Toys sample application user name.</span></span> 

    ![Check-out e pagamento com o PayPal - registro de conta](checkout-and-payment-with-paypal/_static/image23.png)
10. <span data-ttu-id="3f1a4-454">No site de teste do PayPal, adicione sua **comprador** endereço de email e senha que você criou neste tutorial e, em seguida, clique no **Log In** botão.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-454">On the PayPal test site, add your **buyer** email address and password that you created earlier in this tutorial, then click the **Log In** button.</span></span> 

    ![Check-out e pagamento com o PayPal - PayPal de entrada](checkout-and-payment-with-paypal/_static/image24.png)
11. <span data-ttu-id="3f1a4-456">Concordar com a política do PayPal e clique no **Concordo e continuar** botão.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-456">Agree to the PayPal policy and click the **Agree and Continue** button.</span></span>  
    <span data-ttu-id="3f1a4-457">Observe que esta página só é exibida na primeira vez que você usar essa conta PayPal.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-457">Note that this page is only displayed the first time you use this PayPal account.</span></span> <span data-ttu-id="3f1a4-458">Novamente, observe que esta é uma conta de teste, nenhum dinheiro real é trocado.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-458">Again note that this is a test account, no real money is exchanged.</span></span> 

    ![Check-out e pagamento com o PayPal - política PayPal](checkout-and-payment-with-paypal/_static/image25.png)
12. <span data-ttu-id="3f1a4-460">Examine as informações de pedido do PayPal Testando a página de revisão do ambiente e clique em **continuar**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-460">Review the order information on the PayPal testing environment review page and click **Continue**.</span></span> 

    ![Check-out e pagamento com o PayPal - informações de análise](checkout-and-payment-with-paypal/_static/image26.png)
13. <span data-ttu-id="3f1a4-462">Sobre o *CheckoutReview.aspx* página, verifique se o valor do pedido e exibir o endereço de envio gerado.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-462">On the *CheckoutReview.aspx* page, verify the order amount and view the generated shipping address.</span></span> <span data-ttu-id="3f1a4-463">Em seguida, clique o **ordem completo** botão.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-463">Then, click the **Complete Order** button.</span></span> 

    ![Check-out e pagamento com o PayPal - revisão de ordem](checkout-and-payment-with-paypal/_static/image27.png)
14. <span data-ttu-id="3f1a4-465">O **CheckoutComplete.aspx** página é exibida com uma ID de transação de pagamento.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-465">The **CheckoutComplete.aspx** page is displayed with a payment transaction ID.</span></span> 

    ![Check-out e pagamento com o PayPal - check-out completa](checkout-and-payment-with-paypal/_static/image28.png)

<a id="ReviewDBWebForms"></a>
## <a name="reviewing-the-database"></a><span data-ttu-id="3f1a4-467">Revisando o banco de dados</span><span class="sxs-lookup"><span data-stu-id="3f1a4-467">Reviewing the Database</span></span>

<span data-ttu-id="3f1a4-468">Ao analisar os dados atualizados no banco de dados de aplicativo de exemplo Wingtip Toys depois de executar o aplicativo, você pode ver que o aplicativo registrada com êxito a compra de produtos.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-468">By reviewing the updated data in the Wingtip Toys sample application database after running the application, you can see that the application successfully recorded the purchase of the products.</span></span>

<span data-ttu-id="3f1a4-469">Você pode inspecionar os dados contidos na *Wingtiptoys.mdf* arquivo de banco de dados usando o **Database Explorer** janela (**Server Explorer** janela no Visual Studio) como você fez anteriormente nessa série de tutoriais.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-469">You can inspect the data contained in the *Wingtiptoys.mdf* database file by using the **Database Explorer** window (**Server Explorer** window in Visual Studio) as you did earlier in this tutorial series.</span></span>

1. <span data-ttu-id="3f1a4-470">Se ele ainda estiver aberto, feche a janela do navegador.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-470">Close the browser window if it is still open.</span></span>
2. <span data-ttu-id="3f1a4-471">No Visual Studio, selecione o **Show All Files** ícone na parte superior da **Gerenciador de soluções** para permitir que você expanda o **aplicativo\_dados** pasta.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-471">In Visual Studio, select the **Show All Files** icon at the top of **Solution Explorer** to allow you to expand the **App\_Data** folder.</span></span>
3. <span data-ttu-id="3f1a4-472">Expanda o **App\_dados** pasta.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-472">Expand the **App\_Data** folder.</span></span>  
 <span data-ttu-id="3f1a4-473">Talvez você precise selecionar o **Show All Files** ícone da pasta.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-473">You may need to select the **Show All Files** icon for the folder.</span></span>
4. <span data-ttu-id="3f1a4-474">Clique com botão direito do *Wingtiptoys.mdf* arquivo de banco de dados e selecione **abrir**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-474">Right-click the *Wingtiptoys.mdf* database file and select **Open**.</span></span>  
    <span data-ttu-id="3f1a4-475">**Gerenciador de servidores** é exibida.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-475">**Server Explorer** is displayed.</span></span>
5. <span data-ttu-id="3f1a4-476">Expanda o **tabelas** pasta.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-476">Expand the **Tables** folder.</span></span>
6. <span data-ttu-id="3f1a4-477">Clique com botão direito do **pedidos**de tabela e selecione **Mostrar dados da tabela**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-477">Right-click the **Orders**table and select **Show Table Data**.</span></span>  
 <span data-ttu-id="3f1a4-478">O **pedidos** tabela é exibida.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-478">The **Orders** table is displayed.</span></span>
7. <span data-ttu-id="3f1a4-479">Examine os **PaymentTransactionID** coluna para confirmar transações com êxito.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-479">Review the **PaymentTransactionID** column to confirm successful transactions.</span></span> 

    ![Check-out e pagamento com o PayPal - banco de dados de revisão](checkout-and-payment-with-paypal/_static/image29.png)
8. <span data-ttu-id="3f1a4-481">Fechar o **pedidos** janela da tabela.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-481">Close the **Orders** table window.</span></span>
9. <span data-ttu-id="3f1a4-482">No Gerenciador de servidores, clique com botão direito do **OrderDetails** de tabela e selecione **Mostrar dados da tabela**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-482">In the Server Explorer, right-click the **OrderDetails** table and select **Show Table Data**.</span></span>
10. <span data-ttu-id="3f1a4-483">Examine os `OrderId` e `Username` os valores na **OrderDetails** tabela.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-483">Review the `OrderId` and `Username` values in the **OrderDetails** table.</span></span> <span data-ttu-id="3f1a4-484">Observe que esses valores correspondem a `OrderId` e `Username` valores incluídos na **pedidos** tabela.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-484">Note that these values match the `OrderId` and `Username` values included in the **Orders** table.</span></span>
11. <span data-ttu-id="3f1a4-485">Fechar o **OrderDetails** janela da tabela.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-485">Close the **OrderDetails** table window.</span></span>
12. <span data-ttu-id="3f1a4-486">Clique no arquivo de banco de dados da Wingtip Toys (*Wingtiptoys.mdf*) e selecione **fechar Conexão**.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-486">Right-click the Wingtip Toys database file (*Wingtiptoys.mdf*) and select **Close Connection**.</span></span>
13. <span data-ttu-id="3f1a4-487">Se você não vir as **Gerenciador de soluções** janela, clique em **Gerenciador de soluções** na parte inferior da **Gerenciador de servidores** janela para mostrar o **Gerenciador de soluções**  novamente.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-487">If you do not see the **Solution Explorer** window, click **Solution Explorer** at the bottom of the **Server Explorer** window to show the **Solution Explorer** again.</span></span>

## <a name="summary"></a><span data-ttu-id="3f1a4-488">Resumo</span><span class="sxs-lookup"><span data-stu-id="3f1a4-488">Summary</span></span>

<span data-ttu-id="3f1a4-489">Neste tutorial, você adicionou ordem e esquemas de detalhes do pedido para acompanhar a compra de produtos.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-489">In this tutorial you added order and order detail schemas to track the purchase of products.</span></span> <span data-ttu-id="3f1a4-490">Você também PayPal funcionalidade integrada no aplicativo de exemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-490">You also integrated PayPal functionality into the Wingtip Toys sample application.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="3f1a4-491">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="3f1a4-491">Additional Resources</span></span>

<span data-ttu-id="3f1a4-492">[Visão geral da configuração do ASP.NET](https://msdn.microsoft.com/library/ms178683(v=vs.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="3f1a4-492">[ASP.NET Configuration Overview](https://msdn.microsoft.com/library/ms178683(v=vs.100).aspx)</span></span>  
[<span data-ttu-id="3f1a4-493">Implantar um aplicativo de formulários da Web do ASP.NET seguro com associação, OAuth e banco de dados SQL no serviço de aplicativo do Azure</span><span class="sxs-lookup"><span data-stu-id="3f1a4-493">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to Azure App Service</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)  
[<span data-ttu-id="3f1a4-494">Microsoft Azure – avaliação gratuita</span><span class="sxs-lookup"><span data-stu-id="3f1a4-494">Microsoft Azure - Free Trial</span></span>](https://azure.microsoft.com/pricing/free-trial/)

## <a name="disclaimer"></a><span data-ttu-id="3f1a4-495">Aviso de isenção de responsabilidade</span><span class="sxs-lookup"><span data-stu-id="3f1a4-495">Disclaimer</span></span>

<span data-ttu-id="3f1a4-496">Este tutorial contém código de exemplo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-496">This tutorial contains sample code.</span></span> <span data-ttu-id="3f1a4-497">Esse código de exemplo é fornecido "como está" sem garantias de qualquer tipo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-497">Such sample code is provided "as is" without warranty of any kind.</span></span> <span data-ttu-id="3f1a4-498">Da mesma forma, a Microsoft não garante a precisão, integridade ou a qualidade do código de exemplo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-498">Accordingly, Microsoft does not guarantee the accuracy, integrity, or quality of the sample code.</span></span> <span data-ttu-id="3f1a4-499">Você concorda em usar o código de exemplo em seu próprio risco.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-499">You agree to use the sample code at your own risk.</span></span> <span data-ttu-id="3f1a4-500">Sob nenhuma circunstância a Microsoft Corporation é responsável de qualquer maneira por qualquer código de exemplo, conteúdo, incluindo, mas não se limitando a quaisquer erros ou omissões em qualquer código de exemplo, conteúdo, ou qualquer perda ou dano de qualquer tipo incorrido em decorrência do uso de qualquer código de exemplo.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-500">Under no circumstances will Microsoft be liable to you in any way for any sample code, content, including but not limited to, any errors or omissions in any sample code, content, or any loss or damage of any kind incurred as a result of the use of any sample code.</span></span> <span data-ttu-id="3f1a4-501">Você será notificado por meio deste e concorda em indenizar, salvar e armazenar contra perda de toda e qualquer, declarações de perda, lesões ou dano de qualquer tipo incluindo, sem limitação, aqueles occasioned por ou decorrentes do material que você postar, a Microsoft transmitir, usar ou contar incluindo, mas sem limitação, as opiniões expressadas contido nele.</span><span class="sxs-lookup"><span data-stu-id="3f1a4-501">You are hereby notified and do hereby agree to indemnify, save and hold Microsoft harmless from and against any and all loss, claims of loss, injury or damage of any kind including, without limitation, those occasioned by or arising from material that you post, transmit, use or rely on including, but not limited to, the views expressed therein.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="3f1a4-502">[Anterior](shopping-cart.md)
> [Próximo](membership-and-administration.md)</span><span class="sxs-lookup"><span data-stu-id="3f1a4-502">[Previous](shopping-cart.md)
[Next](membership-and-administration.md)</span></span>
