---
uid: web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-cs
title: Incluindo um arquivo de opção Carregar ao adicionar um novo registro (c#) | Microsoft Docs
author: rick-anderson
description: Este tutorial mostra como criar uma interface da Web que permite que o usuário digite dados de texto e carregar arquivos binários. Para ilustrar o t disponível de opções...
ms.author: aspnetcontent
ms.date: 03/27/2007
ms.assetid: 362ade25-3965-4fb2-88d2-835c4786244f
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-cs
msc.type: authoredcontent
ms.openlocfilehash: 5cc1db20a724c8a060e978e2360b977fb16f1e0c
ms.sourcegitcommit: b28cd0313af316c051c2ff8549865bff67f2fbb4
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/05/2018
ms.locfileid: "37842375"
---
<a name="including-a-file-upload-option-when-adding-a-new-record-c"></a><span data-ttu-id="9a9d6-104">Incluindo uma opção de Upload de arquivo ao adicionar um novo registro (c#)</span><span class="sxs-lookup"><span data-stu-id="9a9d6-104">Including a File Upload Option When Adding a New Record (C#)</span></span>
====================
<span data-ttu-id="9a9d6-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9a9d6-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9a9d6-106">[Baixe o aplicativo de exemplo](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_CS.exe) ou [baixar PDF](including-a-file-upload-option-when-adding-a-new-record-cs/_static/datatutorial56cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="9a9d6-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_CS.exe) or [Download PDF](including-a-file-upload-option-when-adding-a-new-record-cs/_static/datatutorial56cs1.pdf)</span></span>

> <span data-ttu-id="9a9d6-107">Este tutorial mostra como criar uma interface da Web que permite que o usuário digite dados de texto e carregar arquivos binários.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-107">This tutorial shows how to create a Web interface that allows the user to both enter text data and upload binary files.</span></span> <span data-ttu-id="9a9d6-108">Para ilustrar as opções disponíveis para armazenar dados binários, um arquivo será salvo no banco de dados enquanto o outro é armazenado no sistema de arquivos.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-108">To illustrate the options available to store binary data, one file will be saved in the database while the other is stored in the file system.</span></span>


## <a name="introduction"></a><span data-ttu-id="9a9d6-109">Introdução</span><span class="sxs-lookup"><span data-stu-id="9a9d6-109">Introduction</span></span>

<span data-ttu-id="9a9d6-110">Nos tutoriais anteriores dois exploramos técnicas para armazenar dados binários que está associados com o modelo de dados de s do aplicativo, examinado como usar o controle FileUpload para enviar os arquivos do cliente para o servidor web e viu como apresentar esses dados binários em um dado W controle EB.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-110">In the previous two tutorials we explored techniques for storing binary data that is associated with the application s data model, looked at how to use the FileUpload control to send files from the client to the web server, and saw how to present this binary data in a data Web control.</span></span> <span data-ttu-id="9a9d6-111">Podemos var ainda para falar sobre como associar dados carregados com o modelo de dados, no entanto.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-111">We ve yet to talk about how to associate uploaded data with the data model, though.</span></span>

<span data-ttu-id="9a9d6-112">Neste tutorial, criaremos uma página da web para adicionar uma nova categoria.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-112">In this tutorial we will create a web page to add a new category.</span></span> <span data-ttu-id="9a9d6-113">Além de caixas de texto para o nome da categoria s e a descrição, essa página será necessário incluir dois controles FileUpload para a nova imagem de categoria s e outro para o folheto do.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-113">In addition to TextBoxes for the category s name and description, this page will need to include two FileUpload controls one for the new category s picture and one for the brochure.</span></span> <span data-ttu-id="9a9d6-114">A imagem carregada será armazenada diretamente no novo registro de s `Picture` coluna, enquanto o folheto será salvo para o `~/Brochures` pasta com o caminho para o arquivo salvo no novo registro s `BrochurePath` coluna.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-114">The uploaded picture will be stored directly in the new record s `Picture` column, whereas the brochure will be saved to the `~/Brochures` folder with the path to the file saved in the new record s `BrochurePath` column.</span></span>

<span data-ttu-id="9a9d6-115">Antes de criar essa nova página da web, precisaremos atualizar a arquitetura.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-115">Before creating this new web page, we'll need to update the architecture.</span></span> <span data-ttu-id="9a9d6-116">O `CategoriesTableAdapter` consulta principal de s não recuperar o `Picture` coluna.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-116">The `CategoriesTableAdapter` s main query does not retrieve the `Picture` column.</span></span> <span data-ttu-id="9a9d6-117">Consequentemente, o autogerado `Insert` método só tem entradas para o `CategoryName`, `Description`, e `BrochurePath` campos.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-117">Consequently, the auto-generated `Insert` method only has inputs for the `CategoryName`, `Description`, and `BrochurePath` fields.</span></span> <span data-ttu-id="9a9d6-118">Portanto, precisamos criar um método adicional no TableAdapter que solicita todos os quatro `Categories` campos.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-118">Therefore, we need to create an additional method in the TableAdapter that prompts for all four `Categories` fields.</span></span> <span data-ttu-id="9a9d6-119">O `CategoriesBLL` classe na camada de lógica de negócios também precisam ser atualizados.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-119">The `CategoriesBLL` class in the Business Logic Layer will also need to be updated.</span></span>

## <a name="step-1-adding-aninsertwithpicturemethod-to-thecategoriestableadapter"></a><span data-ttu-id="9a9d6-120">Etapa 1: Adicionando um`InsertWithPicture`método para o`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="9a9d6-120">Step 1: Adding an`InsertWithPicture`Method to the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="9a9d6-121">Quando criamos o `CategoriesTableAdapter` volta a [criando uma camada de acesso de dados](../introduction/creating-a-data-access-layer-cs.md) tutorial, estamos configurados para gerar automaticamente `INSERT`, `UPDATE`, e `DELETE` instruções com base em consulta principal.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-121">When we created the `CategoriesTableAdapter` back in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial, we configured it to automatically generate `INSERT`, `UPDATE`, and `DELETE` statements based on the main query.</span></span> <span data-ttu-id="9a9d6-122">Além disso, nós o instruímos a empregar a abordagem direta de banco de dados, o que criou os métodos TableAdapter `Insert`, `Update`, e `Delete`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-122">Moreover, we instructed the TableAdapter to employ the DB Direct approach, which created the methods `Insert`, `Update`, and `Delete`.</span></span> <span data-ttu-id="9a9d6-123">Esses métodos são executados geradas automaticamente `INSERT`, `UPDATE`, e `DELETE` instruções e, consequentemente, aceitar parâmetros de entrada com base nas colunas retornadas pela consulta principal.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-123">These methods execute the auto-generated `INSERT`, `UPDATE`, and `DELETE` statements and, consequently, accept input parameters based on the columns returned by the main query.</span></span> <span data-ttu-id="9a9d6-124">No [carregar arquivos](uploading-files-cs.md) tutorial aumentássemos a `CategoriesTableAdapter` a consulta principal s para usar o `BrochurePath` coluna.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-124">In the [Uploading Files](uploading-files-cs.md) tutorial we augmented the `CategoriesTableAdapter` s main query to use the `BrochurePath` column.</span></span>

<span data-ttu-id="9a9d6-125">Uma vez que o `CategoriesTableAdapter` não faz referência a consulta principal de s a `Picture` coluna, podemos não pode adicionar um novo registro nem atualizar um registro existente com um valor para o `Picture` coluna.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-125">Since the `CategoriesTableAdapter` s main query does not reference the `Picture` column, we can neither add a new record nor update an existing record with a value for the `Picture` column.</span></span> <span data-ttu-id="9a9d6-126">Para capturar essas informações, podemos pode criar um novo método no TableAdapter que é usado especificamente para inserir um registro com dados binários ou podemos personalizar geradas automaticamente `INSERT` instrução.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-126">In order to capture this information, we can either create a new method in the TableAdapter that is used specifically to insert a record with binary data or we can customize the auto-generated `INSERT` statement.</span></span> <span data-ttu-id="9a9d6-127">O problema com a personalização geradas automaticamente `INSERT` instrução é que podemos o risco de ter nossas personalizações substituídas pelo assistente.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-127">The problem with customizing the auto-generated `INSERT` statement is that we risk having our customizations overwritten by the wizard.</span></span> <span data-ttu-id="9a9d6-128">Por exemplo, imagine que estamos personalizada a `INSERT` instrução para incluir o uso do `Picture` coluna.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-128">For example, imagine that we customized the `INSERT` statement to include use of the `Picture` column.</span></span> <span data-ttu-id="9a9d6-129">Isso atualizará o TableAdapter s `Insert` método para incluir um parâmetro de entrada adicional para os dados binários de imagem s s da categoria.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-129">This would update the TableAdapter s `Insert` method to include an additional input parameter for the category s picture s binary data.</span></span> <span data-ttu-id="9a9d6-130">Em seguida, criamos um método na camada de lógica de negócios para usar esse método DAL e invocar esse método BLL por meio da camada de apresentação, e tudo o que funcionaria brilhante.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-130">We could then create a method in the Business Logic Layer to use this DAL method and invoke this BLL method through the Presentation Layer, and everything would work wonderfully.</span></span> <span data-ttu-id="9a9d6-131">Ou seja, até a próxima vez, configuramos o TableAdapter o Assistente de configuração do TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-131">That is, until the next time we configured the TableAdapter through the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="9a9d6-132">Assim que o assistente for concluído, nosso personalizações para o `INSERT` instrução seria substituída, o `Insert` método seria revertida para sua forma antiga, e nosso código não seria mais compilado!</span><span class="sxs-lookup"><span data-stu-id="9a9d6-132">As soon as the wizard completed, our customizations to the `INSERT` statement would be overwritten, the `Insert` method would revert to its old form, and our code would no longer compile!</span></span>

> [!NOTE]
> <span data-ttu-id="9a9d6-133">Essa mensagem inconveniente não é um-problema ao usar procedimentos armazenados, em vez de instruções SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-133">This annoyance is a non-issue when using stored procedures instead of ad-hoc SQL statements.</span></span> <span data-ttu-id="9a9d6-134">Um tutorial futuro explorará usando procedimentos armazenados no lugar de instruções SQL ad hoc na camada de acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-134">A future tutorial will explore using stored procedures in lieu of ad-hoc SQL statements in the Data Access Layer.</span></span>


<span data-ttu-id="9a9d6-135">Para evitar essa possibilidade dor de cabeça, em vez de como personalizar as instruções de SQL gerado automaticamente permitem s em vez disso, crie um novo método para o TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-135">To avoid this potential headache, rather than customizing the auto-generated SQL statements let s instead create a new method for the TableAdapter.</span></span> <span data-ttu-id="9a9d6-136">Esse método, chamado `InsertWithPicture`, aceite os valores para o `CategoryName`, `Description`, `BrochurePath`, e `Picture` colunas e executar um `INSERT` instrução que armazena todos os quatro valores em um novo registro.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-136">This method, named `InsertWithPicture`, will accept values for the `CategoryName`, `Description`, `BrochurePath`, and `Picture` columns and execute an `INSERT` statement that stores all four values in a new record.</span></span>

<span data-ttu-id="9a9d6-137">Abra o conjunto de dados tipado e, no Designer, clique com botão direito no `CategoriesTableAdapter` cabeçalho s e escolha Add Query no menu de contexto.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-137">Open the Typed DataSet and, from the Designer, right-click on the `CategoriesTableAdapter` s header and choose Add Query from the context menu.</span></span> <span data-ttu-id="9a9d6-138">Isso inicia o Assistente de configuração de consulta do TableAdapter, que começa com a pergunta como a consulta do TableAdapter deve acessar o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-138">This launches the TableAdapter Query Configuration Wizard, which begins by asking us how the TableAdapter query should access the database.</span></span> <span data-ttu-id="9a9d6-139">Escolha usar instruções SQL e clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-139">Choose Use SQL statements and click Next.</span></span> <span data-ttu-id="9a9d6-140">A próxima etapa solicitará o tipo de consulta a ser gerado.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-140">The next step prompts for the type of query to be generated.</span></span> <span data-ttu-id="9a9d6-141">Desde que criamos re criando uma consulta para adicionar um novo registro para o `Categories` de tabela, escolha Inserir e clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-141">Since we re creating a query to add a new record to the `Categories` table, choose INSERT and click Next.</span></span>


<span data-ttu-id="9a9d6-142">[![Selecione a opção de inserção](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9a9d6-142">[![Select the INSERT Option](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.png)</span></span>

<span data-ttu-id="9a9d6-143">**Figura 1**: selecione a opção de inserir ([clique para exibir a imagem em tamanho normal](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="9a9d6-143">**Figure 1**: Select the INSERT Option ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.png))</span></span>


<span data-ttu-id="9a9d6-144">Agora, precisamos especificar o `INSERT` instrução SQL.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-144">We now need to specify the `INSERT` SQL statement.</span></span> <span data-ttu-id="9a9d6-145">O assistente sugere automaticamente um `INSERT` instrução corresponde à consulta principal do TableAdapter s.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-145">The wizard automatically suggests an `INSERT` statement corresponding to the TableAdapter s main query.</span></span> <span data-ttu-id="9a9d6-146">Nesse caso, ele s uma `INSERT` instrução que insere a `CategoryName`, `Description`, e `BrochurePath` valores.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-146">In this case, it s an `INSERT` statement that inserts the `CategoryName`, `Description`, and `BrochurePath` values.</span></span> <span data-ttu-id="9a9d6-147">A instrução Update para que o `Picture` coluna está incluída junto com um `@Picture` parâmetro, da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="9a9d6-147">Update the statement so that the `Picture` column is included along with a `@Picture` parameter, like so:</span></span>


[!code-sql[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample1.sql)]

<span data-ttu-id="9a9d6-148">A tela final do assistente nos pede para nomear o novo método do TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-148">The final screen of the wizard asks us to name the new TableAdapter method.</span></span> <span data-ttu-id="9a9d6-149">Insira `InsertWithPicture` e clique em Concluir.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-149">Enter `InsertWithPicture` and click Finish.</span></span>


<span data-ttu-id="9a9d6-150">[![Nomeie o novo InsertWithPicture de método do TableAdapter](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="9a9d6-150">[![Name the New TableAdapter Method InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.png)</span></span>

<span data-ttu-id="9a9d6-151">**Figura 2**: Nomeie o novo método do TableAdapter `InsertWithPicture` ([clique para exibir a imagem em tamanho normal](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="9a9d6-151">**Figure 2**: Name the New TableAdapter Method `InsertWithPicture` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.png))</span></span>


## <a name="step-2-updating-the-business-logic-layer"></a><span data-ttu-id="9a9d6-152">Etapa 2: Atualizar a camada de lógica de negócios</span><span class="sxs-lookup"><span data-stu-id="9a9d6-152">Step 2: Updating the Business Logic Layer</span></span>

<span data-ttu-id="9a9d6-153">Uma vez que a camada de apresentação devem fazer interface com a camada de lógica de negócios em vez de ignorar nele para ir diretamente para a camada de acesso a dados, precisamos criar um método BLL que invoca o método DAL que acabamos de criar (`InsertWithPicture`).</span><span class="sxs-lookup"><span data-stu-id="9a9d6-153">Since the Presentation Layer should only interface with the Business Logic Layer rather than bypassing it to go directly to the Data Access Layer, we need to create a BLL method that invokes the DAL method we just created (`InsertWithPicture`).</span></span> <span data-ttu-id="9a9d6-154">Para este tutorial, crie um método na `CategoriesBLL` classe denominada `InsertWithPicture` que aceita como entrada três `string` s e um `byte` matriz.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-154">For this tutorial, create a method in the `CategoriesBLL` class named `InsertWithPicture` that accepts as input three `string` s and a `byte` array.</span></span> <span data-ttu-id="9a9d6-155">O `string` parâmetros de entrada são para o nome da categoria s, descrição e caminho do arquivo de folheto, enquanto o `byte` matriz é para o conteúdo binário de imagem categoria s.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-155">The `string` input parameters are for the category s name, description, and brochure file path, while the `byte` array is for the binary contents of the category s picture.</span></span> <span data-ttu-id="9a9d6-156">Como mostra o código a seguir, esse método BLL invoca o método DAL correspondente:</span><span class="sxs-lookup"><span data-stu-id="9a9d6-156">As the following code shows, this BLL method invokes the corresponding DAL method:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample2.cs)]

> [!NOTE]
> <span data-ttu-id="9a9d6-157">Certifique-se de que você salvou o conjunto de dados tipado antes de adicionar o `InsertWithPicture` método para a BLL.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-157">Make sure that you have saved the Typed DataSet before adding the `InsertWithPicture` method to the BLL.</span></span> <span data-ttu-id="9a9d6-158">Uma vez que o `CategoriesTableAdapter` código da classe é gerado automaticamente com base em um DataSet tipado, se don t primeiro salvar suas alterações para o conjunto de dados tipado a `Adapter` propriedade ganhou um t saber sobre o `InsertWithPicture` método.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-158">Since the `CategoriesTableAdapter` class code is auto-generated based on the Typed DataSet, if you don t first save your changes to the Typed DataSet the `Adapter` property won t know about the `InsertWithPicture` method.</span></span>


## <a name="step-3-listing-the-existing-categories-and-their-binary-data"></a><span data-ttu-id="9a9d6-159">Etapa 3: Listando as categorias existentes e seus dados binários</span><span class="sxs-lookup"><span data-stu-id="9a9d6-159">Step 3: Listing the Existing Categories and their Binary Data</span></span>

<span data-ttu-id="9a9d6-160">Neste tutorial vamos criar uma página que permite que um usuário final adicionar uma nova categoria para o sistema, fornecendo uma imagem e folheto para a nova categoria.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-160">In this tutorial we will create a page that allows an end user to add a new category to the system, providing a picture and brochure for the new category.</span></span> <span data-ttu-id="9a9d6-161">No [tutorial anterior](displaying-binary-data-in-the-data-web-controls-cs.md) usamos um GridView com um TemplateField e ImageField para exibir cada nome de categoria s, descrição, imagem e um link para baixar seu folheto.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-161">In the [preceding tutorial](displaying-binary-data-in-the-data-web-controls-cs.md) we used a GridView with a TemplateField and ImageField to display each category s name, description, picture, and a link to download its brochure.</span></span> <span data-ttu-id="9a9d6-162">Deixe o s replicar essa funcionalidade para este tutorial, criando uma página que lista todas as categorias existentes e permite que novos processos a serem criados.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-162">Let s replicate that functionality for this tutorial, creating a page that both lists all existing categories and allows for new ones to be created.</span></span>

<span data-ttu-id="9a9d6-163">Comece abrindo o `DisplayOrDownload.aspx` página a partir de `BinaryData` pasta.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-163">Start by opening the `DisplayOrDownload.aspx` page from the `BinaryData` folder.</span></span> <span data-ttu-id="9a9d6-164">Vá para a exibição da fonte e copie a GridView e ObjectDataSource s sintaxe declarativa, colando-o dentro de `<asp:Content>` elemento no `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-164">Go to the Source view and copy the GridView and ObjectDataSource s declarative syntax, pasting it within the `<asp:Content>` element in `UploadInDetailsView.aspx`.</span></span> <span data-ttu-id="9a9d6-165">Além disso, não se esqueça de copiar ao longo de `GenerateBrochureLink` a classe code-behind do método `DisplayOrDownload.aspx` para `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-165">Also, don t forget to copy over the `GenerateBrochureLink` method from the code-behind class of `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx`.</span></span>


<span data-ttu-id="9a9d6-166">[![Copie e cole a sintaxe declarativa do DisplayOrDownload.aspx para UploadInDetailsView.aspx](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="9a9d6-166">[![Copy and Paste the Declarative Syntax from DisplayOrDownload.aspx to UploadInDetailsView.aspx](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.png)</span></span>

<span data-ttu-id="9a9d6-167">**Figura 3**: copie e cole a sintaxe declarativa do `DisplayOrDownload.aspx` à `UploadInDetailsView.aspx` ([clique para exibir a imagem em tamanho normal](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="9a9d6-167">**Figure 3**: Copy and Paste the Declarative Syntax from `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.png))</span></span>


<span data-ttu-id="9a9d6-168">Depois de copiar a sintaxe declarativa e `GenerateBrochureLink` método de failover para o `UploadInDetailsView.aspx` de página, exibir a página por meio de um navegador para garantir que tudo o que foi copiado corretamente sobre.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-168">After copying the declarative syntax and `GenerateBrochureLink` method over to the `UploadInDetailsView.aspx` page, view the page through a browser to ensure that everything was copied over correctly.</span></span> <span data-ttu-id="9a9d6-169">Você deve ver um GridView as oito categorias de listagem que inclui um link para baixar o folheto, bem como a imagem de categoria s.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-169">You should see a GridView listing the eight categories that includes a link to download the brochure as well as the category s picture.</span></span>


<span data-ttu-id="9a9d6-170">[![Agora você deve ver cada categoria, juntamente com seus dados binários](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="9a9d6-170">[![You Should Now See Each Category Along with Its Binary Data](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.png)</span></span>

<span data-ttu-id="9a9d6-171">**Figura 4**: você deve agora veja cada categoria juntamente com seus dados binários ([clique para exibir a imagem em tamanho normal](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="9a9d6-171">**Figure 4**: You Should Now See Each Category Along with Its Binary Data ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.png))</span></span>


## <a name="step-4-configuring-thecategoriesdatasourceto-support-inserting"></a><span data-ttu-id="9a9d6-172">Etapa 4: Configurando o`CategoriesDataSource`à inserção de suporte</span><span class="sxs-lookup"><span data-stu-id="9a9d6-172">Step 4: Configuring the`CategoriesDataSource`to Support Inserting</span></span>

<span data-ttu-id="9a9d6-173">O `CategoriesDataSource` ObjectDataSource usado pelo `Categories` GridView atualmente não fornece a capacidade de inserir dados.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-173">The `CategoriesDataSource` ObjectDataSource used by the `Categories` GridView currently does not provide the ability to insert data.</span></span> <span data-ttu-id="9a9d6-174">Para dar suporte à inserção desse controle de fonte de dados, precisamos mapear suas `Insert` método para um método em seu objeto subjacente, `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-174">In order to support inserting through this data source control, we need to map its `Insert` method to a method in its underlying object, `CategoriesBLL`.</span></span> <span data-ttu-id="9a9d6-175">Em particular, queremos mapeá-lo para o `CategoriesBLL` método que adicionamos novamente na etapa 2, `InsertWithPicture`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-175">In particular, we want to map it to the `CategoriesBLL` method we added back in Step 2, `InsertWithPicture`.</span></span>

<span data-ttu-id="9a9d6-176">Inicie clicando no link configurar fonte de dados a partir da marca inteligente do ObjectDataSource s.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-176">Start by clicking the Configure Data Source link from the ObjectDataSource s smart tag.</span></span> <span data-ttu-id="9a9d6-177">A primeira tela mostra o objeto de fonte de dados está configurada para funcionar com, `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-177">The first screen shows the object the data source is configured to work with, `CategoriesBLL`.</span></span> <span data-ttu-id="9a9d6-178">Deixe essa configuração como-está e clique em Next para ir para a tela Definir métodos de dados.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-178">Leave this setting as-is and click Next to advance to the Define Data Methods screen.</span></span> <span data-ttu-id="9a9d6-179">Mover para a guia Inserir e escolha o `InsertWithPicture` método na lista suspensa.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-179">Move to the INSERT tab and pick the `InsertWithPicture` method from the drop-down list.</span></span> <span data-ttu-id="9a9d6-180">Clique em Concluir para concluir o assistente.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-180">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="9a9d6-181">[![Configurar o ObjectDataSource para usar o método InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="9a9d6-181">[![Configure the ObjectDataSource to use the InsertWithPicture Method](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.png)</span></span>

<span data-ttu-id="9a9d6-182">**Figura 5**: configurar o ObjectDataSource para usar o `InsertWithPicture` método ([clique para exibir a imagem em tamanho normal](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="9a9d6-182">**Figure 5**: Configure the ObjectDataSource to use the `InsertWithPicture` Method ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.png))</span></span>


> [!NOTE]
> <span data-ttu-id="9a9d6-183">Após a conclusão do assistente, o Visual Studio poderá solicitar se você quiser atualizar campos e as chaves, que irá gerar novamente os dados da Web controla os campos.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-183">Upon completing the wizard, Visual Studio may ask if you want to Refresh Fields and Keys, which will regenerate the data Web controls fields.</span></span> <span data-ttu-id="9a9d6-184">Selecione não, porque se você escolher Sim, substituirá todas as personalizações de campo que tenha feito.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-184">Choose No, because choosing Yes will overwrite any field customizations you may have made.</span></span>


<span data-ttu-id="9a9d6-185">Depois de concluir o assistente, o ObjectDataSource agora incluem um valor para seus `InsertMethod` propriedade, bem como `InsertParameters` para as colunas de quatro categorias, como a seguinte marcação declarativa ilustra:</span><span class="sxs-lookup"><span data-stu-id="9a9d6-185">After completing the wizard, the ObjectDataSource will now include a value for its `InsertMethod` property as well as `InsertParameters` for the four category columns, as the following declarative markup illustrates:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample3.aspx)]

## <a name="step-5-creating-the-inserting-interface"></a><span data-ttu-id="9a9d6-186">Etapa 5: Criar a Interface de inserção</span><span class="sxs-lookup"><span data-stu-id="9a9d6-186">Step 5: Creating the Inserting Interface</span></span>

<span data-ttu-id="9a9d6-187">Como inicialmente abordados os [uma visão geral de inserção de, atualizando e excluindo dados](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md), o controle DetailsView fornece uma interface de inserção internos que pode ser utilizada ao trabalhar com um controle de fonte de dados que dá suporte à inserção.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-187">As first covered in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md), the DetailsView control provides a built-in inserting interface that can be utilized when working with a data source control that supports inserting.</span></span> <span data-ttu-id="9a9d6-188">Permitir que o s adicione um controle DetailsView a esta página acima GridView que processará permanentemente sua interface de inserção, que permite ao usuário adicionar rapidamente uma nova categoria.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-188">Let s add a DetailsView control to this page above the GridView that will permanently render its inserting interface, allowing a user to quickly add a new category.</span></span> <span data-ttu-id="9a9d6-189">Após a adição de uma nova categoria em DetailsView, GridView abaixo dele será automaticamente atualizar e exibir a nova categoria.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-189">Upon adding a new category in the DetailsView, the GridView beneath it will automatically refresh and display the new category.</span></span>

<span data-ttu-id="9a9d6-190">Início arrastando um DetailsView da caixa de ferramentas para o Designer acima GridView, definindo sua `ID` propriedade para `NewCategory` e apagando o `Height` e `Width` valores de propriedade.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-190">Start by dragging a DetailsView from the Toolbox onto the Designer above the GridView, setting its `ID` property to `NewCategory` and clearing out the `Height` and `Width` property values.</span></span> <span data-ttu-id="9a9d6-191">Da DetailsView s marca inteligente, associá-lo ao existente `CategoriesDataSource` e, em seguida, marque a caixa de seleção Permitir inserção.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-191">From the DetailsView s smart tag, bind it to the existing `CategoriesDataSource` and then check the Enable Inserting checkbox.</span></span>


<span data-ttu-id="9a9d6-192">[![Associar o CategoriesDataSource DetailsView e ativar inserir](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="9a9d6-192">[![Bind the DetailsView to the CategoriesDataSource and Enable Inserting](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.png)</span></span>

<span data-ttu-id="9a9d6-193">**Figura 6**: associar DetailsView para o `CategoriesDataSource` e permitir inserção ([clique para exibir a imagem em tamanho normal](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="9a9d6-193">**Figure 6**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image12.png))</span></span>


<span data-ttu-id="9a9d6-194">Para processar permanentemente DetailsView na sua interface de inserção, defina suas `DefaultMode` propriedade para `Insert`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-194">To permanently render the DetailsView in its inserting interface, set its `DefaultMode` property to `Insert`.</span></span>

<span data-ttu-id="9a9d6-195">Observe que o DetailsView tem cinco BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, e `BrochurePath` Embora o `CategoryID` BoundField não é renderizado na interface de inserção porque seu `InsertVisible` propriedade é definida como `false`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-195">Note that the DetailsView has five BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` although the `CategoryID` BoundField is not rendered in the inserting interface because its `InsertVisible` property is set to `false`.</span></span> <span data-ttu-id="9a9d6-196">Esses BoundFields existe porque eles são as colunas retornadas pelo `GetCategories()` método, que é o que o ObjectDataSource invoca para recuperar seus dados.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-196">These BoundFields exists because they are the columns returned by the `GetCategories()` method, which is what the ObjectDataSource invokes to retrieve its data.</span></span> <span data-ttu-id="9a9d6-197">Para inserir, no entanto, podemos don t deseja permitir que o usuário especifique um valor para `NumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-197">For inserting, however, we don t want to let the user specify a value for `NumberOfProducts`.</span></span> <span data-ttu-id="9a9d6-198">Além disso, é necessário permitir que ele carregue uma imagem para a nova categoria, bem como carregar um PDF para o folheto do.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-198">Moreover, we need to allow them to upload a picture for the new category as well as upload a PDF for the brochure.</span></span>

<span data-ttu-id="9a9d6-199">Remover o `NumberOfProducts` BoundField do DetailsView totalmente e atualize o `HeaderText` propriedades da `CategoryName` e `BrochurePath` BoundFields à categoria e folheto, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-199">Remove the `NumberOfProducts` BoundField from the DetailsView altogether and then update the `HeaderText` properties of the `CategoryName` and `BrochurePath` BoundFields to Category and Brochure, respectively.</span></span> <span data-ttu-id="9a9d6-200">Em seguida, converter o `BrochurePath` BoundField em um TemplateField e adicionar um novo TemplateField para a imagem, dando a esse novo TemplateField um `HeaderText` valor da imagem.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-200">Next, convert the `BrochurePath` BoundField into a TemplateField and add a new TemplateField for the picture, giving this new TemplateField a `HeaderText` value of Picture.</span></span> <span data-ttu-id="9a9d6-201">Mover o `Picture` TemplateField para que ele fique entre a `BrochurePath` TemplateField e CommandField.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-201">Move the `Picture` TemplateField so that it is between the `BrochurePath` TemplateField and CommandField.</span></span>


![Associar o CategoriesDataSource DetailsView e ativar inserir](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.gif)

<span data-ttu-id="9a9d6-203">**Figura 7**: associar DetailsView para o `CategoriesDataSource` e ativar inserir</span><span class="sxs-lookup"><span data-stu-id="9a9d6-203">**Figure 7**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting</span></span>


<span data-ttu-id="9a9d6-204">Se você tiver convertido a `BrochurePath` o TemplateField de BoundField em um TemplateField por meio da caixa de diálogo Editar campos, inclui um `ItemTemplate`, `EditItemTemplate`, e `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-204">If you converted the `BrochurePath` BoundField into a TemplateField through the Edit Fields dialog box, the TemplateField includes an `ItemTemplate`, `EditItemTemplate`, and `InsertItemTemplate`.</span></span> <span data-ttu-id="9a9d6-205">Somente o `InsertItemTemplate` é necessário, no entanto, fique à vontade remover os dois outros modelos.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-205">Only the `InsertItemTemplate` is needed, however, so feel free to remove the other two templates.</span></span> <span data-ttu-id="9a9d6-206">Neste ponto, sua sintaxe declarativa do DetailsView s deve ser semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="9a9d6-206">At this point your DetailsView s declarative syntax should look like the following:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample4.aspx)]

## <a name="adding-fileupload-controls-for-the-brochure-and-picture-fields"></a><span data-ttu-id="9a9d6-207">Adicionando controles de FileUpload para o folheto e campos de imagem</span><span class="sxs-lookup"><span data-stu-id="9a9d6-207">Adding FileUpload Controls for the Brochure and Picture Fields</span></span>

<span data-ttu-id="9a9d6-208">No momento, o `BrochurePath` s TemplateField `InsertItemTemplate` contém uma caixa de texto, enquanto o `Picture` TemplateField não contém todos os modelos.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-208">Presently, the `BrochurePath` TemplateField s `InsertItemTemplate` contains a TextBox, while the `Picture` TemplateField does not contain any templates.</span></span> <span data-ttu-id="9a9d6-209">É necessário atualizar essas duas s TemplateField `InsertItemTemplate` s para usar controles FileUpload.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-209">We need to update these two TemplateField s `InsertItemTemplate` s to use FileUpload controls.</span></span>

<span data-ttu-id="9a9d6-210">Da DetailsView s marca inteligente, escolha a opção de editar modelos e, em seguida, selecione a `BrochurePath` TemplateField s `InsertItemTemplate` na lista suspensa.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-210">From the DetailsView s smart tag, choose the Edit Templates option and then select the `BrochurePath` TemplateField s `InsertItemTemplate` from the drop-down list.</span></span> <span data-ttu-id="9a9d6-211">Remover a caixa de texto e, em seguida, arraste um controle FileUpload da caixa de ferramentas para o modelo.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-211">Remove the TextBox and then drag a FileUpload control from the Toolbox into the template.</span></span> <span data-ttu-id="9a9d6-212">Defina o controle FileUpload s `ID` para `BrochureUpload`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-212">Set the FileUpload control s `ID` to `BrochureUpload`.</span></span> <span data-ttu-id="9a9d6-213">Da mesma forma, adicione um controle FileUpload para o `Picture` TemplateField s `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-213">Similarly, add a FileUpload control to the `Picture` TemplateField s `InsertItemTemplate`.</span></span> <span data-ttu-id="9a9d6-214">Definir esse controle FileUpload s `ID` para `PictureUpload`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-214">Set this FileUpload control s `ID` to `PictureUpload`.</span></span>


<span data-ttu-id="9a9d6-215">[![Adicionar um controle FileUpload para o InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="9a9d6-215">[![Add a FileUpload Control to the InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image13.png)</span></span>

<span data-ttu-id="9a9d6-216">**Figura 8**: adicionar um controle FileUpload para o `InsertItemTemplate` ([clique para exibir a imagem em tamanho normal](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="9a9d6-216">**Figure 8**: Add a FileUpload Control to the `InsertItemTemplate` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image14.png))</span></span>


<span data-ttu-id="9a9d6-217">Depois de fazer essas adições, a sintaxe declarativa do dois TemplateField s será:</span><span class="sxs-lookup"><span data-stu-id="9a9d6-217">After making these additions, the two TemplateField s declarative syntax will be:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample5.aspx)]

<span data-ttu-id="9a9d6-218">Quando um usuário adiciona uma nova categoria, queremos garantir que o folheto e a imagem são do tipo de arquivo correto.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-218">When a user adds a new category, we want to ensure that the brochure and picture are of the correct file type.</span></span> <span data-ttu-id="9a9d6-219">Para criar o folheto, o usuário deve fornecer um PDF.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-219">For the brochure, the user must supply a PDF.</span></span> <span data-ttu-id="9a9d6-220">Para a imagem, é necessário que o usuário carregue um arquivo de imagem, mas podemos permitir *qualquer* apenas os arquivos de imagem de um tipo específico, como GIFs ou JPGs ou de arquivo de imagem?</span><span class="sxs-lookup"><span data-stu-id="9a9d6-220">For the picture, we need the user to upload an image file, but do we allow *any* image file or only image files of a particular type, such as GIFs or JPGs?</span></span> <span data-ttu-id="9a9d6-221">Para permitir diferentes tipos de arquivo, d precisamos estender a `Categories` esquema para incluir uma coluna que captura o tipo de arquivo para que esse tipo pode ser enviado ao cliente por meio `Response.ContentType` em `DisplayCategoryPicture.aspx`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-221">In order to allow for different file types, we d need to extend the `Categories` schema to include a column that captures the file type so that this type can be sent to the client through `Response.ContentType` in `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="9a9d6-222">Já que estamos não t tem uma coluna desse tipo, seria prudente restringir os usuários para fornecer apenas um tipo de arquivo de imagem específico.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-222">Since we don t have such a column, it would be prudent to restrict users to only providing a specific image file type.</span></span> <span data-ttu-id="9a9d6-223">O `Categories` imagens existentes da tabela s são bitmaps, mas JPGs estão um formato de arquivo mais adequado para imagens atendidas pela web.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-223">The `Categories` table s existing images are bitmaps, but JPGs are a more appropriate file format for images served over the web.</span></span>

<span data-ttu-id="9a9d6-224">Se um usuário carrega um tipo de arquivo incorreto, é necessário cancelar a inserção e exibir uma mensagem indicando que o problema.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-224">If a user uploads an incorrect file type, we need to cancel the insert and display a message indicating the problem.</span></span> <span data-ttu-id="9a9d6-225">Adicione um controle de Web de rótulo abaixo DetailsView.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-225">Add a Label Web control beneath the DetailsView.</span></span> <span data-ttu-id="9a9d6-226">Definir seus `ID` propriedade para `UploadWarning`, desmarque out seu `Text` propriedade, defina o `CssClass` propriedade para aviso e o `Visible` e `EnableViewState` propriedades para `false`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-226">Set its `ID` property to `UploadWarning`, clear out its `Text` property, set the `CssClass` property to Warning, and the `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="9a9d6-227">O `Warning` classe CSS é definida em `Styles.css` e renderiza o texto em uma fonte grande, vermelho, em itálico e negrito.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-227">The `Warning` CSS class is defined in `Styles.css` and renders the text in a large, red, italicized, bold font.</span></span>

> [!NOTE]
> <span data-ttu-id="9a9d6-228">O ideal é que o `CategoryName` e `Description` BoundFields seria convertida em TemplateFields e suas interfaces de inserção personalizadas.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-228">Ideally, the `CategoryName` and `Description` BoundFields would be converted to TemplateFields and their inserting interfaces customized.</span></span> <span data-ttu-id="9a9d6-229">O `Description` inserir interface, por exemplo, seria provavelmente mais adequado por meio de uma caixa de texto de várias linha.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-229">The `Description` inserting interface, for example, would likely be better suited through a multi-line textbox.</span></span> <span data-ttu-id="9a9d6-230">E, como o `CategoryName` coluna não aceita `NULL` valores, um RequiredFieldValidator deve ser adicionado para garantir que o usuário fornece um valor para o novo nome da categoria s.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-230">And since the `CategoryName` column does not accept `NULL` values, a RequiredFieldValidator should be added to ensure the user provides a value for the new category s name.</span></span> <span data-ttu-id="9a9d6-231">Essas etapas são deixadas como um exercício para o leitor.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-231">These steps are left as an exercise to the reader.</span></span> <span data-ttu-id="9a9d6-232">Consultar novamente [Personalizando a Interface de modificação de dados](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) para um olhar detalhado sobre aumentando as interfaces de modificação de dados.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-232">Refer back to [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) for an in-depth look at augmenting the data modification interfaces.</span></span>


## <a name="step-6-saving-the-uploaded-brochure-to-the-web-server-s-file-system"></a><span data-ttu-id="9a9d6-233">Etapa 6: Salvar o folheto carregado para o sistema de arquivos do Web Server s</span><span class="sxs-lookup"><span data-stu-id="9a9d6-233">Step 6: Saving the Uploaded Brochure to the Web Server s File System</span></span>

<span data-ttu-id="9a9d6-234">Quando o usuário insere os valores para uma nova categoria e clica no botão de inserção, ocorre um postback e o fluxo de trabalho de inserção é revelado.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-234">When the user enters the values for a new category and clicks the Insert button, a postback occurs and the inserting workflow unfolds.</span></span> <span data-ttu-id="9a9d6-235">Primeiro, o s DetailsView [ `ItemInserting` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) é acionado.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-235">First, the DetailsView s [`ItemInserting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) fires.</span></span> <span data-ttu-id="9a9d6-236">Em seguida, o s ObjectDataSource `Insert()` método é invocado, o que resulta em um novo registro que está sendo adicionado para o `Categories` tabela.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-236">Next, the ObjectDataSource s `Insert()` method is invoked, which results in a new record being added to the `Categories` table.</span></span> <span data-ttu-id="9a9d6-237">Depois disso, o s DetailsView [ `ItemInserted` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) é acionado.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-237">After that, the DetailsView s [`ItemInserted` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) fires.</span></span>

<span data-ttu-id="9a9d6-238">Antes do s ObjectDataSource `Insert()` método é invocado, devemos primeiro certifique-se de que os tipos de arquivos apropriados foram carregados pelo usuário e, em seguida, salvar o folheto do PDF para o sistema de arquivos do servidor s da web.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-238">Before the ObjectDataSource s `Insert()` method is invoked, we must first ensure that the appropriate file types were uploaded by the user and then save the brochure PDF to the web server s file system.</span></span> <span data-ttu-id="9a9d6-239">Criar um manipulador de eventos para o s DetailsView `ItemInserting` eventos e adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="9a9d6-239">Create an event handler for the DetailsView s `ItemInserting` event and add the following code:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample6.cs)]

<span data-ttu-id="9a9d6-240">O manipulador de eventos começa fazendo referência a `BrochureUpload` controle FileUpload dos modelos de s DetailsView.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-240">The event handler starts by referencing the `BrochureUpload` FileUpload control from the DetailsView s templates.</span></span> <span data-ttu-id="9a9d6-241">Em seguida, se um folheto tiver sido carregado, a extensão do arquivo carregado s é examinada.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-241">Then, if a brochure has been uploaded, the uploaded file s extension is examined.</span></span> <span data-ttu-id="9a9d6-242">Se a extensão não é. PDF, em seguida, um aviso é exibido, a inserção é cancelada e termina a execução do manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-242">If the extension is not .PDF, then a warning is displayed, the insert is cancelled, and the execution of the event handler ends.</span></span>

> [!NOTE]
> <span data-ttu-id="9a9d6-243">Contar com a extensão de s do arquivo carregado não é uma técnica segura para garantir que o arquivo carregado é um documento em PDF.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-243">Relying on the uploaded file s extension is not a sure-fire technique for ensuring that the uploaded file is a PDF document.</span></span> <span data-ttu-id="9a9d6-244">O usuário pode ter um documento válido de PDF com a extensão `.Brochure`, ou poderia ter levado um documento não PDF e deu a ela um `.pdf` extensão.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-244">The user could have a valid PDF document with the extension `.Brochure`, or could have taken a non-PDF document and given it a `.pdf` extension.</span></span> <span data-ttu-id="9a9d6-245">O conteúdo binário do arquivo s precisariam ser examinado por meio de programação para a mais conclusivamente Verifique se o tipo de arquivo.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-245">The file s binary content would need to be programmatically examined in order to more conclusively verify the file type.</span></span> <span data-ttu-id="9a9d6-246">Essas abordagens completas, no entanto, geralmente são um exagero; Verificando a extensão é suficiente para a maioria dos cenários.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-246">Such thorough approaches, though, are often overkill; checking the extension is sufficient for most scenarios.</span></span>


<span data-ttu-id="9a9d6-247">Conforme discutido na [carregar arquivos](uploading-files-cs.md) tutorial, é necessário ter cuidado ao salvamento de arquivos para o sistema de arquivos para esse carregamento de um usuário s não substitua s outro.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-247">As discussed in the [Uploading Files](uploading-files-cs.md) tutorial, care must be taken when saving files to the file system so that one user s upload does not overwrite another s.</span></span> <span data-ttu-id="9a9d6-248">Para este tutorial, estamos tentará usar o mesmo nome como o arquivo carregado.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-248">For this tutorial we will attempt to use the same name as the uploaded file.</span></span> <span data-ttu-id="9a9d6-249">Se já existe um arquivo no `~/Brochures` diretório com esse mesmo nome de arquivo, no entanto, podemos irá acrescentar um número ao final até encontra um nome exclusivo.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-249">If there already exists a file in the `~/Brochures` directory with that same file name, however, we'll append a number at the end until a unique name is found.</span></span> <span data-ttu-id="9a9d6-250">Por exemplo, se o usuário carrega um arquivo de folheto denominado `Meats.pdf`, mas já existe um arquivo chamado `Meats.pdf` na `~/Brochures` pasta, vamos alterar o nome do arquivo salvo para `Meats-1.pdf`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-250">For example, if the user uploads a brochure file named `Meats.pdf`, but there is already a file named `Meats.pdf` in the `~/Brochures` folder, we'll change the saved file name to `Meats-1.pdf`.</span></span> <span data-ttu-id="9a9d6-251">Se o que existe, tentaremos `Meats-2.pdf`e assim por diante, até encontra um nome de arquivo exclusivo.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-251">If that exists, we'll try `Meats-2.pdf`, and so on, until a unique file name is found.</span></span>

<span data-ttu-id="9a9d6-252">O código a seguir usa o [ `File.Exists(path)` método](https://msdn.microsoft.com/library/system.io.file.exists.aspx) para determinar se um arquivo já existe com o nome de arquivo especificado.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-252">The following code uses the [`File.Exists(path)` method](https://msdn.microsoft.com/library/system.io.file.exists.aspx) to determine if a file already exists with the specified file name.</span></span> <span data-ttu-id="9a9d6-253">Nesse caso, ele continua experimentar os novos nomes de arquivo para o folheto até que nenhum conflito seja encontrado.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-253">If so, it continues to try new file names for the brochure until no conflict is found.</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample7.cs)]

<span data-ttu-id="9a9d6-254">Depois que um nome de arquivo válido foi encontrado, o arquivo precisa ser salvo no sistema de arquivos e os s ObjectDataSource `brochurePath``InsertParameter` valor precisa ser atualizado para que esse nome de arquivo é gravado no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-254">Once a valid file name has been found, the file needs to be saved to the file system and the ObjectDataSource s `brochurePath``InsertParameter` value needs to be updated so that this file name is written to the database.</span></span> <span data-ttu-id="9a9d6-255">Como vimos na *carregar arquivos* tutorial, o arquivo pode ser salvo usando o controle FileUpload s `SaveAs(path)` método.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-255">As we saw back in the *Uploading Files* tutorial, the file can be saved using the FileUpload control s `SaveAs(path)` method.</span></span> <span data-ttu-id="9a9d6-256">Para atualizar o s ObjectDataSource `brochurePath` parâmetro, use o `e.Values` coleção.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-256">To update the ObjectDataSource s `brochurePath` parameter, use the `e.Values` collection.</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample8.cs)]

## <a name="step-7-saving-the-uploaded-picture-to-the-database"></a><span data-ttu-id="9a9d6-257">Etapa 7: Salvar a imagem carregada no banco de dados</span><span class="sxs-lookup"><span data-stu-id="9a9d6-257">Step 7: Saving the Uploaded Picture to the Database</span></span>

<span data-ttu-id="9a9d6-258">Para armazenar a imagem carregada no novo `Categories` registro, precisamos atribuir o conteúdo binário carregado para o s ObjectDataSource `picture` parâmetro em s DetailsView `ItemInserting` eventos.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-258">To store the uploaded picture in the new `Categories` record, we need to assign the uploaded binary content to the ObjectDataSource s `picture` parameter in the DetailsView s `ItemInserting` event.</span></span> <span data-ttu-id="9a9d6-259">Antes de fazermos essa atribuição, no entanto, precisamos primeiro certifique-se de que a imagem carregada é um JPG e não outro tipo de imagem.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-259">Before we make this assignment, however, we need to first make sure that the uploaded picture is a JPG and not some other image type.</span></span> <span data-ttu-id="9a9d6-260">Como na etapa 6, deixe s para usar a extensão de arquivo imagem carregada s para determinar seu tipo.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-260">As in Step 6, let s use the uploaded picture s file extension to ascertain its type.</span></span>

<span data-ttu-id="9a9d6-261">Enquanto o `Categories` table permite `NULL` os valores para o `Picture` coluna, todas as categorias atualmente tiver uma imagem.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-261">While the `Categories` table allows `NULL` values for the `Picture` column, all categories currently have a picture.</span></span> <span data-ttu-id="9a9d6-262">Deixe o s forçar o usuário a fornecer uma imagem ao adicionar uma nova categoria por meio desta página.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-262">Let s force the user to provide a picture when adding a new category through this page.</span></span> <span data-ttu-id="9a9d6-263">O código a seguir verifica para garantir que uma imagem foi carregada e se ele tem uma extensão apropriada.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-263">The following code checks to ensure that a picture has been uploaded and that it has an appropriate extension.</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample9.cs)]

<span data-ttu-id="9a9d6-264">Esse código deve ser colocado *antes de* o código da etapa 6 para que se houver um problema com o carregamento de imagem, o manipulador de eventos será encerrado antes que o arquivo de folheto é salvo no sistema de arquivos.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-264">This code should be placed *before* the code from Step 6 so that if there is a problem with the picture upload, the event handler will terminate before the brochure file is saved to the file system.</span></span>

<span data-ttu-id="9a9d6-265">Supondo que um arquivo apropriado tiver sido carregado, atribua o conteúdo binário carregado para o valor de parâmetro da imagem s com a seguinte linha de código:</span><span class="sxs-lookup"><span data-stu-id="9a9d6-265">Assuming that an appropriate file has been uploaded, assign the uploaded binary content to the picture parameter s value with the following line of code:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample10.cs)]

## <a name="the-completeiteminsertingevent-handler"></a><span data-ttu-id="9a9d6-266">Completo`ItemInserting`manipulador de eventos</span><span class="sxs-lookup"><span data-stu-id="9a9d6-266">The Complete`ItemInserting`Event Handler</span></span>

<span data-ttu-id="9a9d6-267">Para fins de integridade, aqui está o `ItemInserting` manipulador de eventos em sua totalidade:</span><span class="sxs-lookup"><span data-stu-id="9a9d6-267">For completeness, here is the `ItemInserting` event handler in its entirety:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample11.cs)]

## <a name="step-8-fixing-thedisplaycategorypictureaspxpage"></a><span data-ttu-id="9a9d6-268">Etapa 8: Corrigindo o`DisplayCategoryPicture.aspx`página</span><span class="sxs-lookup"><span data-stu-id="9a9d6-268">Step 8: Fixing the`DisplayCategoryPicture.aspx`Page</span></span>

<span data-ttu-id="9a9d6-269">Let s dedique uns momentos para testar a interface de inserção e `ItemInserting` manipulador de eventos que foi criado durante os últimos algumas etapas.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-269">Let s take a moment to test out the inserting interface and `ItemInserting` event handler that was created over the last few steps.</span></span> <span data-ttu-id="9a9d6-270">Visite o `UploadInDetailsView.aspx` página por meio de um navegador e tentar adicionar uma categoria, mas omita a imagem, ou especificar uma imagem não JPG ou um folheto não PDF.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-270">Visit the `UploadInDetailsView.aspx` page through a browser and attempt to add a category, but omit the picture, or specify a non-JPG picture or a non-PDF brochure.</span></span> <span data-ttu-id="9a9d6-271">Em qualquer um desses casos, será exibida uma mensagem de erro e o fluxo de trabalho de inserção cancelada.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-271">In any of these cases, an error message will be displayed and the insert workflow cancelled.</span></span>


<span data-ttu-id="9a9d6-272">[![Uma mensagem de aviso será exibido se um tipo de arquivo inválido é carregado](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="9a9d6-272">[![A Warning Message is Displayed If an Invalid File Type is Uploaded](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image15.png)</span></span>

<span data-ttu-id="9a9d6-273">**Figura 9**: uma mensagem de aviso é exibido se um tipo de arquivo inválido é carregado ([clique para exibir a imagem em tamanho normal](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="9a9d6-273">**Figure 9**: A Warning Message is Displayed If an Invalid File Type is Uploaded ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image16.png))</span></span>


<span data-ttu-id="9a9d6-274">Uma vez você verificou que a página requer uma imagem a ser carregado e t ganha aceitar arquivos não-PDF ou não JPG, adicionar uma nova categoria com imagem válida JPG, deixando o campo de folheto vazio.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-274">Once you have verified that the page requires a picture to be uploaded and won t accept non-PDF or non-JPG files, add a new category with a valid JPG picture, leaving the Brochure field empty.</span></span> <span data-ttu-id="9a9d6-275">Depois de clicar no botão de inserção, a página fará o postback e será adicionado um novo registro para o `Categories` tabela com o conteúdo binário de imagem carregada s armazenados diretamente no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-275">After clicking the Insert button, the page will postback and a new record will be added to the `Categories` table with the uploaded image s binary contents stored directly in the database.</span></span> <span data-ttu-id="9a9d6-276">O GridView é atualizado e mostra uma linha para a categoria recém adicionada, mas, como mostra a Figura 10, a nova imagem s categoria não é renderizada corretamente.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-276">The GridView is updated and shows a row for the newly added category, but, as Figure 10 shows, the new category s picture is not rendered correctly.</span></span>


<span data-ttu-id="9a9d6-277">[![A nova categoria s que imagem não é exibida.](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="9a9d6-277">[![The New Category s Picture is not Displayed](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image17.png)</span></span>

<span data-ttu-id="9a9d6-278">**Figura 10**: s nova categoria a imagem não é exibida ([clique para exibir a imagem em tamanho normal](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="9a9d6-278">**Figure 10**: The New Category s Picture is not Displayed ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image18.png))</span></span>


<span data-ttu-id="9a9d6-279">O motivo pelo qual a nova imagem não é exibida é porque o `DisplayCategoryPicture.aspx` página que retorna uma imagem de categoria especificada s está configurada para processar bitmaps que possuem um cabeçalho OLE.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-279">The reason the new picture is not displayed is because the `DisplayCategoryPicture.aspx` page that returns a specified category s picture is configured to process bitmaps that have an OLE header.</span></span> <span data-ttu-id="9a9d6-280">Esse cabeçalho de 78 bytes é tirado do `Picture` conteúdo binário de coluna s antes de serem enviadas de volta para o cliente.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-280">This 78 byte header is stripped from the `Picture` column s binary contents before they are sent back to the client.</span></span> <span data-ttu-id="9a9d6-281">Mas o arquivo JPG que acabou de carregar para a nova categoria não tem esse cabeçalho OLE; Portanto, bytes válidos, necessárias estão sendo removidos dos dados binários de s de imagem.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-281">But the JPG file we just uploaded for the new category does not have this OLE header; therefore, valid, necessary bytes are being removed from the image s binary data.</span></span>

<span data-ttu-id="9a9d6-282">Já que agora são ambos os bitmaps com cabeçalhos OLE e JPGs na `Categories` tabela, precisamos atualizar `DisplayCategoryPicture.aspx` para que ele não o cabeçalho OLE colocação para oito categorias originais e ignora essa colocação para os registros mais recentes de categoria.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-282">Since there are now both bitmaps with OLE headers and JPGs in the `Categories` table, we need to update `DisplayCategoryPicture.aspx` so that it does the OLE header stripping for the original eight categories and bypasses this stripping for the newer category records.</span></span> <span data-ttu-id="9a9d6-283">Em nosso próximo tutorial, examinaremos como atualizar uma imagem existente do registro s e atualizaremos todas as imagens de categoria antigo para que eles sejam JPGs.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-283">In our next tutorial we'll examine how to update an existing record s image, and we'll update all of the old category pictures so that they are JPGs.</span></span> <span data-ttu-id="9a9d6-284">Por enquanto, porém, use o seguinte código no `DisplayCategoryPicture.aspx` para retirar os cabeçalhos OLE apenas para essas categorias de oito originais:</span><span class="sxs-lookup"><span data-stu-id="9a9d6-284">For now, though, use the following code in `DisplayCategoryPicture.aspx` to strip the OLE headers only for those original eight categories:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample12.cs)]

<span data-ttu-id="9a9d6-285">Com essa alteração, a imagem JPG agora é renderizada corretamente em GridView.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-285">With this change, the JPG image is now rendered correctly in the GridView.</span></span>


<span data-ttu-id="9a9d6-286">[![As imagens JPG para novas categorias são renderizados corretamente](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="9a9d6-286">[![The JPG Images for New Categories are Correctly Rendered](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image19.png)</span></span>

<span data-ttu-id="9a9d6-287">**Figura 11**: as imagens JPG para novas categorias são renderizados corretamente ([clique para exibir a imagem em tamanho normal](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="9a9d6-287">**Figure 11**: The JPG Images for New Categories are Correctly Rendered ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image20.png))</span></span>


## <a name="step-9-deleting-the-brochure-in-the-face-of-an-exception"></a><span data-ttu-id="9a9d6-288">Etapa 9: Excluir o folheto diante de uma exceção</span><span class="sxs-lookup"><span data-stu-id="9a9d6-288">Step 9: Deleting the Brochure in the Face of an Exception</span></span>

<span data-ttu-id="9a9d6-289">Um dos desafios de armazenar dados binários no sistema de arquivo do web server s é que ela introduz uma desconexão entre o modelo de dados e seus dados binários.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-289">One of the challenges of storing binary data on the web server s file system is that it introduces a disconnect between the data model and its binary data.</span></span> <span data-ttu-id="9a9d6-290">Portanto, sempre que um registro é excluído, os dados binários correspondentes no sistema de arquivos devem também ser removidos.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-290">Therefore, whenever a record is deleted, the corresponding binary data on the file system must also be removed.</span></span> <span data-ttu-id="9a9d6-291">Isso pode surgir quando são inseridos, também.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-291">This can come into play when inserting, as well.</span></span> <span data-ttu-id="9a9d6-292">Considere o seguinte cenário: um usuário adiciona uma nova categoria, especificando um folheto e uma imagem válida.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-292">Consider the following scenario: a user adds a new category, specifying a valid picture and brochure.</span></span> <span data-ttu-id="9a9d6-293">Após clicar no botão de inserção, ocorre um postback e o s DetailsView `ItemInserting` evento é acionado, salvando o folheto do sistema de arquivos do servidor s da web.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-293">Upon clicking the Insert button, a postback occurs and the DetailsView s `ItemInserting` event fires, saving the brochure to the web server s file system.</span></span> <span data-ttu-id="9a9d6-294">Em seguida, o s ObjectDataSource `Insert()` método é invocado, que chama o `CategoriesBLL` classe s `InsertWithPicture` método, que chama o `CategoriesTableAdapter` s `InsertWithPicture` método.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-294">Next, the ObjectDataSource s `Insert()` method is invoked, which calls the `CategoriesBLL` class s `InsertWithPicture` method, which calls the `CategoriesTableAdapter` s `InsertWithPicture` method.</span></span>

<span data-ttu-id="9a9d6-295">Agora, o que acontece se o banco de dados estiver offline ou se houver um erro no `INSERT` instrução SQL?</span><span class="sxs-lookup"><span data-stu-id="9a9d6-295">Now, what happens if the database is offline, or if there is an error in the `INSERT` SQL statement?</span></span> <span data-ttu-id="9a9d6-296">Claramente o INSERT falhará, portanto, nenhuma nova linha de categoria será adicionada ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-296">Clearly the INSERT will fail, so no new category row will be added to the database.</span></span> <span data-ttu-id="9a9d6-297">Mas, ainda temos no arquivo do folheto carregados no sistema de arquivo do web server s!</span><span class="sxs-lookup"><span data-stu-id="9a9d6-297">But we still have the uploaded brochure file sitting on the web server s file system!</span></span> <span data-ttu-id="9a9d6-298">Esse arquivo precisa ser excluído diante de uma exceção durante a inserção de fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-298">This file needs to be deleted in the face of an exception during the inserting workflow.</span></span>

<span data-ttu-id="9a9d6-299">Como discutido anteriormente a [tratamento BLL - e exceções de nível DAL em uma página ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, quando uma exceção é lançada de dentro a fundo a arquitetura é aparecido por meio de várias camadas.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-299">As discussed previously in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, when an exception is thrown from within the depths of the architecture it is bubbled up through the various layers.</span></span> <span data-ttu-id="9a9d6-300">Na camada de apresentação, podemos determinar se ocorreu uma exceção de s DetailsView `ItemInserted` eventos.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-300">At the Presentation Layer, we can determine if an exception has occurred from the DetailsView s `ItemInserted` event.</span></span> <span data-ttu-id="9a9d6-301">Esse manipulador de eventos também fornece os valores de s o ObjectDataSource `InsertParameters`.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-301">This event handler also provides the values of the ObjectDataSource s `InsertParameters`.</span></span> <span data-ttu-id="9a9d6-302">Portanto, podemos criar um manipulador de eventos para o `ItemInserted` evento verifica se houve uma exceção e, nesse caso, exclui o arquivo especificado por s o ObjectDataSource `brochurePath` parâmetro:</span><span class="sxs-lookup"><span data-stu-id="9a9d6-302">Therefore, we can create an event handler for the `ItemInserted` event that checks if there was an exception and, if so, deletes the file specified by the ObjectDataSource s `brochurePath` parameter:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample13.cs)]

## <a name="summary"></a><span data-ttu-id="9a9d6-303">Resumo</span><span class="sxs-lookup"><span data-stu-id="9a9d6-303">Summary</span></span>

<span data-ttu-id="9a9d6-304">Há uma série de etapas que devem ser realizadas para fornecer uma interface baseada na web para adicionar os registros que incluem dados binários.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-304">There are a number of steps that must be performed in order to provide a web-based interface for adding records that include binary data.</span></span> <span data-ttu-id="9a9d6-305">Se os dados binários estão sendo armazenados diretamente no banco de dados, provavelmente que você precisará atualizar a arquitetura, a adição de métodos específicos para manipular o caso em que os dados binários está sendo inseridos.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-305">If the binary data is being stored directly into the database, chances are you'll need to update the architecture, adding specific methods to handle the case where binary data is being inserted.</span></span> <span data-ttu-id="9a9d6-306">Depois que a arquitetura tiver sido atualizada, a próxima etapa é criar a interface de inserção, que pode ser feita usando um DetailsView que foi personalizado para incluir um controle FileUpload para cada campo de dados binários.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-306">Once the architecture has been updated, the next step is creating the inserting interface, which can be accomplished using a DetailsView that has been customized to include a FileUpload control for each binary data field.</span></span> <span data-ttu-id="9a9d6-307">Os dados carregados podem ser salvo no sistema de arquivo do web server s ou atribuídos a um parâmetro de fonte de dados em s DetailsView `ItemInserting` manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-307">The uploaded data can then be saved to the web server s file system or assigned to a data source parameter in the DetailsView s `ItemInserting` event handler.</span></span>

<span data-ttu-id="9a9d6-308">Salvar dados binários para o sistema de arquivos requer mais planejamento que salvar os dados diretamente no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-308">Saving binary data to the file system requires more planning than saving data directly into the database.</span></span> <span data-ttu-id="9a9d6-309">Um esquema de nomenclatura deve ser escolhido para evitar um upload de usuário s substituindo s outro.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-309">A naming scheme must be chosen in order to avoid one user s upload overwriting another s.</span></span> <span data-ttu-id="9a9d6-310">Além disso, etapas adicionais devem ficar para excluir o arquivo carregado, se a inserção de banco de dados falhará.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-310">Also, extra steps must be taken to delete the uploaded file if the database insert fails.</span></span>

<span data-ttu-id="9a9d6-311">Agora temos a capacidade de adicionar novas categorias para o sistema com um folheto e imagem, mas podemos ve ainda para observar como atualizar um existente dados binários de s da categoria ou como remover corretamente os dados binários para uma categoria excluído.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-311">We now have the ability to add new categories to the system with a brochure and picture, but we ve yet to look at how to update an existing category s binary data or how to correctly remove the binary data for a deleted category.</span></span> <span data-ttu-id="9a9d6-312">Vamos explorar esses dois tópicos no próximo tutorial.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-312">We'll explore these two topics in the next tutorial.</span></span>

<span data-ttu-id="9a9d6-313">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="9a9d6-313">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="9a9d6-314">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="9a9d6-314">About the Author</span></span>

<span data-ttu-id="9a9d6-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de sete livros sobre ASP/ASP.NET e fundador da [4GuysFromRolla.com](http://www.4guysfromrolla.com), tem trabalhado com tecnologias Microsoft Web desde 1998.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="9a9d6-316">Scott funciona como um consultor independente, instrutor e escritor.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-316">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="9a9d6-317">Seu livro mais recente é [ *Sams Teach por conta própria ASP.NET 2.0 em 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="9a9d6-317">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="9a9d6-318">Ele pode ser contatado pelo [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9a9d6-318">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="9a9d6-319">ou por meio de seu blog, que pode ser encontrado em [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="9a9d6-319">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="9a9d6-320">Agradecimentos especiais a</span><span class="sxs-lookup"><span data-stu-id="9a9d6-320">Special Thanks To</span></span>

<span data-ttu-id="9a9d6-321">Esta série de tutoriais foi revisada por muitos revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-321">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="9a9d6-322">Revisores de avanço para este tutorial foram Dave Gardner, Teresa Murphy e Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="9a9d6-322">Lead reviewers for this tutorial were Dave Gardner, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="9a9d6-323">Você está interessado na revisão Meus próximos artigos do MSDN?</span><span class="sxs-lookup"><span data-stu-id="9a9d6-323">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="9a9d6-324">Nesse caso, me descartar uma linha na [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9a9d6-324">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9a9d6-325">[Anterior](displaying-binary-data-in-the-data-web-controls-cs.md)
> [Próximo](updating-and-deleting-existing-binary-data-cs.md)</span><span class="sxs-lookup"><span data-stu-id="9a9d6-325">[Previous](displaying-binary-data-in-the-data-web-controls-cs.md)
[Next](updating-and-deleting-existing-binary-data-cs.md)</span></span>
