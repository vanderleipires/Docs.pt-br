---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs
title: Usando existente de procedimentos armazenados para os TableAdapters do conjunto de dados tipado (c#) | Microsoft Docs
author: rick-anderson
description: No tutorial anterior, aprendemos como usar o Assistente do TableAdapter para gerar novos procedimentos armazenados. Neste tutorial, saiba como o mesmo TableAdapter...
ms.author: riande
ms.date: 07/18/2007
ms.assetid: 440bef2a-1641-4238-99e3-8e2d44e7d94c
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs
msc.type: authoredcontent
ms.openlocfilehash: df095a7eeac0910078cfa206ed1ba7be9a1334d2
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/16/2018
ms.locfileid: "41831002"
---
<a name="using-existing-stored-procedures-for-the-typed-datasets-tableadapters-c"></a><span data-ttu-id="94d1c-104">Usando existente de procedimentos armazenados para os TableAdapters do conjunto de dados tipado (c#)</span><span class="sxs-lookup"><span data-stu-id="94d1c-104">Using Existing Stored Procedures for the Typed DataSet's TableAdapters (C#)</span></span>
====================
<span data-ttu-id="94d1c-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="94d1c-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="94d1c-106">[Baixar o código](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_CS.zip) ou [baixar PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/datatutorial68cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="94d1c-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_CS.zip) or [Download PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/datatutorial68cs1.pdf)</span></span>

> <span data-ttu-id="94d1c-107">No tutorial anterior, aprendemos como usar o Assistente do TableAdapter para gerar novos procedimentos armazenados.</span><span class="sxs-lookup"><span data-stu-id="94d1c-107">In the previous tutorial we learned how to use the TableAdapter Wizard to generate new stored procedures.</span></span> <span data-ttu-id="94d1c-108">Neste tutorial, saiba como o mesmo assistente TableAdapter pode trabalhar com procedimentos armazenados existentes.</span><span class="sxs-lookup"><span data-stu-id="94d1c-108">In this tutorial we learn how the same TableAdapter Wizard can work with existing stored procedures.</span></span> <span data-ttu-id="94d1c-109">Podemos também aprenderá a adicionar manualmente novos procedimentos armazenados ao nosso banco de dados.</span><span class="sxs-lookup"><span data-stu-id="94d1c-109">We also learn how to manually add new stored procedures to our database.</span></span>


## <a name="introduction"></a><span data-ttu-id="94d1c-110">Introdução</span><span class="sxs-lookup"><span data-stu-id="94d1c-110">Introduction</span></span>

<span data-ttu-id="94d1c-111">No [tutorial anterior](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) , vimos como o s TableAdapters do conjunto de dados tipado pode ser configurado para usar procedimentos armazenados para acesso dados em vez de ad hoc de instruções de SQL.</span><span class="sxs-lookup"><span data-stu-id="94d1c-111">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) we saw how the Typed DataSet s TableAdapters could be configured to use stored procedures to access data rather than ad-hoc SQL statements.</span></span> <span data-ttu-id="94d1c-112">Em particular, examinamos como TableAdapter assistente criar automaticamente esses procedimentos armazenados.</span><span class="sxs-lookup"><span data-stu-id="94d1c-112">In particular, we examined how to have the TableAdapter wizard automatically create these stored procedures.</span></span> <span data-ttu-id="94d1c-113">Ao portar um aplicativo herdado para o ASP.NET 2.0 ou ao criar um site do ASP.NET 2.0 em torno de um modelo de dados existente, as chances são que o banco de dados já contém os procedimentos armazenados que precisamos.</span><span class="sxs-lookup"><span data-stu-id="94d1c-113">When porting a legacy application to ASP.NET 2.0 or when building an ASP.NET 2.0 website around an existing data model, chances are that the database already contains the stored procedures we need.</span></span> <span data-ttu-id="94d1c-114">Como alternativa, talvez você prefira criar seus procedimentos armazenados, manualmente ou por meio de uma ferramenta que não seja o Assistente do TableAdapter que gera automaticamente seus procedimentos armazenados.</span><span class="sxs-lookup"><span data-stu-id="94d1c-114">Alternatively, you may prefer to create your stored procedures by hand or through some tool other than the TableAdapter wizard that auto-generates your stored procedures.</span></span>

<span data-ttu-id="94d1c-115">Neste tutorial vamos examinar como configurar o TableAdapter para usar procedimentos armazenados existentes.</span><span class="sxs-lookup"><span data-stu-id="94d1c-115">In this tutorial we will look at how to configure the TableAdapter to use existing stored procedures.</span></span> <span data-ttu-id="94d1c-116">Como o banco de dados Northwind tem apenas um pequeno conjunto de procedimentos armazenados internos, podemos também examinar as etapas necessárias para adicionar manualmente novos procedimentos armazenados no banco de dados por meio do ambiente do Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="94d1c-116">Since the Northwind database only has a small set of built-in stored procedures, we will also look at the steps needed to manually add new stored procedures to the database through the Visual Studio environment.</span></span> <span data-ttu-id="94d1c-117">Permitir que o s começar!</span><span class="sxs-lookup"><span data-stu-id="94d1c-117">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="94d1c-118">No [de encapsulamento de modificações de banco de dados em uma transação](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs.md) tutorial adicionamos métodos ao TableAdapter para dar suporte a transações (`BeginTransaction`, `CommitTransaction`e assim por diante).</span><span class="sxs-lookup"><span data-stu-id="94d1c-118">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs.md) tutorial we added methods to the TableAdapter to support transactions (`BeginTransaction`, `CommitTransaction`, and so on).</span></span> <span data-ttu-id="94d1c-119">Como alternativa, as transações podem ser gerenciadas totalmente dentro de um procedimento armazenado, o que não exige que nenhuma modificação no código da camada de acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="94d1c-119">Alternatively, transactions can be managed entirely within a stored procedure, which requires no modifications to the Data Access Layer code.</span></span> <span data-ttu-id="94d1c-120">Neste tutorial, exploraremos os comandos T-SQL usados para executar instruções de s um procedimento armazenado dentro do escopo de uma transação.</span><span class="sxs-lookup"><span data-stu-id="94d1c-120">In this tutorial we'll explore the T-SQL commands used to execute a stored procedure s statements within the scope of a transaction.</span></span>


## <a name="step-1-adding-stored-procedures-to-the-northwind-database"></a><span data-ttu-id="94d1c-121">Etapa 1: Adicionar procedimentos armazenados no banco de dados Northwind</span><span class="sxs-lookup"><span data-stu-id="94d1c-121">Step 1: Adding Stored Procedures to the Northwind Database</span></span>

<span data-ttu-id="94d1c-122">Visual Studio torna fácil adicionar novos procedimentos armazenados para um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="94d1c-122">Visual Studio makes it easy to add new stored procedures to a database.</span></span> <span data-ttu-id="94d1c-123">Let s adicionar um novo procedimento armazenado no banco de dados Northwind que retorna todas as colunas do `Products` tabela para aqueles que têm um determinado `CategoryID` valor.</span><span class="sxs-lookup"><span data-stu-id="94d1c-123">Let s add a new stored procedure to the Northwind database that returns all columns from the `Products` table for those that have a particular `CategoryID` value.</span></span> <span data-ttu-id="94d1c-124">Na janela do Gerenciador de servidores, expanda o banco de dados Northwind, para que suas pastas - diagramas de banco de dados, tabelas, exibições e assim por diante - são exibidas.</span><span class="sxs-lookup"><span data-stu-id="94d1c-124">From the Server Explorer window, expand the Northwind database so that its folders - Database Diagrams, Tables, Views, and so forth - are displayed.</span></span> <span data-ttu-id="94d1c-125">Como vimos no tutorial anterior, a pasta de procedimentos armazenados contém os banco de dados s os procedimentos armazenados existentes.</span><span class="sxs-lookup"><span data-stu-id="94d1c-125">As we saw in the preceding tutorial, the Stored Procedures folder contains the database s existing stored procedures.</span></span> <span data-ttu-id="94d1c-126">Para adicionar um novo procedimento armazenado, clique com botão direito na pasta de procedimentos armazenados e escolha a opção de adicionar novo procedimento armazenado no menu de contexto.</span><span class="sxs-lookup"><span data-stu-id="94d1c-126">To add a new stored procedure, simply right-click the Stored Procedures folder and choose the Add New Stored Procedure option from the context menu.</span></span>


<span data-ttu-id="94d1c-127">[![Clique na pasta de procedimentos armazenados e adicione um novo procedimento armazenado](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="94d1c-127">[![Right-Click the Stored Procedures Folder and Add a New Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image1.png)</span></span>

<span data-ttu-id="94d1c-128">**Figura 1**: clique com botão direito na pasta de procedimentos armazenados e adicione um novo procedimento armazenado ([clique para exibir a imagem em tamanho normal](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="94d1c-128">**Figure 1**: Right-Click the Stored Procedures Folder and Add a New Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image3.png))</span></span>


<span data-ttu-id="94d1c-129">Como mostra a Figura 1, selecionando a opção de adicionar novo procedimento armazenado abre uma janela de script no Visual Studio com a estrutura de tópicos do script SQL necessária para criar o procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="94d1c-129">As Figure 1 shows, selecting the Add New Stored Procedure option opens a script window in Visual Studio with the outline of the SQL script needed to create the stored procedure.</span></span> <span data-ttu-id="94d1c-130">É nosso trabalho concretizar esse script e executá-lo, no ponto em que o procedimento armazenado será adicionado ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="94d1c-130">It is our job to flesh out this script and execute it, at which point the stored procedure will be added to the database.</span></span>

<span data-ttu-id="94d1c-131">Insira o seguinte script:</span><span class="sxs-lookup"><span data-stu-id="94d1c-131">Enter the following script:</span></span>


[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample1.sql)]

<span data-ttu-id="94d1c-132">Esse script, quando executado, adicionará um novo procedimento armazenado ao banco de dados Northwind denominado `Products_SelectByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="94d1c-132">This script, when executed, will add a new stored procedure to the Northwind database named `Products_SelectByCategoryID`.</span></span> <span data-ttu-id="94d1c-133">Esse procedimento armazenado aceita um parâmetro de entrada único (`@CategoryID`, do tipo `int`) e retorna todos os campos para esses produtos com uma correspondência `CategoryID` valor.</span><span class="sxs-lookup"><span data-stu-id="94d1c-133">This stored procedure accepts a single input parameter (`@CategoryID`, of type `int`) and it returns all of the fields for those products with a matching `CategoryID` value.</span></span>

<span data-ttu-id="94d1c-134">Para executar esta `CREATE PROCEDURE` de script e adicione o procedimento armazenado no banco de dados, clique no ícone Salvar na barra de ferramentas ou pressione Ctrl + S.</span><span class="sxs-lookup"><span data-stu-id="94d1c-134">To execute this `CREATE PROCEDURE` script and add the stored procedure to the database, click the Save icon in the toolbar or hit Ctrl+S.</span></span> <span data-ttu-id="94d1c-135">Depois de fazer isso, as atualizações de pasta de procedimentos armazenados, mostrar o recém-criado procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="94d1c-135">After doing so, the Stored Procedures folder refreshes, showing the newly created stored procedure.</span></span> <span data-ttu-id="94d1c-136">Além disso, o script na janela mudará sutileza do `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` à `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="94d1c-136">Also, the script in the window will change subtlety from `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` to `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`.</span></span> <span data-ttu-id="94d1c-137">`CREATE PROCEDURE` Adiciona um novo procedimento armazenado no banco de dados, enquanto `ALTER PROCEDURE` atualiza uma existente.</span><span class="sxs-lookup"><span data-stu-id="94d1c-137">`CREATE PROCEDURE` adds a new stored procedure to the database, while `ALTER PROCEDURE` updates an existing one.</span></span> <span data-ttu-id="94d1c-138">Desde o início do script foi alterado para `ALTER PROCEDURE`, alterar os procedimentos armazenados de entrada parâmetros ou instruções SQL e clicando no ícone Salvar, o procedimento armazenado será atualizado com essas alterações.</span><span class="sxs-lookup"><span data-stu-id="94d1c-138">Since the start of the script has changed to `ALTER PROCEDURE`, changing the stored procedures input parameters or SQL statements and clicking the Save icon will update the stored procedure with these changes.</span></span>

<span data-ttu-id="94d1c-139">Figura 2 mostra o Visual Studio após a `Products_SelectByCategoryID` procedimento armazenado foi salvo.</span><span class="sxs-lookup"><span data-stu-id="94d1c-139">Figure 2 shows Visual Studio after the `Products_SelectByCategoryID` stored procedure has been saved.</span></span>


<span data-ttu-id="94d1c-140">[![O procedimento armazenado Products_SelectByCategoryID foi adicionado ao banco de dados](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="94d1c-140">[![The Stored Procedure Products_SelectByCategoryID Has Been Added to the Database](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image4.png)</span></span>

<span data-ttu-id="94d1c-141">**Figura 2**: O procedimento armazenado `Products_SelectByCategoryID` foi adicionado ao banco de dados ([clique para exibir a imagem em tamanho normal](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="94d1c-141">**Figure 2**: The Stored Procedure `Products_SelectByCategoryID` Has Been Added to the Database ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image6.png))</span></span>


## <a name="step-2-configuring-the-tableadapter-to-use-an-existing-stored-procedure"></a><span data-ttu-id="94d1c-142">Etapa 2: Configurar o TableAdapter para usar um procedimento armazenado existente</span><span class="sxs-lookup"><span data-stu-id="94d1c-142">Step 2: Configuring the TableAdapter to Use an Existing Stored Procedure</span></span>

<span data-ttu-id="94d1c-143">Agora que o `Products_SelectByCategoryID` procedimento armazenado foi adicionado ao banco de dados, podemos concigure nossa camada de acesso de dados para usar esse procedimento armazenado quando um de seus métodos é invocado.</span><span class="sxs-lookup"><span data-stu-id="94d1c-143">Now that the `Products_SelectByCategoryID` stored procedure has been added to the database, we can concigure our Data Access Layer to use this stored procedure when one of its methods is invoked.</span></span> <span data-ttu-id="94d1c-144">Em particular, vamos adicionar um `GetProducstByCategoryID(categoryID)` método para o `ProductsTableAdapter` na `NorthwindWithSprocs` conjunto de dados tipado que chama o `Products_SelectByCategoryID` que acabamos de criar do procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="94d1c-144">In particular, we will add a `GetProducstByCategoryID(categoryID)` method to the `ProductsTableAdapter` in the `NorthwindWithSprocs` Typed DataSet that calls the `Products_SelectByCategoryID` stored procedure we just created.</span></span>

<span data-ttu-id="94d1c-145">Comece abrindo o `NorthwindWithSprocs` conjunto de dados.</span><span class="sxs-lookup"><span data-stu-id="94d1c-145">Start by opening the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="94d1c-146">Clique com botão direito no `ProductsTableAdapter` e escolha Add Query para iniciar o Assistente de configuração de consulta do TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="94d1c-146">Right-click on the `ProductsTableAdapter` and choose Add Query to launch the TableAdapter Query Configuration wizard.</span></span> <span data-ttu-id="94d1c-147">No [tutorial anterior](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) , optei por ter o TableAdapter criar um novo procedimento armazenado para nós.</span><span class="sxs-lookup"><span data-stu-id="94d1c-147">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) we opted to have the TableAdapter create a new stored procedure for us.</span></span> <span data-ttu-id="94d1c-148">Para este tutorial, no entanto, que desejamos conectar o novo método do TableAdapter para existente `Products_SelectByCategoryID` procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="94d1c-148">For this tutorial, however, we want to wire the new TableAdapter method to the existing `Products_SelectByCategoryID` stored procedure.</span></span> <span data-ttu-id="94d1c-149">Portanto, escolher a opção de procedimento armazenado existente usar a primeira etapa do assistente s e, em seguida, clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="94d1c-149">Therefore, choose the Use existing stored procedure option from the wizard s first step and then click Next.</span></span>


<span data-ttu-id="94d1c-150">[![Escolha o uso de opção de procedimento armazenado de existente](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="94d1c-150">[![Choose the Use existing stored procedure Option](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image7.png)</span></span>

<span data-ttu-id="94d1c-151">**Figura 3**: escolha usar existente armazenado procedimento opção ([clique para exibir a imagem em tamanho normal](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="94d1c-151">**Figure 3**: Choose the Use existing stored procedure Option ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image9.png))</span></span>


<span data-ttu-id="94d1c-152">A tela a seguir fornece que uma lista suspensa preenchida com o banco de dados s procedimentos armazenados.</span><span class="sxs-lookup"><span data-stu-id="94d1c-152">The following screen provides a drop-down list populated with the database s stored procedures.</span></span> <span data-ttu-id="94d1c-153">Selecionar um procedimento armazenado lista seus parâmetros de entrada à esquerda e os campos de dados retornados (se houver) à direita.</span><span class="sxs-lookup"><span data-stu-id="94d1c-153">Selecting a stored procedure lists its input parameters on the left and the data fields returned (if any) on the right.</span></span> <span data-ttu-id="94d1c-154">Escolha o `Products_SelectByCategoryID` procedimento armazenado a partir da lista e clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="94d1c-154">Choose the `Products_SelectByCategoryID` stored procedure from the list and click Next.</span></span>


<span data-ttu-id="94d1c-155">[![Escolher o Products_SelectByCategoryID procedimento armazenado](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="94d1c-155">[![Pick the Products_SelectByCategoryID Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image10.png)</span></span>

<span data-ttu-id="94d1c-156">**Figura 4**: escolha o `Products_SelectByCategoryID` procedimento armazenado ([clique para exibir a imagem em tamanho normal](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="94d1c-156">**Figure 4**: Pick the `Products_SelectByCategoryID` Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image12.png))</span></span>


<span data-ttu-id="94d1c-157">A próxima tela pergunta que tipo de dados é retornado pelo procedimento armazenado e nossa resposta aqui determina o tipo retornado pelo método s TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="94d1c-157">The next screen asks us what kind of data is returned by the stored procedure and our answer here determines the type returned by the TableAdapter s method.</span></span> <span data-ttu-id="94d1c-158">Por exemplo, se podemos indicar que os dados de tabela são retornados, o método retornará um `ProductsDataTable` instância preenchida com os registros retornados pelo procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="94d1c-158">For example, if we indicate that tabular data is returned, the method will return a `ProductsDataTable` instance populated with the records returned by the stored procedure.</span></span> <span data-ttu-id="94d1c-159">Por outro lado, se podemos indicar que esse procedimento armazenado retorna um valor único TableAdapter retornará um `object` que recebe o valor na primeira coluna do primeiro registro retornado pelo procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="94d1c-159">In contrast, if we indicate that this stored procedure returns a single value the TableAdapter will return an `object` that is assigned the value in the first column of the first record returned by the stored procedure.</span></span>

<span data-ttu-id="94d1c-160">Uma vez que o `Products_SelectByCategoryID` procedimento armazenado retorna todos os produtos que pertencem a uma categoria específica, escolha a primeira resposta - dados tabulares – e clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="94d1c-160">Since the `Products_SelectByCategoryID` stored procedure returns all products that belong to a particular category, choose the first answer - Tabular data - and click Next.</span></span>


<span data-ttu-id="94d1c-161">[![Indicar que o procedimento armazenado retorna dados tabulares](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="94d1c-161">[![Indicate that the Stored Procedure Returns Tabular Data](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image13.png)</span></span>

<span data-ttu-id="94d1c-162">**Figura 5**: indica que o procedimento armazenado retorna dados de tabela ([clique para exibir a imagem em tamanho normal](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="94d1c-162">**Figure 5**: Indicate that the Stored Procedure Returns Tabular Data ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image15.png))</span></span>


<span data-ttu-id="94d1c-163">Tudo o que resta é indicar quais padrões de método para usar seguido de nomes para esses métodos.</span><span class="sxs-lookup"><span data-stu-id="94d1c-163">All that remains is to indicate what method patterns to use followed by the names for these methods.</span></span> <span data-ttu-id="94d1c-164">Deixe os dois o preenchimento de uma DataTable e retornar uma DataTable opções verificada, mas renomear os métodos para `FillByCategoryID` e `GetProductsByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="94d1c-164">Leave both the Fill a DataTable and Return a DataTable options checked, but rename the methods to `FillByCategoryID` and `GetProductsByCategoryID`.</span></span> <span data-ttu-id="94d1c-165">Em seguida, clique em Avançar para examinar um resumo das tarefas que o assistente executará.</span><span class="sxs-lookup"><span data-stu-id="94d1c-165">Then click Next to review a summary of the tasks the wizard will perform.</span></span> <span data-ttu-id="94d1c-166">Se tudo estiver correto, clique em Concluir.</span><span class="sxs-lookup"><span data-stu-id="94d1c-166">If everything looks correct, click Finish.</span></span>


<span data-ttu-id="94d1c-167">[![Nome FillByCategoryID os métodos e GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="94d1c-167">[![Name the Methods FillByCategoryID and GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image16.png)</span></span>

<span data-ttu-id="94d1c-168">**Figura 6**: nomear os métodos `FillByCategoryID` e `GetProductsByCategoryID` ([clique para exibir a imagem em tamanho normal](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="94d1c-168">**Figure 6**: Name the Methods `FillByCategoryID` and `GetProductsByCategoryID` ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image18.png))</span></span>


> [!NOTE]
> <span data-ttu-id="94d1c-169">Os métodos TableAdapter que acabamos de criar `FillByCategoryID` e `GetProductsByCategoryID`, espera um parâmetro de entrada do tipo `int`.</span><span class="sxs-lookup"><span data-stu-id="94d1c-169">The TableAdapter methods we just created, `FillByCategoryID` and `GetProductsByCategoryID`, expect an input parameter of type `int`.</span></span> <span data-ttu-id="94d1c-170">Esse valor de parâmetro de entrada é passado para o procedimento armazenado por meio de seu `@CategoryID` parâmetro.</span><span class="sxs-lookup"><span data-stu-id="94d1c-170">This input parameter value is passed into the stored procedure via its `@CategoryID` parameter.</span></span> <span data-ttu-id="94d1c-171">Se você modificar o `Products_SelectByCategory` armazenados parâmetros de procedimento s, será necessário também atualizar os parâmetros para esses métodos do TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="94d1c-171">If you modify the `Products_SelectByCategory` stored procedure s parameters, you'll need to also update the parameters for these TableAdapter methods.</span></span> <span data-ttu-id="94d1c-172">Conforme discutido na [tutorial anterior](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md), isso pode ser feito de duas maneiras: manualmente adicionando ou removendo parâmetros da coleção de parâmetros ou executar novamente o Assistente do TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="94d1c-172">As discussed in the [previous tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md), this can be done in one of two ways: by manually adding or removing parameters from the parameters collection or by rerunning the TableAdapter wizard.</span></span>


## <a name="step-3-adding-agetproductsbycategoryidcategoryidmethod-to-the-bll"></a><span data-ttu-id="94d1c-173">Etapa 3: Adicionando um`GetProductsByCategoryID(categoryID)`método para a BLL</span><span class="sxs-lookup"><span data-stu-id="94d1c-173">Step 3: Adding a`GetProductsByCategoryID(categoryID)`Method to the BLL</span></span>

<span data-ttu-id="94d1c-174">Com o `GetProductsByCategoryID` método DAL completo, a próxima etapa é fornecer acesso a esse método na camada de lógica de negócios.</span><span class="sxs-lookup"><span data-stu-id="94d1c-174">With the `GetProductsByCategoryID` DAL method complete, the next step is to provide access to this method in the Business Logic Layer.</span></span> <span data-ttu-id="94d1c-175">Abra o `ProductsBLLWithSprocs` arquivo de classe e adicione o seguinte método:</span><span class="sxs-lookup"><span data-stu-id="94d1c-175">Open the `ProductsBLLWithSprocs` class file and add the following method:</span></span>


[!code-csharp[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample2.cs)]

<span data-ttu-id="94d1c-176">Esse método BLL simplesmente retorna o `ProductsDataTable` retornado do `ProductsTableAdapter` s `GetProductsByCategoryID` método.</span><span class="sxs-lookup"><span data-stu-id="94d1c-176">This BLL method simply returns the `ProductsDataTable` returned from the `ProductsTableAdapter` s `GetProductsByCategoryID` method.</span></span> <span data-ttu-id="94d1c-177">O `DataObjectMethodAttribute` atributo fornece metadados usados pelo assistente ObjectDataSource s configurar fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="94d1c-177">The `DataObjectMethodAttribute` attribute provides metadata used by the ObjectDataSource s Configure Data Source wizard.</span></span> <span data-ttu-id="94d1c-178">Em particular, este método será exibido na lista suspensa Selecione guia s.</span><span class="sxs-lookup"><span data-stu-id="94d1c-178">In particular, this method will appear in the SELECT tab s drop-down list.</span></span>

## <a name="step-4-displaying-products-by-category"></a><span data-ttu-id="94d1c-179">Etapa 4: Exibindo produtos por categoria</span><span class="sxs-lookup"><span data-stu-id="94d1c-179">Step 4: Displaying Products by Category</span></span>

<span data-ttu-id="94d1c-180">Para testar o recém-adicionado `Products_SelectByCategoryID` procedimento armazenado e os métodos correspondentes de permitir que o s crie uma página ASP.NET que contém uma DropDownList e GridView DAL e BLL.</span><span class="sxs-lookup"><span data-stu-id="94d1c-180">To test the newly added `Products_SelectByCategoryID` stored procedure and the corresponding DAL and BLL methods, let s create an ASP.NET page that contains a DropDownList and a GridView.</span></span> <span data-ttu-id="94d1c-181">DropDownList listará todas as categorias no banco de dados enquanto o GridView exibirá os produtos que pertencem à categoria selecionada.</span><span class="sxs-lookup"><span data-stu-id="94d1c-181">The DropDownList will list all of the categories in the database while the GridView will display the products belonging to the selected category.</span></span>

> [!NOTE]
> <span data-ttu-id="94d1c-182">Podemos var criado interfaces de mestre/detalhes usando DropDownLists nos tutoriais anteriores.</span><span class="sxs-lookup"><span data-stu-id="94d1c-182">We ve created master/detail interfaces using DropDownLists in previous tutorials.</span></span> <span data-ttu-id="94d1c-183">Para obter uma visão mais detalhada sobre a implementação de tal relatório mestre/detalhes, consulte o [filtragem de mestre/detalhes com uma DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) tutorial.</span><span class="sxs-lookup"><span data-stu-id="94d1c-183">For a more in-depth look at implementing such a master/detail report, refer to the [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) tutorial.</span></span>


<span data-ttu-id="94d1c-184">Abra o `ExistingSprocs.aspx` página o `AdvancedDAL` pasta e arraste uma DropDownList da caixa de ferramentas para o Designer.</span><span class="sxs-lookup"><span data-stu-id="94d1c-184">Open the `ExistingSprocs.aspx` page in the `AdvancedDAL` folder and drag a DropDownList from the Toolbox onto the Designer.</span></span> <span data-ttu-id="94d1c-185">Definir o s DropDownList `ID` propriedade para `Categories` e seu `AutoPostBack` propriedade `true`.</span><span class="sxs-lookup"><span data-stu-id="94d1c-185">Set the DropDownList s `ID` property to `Categories` and its `AutoPostBack` property to `true`.</span></span> <span data-ttu-id="94d1c-186">Em seguida, na marca inteligente, de associar a DropDownList a um novo ObjectDataSource chamado `CategoriesDataSource`.</span><span class="sxs-lookup"><span data-stu-id="94d1c-186">Next, from its smart tag, bind the DropDownList to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="94d1c-187">Configurar o ObjectDataSource para que ele recupere seus dados a partir de `CategoriesBLL` classe s `GetCategories` método.</span><span class="sxs-lookup"><span data-stu-id="94d1c-187">Configure the ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="94d1c-188">Defina as listas suspensas na atualização, inserção e excluir guias como (nenhum).</span><span class="sxs-lookup"><span data-stu-id="94d1c-188">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="94d1c-189">[![Recuperar dados do método GetCategories CategoriesBLL classe s](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="94d1c-189">[![Retrieve Data from the CategoriesBLL Class s GetCategories Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image19.png)</span></span>

<span data-ttu-id="94d1c-190">**Figura 7**: recupere dados do `CategoriesBLL` classe s `GetCategories` método ([clique para exibir a imagem em tamanho normal](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="94d1c-190">**Figure 7**: Retrieve Data from the `CategoriesBLL` Class s `GetCategories` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image21.png))</span></span>


<span data-ttu-id="94d1c-191">[![Definir as listas suspensas na atualização, inserção e excluir guias como (nenhum)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="94d1c-191">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image22.png)</span></span>

<span data-ttu-id="94d1c-192">**Figura 8**: defina a lista suspensa no UPDATE, INSERT e excluir guias como (nenhum) ([clique para exibir a imagem em tamanho normal](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="94d1c-192">**Figure 8**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image24.png))</span></span>


<span data-ttu-id="94d1c-193">Depois de concluir o assistente ObjectDataSource, configurar a DropDownList para exibir o `CategoryName` campo de dados e usar o `CategoryID` campo como o `Value` para cada `ListItem`.</span><span class="sxs-lookup"><span data-stu-id="94d1c-193">After completing the ObjectDataSource wizard, configure the DropDownList to display the `CategoryName` data field and to use the `CategoryID` field as the `Value` for each `ListItem`.</span></span>

<span data-ttu-id="94d1c-194">Neste ponto, DropDownList e ObjectDataSource s marcação declarativa deve semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="94d1c-194">At this point, the DropDownList and ObjectDataSource s declarative markup should similar to the following:</span></span>


[!code-aspx[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample3.aspx)]

<span data-ttu-id="94d1c-195">Em seguida, arraste um GridView para o Designer, colocando-o abaixo de DropDownList.</span><span class="sxs-lookup"><span data-stu-id="94d1c-195">Next, drag a GridView onto the Designer, placing it beneath the DropDownList.</span></span> <span data-ttu-id="94d1c-196">Definir o s GridView `ID` à `ProductsByCategory` e, na marca inteligente, de associá-lo a um novo ObjectDataSource chamado `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="94d1c-196">Set the GridView s `ID` to `ProductsByCategory` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="94d1c-197">Configurar o `ProductsByCategoryDataSource` ObjectDataSource para usar o `ProductsBLLWithSprocs` classe, que ela recupere seus dados usando o `GetProductsByCategoryID(categoryID)` método.</span><span class="sxs-lookup"><span data-stu-id="94d1c-197">Configure the `ProductsByCategoryDataSource` ObjectDataSource to use the `ProductsBLLWithSprocs` class, having it retrieve its data using the `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="94d1c-198">Porque este GridView somente será usado para exibir dados, defina as listas suspensas na atualização, inserção e excluir guias como (nenhum) e clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="94d1c-198">Since this GridView will only be used to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) and click Next.</span></span>


<span data-ttu-id="94d1c-199">[![Configurar o ObjectDataSource para usar a classe ProductsBLLWithSprocs](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="94d1c-199">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image25.png)</span></span>

<span data-ttu-id="94d1c-200">**Figura 9**: configurar o ObjectDataSource para usar o `ProductsBLLWithSprocs` classe ([clique para exibir a imagem em tamanho normal](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="94d1c-200">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image27.png))</span></span>


<span data-ttu-id="94d1c-201">[![Recuperar dados do método GetProductsByCategoryID(categoryID)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="94d1c-201">[![Retrieve Data from the GetProductsByCategoryID(categoryID) Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image28.png)</span></span>

<span data-ttu-id="94d1c-202">**Figura 10**: recupere dados do `GetProductsByCategoryID(categoryID)` método ([clique para exibir a imagem em tamanho normal](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="94d1c-202">**Figure 10**: Retrieve Data from the `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image30.png))</span></span>


<span data-ttu-id="94d1c-203">O método escolhido na guia selecione espera um parâmetro, portanto, a etapa final do assistente nos solicita a origem do parâmetro s.</span><span class="sxs-lookup"><span data-stu-id="94d1c-203">The method chosen in the SELECT tab expects a parameter, so the final step of the wizard prompts us for the parameter s source.</span></span> <span data-ttu-id="94d1c-204">Defina a lista de lista suspensa de origem do parâmetro para o controle e escolha o `Categories` controle na lista suspensa ControlID.</span><span class="sxs-lookup"><span data-stu-id="94d1c-204">Set the Parameter source drop-down list to Control and choose the `Categories` control from the ControlID drop-down list.</span></span> <span data-ttu-id="94d1c-205">Clique em Concluir para concluir o assistente.</span><span class="sxs-lookup"><span data-stu-id="94d1c-205">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="94d1c-206">[![Use Categories DropDownList como a origem do parâmetro categoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="94d1c-206">[![Use the Categories DropDownList as the Source of the categoryID Parameter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image31.png)</span></span>

<span data-ttu-id="94d1c-207">**Figura 11**: Use o `Categories` DropDownList como a origem do `categoryID` parâmetro ([clique para exibir a imagem em tamanho normal](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="94d1c-207">**Figure 11**: Use the `Categories` DropDownList as the Source of the `categoryID` Parameter ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image33.png))</span></span>


<span data-ttu-id="94d1c-208">Depois de concluir o assistente ObjectDataSource, o Visual Studio adicionará BoundFields e um CheckBoxField para cada um dos campos de dados do produto.</span><span class="sxs-lookup"><span data-stu-id="94d1c-208">Upon completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="94d1c-209">Fique à vontade personalizar esses campos conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="94d1c-209">Feel free to customize these fields as you see fit.</span></span>

<span data-ttu-id="94d1c-210">Visite a página por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="94d1c-210">Visit the page through a browser.</span></span> <span data-ttu-id="94d1c-211">Ao visitar a página de que categoria Bebidas está selecionada e os produtos correspondentes listados na grade.</span><span class="sxs-lookup"><span data-stu-id="94d1c-211">When visiting the page the Beverages category is selected and the corresponding products listed in the grid.</span></span> <span data-ttu-id="94d1c-212">Alterando a lista suspensa para uma categoria de alternativa, como a Figura 12 mostra, faz com que um postback e recarrega a grade com os produtos da categoria selecionada recentemente.</span><span class="sxs-lookup"><span data-stu-id="94d1c-212">Changing the drop-down list to an alternative category, as Figure 12 shows, causes a postback and reloads the grid with the products of the newly selected category.</span></span>


<span data-ttu-id="94d1c-213">[![Os produtos na categoria de produzir são exibidos](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="94d1c-213">[![The Products in the Produce Category are Displayed](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image34.png)</span></span>

<span data-ttu-id="94d1c-214">**Figura 12**: os produtos na categoria de produzir são exibidos ([clique para exibir a imagem em tamanho normal](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="94d1c-214">**Figure 12**: The Products in the Produce Category are Displayed ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image36.png))</span></span>


## <a name="step-5-wrapping-a-stored-procedure-s-statements-within-the-scope-of-a-transaction"></a><span data-ttu-id="94d1c-215">Etapa 5: Quebra automática de instruções de s um procedimento armazenado dentro do escopo de uma transação</span><span class="sxs-lookup"><span data-stu-id="94d1c-215">Step 5: Wrapping a Stored Procedure s Statements Within the Scope of a Transaction</span></span>

<span data-ttu-id="94d1c-216">No [de encapsulamento de modificações de banco de dados em uma transação](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs.md) tutorial discutimos as técnicas para executar uma série de instruções de modificação do banco de dados dentro do escopo de uma transação.</span><span class="sxs-lookup"><span data-stu-id="94d1c-216">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs.md) tutorial we discussed techniques for performing a series of database modification statements within the scope of a transaction.</span></span> <span data-ttu-id="94d1c-217">Lembre-se que as modificações executadas sob o guarda-chuva de uma transação ou em todos os tenha êxito ou falha de todos os, garantindo atomicidade.</span><span class="sxs-lookup"><span data-stu-id="94d1c-217">Recall that the modifications performed under the umbrella of a transaction either all succeed or all fail, guaranteeing atomicity.</span></span> <span data-ttu-id="94d1c-218">Técnicas para usar transações incluem:</span><span class="sxs-lookup"><span data-stu-id="94d1c-218">Techniques for using transactions include:</span></span>

- <span data-ttu-id="94d1c-219">Usando as classes no `System.Transactions` namespace,</span><span class="sxs-lookup"><span data-stu-id="94d1c-219">Using the classes in the `System.Transactions` namespace,</span></span>
- <span data-ttu-id="94d1c-220">Com a camada de acesso a dados usar classes do ADO.NET como `SqlTransaction`, e</span><span class="sxs-lookup"><span data-stu-id="94d1c-220">Having the Data Access Layer use ADO.NET classes like `SqlTransaction`, and</span></span>
- <span data-ttu-id="94d1c-221">Adicionando os comandos de transação do T-SQL diretamente dentro do procedimento armazenado</span><span class="sxs-lookup"><span data-stu-id="94d1c-221">Adding the T-SQL transaction commands directly within the stored procedure</span></span>

<span data-ttu-id="94d1c-222">O *de encapsulamento de modificações de banco de dados em uma transação* tutorial usou as classes ADO.NET no DAL.</span><span class="sxs-lookup"><span data-stu-id="94d1c-222">The *Wrapping Database Modifications within a Transaction* tutorial used the ADO.NET classes in the DAL.</span></span> <span data-ttu-id="94d1c-223">O restante deste tutorial examina como gerenciar uma transação usando comandos do T-SQL de dentro de um procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="94d1c-223">The remainder of this tutorial examines how to manage a transaction using T-SQL commands from within a stored procedure.</span></span>

<span data-ttu-id="94d1c-224">Os três comandos SQL principais para iniciar manualmente, confirmar e reverter uma transação são `BEGIN TRANSACTION`, `COMMIT TRANSACTION`, e `ROLLBACK TRANSACTION`, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="94d1c-224">The three key SQL commands for manually starting, committing, and rolling back a transaction are `BEGIN TRANSACTION`, `COMMIT TRANSACTION`, and `ROLLBACK TRANSACTION`, respectively.</span></span> <span data-ttu-id="94d1c-225">Como com a abordagem do ADO.NET, ao usar transações de dentro de um procedimento armazenado, é necessário aplicar o seguinte padrão:</span><span class="sxs-lookup"><span data-stu-id="94d1c-225">Like with the ADO.NET approach, when using transactions from within a stored procedure we need to apply the following pattern:</span></span>

1. <span data-ttu-id="94d1c-226">Indica o início de uma transação.</span><span class="sxs-lookup"><span data-stu-id="94d1c-226">Indicate the start of a transaction.</span></span>
2. <span data-ttu-id="94d1c-227">Execute as instruções SQL que compõem a transação.</span><span class="sxs-lookup"><span data-stu-id="94d1c-227">Execute the SQL statements that comprise the transaction.</span></span>
3. <span data-ttu-id="94d1c-228">Se houver um erro em qualquer uma das instruções da etapa 2, reverta a transação</span><span class="sxs-lookup"><span data-stu-id="94d1c-228">If there is an error in any one of the statements from Step 2, rollback the transaction</span></span>
4. <span data-ttu-id="94d1c-229">Se todas as instruções da etapa 2 concluída sem erro, confirme a transação.</span><span class="sxs-lookup"><span data-stu-id="94d1c-229">If all of the statements from Step 2 complete without error, commit the transaction.</span></span>

<span data-ttu-id="94d1c-230">Esse padrão pode ser implementado na sintaxe do T-SQL usando o modelo a seguir:</span><span class="sxs-lookup"><span data-stu-id="94d1c-230">This pattern can be implemented in T-SQL syntax using the following template:</span></span>


[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample4.sql)]

<span data-ttu-id="94d1c-231">O modelo começa definindo um `TRY...CATCH` bloquear uma construção de nova no SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="94d1c-231">The template starts by defining a `TRY...CATCH` block, a construct new to SQL Server 2005.</span></span> <span data-ttu-id="94d1c-232">Como com `try...catch` blocos em c#, o SQL `TRY...CATCH` as instruções no bloco é executado o `TRY` bloco.</span><span class="sxs-lookup"><span data-stu-id="94d1c-232">Like with `try...catch` blocks in C#, the SQL `TRY...CATCH` block executes the statements in the `TRY` block.</span></span> <span data-ttu-id="94d1c-233">Se nenhuma instrução gera um erro, o controle é transferido imediatamente para o `CATCH` bloco.</span><span class="sxs-lookup"><span data-stu-id="94d1c-233">If any statement raises an error, control is immediately transferred to the `CATCH` block.</span></span>

<span data-ttu-id="94d1c-234">Se não houver nenhum erro de execução de instruções SQL que a transação de composição a `COMMIT TRANSACTION` instrução confirma as alterações e conclui a transação.</span><span class="sxs-lookup"><span data-stu-id="94d1c-234">If there are no errors executing the SQL statements that makeup the transaction, the `COMMIT TRANSACTION` statement commits the changes and completes the transaction.</span></span> <span data-ttu-id="94d1c-235">Se, no entanto, uma das instruções resulta em um erro, o `ROLLBACK TRANSACTION` no `CATCH` bloco retorna o banco de dados para seu estado antes do início da transação.</span><span class="sxs-lookup"><span data-stu-id="94d1c-235">If, however, one of the statements results in an error, the `ROLLBACK TRANSACTION` in the `CATCH` block returns the database to its state prior to the start of the transaction.</span></span> <span data-ttu-id="94d1c-236">O procedimento armazenado também gerará um erro usando o [comando RAISERROR](https://msdn.microsoft.com/library/ms178592.aspx), que faz com que um `SqlException` a ser gerado no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="94d1c-236">The stored procedure also raises an error using the [RAISERROR command](https://msdn.microsoft.com/library/ms178592.aspx), which causes a `SqlException` to be raised in the application.</span></span>

> [!NOTE]
> <span data-ttu-id="94d1c-237">Uma vez que o `TRY...CATCH` bloco é novo no SQL Server 2005, o modelo acima não funcionarão se você estiver usando versões mais antigas do Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="94d1c-237">Since the `TRY...CATCH` block is new to SQL Server 2005, the above template will not work if you are using older versions of Microsoft SQL Server.</span></span> <span data-ttu-id="94d1c-238">Se você não estiver usando o SQL Server 2005, consulte [gerenciamento de transações em procedimentos armazenados do SQL Server](http://www.4guysfromrolla.com/webtech/080305-1.shtml) de um modelo que funcionará com outras versões do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="94d1c-238">If you are not using SQL Server 2005, consult [Managing Transactions in SQL Server Stored Procedures](http://www.4guysfromrolla.com/webtech/080305-1.shtml) for a template that will work with other versions of SQL Server.</span></span>


<span data-ttu-id="94d1c-239">Deixe o s examinar um exemplo concreto.</span><span class="sxs-lookup"><span data-stu-id="94d1c-239">Let s look at a concrete example.</span></span> <span data-ttu-id="94d1c-240">Uma restrição de chave estrangeira existe entre o `Categories` e `Products` tabelas, o que significa que cada `CategoryID` campo o `Products` tabela deve ser mapeado para um `CategoryID` valor no `Categories` tabela.</span><span class="sxs-lookup"><span data-stu-id="94d1c-240">A foreign key constraint exists between the `Categories` and `Products` tables, meaning that each `CategoryID` field in the `Products` table must map to a `CategoryID` value in the `Categories` table.</span></span> <span data-ttu-id="94d1c-241">Qualquer ação que faria violam essa restrição, como a tentativa de excluir uma categoria que associou os produtos, resulta em uma violação de restrição de chave estrangeira.</span><span class="sxs-lookup"><span data-stu-id="94d1c-241">Any action that would violate this constraint, such as attempting to delete a category that has associated products, results in a foreign key constraint violation.</span></span> <span data-ttu-id="94d1c-242">Para verificar isso, examine o exemplo atualizando e excluindo dados binários existentes no seção como trabalhar com dados binários (`~/BinaryData/UpdatingAndDeleting.aspx`).</span><span class="sxs-lookup"><span data-stu-id="94d1c-242">To verify this, revisit the Updating and Deleting Existing Binary Data example in the Working with Binary Data section (`~/BinaryData/UpdatingAndDeleting.aspx`).</span></span> <span data-ttu-id="94d1c-243">Esta página lista cada categoria no sistema, juntamente com os botões Editar e excluir (veja a Figura 13), mas se você tentar excluir uma categoria que associou os produtos - como bebidas - a exclusão falha devido a uma violação de restrição de chave estrangeira (consulte a Figura 14).</span><span class="sxs-lookup"><span data-stu-id="94d1c-243">This page lists each category in the system along with Edit and Delete buttons (see Figure 13), but if you attempt to delete a category that has associated products - such as Beverages - the delete fails due to a foreign key constraint violation (see Figure 14).</span></span>


<span data-ttu-id="94d1c-244">[![Cada categoria é exibida em um GridView com botões Editar e excluir](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="94d1c-244">[![Each Category is Displayed in a GridView with Edit and Delete Buttons](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image37.png)</span></span>

<span data-ttu-id="94d1c-245">**Figura 13**: cada categoria é exibida em um GridView com botões Editar e excluir ([clique para exibir a imagem em tamanho normal](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="94d1c-245">**Figure 13**: Each Category is Displayed in a GridView with Edit and Delete Buttons ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image39.png))</span></span>


<span data-ttu-id="94d1c-246">[![Você não pode excluir uma categoria de produtos existentes](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="94d1c-246">[![You Cannot Delete a Category that has Existing Products](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image40.png)</span></span>

<span data-ttu-id="94d1c-247">**Figura 14**: você não pode excluir uma categoria de produtos existentes ([clique para exibir a imagem em tamanho normal](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="94d1c-247">**Figure 14**: You Cannot Delete a Category that has Existing Products ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image42.png))</span></span>


<span data-ttu-id="94d1c-248">No entanto, imagine que desejamos permitir categorias a serem excluídos, independentemente se eles têm associados a produtos.</span><span class="sxs-lookup"><span data-stu-id="94d1c-248">Imagine, though, that we want to allow categories to be deleted regardless of whether they have associated products.</span></span> <span data-ttu-id="94d1c-249">Uma categoria de produtos deve ser excluída, imagine que queremos também excluir seus produtos existentes (embora a outra opção seria simplesmente definir seus produtos `CategoryID` valores `NULL`).</span><span class="sxs-lookup"><span data-stu-id="94d1c-249">Should a category with products be deleted, imagine that we want to also delete its existing products (although another option would be to simply set its products `CategoryID` values to `NULL`).</span></span> <span data-ttu-id="94d1c-250">Essa funcionalidade pode ser implementada por meio das regras em cascata de restrição de chave estrangeira.</span><span class="sxs-lookup"><span data-stu-id="94d1c-250">This functionality could be implemented through the cascade rules of the foreign key constraint.</span></span> <span data-ttu-id="94d1c-251">Como alternativa, podemos pode criar um procedimento armazenado que aceita um `@CategoryID` parâmetro de entrada e, quando invocado, explicitamente exclui todos os produtos associados e, em seguida, a categoria especificada.</span><span class="sxs-lookup"><span data-stu-id="94d1c-251">Alternatively, we could create a stored procedure that accepts a `@CategoryID` input parameter and, when invoked, explicitly deletes all of the associated products and then the specified category.</span></span>

<span data-ttu-id="94d1c-252">Nossa primeira tentativa de tal procedimento armazenado pode parecer com o seguinte:</span><span class="sxs-lookup"><span data-stu-id="94d1c-252">Our first attempt at such a stored procedure might look like the following:</span></span>


[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample5.sql)]

<span data-ttu-id="94d1c-253">Enquanto isso definitivamente excluirá os produtos associados e a categoria, ele não faz isso sob o guarda-chuva de uma transação.</span><span class="sxs-lookup"><span data-stu-id="94d1c-253">While this will definitely delete the associated products and category, it does not do so under the umbrella of a transaction.</span></span> <span data-ttu-id="94d1c-254">Imagine que há outra restrição de chave estrangeira na `Categories` seria proibido a exclusão de um determinado `@CategoryID` valor.</span><span class="sxs-lookup"><span data-stu-id="94d1c-254">Imagine that there is some other foreign key constraint on `Categories` that would prohibit the deletion of a particular `@CategoryID` value.</span></span> <span data-ttu-id="94d1c-255">O problema é que nesse caso, todos os produtos serão excluídos antes de tentar a excluir a categoria.</span><span class="sxs-lookup"><span data-stu-id="94d1c-255">The problem is that in such a case all of the products will be deleted before we attempt to delete the category.</span></span> <span data-ttu-id="94d1c-256">O resultado líquido é que para a categoria, esse procedimento armazenado deve remover todos os seus produtos enquanto a categoria permaneceu, pois ele ainda tem registros relacionados de alguma outra tabela.</span><span class="sxs-lookup"><span data-stu-id="94d1c-256">The net result is that for such a category, this stored procedure would remove all of its products while the category remained since it still has related records in some other table.</span></span>

<span data-ttu-id="94d1c-257">Se o procedimento armazenado foram encapsulado dentro do escopo de uma transação, no entanto, as exclusões para o `Products` tabela seria revertida em caso de uma falha ao excluir no `Categories`.</span><span class="sxs-lookup"><span data-stu-id="94d1c-257">If the stored procedure were wrapped within the scope of a transaction, however, the deletes to the `Products` table would be rolled back in the face of a failed delete on `Categories`.</span></span> <span data-ttu-id="94d1c-258">O script de procedimento armazenado a seguir usa uma transação para garantir a atomicidade entre os dois `DELETE` instruções:</span><span class="sxs-lookup"><span data-stu-id="94d1c-258">The following stored procedure script uses a transaction to assure atomicity between the two `DELETE` statements:</span></span>


[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample6.sql)]

<span data-ttu-id="94d1c-259">Reserve um tempo para adicionar o `Categories_Delete` procedimento armazenado para o banco de dados Northwind.</span><span class="sxs-lookup"><span data-stu-id="94d1c-259">Take a moment to add the `Categories_Delete` stored procedure to the Northwind database.</span></span> <span data-ttu-id="94d1c-260">Voltar para a etapa 1 para obter instruções sobre como adicionar procedimentos armazenados para um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="94d1c-260">Refer back to Step 1 for instructions on adding stored procedures to a database.</span></span>

## <a name="step-6-updating-thecategoriestableadapter"></a><span data-ttu-id="94d1c-261">Etapa 6: Atualizando a`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="94d1c-261">Step 6: Updating the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="94d1c-262">Enquanto criamos adicionou o `Categories_Delete` procedimento armazenado no banco de dados, a DAL está atualmente configurado para usar instruções SQL ad hoc para executar a exclusão.</span><span class="sxs-lookup"><span data-stu-id="94d1c-262">While we ve added the `Categories_Delete` stored procedure to the database, the DAL is currently configured to use ad-hoc SQL statements to perform the delete.</span></span> <span data-ttu-id="94d1c-263">Precisamos atualizar o `CategoriesTableAdapter` e instruí-lo a usar o `Categories_Delete` procedimento armazenado em vez disso.</span><span class="sxs-lookup"><span data-stu-id="94d1c-263">We need to update the `CategoriesTableAdapter` and instruct it to use the `Categories_Delete` stored procedure instead.</span></span>

> [!NOTE]
> <span data-ttu-id="94d1c-264">Neste tutorial que estávamos trabalhando com o `NorthwindWithSprocs` conjunto de dados.</span><span class="sxs-lookup"><span data-stu-id="94d1c-264">Earlier in this tutorial we were working with the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="94d1c-265">Mas esse conjunto de dados tem apenas uma única entidade, `ProductsDataTable`, e precisamos trabalhar com categorias.</span><span class="sxs-lookup"><span data-stu-id="94d1c-265">But that DataSet only has a single entity, `ProductsDataTable`, and we need to work with categories.</span></span> <span data-ttu-id="94d1c-266">Portanto, para o restante deste tutorial, quando eu falar sobre o Data Access camada I m referindo-se à `Northwind` conjunto de dados, que primeiro criamos na [criando uma camada de acesso a dados](../introduction/creating-a-data-access-layer-cs.md) tutorial.</span><span class="sxs-lookup"><span data-stu-id="94d1c-266">Therefore, for the remainder of this tutorial when I talk about the Data Access Layer I m referring to the `Northwind` DataSet, the one that we first created in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial.</span></span>


<span data-ttu-id="94d1c-267">Abra o Northwind DataSet, selecione o `CategoriesTableAdapter`e vá para a janela Propriedades.</span><span class="sxs-lookup"><span data-stu-id="94d1c-267">Open the Northwind DataSet, select the `CategoriesTableAdapter`, and go to the Properties window.</span></span> <span data-ttu-id="94d1c-268">As listas de janela de propriedades de `InsertCommand`, `UpdateCommand`, `DeleteCommand`, e `SelectCommand` usados pelo TableAdapter, assim como suas informações de nome e a conexão.</span><span class="sxs-lookup"><span data-stu-id="94d1c-268">The Properties window lists the `InsertCommand`, `UpdateCommand`, `DeleteCommand`, and `SelectCommand` used by the TableAdapter, as well as its name and connection information.</span></span> <span data-ttu-id="94d1c-269">Expanda o `DeleteCommand` propriedade para ver seus detalhes.</span><span class="sxs-lookup"><span data-stu-id="94d1c-269">Expand the `DeleteCommand` property to see its details.</span></span> <span data-ttu-id="94d1c-270">Como mostra a Figura 15, o `DeleteCommand` s `ComamndType` estiver definida como texto, que instrui a enviar o texto no `CommandText` a propriedade como uma consulta SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="94d1c-270">As Figure 15 shows, the `DeleteCommand` s `ComamndType` property is set to Text, which instructs it to send the text in the `CommandText` property as an ad-hoc SQL query.</span></span>


![Selecione o CategoriesTableAdapter no Designer para exibir suas propriedades na janela Propriedades](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image43.png)

<span data-ttu-id="94d1c-272">**Figura 15**: selecione o `CategoriesTableAdapter` no Designer para exibir suas propriedades na janela Propriedades</span><span class="sxs-lookup"><span data-stu-id="94d1c-272">**Figure 15**: Select the `CategoriesTableAdapter` in the Designer to View Its Properties in the Properties Window</span></span>


<span data-ttu-id="94d1c-273">Para alterar essas configurações, selecione o texto (DeleteCommand) na janela Propriedades e escolha (novo) na lista suspensa.</span><span class="sxs-lookup"><span data-stu-id="94d1c-273">To change these settings, select the (DeleteCommand) text in the Properties window and choose (New) from the drop-down list.</span></span> <span data-ttu-id="94d1c-274">Isso limpará as configurações para o `CommandText`, `CommandType`, e `Parameters` propriedades.</span><span class="sxs-lookup"><span data-stu-id="94d1c-274">This will clear out the settings for the `CommandText`, `CommandType`, and `Parameters` properties.</span></span> <span data-ttu-id="94d1c-275">Em seguida, defina as `CommandType` propriedade para `StoredProcedure` e, em seguida, digite o nome do procedimento armazenado para o `CommandText` (`dbo.Categories_Delete`).</span><span class="sxs-lookup"><span data-stu-id="94d1c-275">Next, set the `CommandType` property to `StoredProcedure` and then type in the name of the stored procedure for the `CommandText` (`dbo.Categories_Delete`).</span></span> <span data-ttu-id="94d1c-276">Se você certifique-se de inserir as propriedades nesta ordem - pela primeira vez o `CommandType` e, em seguida, o `CommandText` -Visual Studio populará automaticamente a coleção de parâmetros.</span><span class="sxs-lookup"><span data-stu-id="94d1c-276">If you make sure to enter the properties in this order - first the `CommandType` and then the `CommandText` - Visual Studio will automatically populate the Parameters collection.</span></span> <span data-ttu-id="94d1c-277">Se você não inserir essas propriedades nesta ordem, você precisará adicionar manualmente os parâmetros por meio do Editor de coleção de parâmetros.</span><span class="sxs-lookup"><span data-stu-id="94d1c-277">If you do not enter these properties in this order, you will have to manually add the parameters through the Parameters Collection Editor.</span></span> <span data-ttu-id="94d1c-278">Em ambos os casos, ele s prudente clicar nas elipses na propriedade parâmetros para transferir anterior o Editor de coleção de parâmetros para verificar que as alterações de configurações de parâmetro corretos foram feitas (consulte a Figura 16).</span><span class="sxs-lookup"><span data-stu-id="94d1c-278">In either case, it s prudent to click on the ellipses in the Parameters property to bring up the Parameters Collection Editor to verify that the correct parameter settings changes have been made (see Figure 16).</span></span> <span data-ttu-id="94d1c-279">Se você não vir quaisquer parâmetros na caixa de diálogo, adicione a `@CategoryID` parâmetro manualmente (você não precisará adicionar o `@RETURN_VALUE` parâmetro).</span><span class="sxs-lookup"><span data-stu-id="94d1c-279">If you do not see any parameters in the dialog box, add the `@CategoryID` parameter manually (you do not need to add the `@RETURN_VALUE` parameter).</span></span>


![Certifique-se de que as configurações de parâmetros estão corretas](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image44.png)

<span data-ttu-id="94d1c-281">**Figura 16**: Certifique-se de que as configurações de parâmetros estão corretas</span><span class="sxs-lookup"><span data-stu-id="94d1c-281">**Figure 16**: Ensure That the Parameters Settings are Correct</span></span>


<span data-ttu-id="94d1c-282">Depois que a DAL tiver sido atualizada, excluir uma categoria automaticamente excluirá todos os seus produtos associados e fazê-lo sob o guarda-chuva de uma transação.</span><span class="sxs-lookup"><span data-stu-id="94d1c-282">Once the DAL has been updated, deleting a category will automatically delete all of its associated products and do so under the umbrella of a transaction.</span></span> <span data-ttu-id="94d1c-283">Para verificar isso e retornar à página atualizando e excluindo dados binários existentes e clique no botão Excluir para uma das categorias.</span><span class="sxs-lookup"><span data-stu-id="94d1c-283">To verify this, return to the Updating and Deleting Existing Binary Data page and click the Delete button for one of the categories.</span></span> <span data-ttu-id="94d1c-284">Com um único clique do mouse, a categoria e todos os seus produtos associados serão excluídos.</span><span class="sxs-lookup"><span data-stu-id="94d1c-284">With one single click of the mouse, the category and all of its associated products will be deleted.</span></span>

> [!NOTE]
> <span data-ttu-id="94d1c-285">Antes de testar o `Categories_Delete` procedimento armazenado, o que excluirá um número de produtos juntamente com a categoria selecionada, talvez seja prudente ao fazer uma cópia de backup do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="94d1c-285">Before testing the `Categories_Delete` stored procedure, which will delete a number of products along with the selected category, it might be prudent to make a backup copy of your database.</span></span> <span data-ttu-id="94d1c-286">Se você estiver usando o `NORTHWND.MDF` banco de dados no `App_Data`, basta fechar o Visual Studio e copie os arquivos MDF e LDF no `App_Data` para outra pasta.</span><span class="sxs-lookup"><span data-stu-id="94d1c-286">If you are using the `NORTHWND.MDF` database in `App_Data`, simply close Visual Studio and copy the MDF and LDF files in `App_Data` to some other folder.</span></span> <span data-ttu-id="94d1c-287">Depois de testar a funcionalidade, você pode restaurar o banco de dados fechando o Visual Studio e substituir atual MDF e LDF arquivos no `App_Data` com as cópias de backup.</span><span class="sxs-lookup"><span data-stu-id="94d1c-287">After testing the functionality, you can restore the database by closing Visual Studio and replacing the current MDF and LDF files in `App_Data` with the backup copies.</span></span>


## <a name="summary"></a><span data-ttu-id="94d1c-288">Resumo</span><span class="sxs-lookup"><span data-stu-id="94d1c-288">Summary</span></span>

<span data-ttu-id="94d1c-289">Enquanto o Assistente de s TableAdapter gerará automaticamente os procedimentos armazenados para nós, há vezes quando podemos pode já ter esses procedimentos armazenados criados ou deseja criá-las manualmente ou com outras ferramentas em vez disso.</span><span class="sxs-lookup"><span data-stu-id="94d1c-289">While the TableAdapter s wizard will automatically generate stored procedures for us, there are times when we might already have such stored procedures created or want to create them manually or with other tools instead.</span></span> <span data-ttu-id="94d1c-290">Para acomodar esses cenários, o TableAdapter também pode ser configurado para apontar para um procedimento armazenado existente.</span><span class="sxs-lookup"><span data-stu-id="94d1c-290">To accommodate such scenarios, the TableAdapter can also be configured to point to an existing stored procedure.</span></span> <span data-ttu-id="94d1c-291">Neste tutorial vimos como adicionar manualmente os procedimentos armazenados para um banco de dados por meio do ambiente do Visual Studio e como conectar os métodos do TableAdapter s a esses procedimentos armazenados.</span><span class="sxs-lookup"><span data-stu-id="94d1c-291">In this tutorial we looked at how to manually add stored procedures to a database through the Visual Studio environment and how to wire the TableAdapter s methods to these stored procedures.</span></span> <span data-ttu-id="94d1c-292">Também examinamos os comandos T-SQL e o padrão de script usado para iniciar, confirmar e reverter as transações de dentro de um procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="94d1c-292">We also examined the T-SQL commands and script pattern used for starting, committing, and rolling back transactions from within a stored procedure.</span></span>

<span data-ttu-id="94d1c-293">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="94d1c-293">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="94d1c-294">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="94d1c-294">About the Author</span></span>

<span data-ttu-id="94d1c-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de sete livros sobre ASP/ASP.NET e fundador da [4GuysFromRolla.com](http://www.4guysfromrolla.com), tem trabalhado com tecnologias Microsoft Web desde 1998.</span><span class="sxs-lookup"><span data-stu-id="94d1c-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="94d1c-296">Scott funciona como um consultor independente, instrutor e escritor.</span><span class="sxs-lookup"><span data-stu-id="94d1c-296">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="94d1c-297">Seu livro mais recente é [ *Sams Teach por conta própria ASP.NET 2.0 em 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="94d1c-297">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="94d1c-298">Ele pode ser contatado pelo [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="94d1c-298">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="94d1c-299">ou por meio de seu blog, que pode ser encontrado em [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="94d1c-299">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="94d1c-300">Agradecimentos especiais a</span><span class="sxs-lookup"><span data-stu-id="94d1c-300">Special Thanks To</span></span>

<span data-ttu-id="94d1c-301">Esta série de tutoriais foi revisada por muitos revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="94d1c-301">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="94d1c-302">Os revisores de avanço para este tutorial foram Geisenow Hilton, S ren Jacob Lauritsen e Teresa Murphy.</span><span class="sxs-lookup"><span data-stu-id="94d1c-302">Lead reviewers for this tutorial were Hilton Geisenow, S ren Jacob Lauritsen, and Teresa Murphy.</span></span> <span data-ttu-id="94d1c-303">Você está interessado na revisão Meus próximos artigos do MSDN?</span><span class="sxs-lookup"><span data-stu-id="94d1c-303">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="94d1c-304">Nesse caso, me descartar uma linha na [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="94d1c-304">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="94d1c-305">[Anterior](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)
> [Próximo](updating-the-tableadapter-to-use-joins-cs.md)</span><span class="sxs-lookup"><span data-stu-id="94d1c-305">[Previous](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)
[Next](updating-the-tableadapter-to-use-joins-cs.md)</span></span>
