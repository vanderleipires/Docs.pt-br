---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-vb
title: Tratamento de exceções de nível BLL e DAL (VB) | Microsoft Docs
author: rick-anderson
description: Neste tutorial, veremos como tactfully tratar as exceções geradas durante o fluxo de trabalho de atualização do DataList um editável.
ms.author: riande
ms.date: 10/30/2006
ms.assetid: ca665073-b379-4239-9404-f597663ca65e
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-vb
msc.type: authoredcontent
ms.openlocfilehash: e71ad365ecbfc1bb33117a6c93e7108a4b3866a6
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/16/2018
ms.locfileid: "41831043"
---
<a name="handling-bll--and-dal-level-exceptions-vb"></a><span data-ttu-id="dbce0-103">Tratamento de exceções de nível BLL e DAL (VB)</span><span class="sxs-lookup"><span data-stu-id="dbce0-103">Handling BLL- and DAL-Level Exceptions (VB)</span></span>
====================
<span data-ttu-id="dbce0-104">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="dbce0-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="dbce0-105">[Baixe o aplicativo de exemplo](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_VB.exe) ou [baixar PDF](handling-bll-and-dal-level-exceptions-vb/_static/datatutorial38vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="dbce0-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_VB.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-vb/_static/datatutorial38vb1.pdf)</span></span>

> <span data-ttu-id="dbce0-106">Neste tutorial, veremos como tactfully tratar as exceções geradas durante o fluxo de trabalho de atualização do DataList um editável.</span><span class="sxs-lookup"><span data-stu-id="dbce0-106">In this tutorial, we'll see how to tactfully handle exceptions raised during an editable DataList's updating workflow.</span></span>


## <a name="introduction"></a><span data-ttu-id="dbce0-107">Introdução</span><span class="sxs-lookup"><span data-stu-id="dbce0-107">Introduction</span></span>

<span data-ttu-id="dbce0-108">No [visão geral de edição e exclusão de dados no DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) tutorial, criamos uma DataList que oferecidos simples de edição e exclusão de recursos.</span><span class="sxs-lookup"><span data-stu-id="dbce0-108">In the [Overview of Editing and Deleting Data in the DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) tutorial, we created a DataList that offered simple editing and deleting capabilities.</span></span> <span data-ttu-id="dbce0-109">Embora seja totalmente funcional, foi mal amigável, como os erros ocorridos durante a edição ou exclusão de processo resultou em uma exceção sem tratamento.</span><span class="sxs-lookup"><span data-stu-id="dbce0-109">While fully functional, it was hardly user-friendly, as any error that occurred during the editing or deleting process resulted in an unhandled exception.</span></span> <span data-ttu-id="dbce0-110">Por exemplo, omitindo o nome do produto s ou, ao editar um produto, inserir um valor de preço de muito acessível!, gera uma exceção.</span><span class="sxs-lookup"><span data-stu-id="dbce0-110">For example, omitting the product s name or, when editing a product, entering a price value of Very affordable!, throws an exception.</span></span> <span data-ttu-id="dbce0-111">Uma vez que essa exceção não for capturada no código, ele propaga-se até o tempo de execução do ASP.NET, que, em seguida, exibe os detalhes da exceção s na página da web.</span><span class="sxs-lookup"><span data-stu-id="dbce0-111">Since this exception is not caught in code, it bubbles up to the ASP.NET runtime, which then displays the exception s details in the web page.</span></span>

<span data-ttu-id="dbce0-112">Como vimos na [tratamento BLL - e exceções de nível DAL em uma página ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, se uma exceção for gerada das profundezas da lógica de negócios ou camadas de acesso de dados, os detalhes da exceção são retornados para o ObjectDataSource e em seguida, para o GridView.</span><span class="sxs-lookup"><span data-stu-id="dbce0-112">As we saw in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, if an exception is raised from the depths of the Business Logic or Data Access Layers, the exception details are returned to the ObjectDataSource and then to the GridView.</span></span> <span data-ttu-id="dbce0-113">Vimos como lidar normalmente com essas exceções, criando `Updated` ou `RowUpdated` manipuladores de eventos para o ObjectDataSource ou GridView, verificando uma exceção e, em seguida, indicando que a exceção foi tratada.</span><span class="sxs-lookup"><span data-stu-id="dbce0-113">We saw how to gracefully handle these exceptions by creating `Updated` or `RowUpdated` event handlers for the ObjectDataSource or GridView, checking for an exception, and then indicating that the exception was handled.</span></span>

<span data-ttu-id="dbce0-114">Nossos DataList tutoriais, no entanto, t não estão usando o ObjectDataSource para atualizar e excluir dados.</span><span class="sxs-lookup"><span data-stu-id="dbce0-114">Our DataList tutorials, however, aren t using the ObjectDataSource for updating and deleting data.</span></span> <span data-ttu-id="dbce0-115">Em vez disso, estamos trabalhando diretamente em relação a BLL.</span><span class="sxs-lookup"><span data-stu-id="dbce0-115">Instead, we are working directly against the BLL.</span></span> <span data-ttu-id="dbce0-116">Para detectar exceções originadas da BLL ou DAL, precisamos implementar o código no code-behind da página ASP.NET de tratamento de exceções.</span><span class="sxs-lookup"><span data-stu-id="dbce0-116">In order to detect exceptions originating from the BLL or DAL, we need to implement exception handling code within the code-behind of our ASP.NET page.</span></span> <span data-ttu-id="dbce0-117">Neste tutorial, veremos como mais tactfully tratar as exceções geradas durante um s DataList editável atualizando fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="dbce0-117">In this tutorial, we'll see how to more tactfully handle exceptions raised during an editable DataList s updating workflow.</span></span>

> [!NOTE]
> <span data-ttu-id="dbce0-118">No *An de visão geral de edição e exclusão de dados no DataList* envolvido de algumas técnicas de tutorial discutimos diferentes técnicas para edição e exclusão de dados do DataList, usando um ObjectDataSource para a atualização e a exclusão.</span><span class="sxs-lookup"><span data-stu-id="dbce0-118">In the *An Overview of Editing and Deleting Data in the DataList* tutorial we discussed different techniques for editing and deleting data from the DataList, Some techniques involved using an ObjectDataSource for updating and deleting.</span></span> <span data-ttu-id="dbce0-119">Se você usar essas técnicas, você pode tratar exceções da BLL ou DAL por meio de s ObjectDataSource `Updated` ou `Deleted` manipuladores de eventos.</span><span class="sxs-lookup"><span data-stu-id="dbce0-119">If you employ these techniques, you can handle exceptions from the BLL or DAL through the ObjectDataSource s `Updated` or `Deleted` event handlers.</span></span>


## <a name="step-1-creating-an-editable-datalist"></a><span data-ttu-id="dbce0-120">Etapa 1: Criando um DataList editável</span><span class="sxs-lookup"><span data-stu-id="dbce0-120">Step 1: Creating an Editable DataList</span></span>

<span data-ttu-id="dbce0-121">Antes de nos preocupamos com tratamento de exceções que ocorrem durante o fluxo de trabalho de atualização, deixe s primeiro criar uma DataList editável.</span><span class="sxs-lookup"><span data-stu-id="dbce0-121">Before we worry about handling exceptions that occur during the updating workflow, let s first create an editable DataList.</span></span> <span data-ttu-id="dbce0-122">Abra o `ErrorHandling.aspx` página na `EditDeleteDataList` pasta, adicionar uma DataList ao Designer de conjunto seu `ID` propriedade a ser `Products`, e adicione um novo ObjectDataSource chamado `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="dbce0-122">Open the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder, add a DataList to the Designer, set its `ID` property to `Products`, and add a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="dbce0-123">Configurar o ObjectDataSource para usar o `ProductsBLL` classe s `GetProducts()` método para selecionar registros; definir as listas suspensas em INSERT, UPDATE e excluir guias como (nenhum).</span><span class="sxs-lookup"><span data-stu-id="dbce0-123">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProducts()` method for selecting records; set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>


<span data-ttu-id="dbce0-124">[![Retornar as informações de produto usando o método GetProducts()](handling-bll-and-dal-level-exceptions-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="dbce0-124">[![Return the Product Information Using the GetProducts() Method](handling-bll-and-dal-level-exceptions-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-vb/_static/image1.png)</span></span>

<span data-ttu-id="dbce0-125">**Figura 1**: retornar as informações de produto usando o `GetProducts()` método ([clique para exibir a imagem em tamanho normal](handling-bll-and-dal-level-exceptions-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="dbce0-125">**Figure 1**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image3.png))</span></span>


<span data-ttu-id="dbce0-126">Depois de concluir o assistente ObjectDataSource, Visual Studio criará automaticamente um `ItemTemplate` para DataList.</span><span class="sxs-lookup"><span data-stu-id="dbce0-126">After completing the ObjectDataSource wizard, Visual Studio will automatically create an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="dbce0-127">Substitua-o por um `ItemTemplate` que exibe o nome do produto s e o preço e inclui um botão Editar.</span><span class="sxs-lookup"><span data-stu-id="dbce0-127">Replace this with an `ItemTemplate` that displays each product s name and price and includes an Edit button.</span></span> <span data-ttu-id="dbce0-128">Em seguida, crie um `EditItemTemplate` com um controle de TextBox Web para o nome e o preço e botões de atualização e Cancelar.</span><span class="sxs-lookup"><span data-stu-id="dbce0-128">Next, create an `EditItemTemplate` with a TextBox Web control for name and price and Update and Cancel buttons.</span></span> <span data-ttu-id="dbce0-129">Por fim, defina DataList s `RepeatColumns` propriedade como 2.</span><span class="sxs-lookup"><span data-stu-id="dbce0-129">Finally, set the DataList s `RepeatColumns` property to 2.</span></span>

<span data-ttu-id="dbce0-130">Após essas alterações, sua marcação declarativa de s de página deve ser semelhante ao seguinte.</span><span class="sxs-lookup"><span data-stu-id="dbce0-130">After these changes, your page s declarative markup should look similar to the following.</span></span> <span data-ttu-id="dbce0-131">Verifique novamente para fazer a certeza de que a edição, cancelar, e botões de atualização têm seus `CommandName` propriedades definidas para editar, cancelar e atualizar, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="dbce0-131">Double-check to make certain that the Edit, Cancel, and Update buttons have their `CommandName` properties set to Edit, Cancel, and Update, respectively.</span></span>


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="dbce0-132">Para este tutorial DataList o estado de exibição s deve ser habilitado.</span><span class="sxs-lookup"><span data-stu-id="dbce0-132">For this tutorial the DataList s view state must be enabled.</span></span>


<span data-ttu-id="dbce0-133">Reserve um tempo para exibir nosso progresso através de um navegador (veja a Figura 2).</span><span class="sxs-lookup"><span data-stu-id="dbce0-133">Take a moment to view our progress through a browser (see Figure 2).</span></span>


<span data-ttu-id="dbce0-134">[![Cada produto inclui um botão Editar](handling-bll-and-dal-level-exceptions-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="dbce0-134">[![Each Product Includes an Edit Button](handling-bll-and-dal-level-exceptions-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-vb/_static/image4.png)</span></span>

<span data-ttu-id="dbce0-135">**Figura 2**: cada produto inclui um botão Editar ([clique para exibir a imagem em tamanho normal](handling-bll-and-dal-level-exceptions-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="dbce0-135">**Figure 2**: Each Product Includes an Edit Button ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image6.png))</span></span>


<span data-ttu-id="dbce0-136">Atualmente, o botão Editar apenas faz com que um postback-t ainda tornam o produto editável.</span><span class="sxs-lookup"><span data-stu-id="dbce0-136">Currently, the Edit button only causes a postback it doesn t yet make the product editable.</span></span> <span data-ttu-id="dbce0-137">Para habilitar a edição, precisamos criar manipuladores de eventos para o s DataList `EditCommand`, `CancelCommand`, e `UpdateCommand` eventos.</span><span class="sxs-lookup"><span data-stu-id="dbce0-137">To enable editing, we need to create event handlers for the DataList s `EditCommand`, `CancelCommand`, and `UpdateCommand` events.</span></span> <span data-ttu-id="dbce0-138">O `EditCommand` e `CancelCommand` eventos simplesmente atualizar DataList s `EditItemIndex` reassociar os dados para o DataList e propriedade:</span><span class="sxs-lookup"><span data-stu-id="dbce0-138">The `EditCommand` and `CancelCommand` events simply update the DataList s `EditItemIndex` property and rebind the data to the DataList:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample2.vb)]

<span data-ttu-id="dbce0-139">O `UpdateCommand` manipulador de eventos é um pouco mais complicado.</span><span class="sxs-lookup"><span data-stu-id="dbce0-139">The `UpdateCommand` event handler is a bit more involved.</span></span> <span data-ttu-id="dbce0-140">Ele precisa ler no produto editado s `ProductID` do `DataKeys` coleção juntamente com o nome do produto s e o preço de TextBoxes a `EditItemTemplate`e, em seguida, chame o `ProductsBLL` classe s `UpdateProduct` método antes de retornar do DataList para seu estado de edição previamente.</span><span class="sxs-lookup"><span data-stu-id="dbce0-140">It needs to read in the edited product s `ProductID` from the `DataKeys` collection along with the product s name and price from the TextBoxes in the `EditItemTemplate`, and then call the `ProductsBLL` class s `UpdateProduct` method before returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="dbce0-141">Por enquanto, let s apenas usar o mesmo código do `UpdateCommand` manipulador de eventos em de *visão geral de edição e exclusão de dados no DataList* tutorial.</span><span class="sxs-lookup"><span data-stu-id="dbce0-141">For now, let s just use the exact same code from the `UpdateCommand` event handler in the *Overview of Editing and Deleting Data in the DataList* tutorial.</span></span> <span data-ttu-id="dbce0-142">Adicionaremos o código para tratar normalmente exceções na etapa 2.</span><span class="sxs-lookup"><span data-stu-id="dbce0-142">We'll add the code to gracefully handle exceptions in step 2.</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample3.vb)]

<span data-ttu-id="dbce0-143">Diante de uma entrada inválida, que pode ser na forma de um preço de unidade formatada incorretamente, um valor de preço de unidade ilegal, como - US $5,00 ou a omissão do nome de s do produto, que uma exceção será gerada.</span><span class="sxs-lookup"><span data-stu-id="dbce0-143">In the face of invalid input which can be in the form of an improperly formatted unit price, an illegal unit price value like -$5.00, or the omission of the product s name an exception will be raised.</span></span> <span data-ttu-id="dbce0-144">Uma vez que o `UpdateCommand` manipulador de eventos não inclui qualquer neste ponto de código de tratamento de exceção, a exceção serão propagados o tempo de execução do ASP.NET, onde ele será exibido para o usuário final (veja a Figura 3).</span><span class="sxs-lookup"><span data-stu-id="dbce0-144">Since the `UpdateCommand` event handler does not include any exception handling code at this point, the exception will bubble up to the ASP.NET runtime, where it will be displayed to the end user (see Figure 3).</span></span>


![Quando ocorre uma exceção sem tratamento, o usuário final vê uma página de erro](handling-bll-and-dal-level-exceptions-vb/_static/image7.png)

<span data-ttu-id="dbce0-146">**Figura 3**: quando ocorre uma exceção sem tratamento, o usuário final vê uma página de erro</span><span class="sxs-lookup"><span data-stu-id="dbce0-146">**Figure 3**: When an Unhandled Exception Occurs, the End User Sees an Error Page</span></span>


## <a name="step-2-gracefully-handling-exceptions-in-the-updatecommand-event-handler"></a><span data-ttu-id="dbce0-147">Etapa 2: Normalmente tratamento de exceções no manipulador de eventos UpdateCommand</span><span class="sxs-lookup"><span data-stu-id="dbce0-147">Step 2: Gracefully Handling Exceptions in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="dbce0-148">Durante o fluxo de trabalho de atualização, poderão ocorrer exceções no `UpdateCommand` a DAL, a BLL ou manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="dbce0-148">During the updating workflow, exceptions can occur in the `UpdateCommand` event handler, the BLL, or the DAL.</span></span> <span data-ttu-id="dbce0-149">Por exemplo, se um usuário inserir um preço de muito caro, o `Decimal.Parse` instrução na `UpdateCommand` lançará o manipulador de eventos um `FormatException` exceção.</span><span class="sxs-lookup"><span data-stu-id="dbce0-149">For example, if a user enters a price of Too expensive, the `Decimal.Parse` statement in the `UpdateCommand` event handler will throw a `FormatException` exception.</span></span> <span data-ttu-id="dbce0-150">Se o usuário omite o nome do produto s ou se o preço tem um valor negativo, a DAL irá gerar uma exceção.</span><span class="sxs-lookup"><span data-stu-id="dbce0-150">If the user omits the product s name or if the price has a negative value, the DAL will raise an exception.</span></span>

<span data-ttu-id="dbce0-151">Quando ocorre uma exceção, queremos exibir uma mensagem informativa da página em si.</span><span class="sxs-lookup"><span data-stu-id="dbce0-151">When an exception occurs, we want to display an informative message within the page itself.</span></span> <span data-ttu-id="dbce0-152">Adicionar uma Web de rótulo de controle para a página cuja `ID` é definido como `ExceptionDetails`.</span><span class="sxs-lookup"><span data-stu-id="dbce0-152">Add a Label Web control to the page whose `ID` is set to `ExceptionDetails`.</span></span> <span data-ttu-id="dbce0-153">Configurar o texto do rótulo s para exibir em vermelho, extra grande, a fonte em negrito e itálico, atribuindo suas `CssClass` propriedade para o `Warning` classe CSS, que é definido no `Styles.css` arquivo.</span><span class="sxs-lookup"><span data-stu-id="dbce0-153">Configure the Label s text to display in a red, extra-large, bold and italic font by assigning its `CssClass` property to the `Warning` CSS class, which is defined in the `Styles.css` file.</span></span>

<span data-ttu-id="dbce0-154">Quando ocorre um erro, só queremos o rótulo a ser exibido uma vez.</span><span class="sxs-lookup"><span data-stu-id="dbce0-154">When an error occurs, we only want the Label to be displayed once.</span></span> <span data-ttu-id="dbce0-155">Ou seja, em postbacks subsequentes, a mensagem de aviso de rótulo s deve desaparecer.</span><span class="sxs-lookup"><span data-stu-id="dbce0-155">That is, on subsequent postbacks, the Label s warning message should disappear.</span></span> <span data-ttu-id="dbce0-156">Isso pode ser feito limpando qualquer rótulo s `Text` propriedade ou as configurações de seu `Visible` propriedade a ser `False` no `Page_Load` manipulador de eventos (como fizemos no [BLL tratando - e exceções de nível DAL em um ASP Página do .NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial) ou desativando o suporte de estado de exibição de rótulo s.</span><span class="sxs-lookup"><span data-stu-id="dbce0-156">This can be accomplished by either clearing out the Label s `Text` property or settings its `Visible` property to `False` in the `Page_Load` event handler (as we did back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial) or by disabling the Label s view state support.</span></span> <span data-ttu-id="dbce0-157">Permitir que o s use a última opção.</span><span class="sxs-lookup"><span data-stu-id="dbce0-157">Let s use the latter option.</span></span>


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample4.aspx)]

<span data-ttu-id="dbce0-158">Quando uma exceção é gerada, vamos atribuir os detalhes da exceção para o `ExceptionDetails` s de controle de rótulo `Text` propriedade.</span><span class="sxs-lookup"><span data-stu-id="dbce0-158">When an exception is raised, we'll assign the details of the exception to the `ExceptionDetails` Label control s `Text` property.</span></span> <span data-ttu-id="dbce0-159">Uma vez que seu estado de exibição estiver desabilitado, em postbacks subsequentes a `Text` alterações programáticas de propriedade s serão perdidas, reverter para o texto padrão (uma cadeia de caracteres vazia), ocultando assim a mensagem de aviso.</span><span class="sxs-lookup"><span data-stu-id="dbce0-159">Since its view state is disabled, on subsequent postbacks the `Text` property s programmatic changes will be lost, reverting back to the default text (an empty string), thereby hiding the warning message.</span></span>

<span data-ttu-id="dbce0-160">Para determinar quando um erro foi ativado para exibir uma mensagem útil na página, precisamos adicionar um `Try ... Catch` bloco para o `UpdateCommand` manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="dbce0-160">To determine when an error has been raised in order to display a helpful message on the page, we need to add a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="dbce0-161">O `Try` parte contém o código que pode levar a uma exceção, enquanto o `Catch` bloco contém código que é executado diante de uma exceção.</span><span class="sxs-lookup"><span data-stu-id="dbce0-161">The `Try` portion contains code that may lead to an exception, while the `Catch` block contains code that is executed in the face of an exception.</span></span> <span data-ttu-id="dbce0-162">Confira o [conceitos básicos de manipulação de exceção](https://msdn.microsoft.com/library/2w8f0bss.aspx) seção na documentação do .NET Framework para obter mais informações sobre o `Try ... Catch` bloco.</span><span class="sxs-lookup"><span data-stu-id="dbce0-162">Check out the [Exception Handling Fundamentals](https://msdn.microsoft.com/library/2w8f0bss.aspx) section in the .NET Framework documentation for more information on the `Try ... Catch` block.</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample5.vb)]

<span data-ttu-id="dbce0-163">Quando uma exceção de qualquer tipo é lançada pelo código dentro de `Try` bloco, o `Catch` código do bloco s inicia a execução.</span><span class="sxs-lookup"><span data-stu-id="dbce0-163">When an exception of any type is thrown by code within the `Try` block, the `Catch` block s code will begin executing.</span></span> <span data-ttu-id="dbce0-164">O tipo de exceção que é lançada `DbException`, `NoNullAllowedException`, `ArgumentException`e assim por diante depende de qual, exatamente, precipitou o erro em primeiro lugar.</span><span class="sxs-lookup"><span data-stu-id="dbce0-164">The type of exception that is thrown `DbException`, `NoNullAllowedException`, `ArgumentException`, and so on depends on what, exactly, precipitated the error in the first place.</span></span> <span data-ttu-id="dbce0-165">Se há um problema de s no nível do banco de dados, um `DbException` será lançada.</span><span class="sxs-lookup"><span data-stu-id="dbce0-165">If there s a problem at the database level, a `DbException` will be thrown.</span></span> <span data-ttu-id="dbce0-166">Se um valor inválido for inserido para o `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, ou `ReorderLevel` campos, uma `ArgumentException` será gerada, como adicionamos código para validar esses valores de campo no `ProductsDataTable` classe (consulte a [ Criando uma camada de lógica de negócios](../introduction/creating-a-business-logic-layer-vb.md) tutorial).</span><span class="sxs-lookup"><span data-stu-id="dbce0-166">If an illegal value is entered for the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` fields, an `ArgumentException` will be thrown, as we added code to validate these field values in the `ProductsDataTable` class (see the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial).</span></span>

<span data-ttu-id="dbce0-167">Podemos fornecer uma explicação mais úteis para o usuário final baseando-se o texto da mensagem no tipo de exceção capturada.</span><span class="sxs-lookup"><span data-stu-id="dbce0-167">We can provide a more helpful explanation to the end user by basing the message text on the type of exception caught.</span></span> <span data-ttu-id="dbce0-168">O seguinte código que foi usado de forma praticamente idêntica volta a [tratamento BLL - e exceções de nível DAL em uma página ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial fornece esse nível de detalhe:</span><span class="sxs-lookup"><span data-stu-id="dbce0-168">The following code which was used in a nearly identical form back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial provides this level of detail:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample6.vb)]

<span data-ttu-id="dbce0-169">Para concluir este tutorial, simplesmente chame o `DisplayExceptionDetails` método a partir de `Catch` bloco passando capturado `Exception` instância (`ex`).</span><span class="sxs-lookup"><span data-stu-id="dbce0-169">To complete this tutorial, simply call the `DisplayExceptionDetails` method from the `Catch` block passing in the caught `Exception` instance (`ex`).</span></span>

<span data-ttu-id="dbce0-170">Com o `Try ... Catch` bloquear em vigor, os usuários são apresentados com uma mensagem de erro mais informativa, como as figuras 4 e 5 show.</span><span class="sxs-lookup"><span data-stu-id="dbce0-170">With the `Try ... Catch` block in place, users are presented with a more informative error message, as Figures 4 and 5 show.</span></span> <span data-ttu-id="dbce0-171">Observe que, diante de uma exceção DataList permanece no modo de edição.</span><span class="sxs-lookup"><span data-stu-id="dbce0-171">Note that in the face of an exception the DataList remains in edit mode.</span></span> <span data-ttu-id="dbce0-172">Isso ocorre porque quando a exceção ocorre, o fluxo de controle é imediatamente redirecionado para o `Catch` bloco, ignorando o código que retorna DataList para seu estado de edição previamente.</span><span class="sxs-lookup"><span data-stu-id="dbce0-172">This is because once the exception occurs, the control flow is immediately redirected to the `Catch` block, bypassing the code that returns the DataList to its pre-editing state.</span></span>


<span data-ttu-id="dbce0-173">[![Uma mensagem de erro será exibida se um usuário omite um campo obrigatório](handling-bll-and-dal-level-exceptions-vb/_static/image9.png)](handling-bll-and-dal-level-exceptions-vb/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="dbce0-173">[![An Error Message is Displayed if a User Omits a Required Field](handling-bll-and-dal-level-exceptions-vb/_static/image9.png)](handling-bll-and-dal-level-exceptions-vb/_static/image8.png)</span></span>

<span data-ttu-id="dbce0-174">**Figura 4**: uma mensagem de erro será exibida se um usuário omite um campo obrigatório ([clique para exibir a imagem em tamanho normal](handling-bll-and-dal-level-exceptions-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="dbce0-174">**Figure 4**: An Error Message is Displayed if a User Omits a Required Field ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image10.png))</span></span>


<span data-ttu-id="dbce0-175">[![Uma mensagem de erro é exibido ao inserir um preço negativo](handling-bll-and-dal-level-exceptions-vb/_static/image12.png)](handling-bll-and-dal-level-exceptions-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="dbce0-175">[![An Error Message is Displayed When Entering a Negative Price](handling-bll-and-dal-level-exceptions-vb/_static/image12.png)](handling-bll-and-dal-level-exceptions-vb/_static/image11.png)</span></span>

<span data-ttu-id="dbce0-176">**Figura 5**: uma mensagem de erro é exibido ao inserir um preço negativo ([clique para exibir a imagem em tamanho normal](handling-bll-and-dal-level-exceptions-vb/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="dbce0-176">**Figure 5**: An Error Message is Displayed When Entering a Negative Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image13.png))</span></span>


## <a name="summary"></a><span data-ttu-id="dbce0-177">Resumo</span><span class="sxs-lookup"><span data-stu-id="dbce0-177">Summary</span></span>

<span data-ttu-id="dbce0-178">O GridView e ObjectDataSource oferecem manipuladores de evento de pós-nível que incluem informações sobre quaisquer exceções que foram geradas durante o fluxo de trabalho de atualização e exclusão, bem como as propriedades que podem ser definidas para indicar se a exceção tiver sido manipulado.</span><span class="sxs-lookup"><span data-stu-id="dbce0-178">The GridView and ObjectDataSource provide post-level event handlers that include information about any exceptions that were raised during the updating and deleting workflow, as well as properties that can be set to indicate whether or not the exception has been handled.</span></span> <span data-ttu-id="dbce0-179">Esses recursos, no entanto, não estão disponíveis ao trabalhar com o DataList e usando a BLL diretamente.</span><span class="sxs-lookup"><span data-stu-id="dbce0-179">These features, however, are unavailable when working with the DataList and using the BLL directly.</span></span> <span data-ttu-id="dbce0-180">Em vez disso, somos responsáveis por implementar o tratamento de exceção.</span><span class="sxs-lookup"><span data-stu-id="dbce0-180">Instead, we are responsible for implementing exception handling.</span></span>

<span data-ttu-id="dbce0-181">Neste tutorial vimos como adicionar tratamento de exceções para um s DataList editável atualizar o fluxo de trabalho adicionando um `Try ... Catch` bloco para o `UpdateCommand` manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="dbce0-181">In this tutorial we saw how to add exception handling to an editable DataList s updating workflow by adding a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="dbce0-182">Se uma exceção for gerada durante o fluxo de trabalho de atualização, o `Catch` s de bloco de código é executado, exibindo informações úteis no `ExceptionDetails` rótulo.</span><span class="sxs-lookup"><span data-stu-id="dbce0-182">If an exception is raised during the updating workflow, the `Catch` block s code executes, displaying helpful information in the `ExceptionDetails` Label.</span></span>

<span data-ttu-id="dbce0-183">Neste ponto, DataList não faz nenhum esforço para impedir exceções aconteçam em primeiro lugar.</span><span class="sxs-lookup"><span data-stu-id="dbce0-183">At this point, the DataList makes no effort to prevent exceptions from happening in the first place.</span></span> <span data-ttu-id="dbce0-184">Mesmo que nós sabemos que um preço negativo resultará em uma exceção, podemos foram t ainda qualquer funcionalidade adicionada para proativamente impedir que um usuário insira essa entrada inválida.</span><span class="sxs-lookup"><span data-stu-id="dbce0-184">Even though we know that a negative price will result in an exception, we haven t yet added any functionality to proactively prevent a user from entering such invalid input.</span></span> <span data-ttu-id="dbce0-185">Em nosso próximo tutorial, veremos como ajudar a reduzir as exceções causadas pela entrada de usuário inválido, adicionando controles de validação no `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="dbce0-185">In our next tutorial we'll see how to help reduce the exceptions caused by invalid user input by adding validation controls in the `EditItemTemplate`.</span></span>

<span data-ttu-id="dbce0-186">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="dbce0-186">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="dbce0-187">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="dbce0-187">Further Reading</span></span>

<span data-ttu-id="dbce0-188">Para obter mais informações sobre os tópicos abordados neste tutorial, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="dbce0-188">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="dbce0-189">Diretrizes de design para exceções</span><span class="sxs-lookup"><span data-stu-id="dbce0-189">Design Guidelines for Exceptions</span></span>](https://msdn.microsoft.com/library/ms298399.aspx)
- <span data-ttu-id="dbce0-190">[Módulos de log de erros e manipuladores (ELMAH)](http://workspaces.gotdotnet.com/elmah) (uma biblioteca de código-fonte aberto para o log de erros)</span><span class="sxs-lookup"><span data-stu-id="dbce0-190">[Error Logging Modules and Handlers (ELMAH)](http://workspaces.gotdotnet.com/elmah) (an open-source library for logging errors)</span></span>
- <span data-ttu-id="dbce0-191">[A Enterprise Library para o .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (inclui o Exception Management Application Block)</span><span class="sxs-lookup"><span data-stu-id="dbce0-191">[Enterprise Library for .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (includes the Exception Management Application Block)</span></span>

## <a name="about-the-author"></a><span data-ttu-id="dbce0-192">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="dbce0-192">About the Author</span></span>

<span data-ttu-id="dbce0-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de sete livros sobre ASP/ASP.NET e fundador da [4GuysFromRolla.com](http://www.4guysfromrolla.com), tem trabalhado com tecnologias Microsoft Web desde 1998.</span><span class="sxs-lookup"><span data-stu-id="dbce0-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="dbce0-194">Scott funciona como um consultor independente, instrutor e escritor.</span><span class="sxs-lookup"><span data-stu-id="dbce0-194">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="dbce0-195">Seu livro mais recente é [ *Sams Teach por conta própria ASP.NET 2.0 em 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="dbce0-195">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="dbce0-196">Ele pode ser contatado pelo [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="dbce0-196">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="dbce0-197">ou por meio de seu blog, que pode ser encontrado em [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="dbce0-197">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="dbce0-198">Agradecimentos especiais a</span><span class="sxs-lookup"><span data-stu-id="dbce0-198">Special Thanks To</span></span>

<span data-ttu-id="dbce0-199">Esta série de tutoriais foi revisada por muitos revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="dbce0-199">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="dbce0-200">Revisor de avanço para este tutorial foi Ken Pespisa.</span><span class="sxs-lookup"><span data-stu-id="dbce0-200">Lead reviewer for this tutorial was Ken Pespisa.</span></span> <span data-ttu-id="dbce0-201">Você está interessado na revisão Meus próximos artigos do MSDN?</span><span class="sxs-lookup"><span data-stu-id="dbce0-201">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="dbce0-202">Nesse caso, me descartar uma linha na [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="dbce0-202">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="dbce0-203">[Anterior](performing-batch-updates-vb.md)
> [Próximo](adding-validation-controls-to-the-datalist-s-editing-interface-vb.md)</span><span class="sxs-lookup"><span data-stu-id="dbce0-203">[Previous](performing-batch-updates-vb.md)
[Next](adding-validation-controls-to-the-datalist-s-editing-interface-vb.md)</span></span>
