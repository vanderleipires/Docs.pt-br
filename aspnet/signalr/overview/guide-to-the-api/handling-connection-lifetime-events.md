---
uid: signalr/overview/guide-to-the-api/handling-connection-lifetime-events
title: Noções básicas sobre e manipular eventos de tempo de vida de Conexão no SignalR | Microsoft Docs
author: pfletcher
description: Este artigo descreve como usar os eventos expostos pela API de Hubs.
ms.author: riande
ms.date: 06/10/2014
ms.assetid: 03960de2-8d95-4444-9169-4426dcc64913
msc.legacyurl: /signalr/overview/guide-to-the-api/handling-connection-lifetime-events
msc.type: authoredcontent
ms.openlocfilehash: 1783a3ab292a5460d5cc1b7ad78073071d65d379
ms.sourcegitcommit: a4dcca4f1cb81227c5ed3c92dc0e28be6e99447b
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/10/2018
ms.locfileid: "48911925"
---
<a name="understanding-and-handling-connection-lifetime-events-in-signalr"></a><span data-ttu-id="d06cd-103">Noções básicas sobre e manipular eventos de tempo de vida de Conexão no SignalR</span><span class="sxs-lookup"><span data-stu-id="d06cd-103">Understanding and Handling Connection Lifetime Events in SignalR</span></span>
====================
<span data-ttu-id="d06cd-104">por [Patrick Fletcher](https://github.com/pfletcher), [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="d06cd-104">by [Patrick Fletcher](https://github.com/pfletcher), [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="d06cd-105">Este artigo fornece uma visão geral de como os eventos de conexão, a reconexão e a desconexão do SignalR que você pode manipular e configurações de tempo limite e keepalive que você pode configurar.</span><span class="sxs-lookup"><span data-stu-id="d06cd-105">This article provides an overview of the SignalR connection, reconnection, and disconnection events that you can handle, and timeout and keepalive settings that you can configure.</span></span>
>
> <span data-ttu-id="d06cd-106">O artigo supõe que você já tem algum conhecimento dos eventos de tempo de vida do SignalR e conexão.</span><span class="sxs-lookup"><span data-stu-id="d06cd-106">The article assumes you already have some knowledge of SignalR and connection lifetime events.</span></span> <span data-ttu-id="d06cd-107">Para obter uma introdução ao SignalR, consulte [Introdução ao SignalR](../getting-started/introduction-to-signalr.md).</span><span class="sxs-lookup"><span data-stu-id="d06cd-107">For an introduction to SignalR, see [Introduction to SignalR](../getting-started/introduction-to-signalr.md).</span></span> <span data-ttu-id="d06cd-108">Para listas de eventos de tempo de vida de conexão, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="d06cd-108">For lists of connection lifetime events, see the following resources:</span></span>
>
> - [<span data-ttu-id="d06cd-109">Como manipular eventos de tempo de vida de conexão na classe Hub</span><span class="sxs-lookup"><span data-stu-id="d06cd-109">How to handle connection lifetime events in the Hub class</span></span>](hubs-api-guide-server.md#connectionlifetime)
> - [<span data-ttu-id="d06cd-110">Como manipular eventos de tempo de vida de conexão nos clientes JavaScript</span><span class="sxs-lookup"><span data-stu-id="d06cd-110">How to handle connection lifetime events in JavaScript clients</span></span>](hubs-api-guide-javascript-client.md#connectionlifetime)
> - [<span data-ttu-id="d06cd-111">Como manipular eventos de tempo de vida de conexão em clientes .NET</span><span class="sxs-lookup"><span data-stu-id="d06cd-111">How to handle connection lifetime events in .NET clients</span></span>](hubs-api-guide-net-client.md#connectionlifetime)
>
> ## <a name="software-versions-used-in-this-topic"></a><span data-ttu-id="d06cd-112">Versões de software usadas neste tópico</span><span class="sxs-lookup"><span data-stu-id="d06cd-112">Software versions used in this topic</span></span>
>
>
> - [<span data-ttu-id="d06cd-113">Visual Studio 2013</span><span class="sxs-lookup"><span data-stu-id="d06cd-113">Visual Studio 2013</span></span>](https://my.visualstudio.com/Downloads?q=visual%20studio%202013)
> - <span data-ttu-id="d06cd-114">.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="d06cd-114">.NET 4.5</span></span>
> - <span data-ttu-id="d06cd-115">Versão 2 do SignalR</span><span class="sxs-lookup"><span data-stu-id="d06cd-115">SignalR version 2</span></span>
>
>
>
> ## <a name="previous-versions-of-this-topic"></a><span data-ttu-id="d06cd-116">Versões anteriores deste tópico</span><span class="sxs-lookup"><span data-stu-id="d06cd-116">Previous versions of this topic</span></span>
>
> <span data-ttu-id="d06cd-117">Para obter informações sobre versões anteriores do SignalR, consulte [versões mais antigas do SignalR](../older-versions/index.md).</span><span class="sxs-lookup"><span data-stu-id="d06cd-117">For information about earlier versions of SignalR, see [SignalR Older Versions](../older-versions/index.md).</span></span>
>
> ## <a name="questions-and-comments"></a><span data-ttu-id="d06cd-118">Perguntas e comentários</span><span class="sxs-lookup"><span data-stu-id="d06cd-118">Questions and comments</span></span>
>
> <span data-ttu-id="d06cd-119">Deixe comentários sobre como você gostou neste tutorial e o que poderíamos melhorar nos comentários na parte inferior da página.</span><span class="sxs-lookup"><span data-stu-id="d06cd-119">Please leave feedback on how you liked this tutorial and what we could improve in the comments at the bottom of the page.</span></span> <span data-ttu-id="d06cd-120">Se você tiver perguntas que não estão diretamente relacionadas para o tutorial, você pode postá-los para o [Fórum do ASP.NET SignalR](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) ou [StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="d06cd-120">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET SignalR forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) or [StackOverflow.com](http://stackoverflow.com/).</span></span>


## <a name="overview"></a><span data-ttu-id="d06cd-121">Visão geral</span><span class="sxs-lookup"><span data-stu-id="d06cd-121">Overview</span></span>

<span data-ttu-id="d06cd-122">Este artigo contém as seguintes seções:</span><span class="sxs-lookup"><span data-stu-id="d06cd-122">This article contains the following sections:</span></span>

- [<span data-ttu-id="d06cd-123">Cenários e a terminologia de tempo de vida da Conexão</span><span class="sxs-lookup"><span data-stu-id="d06cd-123">Connection lifetime terminology and scenarios</span></span>](#terminology)

    - [<span data-ttu-id="d06cd-124">Conexões do SignalR, conexões de transporte e conexões físicas</span><span class="sxs-lookup"><span data-stu-id="d06cd-124">SignalR connections, transport connections, and physical connections</span></span>](#signalrvstransport)
    - [<span data-ttu-id="d06cd-125">Cenários de desconexão de transporte</span><span class="sxs-lookup"><span data-stu-id="d06cd-125">Transport disconnection scenarios</span></span>](#transportdisconnect)
    - [<span data-ttu-id="d06cd-126">Cenários de desconexão do cliente</span><span class="sxs-lookup"><span data-stu-id="d06cd-126">Client disconnection scenarios</span></span>](#clientdisconnect)
    - [<span data-ttu-id="d06cd-127">Cenários de desconexão do servidor</span><span class="sxs-lookup"><span data-stu-id="d06cd-127">Server disconnection scenarios</span></span>](#serverdisconnect)
- [<span data-ttu-id="d06cd-128">Configurações de tempo limite e keepalive</span><span class="sxs-lookup"><span data-stu-id="d06cd-128">Timeout and keepalive settings</span></span>](#timeoutkeepalive)

    - [<span data-ttu-id="d06cd-129">ConnectionTimeout</span><span class="sxs-lookup"><span data-stu-id="d06cd-129">ConnectionTimeout</span></span>](#connectiontimeout)
    - [<span data-ttu-id="d06cd-130">DisconnectTimeout</span><span class="sxs-lookup"><span data-stu-id="d06cd-130">DisconnectTimeout</span></span>](#disconnecttimeout)
    - [<span data-ttu-id="d06cd-131">KeepAlive</span><span class="sxs-lookup"><span data-stu-id="d06cd-131">KeepAlive</span></span>](#keepalive)
    - [<span data-ttu-id="d06cd-132">Como alterar as configurações de tempo limite e keepalive</span><span class="sxs-lookup"><span data-stu-id="d06cd-132">How to change timeout and keepalive settings</span></span>](#changetimeout)
- [<span data-ttu-id="d06cd-133">Como notificar o usuário sobre desconexões</span><span class="sxs-lookup"><span data-stu-id="d06cd-133">How to notify the user about disconnections</span></span>](#notifydisconnect)
- [<span data-ttu-id="d06cd-134">Como reconectar continuamente</span><span class="sxs-lookup"><span data-stu-id="d06cd-134">How to continuously reconnect</span></span>](#continuousreconnect)
- [<span data-ttu-id="d06cd-135">Como desconectar um cliente no código do servidor</span><span class="sxs-lookup"><span data-stu-id="d06cd-135">How to disconnect a client in server code</span></span>](#disconnectclientfromserver)
- [<span data-ttu-id="d06cd-136">Detectando o motivo de uma desconexão</span><span class="sxs-lookup"><span data-stu-id="d06cd-136">Detecting the reason for a disconnection</span></span>](#detectingreasonfordisconnection)

<span data-ttu-id="d06cd-137">Links para tópicos de referência de API são para a versão 4.5 do .NET da API.</span><span class="sxs-lookup"><span data-stu-id="d06cd-137">Links to API Reference topics are to the .NET 4.5 version of the API.</span></span> <span data-ttu-id="d06cd-138">Se você estiver usando o .NET 4, consulte [a versão do .NET 4 dos tópicos da API](https://msdn.microsoft.com/library/jj891075(v=vs.100).aspx).</span><span class="sxs-lookup"><span data-stu-id="d06cd-138">If you're using .NET 4, see [the .NET 4 version of the API topics](https://msdn.microsoft.com/library/jj891075(v=vs.100).aspx).</span></span>

<a id="terminology"></a>

## <a name="connection-lifetime-terminology-and-scenarios"></a><span data-ttu-id="d06cd-139">Cenários e a terminologia de tempo de vida da Conexão</span><span class="sxs-lookup"><span data-stu-id="d06cd-139">Connection lifetime terminology and scenarios</span></span>

<span data-ttu-id="d06cd-140">O `OnReconnected` manipulador de eventos em um SignalR Hub pode executar diretamente após `OnConnected` mas não após `OnDisconnected` para um determinado cliente.</span><span class="sxs-lookup"><span data-stu-id="d06cd-140">The `OnReconnected` event handler in a SignalR Hub can execute directly after `OnConnected` but not after `OnDisconnected` for a given client.</span></span> <span data-ttu-id="d06cd-141">O motivo pelo qual que você pode ter uma reconexão sem uma desconexão é que há várias maneiras em que a palavra "conexão" é usada no SignalR.</span><span class="sxs-lookup"><span data-stu-id="d06cd-141">The reason you can have a reconnection without a disconnection is that there are several ways in which the word "connection" is used in SignalR.</span></span>

<a id="signalrvstransport"></a>

### <a name="signalr-connections-transport-connections-and-physical-connections"></a><span data-ttu-id="d06cd-142">Conexões do SignalR, conexões de transporte e conexões físicas</span><span class="sxs-lookup"><span data-stu-id="d06cd-142">SignalR connections, transport connections, and physical connections</span></span>

<span data-ttu-id="d06cd-143">Este artigo irá diferenciar *conexões SignalR*, *conexões de transporte*, e *conexões físicas*:</span><span class="sxs-lookup"><span data-stu-id="d06cd-143">This article will differentiate between *SignalR connections*, *transport connections*, and *physical connections*:</span></span>

- <span data-ttu-id="d06cd-144">**Conexão do SignalR** refere-se a uma relação lógica entre um cliente e uma URL do servidor, mantida pela API do SignalR e identificado exclusivamente por uma ID de conexão.</span><span class="sxs-lookup"><span data-stu-id="d06cd-144">**SignalR connection** refers to a logical relationship between a client and a server URL, maintained by the SignalR API and uniquely identified by a connection ID.</span></span> <span data-ttu-id="d06cd-145">Os dados sobre essa relação são mantidos pelo SignalR e são usados para estabelecer uma conexão de transporte.</span><span class="sxs-lookup"><span data-stu-id="d06cd-145">The data about this relationship is maintained by SignalR and is used to establish a transport connection.</span></span> <span data-ttu-id="d06cd-146">As extremidades da relação e SignalR descarta os dados quando o cliente chama o `Stop` método ou um limite de tempo limite for alcançado enquanto SignalR está tentando restabelecer uma conexão de transporte perdido.</span><span class="sxs-lookup"><span data-stu-id="d06cd-146">The relationship ends and SignalR disposes of the data when the client calls the `Stop` method or a timeout limit is reached while SignalR is attempting to re-establish a lost transport connection.</span></span>
- <span data-ttu-id="d06cd-147">**Conexão de transporte** refere-se a uma relação lógica entre um cliente e um servidor, mantido por um dos quatro transporte APIs: WebSockets, eventos enviados pelo servidor, para sempre de quadro ou longo de sondagem.</span><span class="sxs-lookup"><span data-stu-id="d06cd-147">**Transport connection** refers to a logical relationship between a client and a server, maintained by one of the four transport APIs: WebSockets, server-sent events, forever frame, or long polling.</span></span> <span data-ttu-id="d06cd-148">O SignalR usa o transporte de API para criar uma conexão de transporte e a API de transporte depende da existência de uma conexão de rede física para criar a conexão de transporte.</span><span class="sxs-lookup"><span data-stu-id="d06cd-148">SignalR uses the transport API to create a transport connection, and the transport API depends on the existence of a physical network connection to create the transport connection.</span></span> <span data-ttu-id="d06cd-149">A conexão de transporte termina quando termina o SignalR ou quando o transporte API detecta que a conexão física é interrompida.</span><span class="sxs-lookup"><span data-stu-id="d06cd-149">The transport connection ends when SignalR terminates it or when the transport API detects that the physical connection is broken.</span></span>
- <span data-ttu-id="d06cd-150">**Conexão física** refere-se os links de rede física – fios, sinais sem fio, roteadores, etc. – que facilitam a comunicação entre um computador cliente e um computador do servidor.</span><span class="sxs-lookup"><span data-stu-id="d06cd-150">**Physical connection** refers to the physical network links -- wires, wireless signals, routers, etc. -- that facilitate communication between a client computer and a server computer.</span></span> <span data-ttu-id="d06cd-151">A conexão física deve estar presente para estabelecer uma conexão de transporte e é necessário estabelecer uma conexão de transporte para estabelecer uma conexão SignalR.</span><span class="sxs-lookup"><span data-stu-id="d06cd-151">The physical connection must be present in order to establish a transport connection, and a transport connection must be established in order to establish a SignalR connection.</span></span> <span data-ttu-id="d06cd-152">No entanto, quebrando a conexão física não ocorrem sempre imediatamente termina a conexão de transporte ou conexão SignalR, conforme será explicado mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="d06cd-152">However, breaking the physical connection doesn't always immediately end the transport connection or the SignalR connection, as will be explained later in this topic.</span></span>

<span data-ttu-id="d06cd-153">No diagrama a seguir, a conexão do SignalR é representado pela API de Hubs e camada PersistentConnection API SignalR, a conexão de transporte é representado pela camada de transportes e a conexão física é representado por linhas entre o servidor e os clientes.</span><span class="sxs-lookup"><span data-stu-id="d06cd-153">In the following diagram, the SignalR connection is represented by the Hubs API and PersistentConnection API SignalR layer, the transport connection is represented by the Transports layer, and the physical connection is represented by the lines between the server and the clients.</span></span>

![Diagrama da arquitetura do SignalR](handling-connection-lifetime-events/_static/image1.png)

<span data-ttu-id="d06cd-155">Quando você chama o `Start` método em um cliente do SignalR, você está fornecendo o código de cliente do SignalR com todas as informações necessárias para estabelecer uma conexão física em um servidor.</span><span class="sxs-lookup"><span data-stu-id="d06cd-155">When you call the `Start` method in a SignalR client, you are providing SignalR client code with all the information it needs in order to establish a physical connection to a server.</span></span> <span data-ttu-id="d06cd-156">Código de cliente SignalR usa essas informações para fazer uma solicitação HTTP e estabelecer uma conexão física que usa um dos métodos de transporte de quatro.</span><span class="sxs-lookup"><span data-stu-id="d06cd-156">SignalR client code uses this information to make an HTTP request and establish a physical connection that uses one of the four transport methods.</span></span> <span data-ttu-id="d06cd-157">Se a conexão de transporte falha ou o servidor falhar, a conexão do SignalR não desaparece imediatamente porque o cliente ainda tem as informações necessárias para restabelecer automaticamente uma nova conexão de transporte para a mesma URL de SignalR.</span><span class="sxs-lookup"><span data-stu-id="d06cd-157">If the transport connection fails or the server fails, the SignalR connection doesn't go away immediately because the client still has the information it needs to automatically re-establish a new transport connection to the same SignalR URL.</span></span> <span data-ttu-id="d06cd-158">Nesse cenário, nenhuma intervenção do aplicativo do usuário está envolvida e quando o código do cliente SignalR estabelece uma nova conexão de transporte, ele não inicia uma nova conexão do SignalR.</span><span class="sxs-lookup"><span data-stu-id="d06cd-158">In this scenario, no intervention from the user application is involved, and when the SignalR client code establishes a new transport connection, it does not start a new SignalR connection.</span></span> <span data-ttu-id="d06cd-159">A continuidade de conexão o SignalR é refletida no fato de que a ID de conexão, que é criada quando você chama o `Start` método, não é alterado.</span><span class="sxs-lookup"><span data-stu-id="d06cd-159">The continuity of the SignalR connection is reflected in the fact that the connection ID, which is created when you call the `Start` method, does not change.</span></span>

<span data-ttu-id="d06cd-160">O `OnReconnected` manipulador de eventos no Hub é executado quando uma conexão de transporte é restabelecida automaticamente depois de ter sido perdidos.</span><span class="sxs-lookup"><span data-stu-id="d06cd-160">The `OnReconnected` event handler on the Hub executes when a transport connection is automatically re-established after having been lost.</span></span> <span data-ttu-id="d06cd-161">O `OnDisconnected` manipulador de eventos é executado no final de uma conexão SignalR.</span><span class="sxs-lookup"><span data-stu-id="d06cd-161">The `OnDisconnected` event handler executes at the end of a SignalR connection.</span></span> <span data-ttu-id="d06cd-162">Uma conexão SignalR pode terminar com qualquer uma das seguintes maneiras:</span><span class="sxs-lookup"><span data-stu-id="d06cd-162">A SignalR connection can end in any of the following ways:</span></span>

- <span data-ttu-id="d06cd-163">Se o cliente chama o `Stop` método, uma mensagem de parada é enviada ao servidor e cliente e servidor terminam a conexão do SignalR imediatamente.</span><span class="sxs-lookup"><span data-stu-id="d06cd-163">If the client calls the `Stop` method, a stop message is sent to the server, and both client and server end the SignalR connection immediately.</span></span>
- <span data-ttu-id="d06cd-164">Depois de conectividade entre cliente e servidor é perdida, o cliente tenta se reconectar e o servidor aguarda o cliente para se reconectar.</span><span class="sxs-lookup"><span data-stu-id="d06cd-164">After connectivity between client and server is lost, the client tries to reconnect and the server waits for the client to reconnect.</span></span> <span data-ttu-id="d06cd-165">Se as tentativas de reconexão são malsucedidas e o período de tempo limite de desconexão termina, o cliente e servidor terminam a conexão do SignalR.</span><span class="sxs-lookup"><span data-stu-id="d06cd-165">If the attempts to reconnect are unsuccessful and the disconnect timeout period ends, both client and server end the SignalR connection.</span></span> <span data-ttu-id="d06cd-166">O cliente para tentar reconectar-se, e descarta o servidor de sua representação de conexão do SignalR.</span><span class="sxs-lookup"><span data-stu-id="d06cd-166">The client stops trying to reconnect, and the server disposes of its representation of the SignalR connection.</span></span>
- <span data-ttu-id="d06cd-167">Se o cliente será interrompido sem ter a chance de chamar o `Stop` método, o servidor aguarda reconectar-se, o cliente e, em seguida, termina a conexão do SignalR após o período de tempo limite de desconexão.</span><span class="sxs-lookup"><span data-stu-id="d06cd-167">If the client stops running without having a chance to call the `Stop` method, the server waits for the client to reconnect, and then ends the SignalR connection after the disconnect timeout period.</span></span>
- <span data-ttu-id="d06cd-168">Se o servidor para a execução, o cliente tenta se reconectar (recriar a conexão de transporte) e, em seguida, termina a conexão do SignalR após o período de tempo limite de desconexão.</span><span class="sxs-lookup"><span data-stu-id="d06cd-168">If the server stops running, the client tries to reconnect (re-create the transport connection), and then ends the SignalR connection after the disconnect timeout period.</span></span>

<span data-ttu-id="d06cd-169">Quando não há nenhum problema de conexão, e o aplicativo de usuário termina a conexão do SignalR chamando o `Stop` método, a conexão do SignalR e a conexão de transporte começam e terminam no aproximadamente ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="d06cd-169">When there are no connection problems, and the user application ends the SignalR connection by calling the `Stop` method, the SignalR connection and the transport connection begin and end at about the same time.</span></span> <span data-ttu-id="d06cd-170">As seções a seguir descrevem mais detalhadamente os outros cenários.</span><span class="sxs-lookup"><span data-stu-id="d06cd-170">The following sections describe in more detail the other scenarios.</span></span>

<a id="transportdisconnect"></a>

### <a name="transport-disconnection-scenarios"></a><span data-ttu-id="d06cd-171">Cenários de desconexão de transporte</span><span class="sxs-lookup"><span data-stu-id="d06cd-171">Transport disconnection scenarios</span></span>

<span data-ttu-id="d06cd-172">Conexões físicas podem ser lentas ou pode haver interrupções na conectividade.</span><span class="sxs-lookup"><span data-stu-id="d06cd-172">Physical connections might be slow or there might be interruptions in connectivity.</span></span> <span data-ttu-id="d06cd-173">Dependendo de fatores como o comprimento da interrupção, a conexão de transporte pode ser descartado.</span><span class="sxs-lookup"><span data-stu-id="d06cd-173">Depending on factors such as the length of the interruption, the transport connection might be dropped.</span></span> <span data-ttu-id="d06cd-174">O SignalR, em seguida, tenta restabelecer a conexão de transporte.</span><span class="sxs-lookup"><span data-stu-id="d06cd-174">SignalR then tries to re-establish the transport connection.</span></span> <span data-ttu-id="d06cd-175">Às vezes, a conexão de transporte API detecta a interrupção e descarta a conexão de transporte e SignalR descobre imediatamente que a conexão for perdida.</span><span class="sxs-lookup"><span data-stu-id="d06cd-175">Sometimes the transport connection API detects the interruption and drops the transport connection, and SignalR finds out immediately that the connection is lost.</span></span> <span data-ttu-id="d06cd-176">Em outros cenários, nem a API de conexão de transporte nem SignalR fica ciente imediatamente que a conectividade foi perdida.</span><span class="sxs-lookup"><span data-stu-id="d06cd-176">In other scenarios, neither the transport connection API nor SignalR becomes aware immediately that connectivity has been lost.</span></span> <span data-ttu-id="d06cd-177">Para todos os transportes, exceto a sondagem longa, o cliente SignalR usa uma função chamada *keepalive* para verificar se há perda de conectividade que o transporte de API não consegue detectar.</span><span class="sxs-lookup"><span data-stu-id="d06cd-177">For all transports except long polling, the SignalR client uses a function called *keepalive* to check for loss of connectivity that the transport API is unable to detect.</span></span> <span data-ttu-id="d06cd-178">Para obter informações sobre conexões de sondagem longa, consulte [as configurações de tempo limite e keepalive](#timeoutkeepalive) mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="d06cd-178">For information about long polling connections, see [Timeout and keepalive settings](#timeoutkeepalive) later in this topic.</span></span>

<span data-ttu-id="d06cd-179">Quando uma conexão estiver inativo, periodicamente o servidor envia um pacote keepalive ao cliente.</span><span class="sxs-lookup"><span data-stu-id="d06cd-179">When a connection is inactive, periodically the server sends a keepalive packet to the client.</span></span> <span data-ttu-id="d06cd-180">A partir da data em que este artigo está sendo escrito, a frequência de padrão é a cada 10 segundos.</span><span class="sxs-lookup"><span data-stu-id="d06cd-180">As of the date this article is being written, the default frequency is every 10 seconds.</span></span> <span data-ttu-id="d06cd-181">Através da escuta para esses pacotes, os clientes podem informar se há um problema de conexão.</span><span class="sxs-lookup"><span data-stu-id="d06cd-181">By listening for these packets, clients can tell if there is a connection problem.</span></span> <span data-ttu-id="d06cd-182">Se um pacote keepalive não for recebido quando esperada, após um curto período o cliente assume que há problemas de conexão como lentidão ou interrupções.</span><span class="sxs-lookup"><span data-stu-id="d06cd-182">If a keepalive packet is not received when expected, after a short time the client assumes that there are connection problems such as slowness or interruptions.</span></span> <span data-ttu-id="d06cd-183">Se o keepalive ainda não for recebido após um tempo mais longo, o cliente presume que a conexão foi descartada, e ele começa a tentar reconectar.</span><span class="sxs-lookup"><span data-stu-id="d06cd-183">If the keepalive is still not received after a longer time, the client assumes that the connection has been dropped, and it begins trying to reconnect.</span></span>

<span data-ttu-id="d06cd-184">O diagrama a seguir ilustra os eventos de cliente e servidor que são gerados em um cenário típico, quando há problemas com a conexão física que não são reconhecidos imediatamente pelo transporte de API.</span><span class="sxs-lookup"><span data-stu-id="d06cd-184">The following diagram illustrates the client and server events that are raised in a typical scenario when there are problems with the physical connection that aren't immediately recognized by the transport API.</span></span> <span data-ttu-id="d06cd-185">O diagrama se aplica aos seguintes circunstâncias:</span><span class="sxs-lookup"><span data-stu-id="d06cd-185">The diagram applies to the following circumstances:</span></span>

- <span data-ttu-id="d06cd-186">O transporte é WebSockets, para sempre quadro ou eventos enviados pelo servidor.</span><span class="sxs-lookup"><span data-stu-id="d06cd-186">The transport is WebSockets, forever frame, or server-sent events.</span></span>
- <span data-ttu-id="d06cd-187">Há diferentes períodos de interrupção na conexão de rede física.</span><span class="sxs-lookup"><span data-stu-id="d06cd-187">There are varying periods of interruption in the physical network connection.</span></span>
- <span data-ttu-id="d06cd-188">O API de transporte não fica ciente de interrupções, então o SignalR se baseia na funcionalidade keepalive para detectá-los.</span><span class="sxs-lookup"><span data-stu-id="d06cd-188">The transport API does not become aware of the interruptions, so SignalR relies on the keepalive functionality to detect them.</span></span>

![Desconexões de transporte](handling-connection-lifetime-events/_static/image2.png)

<span data-ttu-id="d06cd-190">Se o cliente entra em modo reconectar-se, mas não é possível estabelecer uma conexão de transporte dentro do limite de tempo limite de desconexão, o servidor encerra a conexão do SignalR.</span><span class="sxs-lookup"><span data-stu-id="d06cd-190">If the client goes into reconnecting mode but can't establish a transport connection within the disconnect timeout limit, the server terminates the SignalR connection.</span></span> <span data-ttu-id="d06cd-191">Quando isso acontece, o servidor executa o Hub `OnDisconnected` método e enfileira uma mensagem de desconexão para enviar ao cliente, caso o cliente gerencia conectar mais tarde.</span><span class="sxs-lookup"><span data-stu-id="d06cd-191">When that happens, the server executes the Hub's `OnDisconnected` method and queues up a disconnect message to send to the client in case the client manages to connect later.</span></span> <span data-ttu-id="d06cd-192">Se o cliente, em seguida, reconectar, ele receberá o comando de desconexão e chama o `Stop` método.</span><span class="sxs-lookup"><span data-stu-id="d06cd-192">If the client then does reconnect, it receives the disconnect command and calls the `Stop` method.</span></span> <span data-ttu-id="d06cd-193">Nesse cenário, `OnReconnected` não será executado quando o cliente se reconecta, e `OnDisconnected` não será executado quando o cliente chama `Stop`.</span><span class="sxs-lookup"><span data-stu-id="d06cd-193">In this scenario, `OnReconnected` is not executed when the client reconnects, and `OnDisconnected` is not executed when the client calls `Stop`.</span></span> <span data-ttu-id="d06cd-194">O diagrama a seguir ilustra esse cenário.</span><span class="sxs-lookup"><span data-stu-id="d06cd-194">The following diagram illustrates this scenario.</span></span>

![Interrupções de transporte - tempo limite do servidor](handling-connection-lifetime-events/_static/image3.png)

<span data-ttu-id="d06cd-196">Os eventos de tempo de vida de conexão do SignalR que poderão ser gerados no cliente são os seguintes:</span><span class="sxs-lookup"><span data-stu-id="d06cd-196">The SignalR connection lifetime events that may be raised on the client are the following:</span></span>

- <span data-ttu-id="d06cd-197">`ConnectionSlow` evento de cliente.</span><span class="sxs-lookup"><span data-stu-id="d06cd-197">`ConnectionSlow` client event.</span></span>

    <span data-ttu-id="d06cd-198">Gerado quando uma predefinição proporção do período de tempo limite de keepalive se passou desde a última mensagem ou keepalive ping foi recebida.</span><span class="sxs-lookup"><span data-stu-id="d06cd-198">Raised when a preset proportion of the keepalive timeout period has passed since the last message or keepalive ping was received.</span></span> <span data-ttu-id="d06cd-199">O período de aviso de tempo limite de keepalive padrão é 2/3 do tempo limite keepalive.</span><span class="sxs-lookup"><span data-stu-id="d06cd-199">The default keepalive timeout warning period is 2/3 of the keepalive timeout.</span></span> <span data-ttu-id="d06cd-200">O tempo limite de keepalive é 20 segundos, para que o aviso ocorre em cerca de 13 segundos.</span><span class="sxs-lookup"><span data-stu-id="d06cd-200">The keepalive timeout is 20 seconds, so the warning occurs at about 13 seconds.</span></span>

    <span data-ttu-id="d06cd-201">Por padrão, o servidor envia pings keepalive a cada 10 segundos e o cliente verifica os pings de keepalive sobre cada 2 segundos (um terço da diferença entre o valor de tempo limite de manutenção de atividade e o valor de aviso de tempo limite de keepalive).</span><span class="sxs-lookup"><span data-stu-id="d06cd-201">By default, the server sends keepalive pings every 10 seconds, and the client checks for keepalive pings about every 2 seconds (one third of the difference between the keepalive timeout value and the keepalive timeout warning value).</span></span>

    <span data-ttu-id="d06cd-202">Se o transporte API fica ciente de uma desconexão, SignalR pode ser informados sobre a desconexão antes do tempo limite aviso keepalive passa.</span><span class="sxs-lookup"><span data-stu-id="d06cd-202">If the transport API becomes aware of a disconnection, SignalR might be informed of the disconnection before the keepalive timeout warning period passes.</span></span> <span data-ttu-id="d06cd-203">Nesse caso, o `ConnectionSlow` evento não será acionado e SignalR deve ir diretamente para o `Reconnecting` eventos.</span><span class="sxs-lookup"><span data-stu-id="d06cd-203">In that case, the `ConnectionSlow` event would not be raised, and SignalR would go directly to the `Reconnecting` event.</span></span>
- <span data-ttu-id="d06cd-204">`Reconnecting` evento de cliente.</span><span class="sxs-lookup"><span data-stu-id="d06cd-204">`Reconnecting` client event.</span></span>

    <span data-ttu-id="d06cd-205">Gerado quando o (a) o transporte API detecta que a conexão for perdida, ou (b) o período de tempo limite de keepalive se passou desde a última mensagem ou keepalive ping foi recebida.</span><span class="sxs-lookup"><span data-stu-id="d06cd-205">Raised when (a) the transport API detects that the connection is lost, or (b) the keepalive timeout period has passed since the last message or keepalive ping was received.</span></span> <span data-ttu-id="d06cd-206">O código do cliente SignalR começa a tentar reconectar.</span><span class="sxs-lookup"><span data-stu-id="d06cd-206">The SignalR client code begins trying to reconnect.</span></span> <span data-ttu-id="d06cd-207">Você pode manipular esse evento, se você quiser que seu aplicativo execute alguma ação quando uma conexão de transporte é perdida.</span><span class="sxs-lookup"><span data-stu-id="d06cd-207">You can handle this event if you want your application to take some action when a transport connection is lost.</span></span> <span data-ttu-id="d06cd-208">O período de tempo limite padrão keepalive atualmente é de 20 segundos.</span><span class="sxs-lookup"><span data-stu-id="d06cd-208">The default keepalive timeout period is currently 20 seconds.</span></span>

    <span data-ttu-id="d06cd-209">Se seu código de cliente tentar chamar um método de Hub, enquanto o SignalR está em modo reconectar-se, o SignalR tentará enviar o comando.</span><span class="sxs-lookup"><span data-stu-id="d06cd-209">If your client code tries to call a Hub method while SignalR is in reconnecting mode, SignalR will try to send the command.</span></span> <span data-ttu-id="d06cd-210">Na maioria das vezes, essas tentativas falhará, mas em algumas circunstâncias que talvez tenham êxito.</span><span class="sxs-lookup"><span data-stu-id="d06cd-210">Most of the time, such attempts will fail, but in some circumstances they might succeed.</span></span> <span data-ttu-id="d06cd-211">Para os eventos enviados pelo servidor, para sempre quadro e transportes de sondagem longa, o SignalR usa dois canais de comunicação, um que o cliente usa para enviar mensagens e outro que ele usa para receber mensagens.</span><span class="sxs-lookup"><span data-stu-id="d06cd-211">For the server-sent events, forever frame, and long polling transports, SignalR uses two communication channels, one that the client uses to send messages and one that it uses to receive messages.</span></span> <span data-ttu-id="d06cd-212">O canal usado para o recebimento é aquele permanentemente aberto e que é o que é fechada quando a conexão física é interrompida.</span><span class="sxs-lookup"><span data-stu-id="d06cd-212">The channel used for receiving is the permanently open one, and that's the one that is closed when the physical connection is interrupted.</span></span> <span data-ttu-id="d06cd-213">O canal usado para enviar permanece disponível, portanto, se a conectividade física é restaurada, uma chamada de método de cliente para servidor poderá ser bem-sucedida antes que o canal de recebimento é restabelecido.</span><span class="sxs-lookup"><span data-stu-id="d06cd-213">The channel used for sending remains available, so if physical connectivity is restored, a method call from client to server might be successful before the receive channel is re-established.</span></span> <span data-ttu-id="d06cd-214">O valor de retorno não seria recebido até que o SignalR reabre o canal usado para recebimento.</span><span class="sxs-lookup"><span data-stu-id="d06cd-214">The return value would not be received until SignalR re-opens the channel used for receiving.</span></span>
- <span data-ttu-id="d06cd-215">`Reconnected` evento de cliente.</span><span class="sxs-lookup"><span data-stu-id="d06cd-215">`Reconnected` client event.</span></span>

    <span data-ttu-id="d06cd-216">Gerado quando a conexão de transporte é restabelecida.</span><span class="sxs-lookup"><span data-stu-id="d06cd-216">Raised when the transport connection is reestablished.</span></span> <span data-ttu-id="d06cd-217">O `OnReconnected` executa o manipulador de eventos no Hub.</span><span class="sxs-lookup"><span data-stu-id="d06cd-217">The `OnReconnected` event handler in the Hub executes.</span></span>
- <span data-ttu-id="d06cd-218">`Closed` evento de cliente (`disconnected` eventos em JavaScript).</span><span class="sxs-lookup"><span data-stu-id="d06cd-218">`Closed` client event (`disconnected` event in JavaScript).</span></span>

    <span data-ttu-id="d06cd-219">Gerado quando o período de tempo limite de desconexão expira enquanto o código de cliente SignalR está tentando se reconectar após perder a conexão de transporte.</span><span class="sxs-lookup"><span data-stu-id="d06cd-219">Raised when the disconnect timeout period expires while the SignalR client code is trying to reconnect after losing the transport connection.</span></span> <span data-ttu-id="d06cd-220">Desconecte o padrão é de 30 segundos do tempo limite.</span><span class="sxs-lookup"><span data-stu-id="d06cd-220">The default disconnect timeout is 30 seconds.</span></span> <span data-ttu-id="d06cd-221">(Esse evento também é gerado quando a conexão é encerrada porque o `Stop` método é chamado.)</span><span class="sxs-lookup"><span data-stu-id="d06cd-221">(This event is also raised when the connection ends because the `Stop` method is called.)</span></span>

<span data-ttu-id="d06cd-222">Interrupções de conexão de transporte que não são detectadas pelo transporte de API e não adie a recepção de pings de manutenção de atividade do servidor por mais tempo que o período de aviso de tempo limite de keepalive podem não fazer com que qualquer conexão eventos de tempo de vida a serem gerados.</span><span class="sxs-lookup"><span data-stu-id="d06cd-222">Transport connection interruptions that are not detected by the transport API and don't delay the reception of keepalive pings from the server for longer than the keepalive timeout warning period might not cause any connection lifetime events to be raised.</span></span>

<span data-ttu-id="d06cd-223">Alguns ambientes de rede fechar deliberadamente conexões ociosas e outra função dos pacotes keepalive é ajudar a evitar isso, informando a essas redes que uma conexão SignalR está em uso.</span><span class="sxs-lookup"><span data-stu-id="d06cd-223">Some network environments deliberately close idle connections, and another function of the keepalive packets is to help prevent this by letting these networks know that a SignalR connection is in use.</span></span> <span data-ttu-id="d06cd-224">Em casos extremos a frequência de padrão de pings keepalive pode não ser suficiente para impedir conexões fechadas.</span><span class="sxs-lookup"><span data-stu-id="d06cd-224">In extreme cases the default frequency of keepalive pings might not be enough to prevent closed connections.</span></span> <span data-ttu-id="d06cd-225">Nesse caso, você pode configurar os pings de keepalive sejam enviadas com mais frequência.</span><span class="sxs-lookup"><span data-stu-id="d06cd-225">In that case you can configure keepalive pings to be sent more often.</span></span> <span data-ttu-id="d06cd-226">Para obter mais informações, consulte [as configurações de tempo limite e keepalive](#timeoutkeepalive) mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="d06cd-226">For more information, see [Timeout and keepalive settings](#timeoutkeepalive) later in this topic.</span></span>

> [!NOTE]
>
> <span data-ttu-id="d06cd-227">**Importante**: A sequência de eventos descritas aqui não é garantida.</span><span class="sxs-lookup"><span data-stu-id="d06cd-227">**Important**: The sequence of events described here is not guaranteed.</span></span> <span data-ttu-id="d06cd-228">Torna o SignalR cada tentativa de gerar eventos de tempo de vida de conexão de uma maneira previsível de acordo com esse esquema, mas há muitas variações de eventos de rede e de várias maneiras em que estruturas de comunicação subjacente como transporte APIs tratarão-los.</span><span class="sxs-lookup"><span data-stu-id="d06cd-228">SignalR makes every attempt to raise connection lifetime events in a predictable manner according to this scheme, but there are many variations of network events and many ways in which underlying communications frameworks such as transport APIs handle them.</span></span> <span data-ttu-id="d06cd-229">Por exemplo, o `Reconnected` evento não pode ser gerado quando o cliente se reconecta, ou o `OnConnected` manipulador no servidor pode ser executados quando a tentativa de estabelecer uma conexão não for bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="d06cd-229">For example, the `Reconnected` event might not be raised when the client reconnects, or the `OnConnected` handler on the server might run when the attempt to establish a connection is unsuccessful.</span></span> <span data-ttu-id="d06cd-230">Este tópico descreve somente os efeitos que normalmente seriam produzidos por determinadas circunstâncias normais.</span><span class="sxs-lookup"><span data-stu-id="d06cd-230">This topic describes only the effects that would normally be produced by certain typical circumstances.</span></span>


<a id="clientdisconnect"></a>

### <a name="client-disconnection-scenarios"></a><span data-ttu-id="d06cd-231">Cenários de desconexão do cliente</span><span class="sxs-lookup"><span data-stu-id="d06cd-231">Client disconnection scenarios</span></span>

<span data-ttu-id="d06cd-232">Em um cliente de navegador, o código do cliente SignalR que mantém uma conexão SignalR é executado no contexto de uma página da web JavaScript.</span><span class="sxs-lookup"><span data-stu-id="d06cd-232">In a browser client, the SignalR client code that maintains a SignalR connection runs in the JavaScript context of a web page.</span></span> <span data-ttu-id="d06cd-233">Que tem por que a conexão do SignalR tem que encerrar quando você navega de uma página para outro e que por que você tiver várias conexões com a conexão de várias IDs se você se conectar de várias janelas do navegador ou guias.</span><span class="sxs-lookup"><span data-stu-id="d06cd-233">That's why the SignalR connection has to end when you navigate from one page to another, and that's why you have multiple connections with multiple connection IDs if you connect from multiple browser windows or tabs.</span></span> <span data-ttu-id="d06cd-234">Quando o usuário fecha uma janela ou guia navegador, ou navega para uma nova página ou atualiza a página, a conexão do SignalR terminará imediatamente porque o código de cliente SignalR manipula esse evento de navegador para você e chama o `Stop` método.</span><span class="sxs-lookup"><span data-stu-id="d06cd-234">When the user closes a browser window or tab, or navigates to a new page or refreshes the page, the SignalR connection immediately ends because SignalR client code handles that browser event for you and calls the `Stop` method.</span></span> <span data-ttu-id="d06cd-235">Nesses cenários, ou em qualquer plataforma de cliente quando o aplicativo chama o `Stop` método, o `OnDisconnected` manipulador de eventos executa imediatamente no servidor e o cliente gera o `Closed` evento (o evento é chamado `disconnected` em JavaScript).</span><span class="sxs-lookup"><span data-stu-id="d06cd-235">In these scenarios, or in any client platform when your application calls the `Stop` method, the `OnDisconnected` event handler executes immediately on the server and the client raises the `Closed` event (the event is named `disconnected` in JavaScript).</span></span>

<span data-ttu-id="d06cd-236">Se um aplicativo cliente ou no computador que está sendo executado falha ou entra em suspensão (por exemplo, quando o usuário fecha o laptop), o servidor não é informado sobre o que aconteceu.</span><span class="sxs-lookup"><span data-stu-id="d06cd-236">If a client application or the computer that it's running on crashes or goes to sleep (for example, when the user closes the laptop), the server is not informed about what happened.</span></span> <span data-ttu-id="d06cd-237">Como o servidor sabe, a perda do cliente pode ser devido a interrupção da conectividade e o cliente pode estar tentando se reconectar.</span><span class="sxs-lookup"><span data-stu-id="d06cd-237">As far as the server knows, the loss of the client might be due to connectivity interruption and the client might be trying to reconnect.</span></span> <span data-ttu-id="d06cd-238">Portanto, nesses cenários em que o servidor espera para que o cliente possam se reconectar, e `OnDisconnected` não será executada até que o período de tempo limite de desconexão expire (cerca de 30 segundos por padrão).</span><span class="sxs-lookup"><span data-stu-id="d06cd-238">Therefore, in these scenarios the server waits to give the client a chance to reconnect, and `OnDisconnected` does not execute until the disconnect timeout period expires (about 30 seconds by default).</span></span> <span data-ttu-id="d06cd-239">O diagrama a seguir ilustra esse cenário.</span><span class="sxs-lookup"><span data-stu-id="d06cd-239">The following diagram illustrates this scenario.</span></span>

![Falha no computador cliente](handling-connection-lifetime-events/_static/image4.png)

<a id="serverdisconnect"></a>

### <a name="server-disconnection-scenarios"></a><span data-ttu-id="d06cd-241">Cenários de desconexão do servidor</span><span class="sxs-lookup"><span data-stu-id="d06cd-241">Server disconnection scenarios</span></span>

<span data-ttu-id="d06cd-242">Quando um servidor ficar offline – ele é reinicializado, falhar, o domínio do aplicativo recicla, etc. – o resultado pode ser semelhante a uma conexão perdida ou a API de transporte e o SignalR podem saber imediatamente que o servidor não existe mais e SignalR pode começar a tentar reconectar sem Gerando o `ConnectionSlow` eventos.</span><span class="sxs-lookup"><span data-stu-id="d06cd-242">When a server goes offline -- it reboots, fails, the app domain recycles, etc. -- the result might be similar to a lost connection, or the transport API and SignalR might know immediately that the server is gone, and SignalR might begin trying to reconnect without raising the `ConnectionSlow` event.</span></span> <span data-ttu-id="d06cd-243">Se o cliente entra em modo reconectar-se e se o servidor recupera ou reinicializações ou um novo servidor é colocado online antes de expira o tempo limite de desconexão, o cliente se reconectará ao servidor novo ou restaurado.</span><span class="sxs-lookup"><span data-stu-id="d06cd-243">If the client goes into reconnecting mode, and if the server recovers or restarts or a new server is brought online before the disconnect timeout period expires, the client will reconnect to the restored or new server.</span></span> <span data-ttu-id="d06cd-244">Nesse caso, a conexão do SignalR continua no cliente e o `Reconnected` é gerado.</span><span class="sxs-lookup"><span data-stu-id="d06cd-244">In that case, the SignalR connection continues on the client and the `Reconnected` event is raised.</span></span> <span data-ttu-id="d06cd-245">No primeiro servidor, `OnDisconnected` nunca será executado e no novo servidor `OnReconnected` é executado, embora `OnConnected` nunca foi executada para esse cliente no servidor antes.</span><span class="sxs-lookup"><span data-stu-id="d06cd-245">On the first server, `OnDisconnected` is never executed, and on the new server, `OnReconnected` is executed although `OnConnected` was never executed for that client on that server before.</span></span> <span data-ttu-id="d06cd-246">(O efeito é o mesmo se o cliente se reconecta ao mesmo servidor após uma reinicialização ou aplicativo reciclagem de domínio, porque quando o servidor reiniciar não tem memória de atividade de conexão anterior). O diagrama a seguir pressupõe que o transporte API fica ciente da conexão perdida imediatamente, portanto, o `ConnectionSlow` não é gerado.</span><span class="sxs-lookup"><span data-stu-id="d06cd-246">(The effect is the same if the client reconnects to the same server after a reboot or app domain recycle, because when the server restarts it has no memory of prior connection activity.) The following diagram assumes that the transport API becomes aware of the lost connection immediately, so the `ConnectionSlow` event is not raised.</span></span>

![Falha do servidor e reconexão](handling-connection-lifetime-events/_static/image5.png)

<span data-ttu-id="d06cd-248">Se um servidor não ficar disponível dentro do período de tempo limite de desconexão, termina a conexão do SignalR.</span><span class="sxs-lookup"><span data-stu-id="d06cd-248">If a server does not become available within the disconnect timeout period, the SignalR connection ends.</span></span> <span data-ttu-id="d06cd-249">Nesse cenário, o `Closed` evento (`disconnected` nos clientes JavaScript) é gerado no cliente, mas `OnDisconnected` nunca é chamado no servidor.</span><span class="sxs-lookup"><span data-stu-id="d06cd-249">In this scenario, the `Closed` event (`disconnected` in JavaScript clients) is raised on the client but `OnDisconnected` is never called on the server.</span></span> <span data-ttu-id="d06cd-250">O diagrama a seguir pressupõe que o transporte de API não reconhecem a conexão perdida, para que ele é detectado pelo SignalR keepalive funcionalidade e o `ConnectionSlow` é gerado.</span><span class="sxs-lookup"><span data-stu-id="d06cd-250">The following diagram assumes that the transport API does not become aware of the lost connection, so it is detected by SignalR keepalive functionality and the `ConnectionSlow` event is raised.</span></span>

![Tempo limite e falha do servidor](handling-connection-lifetime-events/_static/image6.png)

<a id="timeoutkeepalive"></a>

## <a name="timeout-and-keepalive-settings"></a><span data-ttu-id="d06cd-252">Configurações de tempo limite e keepalive</span><span class="sxs-lookup"><span data-stu-id="d06cd-252">Timeout and keepalive settings</span></span>

<span data-ttu-id="d06cd-253">O padrão `ConnectionTimeout`, `DisconnectTimeout`, e `KeepAlive` valores apropriados para a maioria dos cenários, mas pode ser alteradas se seu ambiente tiver necessidades especiais.</span><span class="sxs-lookup"><span data-stu-id="d06cd-253">The default `ConnectionTimeout`, `DisconnectTimeout`, and `KeepAlive` values are appropriate for most scenarios but can be changed if your environment has special needs.</span></span> <span data-ttu-id="d06cd-254">Por exemplo, se seu ambiente de rede fecha as conexões que estão ociosas por 5 segundos, você terá que diminua o valor de keepalive.</span><span class="sxs-lookup"><span data-stu-id="d06cd-254">For example, if your network environment closes connections that are idle for 5 seconds, you might have to decrease the keepalive value.</span></span>

<a id="connectiontimeout"></a>

### <a name="connectiontimeout"></a><span data-ttu-id="d06cd-255">ConnectionTimeout</span><span class="sxs-lookup"><span data-stu-id="d06cd-255">ConnectionTimeout</span></span>

<span data-ttu-id="d06cd-256">Essa configuração representa a quantidade de tempo para manter uma conexão de transporte abertas e está aguardando uma resposta antes de fechá-lo e abrir uma nova conexão.</span><span class="sxs-lookup"><span data-stu-id="d06cd-256">This setting represents the amount of time to leave a transport connection open and waiting for a response before closing it and opening a new connection.</span></span> <span data-ttu-id="d06cd-257">O valor padrão é de 110 segundos.</span><span class="sxs-lookup"><span data-stu-id="d06cd-257">The default value is 110 seconds.</span></span>

<span data-ttu-id="d06cd-258">Essa configuração se aplica somente quando funcionalidade keepalive está desabilitada, que normalmente se aplica somente à longa transporte de sondagem.</span><span class="sxs-lookup"><span data-stu-id="d06cd-258">This setting applies only when keepalive functionality is disabled, which normally applies only to the long polling transport.</span></span> <span data-ttu-id="d06cd-259">O diagrama a seguir ilustra o efeito dessa configuração em um longo conexão de transporte de sondagem.</span><span class="sxs-lookup"><span data-stu-id="d06cd-259">The following diagram illustrates the effect of this setting on a long polling transport connection.</span></span>

![Conexão de transporte de sondagem longa](handling-connection-lifetime-events/_static/image7.png)

<a id="disconnecttimeout"></a>

### <a name="disconnecttimeout"></a><span data-ttu-id="d06cd-261">DisconnectTimeout</span><span class="sxs-lookup"><span data-stu-id="d06cd-261">DisconnectTimeout</span></span>

<span data-ttu-id="d06cd-262">Essa configuração representa a quantidade de tempo a aguardar após uma conexão de transporte é perdida, antes de acionar o `Disconnected` eventos.</span><span class="sxs-lookup"><span data-stu-id="d06cd-262">This setting represents the amount of time to wait after a transport connection is lost before raising the `Disconnected` event.</span></span> <span data-ttu-id="d06cd-263">O valor padrão é 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="d06cd-263">The default value is 30 seconds.</span></span> <span data-ttu-id="d06cd-264">Quando você define `DisconnectTimeout`, `KeepAlive` é definida automaticamente como 1/3 do `DisconnectTimeout` valor.</span><span class="sxs-lookup"><span data-stu-id="d06cd-264">When you set `DisconnectTimeout`, `KeepAlive` is automatically set to 1/3 of the `DisconnectTimeout` value.</span></span>

<a id="keepalive"></a>

### <a name="keepalive"></a><span data-ttu-id="d06cd-265">KeepAlive</span><span class="sxs-lookup"><span data-stu-id="d06cd-265">KeepAlive</span></span>

<span data-ttu-id="d06cd-266">Essa configuração representa a quantidade de tempo de espera antes de enviar um pacote keepalive ao longo de uma conexão ociosa.</span><span class="sxs-lookup"><span data-stu-id="d06cd-266">This setting represents the amount of time to wait before sending a keepalive packet over an idle connection.</span></span> <span data-ttu-id="d06cd-267">O valor padrão é 10 segundos.</span><span class="sxs-lookup"><span data-stu-id="d06cd-267">The default value is 10 seconds.</span></span> <span data-ttu-id="d06cd-268">Esse valor não deve ser a mais de 1/3 do `DisconnectTimeout` valor.</span><span class="sxs-lookup"><span data-stu-id="d06cd-268">This value must not be more than 1/3 of the `DisconnectTimeout` value.</span></span>

<span data-ttu-id="d06cd-269">Se você quiser definir ambos `DisconnectTimeout` e `KeepAlive`, defina `KeepAlive` depois `DisconnectTimeout`.</span><span class="sxs-lookup"><span data-stu-id="d06cd-269">If you want to set both `DisconnectTimeout` and `KeepAlive`, set `KeepAlive` after `DisconnectTimeout`.</span></span> <span data-ttu-id="d06cd-270">Caso contrário, sua `KeepAlive` configuração serão substituídas ao `DisconnectTimeout` define automaticamente `KeepAlive` como 1/3 do valor de tempo limite.</span><span class="sxs-lookup"><span data-stu-id="d06cd-270">Otherwise your `KeepAlive` setting will be overwritten when `DisconnectTimeout` automatically sets `KeepAlive` to 1/3 of the timeout value.</span></span>

<span data-ttu-id="d06cd-271">Se você quiser desabilitar a funcionalidade de manutenção de atividade, defina `KeepAlive` como null.</span><span class="sxs-lookup"><span data-stu-id="d06cd-271">If you want to disable keepalive functionality, set `KeepAlive` to null.</span></span> <span data-ttu-id="d06cd-272">Funcionalidade keepalive será desabilitada automaticamente para o long transporte de sondagem.</span><span class="sxs-lookup"><span data-stu-id="d06cd-272">Keepalive functionality is automatically disabled for the long polling transport.</span></span>

<a id="changetimeout"></a>

### <a name="how-to-change-timeout-and-keepalive-settings"></a><span data-ttu-id="d06cd-273">Como alterar as configurações de tempo limite e keepalive</span><span class="sxs-lookup"><span data-stu-id="d06cd-273">How to change timeout and keepalive settings</span></span>

<span data-ttu-id="d06cd-274">Para alterar os valores padrão para essas configurações, defini-los no `Application_Start` em seu *global. asax* de arquivos, conforme mostrado no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="d06cd-274">To change the default values for these settings, set them in `Application_Start` in your *Global.asax* file, as shown in the following example.</span></span> <span data-ttu-id="d06cd-275">Os valores mostrados no código de exemplo são o mesmo que os valores padrão.</span><span class="sxs-lookup"><span data-stu-id="d06cd-275">The values shown in the sample code are the same as the default values.</span></span>

[!code-csharp[Main](handling-connection-lifetime-events/samples/sample1.cs)]

<a id="notifydisconnect"></a>

## <a name="how-to-notify-the-user-about-disconnections"></a><span data-ttu-id="d06cd-276">Como notificar o usuário sobre desconexões</span><span class="sxs-lookup"><span data-stu-id="d06cd-276">How to notify the user about disconnections</span></span>

<span data-ttu-id="d06cd-277">Em alguns aplicativos, você talvez queira exibir uma mensagem para o usuário quando houver problemas de conectividade.</span><span class="sxs-lookup"><span data-stu-id="d06cd-277">In some applications you might want to display a message to the user when there are connectivity problems.</span></span> <span data-ttu-id="d06cd-278">Você tem várias opções para como e quando fazer isso.</span><span class="sxs-lookup"><span data-stu-id="d06cd-278">You have several options for how and when to do this.</span></span> <span data-ttu-id="d06cd-279">Os exemplos de código a seguir são para um cliente JavaScript usando o proxy gerado.</span><span class="sxs-lookup"><span data-stu-id="d06cd-279">The following code samples are for a JavaScript client using the generated proxy.</span></span>

- <span data-ttu-id="d06cd-280">Manipular o `connectionSlow` evento para exibir uma mensagem assim que o SignalR é fica ciente dos problemas de conexão, antes que ele entra no modo reconectar-se.</span><span class="sxs-lookup"><span data-stu-id="d06cd-280">Handle the `connectionSlow` event to display a message as soon as SignalR is aware of connection problems, before it goes into reconnecting mode.</span></span>

    [!code-javascript[Main](handling-connection-lifetime-events/samples/sample2.js)]
- <span data-ttu-id="d06cd-281">Manipular o `reconnecting` evento para exibir uma mensagem quando o SignalR está ciente de uma desconexão e está indo para reconectar-se o modo.</span><span class="sxs-lookup"><span data-stu-id="d06cd-281">Handle the `reconnecting` event to display a message when SignalR is aware of a disconnection and is going into reconnecting mode.</span></span>

    [!code-javascript[Main](handling-connection-lifetime-events/samples/sample3.js)]
- <span data-ttu-id="d06cd-282">Manipular o `disconnected` atingiu o evento para exibir uma mensagem quando tentar se reconectar. Nesse cenário, a única maneira de restabelecer uma conexão com o servidor novamente é reiniciar a conexão do SignalR, chamando o `Start` método, que criará uma nova ID de conexão.</span><span class="sxs-lookup"><span data-stu-id="d06cd-282">Handle the `disconnected` event to display a message when an attempt to reconnect has timed out. In this scenario, the only way to re-establish a connection with the server again is to restart the SignalR connection by calling the `Start` method, which will create a new connection ID.</span></span> <span data-ttu-id="d06cd-283">O exemplo de código a seguir usa um sinalizador para certificar-se de que você emita a notificação somente depois de um tempo de limite de reconexão, não após um encerramento normal para a conexão do SignalR causado ao chamar o `Stop` método.</span><span class="sxs-lookup"><span data-stu-id="d06cd-283">The following code sample uses a flag to make sure that you issue the notification only after a reconnecting timeout, not after a normal end to the SignalR connection caused by calling the `Stop` method.</span></span>

    [!code-javascript[Main](handling-connection-lifetime-events/samples/sample4.js)]

<a id="continuousreconnect"></a>

## <a name="how-to-continuously-reconnect"></a><span data-ttu-id="d06cd-284">Como reconectar continuamente</span><span class="sxs-lookup"><span data-stu-id="d06cd-284">How to continuously reconnect</span></span>

<span data-ttu-id="d06cd-285">Em alguns aplicativos, convém automaticamente restabelecer uma conexão depois que foi perdido e tentar reconectar-se esgotou. Para fazer isso, você pode chamar o `Start` método a partir do seu `Closed` manipulador de eventos (`disconnected` manipulador de eventos em clientes JavaScript).</span><span class="sxs-lookup"><span data-stu-id="d06cd-285">In some applications you might want to automatically re-establish a connection after it has been lost and the attempt to reconnect has timed out. To do that, you can call the `Start` method from your `Closed` event handler (`disconnected` event handler on JavaScript clients).</span></span> <span data-ttu-id="d06cd-286">Talvez você queira aguardar um período de tempo antes de chamar `Start` para evitar fazer isso muito frequentemente quando o servidor ou a conexão física não estiverem disponíveis.</span><span class="sxs-lookup"><span data-stu-id="d06cd-286">You might want to wait a period of time before calling `Start` in order to avoid doing this too frequently when the server or the physical connection are unavailable.</span></span> <span data-ttu-id="d06cd-287">O exemplo de código a seguir é para um cliente JavaScript usando o proxy gerado.</span><span class="sxs-lookup"><span data-stu-id="d06cd-287">The following code sample is for a JavaScript client using the generated proxy.</span></span>

[!code-javascript[Main](handling-connection-lifetime-events/samples/sample5.js)]

<span data-ttu-id="d06cd-288">Um problema potencial para estar atento em clientes móveis é que as tentativas de reconexão contínua quando o servidor ou a conexão física não está disponível poderá causar desnecessária de bateria.</span><span class="sxs-lookup"><span data-stu-id="d06cd-288">A potential problem to be aware of in mobile clients is that continuous reconnection attempts when the server or physical connection isn't available could cause unnecessary battery drain.</span></span>

<a id="disconnectclientfromserver"></a>

## <a name="how-to-disconnect-a-client-in-server-code"></a><span data-ttu-id="d06cd-289">Como desconectar um cliente no código do servidor</span><span class="sxs-lookup"><span data-stu-id="d06cd-289">How to disconnect a client in server code</span></span>

<span data-ttu-id="d06cd-290">O SignalR versão 2 não tem uma API de servidor interno para desconexão de clientes.</span><span class="sxs-lookup"><span data-stu-id="d06cd-290">SignalR version 2 does not have a built-in server API for disconnecting clients.</span></span> <span data-ttu-id="d06cd-291">Há [planos para adicionar essa funcionalidade no futuro](https://github.com/SignalR/SignalR/issues/2101).</span><span class="sxs-lookup"><span data-stu-id="d06cd-291">There are [plans for adding this functionality in the future](https://github.com/SignalR/SignalR/issues/2101).</span></span> <span data-ttu-id="d06cd-292">Na versão atual do SignalR, a maneira mais simples de se desconectar de um cliente do servidor é implementar um método de desconexão no cliente e chamar esse método do servidor.</span><span class="sxs-lookup"><span data-stu-id="d06cd-292">In the current SignalR release, the simplest way to disconnect a client from the server is to implement a disconnect method on the client and call that method from the server.</span></span> <span data-ttu-id="d06cd-293">O exemplo de código a seguir mostra um método de desconexão de um cliente JavaScript usando o proxy gerado.</span><span class="sxs-lookup"><span data-stu-id="d06cd-293">The following code sample shows a disconnect method for a JavaScript client using the generated proxy.</span></span>

[!code-javascript[Main](handling-connection-lifetime-events/samples/sample6.js)]

> [!WARNING]
> <span data-ttu-id="d06cd-294">Security - nem esse método para desconexão de clientes, nem a API interna proposta abordarão o cenário de atacados clientes que estão executando o código mal-intencionado, desde que os clientes podem se reconectar ou o código atacados por um hacker pode remover o `stopClient` método ou alteração o que ele faz.</span><span class="sxs-lookup"><span data-stu-id="d06cd-294">Security - Neither this method for disconnecting clients nor the proposed built-in API will address the scenario of hacked clients that are running malicious code, since the clients could reconnect or the hacked code might remove the `stopClient` method or change what it does.</span></span> <span data-ttu-id="d06cd-295">O local adequado para implementar a proteção de (DOS) de negação de serviço com monitoração de estado não está na estrutura ou da camada de servidor, mas em vez disso, na infraestrutura de front-end.</span><span class="sxs-lookup"><span data-stu-id="d06cd-295">The appropriate place to implement stateful denial-of-service (DOS) protection is not in the framework or the server layer, but rather in front-end infrastructure.</span></span>


<a id="detectingreasonfordisconnection"></a>
## <a name="detecting-the-reason-for-a-disconnection"></a><span data-ttu-id="d06cd-296">Detectando o motivo de uma desconexão</span><span class="sxs-lookup"><span data-stu-id="d06cd-296">Detecting the reason for a disconnection</span></span>

<span data-ttu-id="d06cd-297">2.1 SignalR adiciona uma sobrecarga para o servidor `OnDisconnect` evento que indica se o cliente foi desconectado deliberadamente em vez de atingir o tempo limite. O `StopCalled` parâmetro é verdadeiro se o cliente fechada explicitamente a conexão.</span><span class="sxs-lookup"><span data-stu-id="d06cd-297">SignalR 2.1 adds an overload to the server `OnDisconnect` event that indicates if the client deliberately disconnected rather than timing out. The `StopCalled` parameter is true if the client explicitly closed the connection.</span></span> <span data-ttu-id="d06cd-298">No JavaScript, se um erro de servidor levou o cliente para se desconectar, as informações de erro serão passadas para o cliente como `$.connection.hub.lastError`.</span><span class="sxs-lookup"><span data-stu-id="d06cd-298">In JavaScript, if a server error led the client to disconnect, the error information will be passed to the client as `$.connection.hub.lastError`.</span></span>

<span data-ttu-id="d06cd-299">**O código do servidor c#: `stopCalled` parâmetro**</span><span class="sxs-lookup"><span data-stu-id="d06cd-299">**C# server code: `stopCalled` parameter**</span></span>

[!code-csharp[Main](handling-connection-lifetime-events/samples/sample7.cs?highlight=1,3)]

<span data-ttu-id="d06cd-300">**Código de cliente JavaScript: acessando `lastError` no `disconnect` eventos.**</span><span class="sxs-lookup"><span data-stu-id="d06cd-300">**JavaScript client code: accessing `lastError` in the `disconnect` event.**</span></span>

[!code-javascript[Main](handling-connection-lifetime-events/samples/sample8.js?highlight=2-3)]
