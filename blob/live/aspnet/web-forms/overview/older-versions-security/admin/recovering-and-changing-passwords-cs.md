---
uid: web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-cs
title: Recuperando e alterar senhas (c#) | Microsoft Docs
author: rick-anderson
description: "O ASP.NET inclui dois controles da Web para ajudar com a recuperação e a alteração de senhas. O controle PasswordRecovery habilita um visitante recuperar seu pa perdido..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/01/2008
ms.topic: article
ms.assetid: 19c4d042-4e34-4b44-9f1d-6bf2253ba366
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-cs
msc.type: authoredcontent
ms.openlocfilehash: ef10d5140073d28589c0be80a3a3bb4d3a554e35
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/10/2017
---
<a name="recovering-and-changing-passwords-c"></a><span data-ttu-id="54d11-104">Recuperando e alterar senhas (c#)</span><span class="sxs-lookup"><span data-stu-id="54d11-104">Recovering and Changing Passwords (C#)</span></span>
====================
<span data-ttu-id="54d11-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="54d11-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="54d11-106">[Baixar o código](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.13.zip) ou [baixar PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="54d11-106">[Download Code](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.13.zip) or [Download PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_cs.pdf)</span></span>

> <span data-ttu-id="54d11-107">O ASP.NET inclui dois controles da Web para ajudar com a recuperação e a alteração de senhas.</span><span class="sxs-lookup"><span data-stu-id="54d11-107">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="54d11-108">O controle PasswordRecovery permite que um visitante recuperar sua senha perdida.</span><span class="sxs-lookup"><span data-stu-id="54d11-108">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="54d11-109">O controle ChangePassword permite ao usuário atualizar sua senha.</span><span class="sxs-lookup"><span data-stu-id="54d11-109">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="54d11-110">Com os outros controles da Web relacionadas a logon já vimos em toda esta série de tutoriais, o PasswordRecovery e ChangePassword controles funcionam com a estrutura de associação em segundo plano para redefinir ou modificar senhas de usuários.</span><span class="sxs-lookup"><span data-stu-id="54d11-110">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>


## <a name="introduction"></a><span data-ttu-id="54d11-111">Introdução</span><span class="sxs-lookup"><span data-stu-id="54d11-111">Introduction</span></span>

<span data-ttu-id="54d11-112">Entre os sites para meu banco da empresa do utilitário, empresa de telefone, contas de email e portais da web personalizado, como a maioria das pessoas, tenho dezenas de senhas diferentes para lembrar.</span><span class="sxs-lookup"><span data-stu-id="54d11-112">Between the websites for my bank, utility company, phone company, email accounts, and personalized web portals, I, like most people, have dozens of different passwords to remember.</span></span> <span data-ttu-id="54d11-113">Com tantas credenciais para memorizar hoje em dia, não é incomum para as pessoas esquecer sua senha.</span><span class="sxs-lookup"><span data-stu-id="54d11-113">With so many credentials to memorize these days, it's not uncommon for people to forget their password.</span></span> <span data-ttu-id="54d11-114">Para levar isso em conta, sites que oferecem as contas de usuário precisam incluir uma forma de um usuário para recuperar sua senha.</span><span class="sxs-lookup"><span data-stu-id="54d11-114">To account for this, websites that offer user accounts need to include a way for a user to recover his password.</span></span> <span data-ttu-id="54d11-115">Esse processo normalmente envolve a geração de uma nova senha aleatória e enviar um email para o endereço de email do usuário no arquivo.</span><span class="sxs-lookup"><span data-stu-id="54d11-115">This process typically involves generating a new, random password and emailing it to the user's email address on file.</span></span> <span data-ttu-id="54d11-116">Após receber sua nova senha a maioria dos usuários retorne ao site e alterar sua senha do gerada aleatoriamente para um mais fácil de lembrar.</span><span class="sxs-lookup"><span data-stu-id="54d11-116">After receiving their new password most users return to the site and change their password from the randomly generated one to a more memorable one.</span></span>

<span data-ttu-id="54d11-117">O ASP.NET inclui dois controles da Web para ajudar com a recuperação e a alteração de senhas.</span><span class="sxs-lookup"><span data-stu-id="54d11-117">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="54d11-118">O controle PasswordRecovery permite que um visitante recuperar sua senha perdida.</span><span class="sxs-lookup"><span data-stu-id="54d11-118">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="54d11-119">O controle ChangePassword permite ao usuário atualizar sua senha.</span><span class="sxs-lookup"><span data-stu-id="54d11-119">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="54d11-120">Com os outros controles da Web relacionadas a logon já vimos em toda esta série de tutoriais, o PasswordRecovery e ChangePassword controles funcionam com a estrutura de associação em segundo plano para redefinir ou modificar senhas de usuários.</span><span class="sxs-lookup"><span data-stu-id="54d11-120">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>

<span data-ttu-id="54d11-121">Neste tutorial, examinaremos usando esses dois controles.</span><span class="sxs-lookup"><span data-stu-id="54d11-121">In this tutorial we will examine using these two controls.</span></span> <span data-ttu-id="54d11-122">Também veremos como alterar programaticamente e redefinir a senha do usuário por meio de `MembershipUser` da classe `ChangePassword` e `ResetPassword` métodos.</span><span class="sxs-lookup"><span data-stu-id="54d11-122">We will also see how to programmatically change and reset a user's password via the `MembershipUser` class's `ChangePassword` and `ResetPassword` methods.</span></span>

## <a name="step-1-helping-users-recover-lost-passwords"></a><span data-ttu-id="54d11-123">Etapa 1: Ajudando os usuários recuperar perdido senhas</span><span class="sxs-lookup"><span data-stu-id="54d11-123">Step 1: Helping Users Recover Lost Passwords</span></span>

<span data-ttu-id="54d11-124">Todos os sites que dão suporte a contas de usuário necessário fornecer aos usuários um mecanismo para recuperar suas senhas esquecidas.</span><span class="sxs-lookup"><span data-stu-id="54d11-124">All websites that support user accounts need to provide users with some mechanism for recovering their forgotten passwords.</span></span> <span data-ttu-id="54d11-125">A boa notícia é que implementar essa funcionalidade no ASP.NET é muito fácil graças ao controle PasswordRecovery Web.</span><span class="sxs-lookup"><span data-stu-id="54d11-125">The good news is that implementing such functionality in ASP.NET is a breeze thanks to the PasswordRecovery Web control.</span></span> <span data-ttu-id="54d11-126">O controle PasswordRecovery renderiza uma interface que solicita ao usuário seu nome de usuário e, se necessário, a resposta à sua pergunta de segurança.</span><span class="sxs-lookup"><span data-stu-id="54d11-126">The PasswordRecovery control renders an interface that prompts the user for their username and, if needed, the answer to their security question.</span></span> <span data-ttu-id="54d11-127">Ele envia o usuário a senha.</span><span class="sxs-lookup"><span data-stu-id="54d11-127">It then emails the user their password.</span></span>

> [!NOTE]
> <span data-ttu-id="54d11-128">Como as mensagens de email são transmitidas eletronicamente em texto sem formatação riscos de segurança são envolvidos com o envio de uma senha de usuário por email.</span><span class="sxs-lookup"><span data-stu-id="54d11-128">Because email messages are transmitted over the wire in plain-text there are security risks involved with sending a user's password via email.</span></span>


<span data-ttu-id="54d11-129">O controle PasswordRecovery consiste em três modos de exibição:</span><span class="sxs-lookup"><span data-stu-id="54d11-129">The PasswordRecovery control consists of three views:</span></span>

- <span data-ttu-id="54d11-130">**Nome de usuário** -solicita que o visitante do seu nome de usuário.</span><span class="sxs-lookup"><span data-stu-id="54d11-130">**UserName** - prompts the visitor for their username.</span></span> <span data-ttu-id="54d11-131">Esta é a exibição inicial.</span><span class="sxs-lookup"><span data-stu-id="54d11-131">This is the initial view.</span></span>
- <span data-ttu-id="54d11-132">**Pergunta**-exibe a pergunta de segurança e o nome de usuário do usuário como texto, juntamente com uma caixa de texto para o usuário insira a resposta à sua pergunta de segurança.</span><span class="sxs-lookup"><span data-stu-id="54d11-132">**Question**- displays the user's username and security question as text, along with a TextBox for the user to enter the answer to his security question.</span></span>
- <span data-ttu-id="54d11-133">**Sucesso**-exibe uma mensagem informando ao usuário que sua senha foi enviado por email.</span><span class="sxs-lookup"><span data-stu-id="54d11-133">**Success**- displays a message informing the user that his password has been emailed.</span></span>

<span data-ttu-id="54d11-134">Os modos de exibição exibido e ações realizadas pelo controle PasswordRecovery dependem dos seguintes parâmetros de configuração de associação:</span><span class="sxs-lookup"><span data-stu-id="54d11-134">The views displayed and actions performed by the PasswordRecovery control depend upon the following Membership configuration settings:</span></span>

- `RequiresQuestionAndAnswer`
- `EnablePasswordRetrieval`
- `EnablePasswordReset`

<span data-ttu-id="54d11-135">A estrutura de associação `RequiresQuestionAndAnswer` configuração indica se os usuários devem especificar uma pergunta de segurança e uma resposta ao se inscrever para uma conta.</span><span class="sxs-lookup"><span data-stu-id="54d11-135">The Membership framework's `RequiresQuestionAndAnswer` setting indicates whether users must specify a security question and answer when registering for an account.</span></span> <span data-ttu-id="54d11-136">Conforme abordado no <a id="_msoanchor_1"> </a> [ *criando contas de usuário* ](../membership/creating-user-accounts-cs.md) tutorial, se `RequiresQuestionAndAnswer` for True (o padrão) e a interface do CreateUserWizard inclui a caixa de texto controles para o novo usuário pergunta de segurança e resposta; Se `RequiresQuestionAndAnswer` for False, sem essas informações são coletadas.</span><span class="sxs-lookup"><span data-stu-id="54d11-136">As we discussed in the <a id="_msoanchor_1"></a>[*Creating User Accounts*](../membership/creating-user-accounts-cs.md) tutorial, if `RequiresQuestionAndAnswer` is True (the default) then the CreateUserWizard's interface includes TextBox controls for the new user's security question and answer; if `RequiresQuestionAndAnswer` is False, no such information is collected.</span></span> <span data-ttu-id="54d11-137">Da mesma forma, se `RequiresQuestionAndAnswer` for verdadeiro, as exibições de controle PasswordRecovery a pergunta exibir depois que o usuário insere seu nome de usuário e a senha é recuperada somente se o usuário insere a resposta de segurança correto.</span><span class="sxs-lookup"><span data-stu-id="54d11-137">Similarly, if `RequiresQuestionAndAnswer` is True, then the PasswordRecovery control displays the Question view after the user has entered their username; the password is recovered only if the user enters the correct security answer.</span></span> <span data-ttu-id="54d11-138">Se `RequiresQuestionAndAnswer` for False, no entanto, o controle PasswordRecovery move diretamente da exibição de nome de usuário para o modo de exibição de êxito.</span><span class="sxs-lookup"><span data-stu-id="54d11-138">If `RequiresQuestionAndAnswer` is False, however, the PasswordRecovery control moves straight from the UserName view to the Success view.</span></span>

<span data-ttu-id="54d11-139">Depois que o usuário forneceu seu nome de usuário - ou sua resposta de nome de usuário e segurança, se `RequiresQuestionAndAnswer` for True - o PasswordRecovery emails sua senha de usuário.</span><span class="sxs-lookup"><span data-stu-id="54d11-139">After the user has provided his username - or his username and security answer, if `RequiresQuestionAndAnswer` is True - the PasswordRecovery emails the user his password.</span></span> <span data-ttu-id="54d11-140">Se o `EnablePasswordRetrieval` opção é definida como True, então o usuário é enviado por email a senha atual.</span><span class="sxs-lookup"><span data-stu-id="54d11-140">If the `EnablePasswordRetrieval` option is set to True, then the user is emailed their current password.</span></span> <span data-ttu-id="54d11-141">Se ele for definido como False e `EnablePasswordReset` é definida como True, o controle PasswordRecovery gera uma nova senha aleatória para o usuário e emails essa nova senha para eles.</span><span class="sxs-lookup"><span data-stu-id="54d11-141">If it is set to False and `EnablePasswordReset` is set to True, then the PasswordRecovery control generates a new, random password for the user, and emails this new password to them.</span></span> <span data-ttu-id="54d11-142">Se ambos os `EnablePasswordRetrieval` e `EnablePasswordReset` são False, o controle PasswordRecovery lança uma exceção.</span><span class="sxs-lookup"><span data-stu-id="54d11-142">If both `EnablePasswordRetrieval` and `EnablePasswordReset` are False, the PasswordRecovery control throws an exception.</span></span>

> [!NOTE]
> <span data-ttu-id="54d11-143">Lembre-se de que o `SqlMembershipProvider` armazena as senhas dos usuários em um dos três formatos: Clear, Hashed (o padrão) ou criptografado.</span><span class="sxs-lookup"><span data-stu-id="54d11-143">Recall that the `SqlMembershipProvider` stores users' passwords in one of three formats: Clear, Hashed (the default), or Encrypted.</span></span> <span data-ttu-id="54d11-144">O mecanismo de armazenamento usado depende das configurações de configuração de associação; o aplicativo de demonstração usa o formato da senha Hashed.</span><span class="sxs-lookup"><span data-stu-id="54d11-144">The storage mechanism used depends on the Membership configuration settings; the demo application uses the Hashed password format.</span></span> <span data-ttu-id="54d11-145">Ao usar o formato da senha Hashed o `EnablePasswordRetrieval` opção deve ser definida como False, porque o sistema não pode determinar a senha do usuário real da versão de hash armazenada no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="54d11-145">When using the Hashed password format the `EnablePasswordRetrieval` option must be set to False because the system cannot determine the user's actual password from the hashed version stored in the database.</span></span>


<span data-ttu-id="54d11-146">A Figura 1 ilustra como a interface e o comportamento do PasswordRecovery é influenciado pela configuração de associação.</span><span class="sxs-lookup"><span data-stu-id="54d11-146">Figure 1 illustrates how the PasswordRecovery's interface and behavior is influenced by the Membership configuration.</span></span>


<span data-ttu-id="54d11-147">[![O RequiresQuestionAndAnswer, EnablePasswordRetrieval e EnablePasswordReset influenciar a aparência e o comportamento do controle PasswordRecovery](recovering-and-changing-passwords-cs/_static/image2.png)](recovering-and-changing-passwords-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="54d11-147">[![The RequiresQuestionAndAnswer, EnablePasswordRetrieval, and EnablePasswordReset Influence the PasswordRecovery control's Appearance and Behavior](recovering-and-changing-passwords-cs/_static/image2.png)](recovering-and-changing-passwords-cs/_static/image1.png)</span></span>

<span data-ttu-id="54d11-148">**Figura 1**: O `RequiresQuestionAndAnswer`, `EnablePasswordRetrieval`, e `EnablePasswordReset` influenciar a aparência e o comportamento do controle PasswordRecovery ([clique para exibir a imagem em tamanho normal](recovering-and-changing-passwords-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="54d11-148">**Figure 1**: The `RequiresQuestionAndAnswer`, `EnablePasswordRetrieval`, and `EnablePasswordReset` Influence the PasswordRecovery control's Appearance and Behavior  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image3.png))</span></span>


> [!NOTE]
> <span data-ttu-id="54d11-149">No <a id="_msoanchor_2"> </a> [ *criar o esquema de associação no SQL Server* ](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial configuramos o provedor de associação, definindo `RequiresQuestionAndAnswer` como True, `EnablePasswordRetrieval` para False, e `EnablePasswordReset` como True.</span><span class="sxs-lookup"><span data-stu-id="54d11-149">In the <a id="_msoanchor_2"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial we configured the Membership provider by setting `RequiresQuestionAndAnswer` to True, `EnablePasswordRetrieval` to False, and `EnablePasswordReset` to True.</span></span>


### <a name="using-the-passwordrecovery-control"></a><span data-ttu-id="54d11-150">Usando o controle PasswordRecovery</span><span class="sxs-lookup"><span data-stu-id="54d11-150">Using the PasswordRecovery Control</span></span>

<span data-ttu-id="54d11-151">Vamos examinar usando o controle PasswordRecovery em uma página ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="54d11-151">Let's look at using the PasswordRecovery control in an ASP.NET page.</span></span> <span data-ttu-id="54d11-152">Abra `RecoverPassword.aspx` e arraste e solte um controle PasswordRecovery da caixa de ferramentas para o Designer; definir seu `ID` para `RecoverPwd`.</span><span class="sxs-lookup"><span data-stu-id="54d11-152">Open `RecoverPassword.aspx` and drag and drop a PasswordRecovery control from the Toolbox onto the Designer; set its `ID` to `RecoverPwd`.</span></span> <span data-ttu-id="54d11-153">Como os controles de logon e CreateUserWizard Web, modos de exibição do controle PasswordRecovery renderizam uma interface avançada composta que inclui os rótulos, caixas de texto, botões e controles de validação.</span><span class="sxs-lookup"><span data-stu-id="54d11-153">Like the Login and CreateUserWizard Web controls, the PasswordRecovery control's views render a rich composite interface that includes Labels, TextBoxes, Buttons, and validation controls.</span></span> <span data-ttu-id="54d11-154">Você pode personalizar a aparência das exibições por meio das propriedades de estilo do controle ou convertendo os modos de exibição para um modelo.</span><span class="sxs-lookup"><span data-stu-id="54d11-154">You can customize the appearance of the views through the control's style properties or by converting the views into templates.</span></span> <span data-ttu-id="54d11-155">Posso deixar isso como um exercício para o leitor de interesse.</span><span class="sxs-lookup"><span data-stu-id="54d11-155">I leave this as an exercise for the interested reader.</span></span>

<span data-ttu-id="54d11-156">Quando um usuário visita esta página, ela será insira seu nome de usuário e clique no botão Enviar.</span><span class="sxs-lookup"><span data-stu-id="54d11-156">When a user visits this page she will enter her username and click the Submit button.</span></span> <span data-ttu-id="54d11-157">Como definimos o `RequiresQuestionAndAnswer` propriedade como True no nosso definições de configuração de associação, o PasswordRecovery controlar será, em seguida, exibe o modo de exibição de pergunta.</span><span class="sxs-lookup"><span data-stu-id="54d11-157">Because we have set the `RequiresQuestionAndAnswer` property to True in our Membership configuration settings, the PasswordRecovery control will then display the Question view.</span></span> <span data-ttu-id="54d11-158">Depois que o usuário insere sua resposta de segurança corretas e clicar em enviar, o controle PasswordRecovery atualizar a senha do usuário para um gerada aleatoriamente e essa senha para o endereço de email no arquivo de email.</span><span class="sxs-lookup"><span data-stu-id="54d11-158">After the user enters her correct security answer and clicks Submit, the PasswordRecovery control will update the user's password to a randomly-generated one, and email this password to the email address on file.</span></span> <span data-ttu-id="54d11-159">Tudo isso era possível sem nós precisar escrever uma única linha de código!</span><span class="sxs-lookup"><span data-stu-id="54d11-159">All of this was possible without us having to write a single line of code!</span></span>

<span data-ttu-id="54d11-160">Antes de você testa esta página, há uma parte final da configuração para tendem a: é necessário especificar as configurações de entrega de email em `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="54d11-160">Before you test this page, there's one final piece of configuration to tend to: we need to specify the mail delivery settings in `Web.config`.</span></span> <span data-ttu-id="54d11-161">O controle PasswordRecovery depende dessas configurações para enviar o email.</span><span class="sxs-lookup"><span data-stu-id="54d11-161">The PasswordRecovery control relies on these settings for sending the email.</span></span>

<span data-ttu-id="54d11-162">A configuração de entrega de email for especificada por meio de [ `<system.net>` elemento](https://msdn.microsoft.com/en-us/library/6484zdc1.aspx)do [ `<mailSettings>` elemento](https://msdn.microsoft.com/en-us/library/w355a94k.aspx).</span><span class="sxs-lookup"><span data-stu-id="54d11-162">The mail delivery configuration is specified through the [`<system.net>` element](https://msdn.microsoft.com/en-us/library/6484zdc1.aspx)'s [`<mailSettings>` element](https://msdn.microsoft.com/en-us/library/w355a94k.aspx).</span></span> <span data-ttu-id="54d11-163">Use o [ `<smtp>` elemento](https://msdn.microsoft.com/en-us/library/ms164240.aspx) para indicar o método de entrega e o padrão de endereço.</span><span class="sxs-lookup"><span data-stu-id="54d11-163">Use the [`<smtp>` element](https://msdn.microsoft.com/en-us/library/ms164240.aspx) to indicate the delivery method and the default From address.</span></span> <span data-ttu-id="54d11-164">A seguinte marcação define as configurações de email para usar um servidor de rede SMTP chamado `smtp.example.com` na porta 25 e com as credenciais de nome de usuário e senha de usuário e senha.</span><span class="sxs-lookup"><span data-stu-id="54d11-164">The following markup configures mail settings to use a network SMTP server named `smtp.example.com` on port 25 and with username/password credentials of username and password.</span></span>

> [!NOTE]
> <span data-ttu-id="54d11-165">`<system.net>`é um elemento filho da raiz `<configuration>` elemento e um irmão de `<system.web>`.</span><span class="sxs-lookup"><span data-stu-id="54d11-165">`<system.net>` is a child element of the root `<configuration>` element and a sibling of `<system.web>`.</span></span> <span data-ttu-id="54d11-166">Portanto, não coloque o `<system.net>` elemento dentro do `<system.web>` elemento; em vez disso, coloque-o no mesmo nível.</span><span class="sxs-lookup"><span data-stu-id="54d11-166">Therefore, do not put the `<system.net>` element within the `<system.web>` element; instead, put it at the same level.</span></span>


[!code-xml[Main](recovering-and-changing-passwords-cs/samples/sample1.xml)]

<span data-ttu-id="54d11-167">Além de usar um servidor SMTP na rede, você poderá especificar um diretório de retirada de onde as mensagens de email a ser enviada devem depositadas.</span><span class="sxs-lookup"><span data-stu-id="54d11-167">In addition to using an SMTP server on the network, you can alternatively specify a pickup directory where email messages to be sent should be deposited.</span></span>

<span data-ttu-id="54d11-168">Depois de configurar as configurações de SMTP, visite o `RecoverPassword.aspx` página através de um navegador.</span><span class="sxs-lookup"><span data-stu-id="54d11-168">Once you have configured the SMTP settings, visit the `RecoverPassword.aspx` page through a browser.</span></span> <span data-ttu-id="54d11-169">Primeiro, tente inserir um nome de usuário que não existe no repositório do usuário.</span><span class="sxs-lookup"><span data-stu-id="54d11-169">First try entering a username that doesn't exist in the user store.</span></span> <span data-ttu-id="54d11-170">Como mostra a Figura 2, o controle PasswordRecovery exibe uma mensagem indicando que não foi possível acessar as informações do usuário.</span><span class="sxs-lookup"><span data-stu-id="54d11-170">As Figure 2 shows, the PasswordRecovery control displays a message indicating that the user information could not be accessed.</span></span> <span data-ttu-id="54d11-171">O texto da mensagem pode ser personalizado por meio do controle [ `UserNameFailureText` propriedade](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx).</span><span class="sxs-lookup"><span data-stu-id="54d11-171">The text of the message can be customized through the control's [`UserNameFailureText` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx).</span></span>


<span data-ttu-id="54d11-172">[![Uma mensagem de erro é exibida se for digitado um nome de usuário inválido](recovering-and-changing-passwords-cs/_static/image5.png)](recovering-and-changing-passwords-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="54d11-172">[![An Error Message is Displayed if an Invalid Username is Entered](recovering-and-changing-passwords-cs/_static/image5.png)](recovering-and-changing-passwords-cs/_static/image4.png)</span></span>

<span data-ttu-id="54d11-173">**Figura 2**: uma mensagem de erro é exibida se for digitado um nome de usuário inválido ([clique para exibir a imagem em tamanho normal](recovering-and-changing-passwords-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="54d11-173">**Figure 2**: An Error Message is Displayed if an Invalid Username is Entered  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image6.png))</span></span>


<span data-ttu-id="54d11-174">Agora, insira um nome de usuário.</span><span class="sxs-lookup"><span data-stu-id="54d11-174">Now enter a username.</span></span> <span data-ttu-id="54d11-175">Use o nome de usuário de uma conta do sistema com um endereço de email que você pode acessar e cuja segurança responder você sabe.</span><span class="sxs-lookup"><span data-stu-id="54d11-175">Use the username of an account in the system with an email address that you can access and whose security answer you know.</span></span> <span data-ttu-id="54d11-176">Depois de inserir o nome de usuário e clicar em enviar, o controle PasswordRecovery exibe sua pergunta.</span><span class="sxs-lookup"><span data-stu-id="54d11-176">After entering the username and clicking Submit, the PasswordRecovery control displays its Question view.</span></span> <span data-ttu-id="54d11-177">Como com o modo de exibição de nome de usuário, se você inserir um incorreto responder as exibições de controle PasswordRecovery uma mensagem de erro (consulte a Figura 3).</span><span class="sxs-lookup"><span data-stu-id="54d11-177">As with the UserName view, if you enter an incorrect answer the PasswordRecovery control displays an error message (see Figure 3).</span></span> <span data-ttu-id="54d11-178">Use o [ `QuestionFailureText` propriedade](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx) personalizar essa mensagem de erro.</span><span class="sxs-lookup"><span data-stu-id="54d11-178">Use the [`QuestionFailureText` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx) to customize this error message.</span></span>


<span data-ttu-id="54d11-179">[![Uma mensagem de erro será exibida se o usuário insere uma resposta de segurança inválido](recovering-and-changing-passwords-cs/_static/image8.png)](recovering-and-changing-passwords-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="54d11-179">[![An Error Message is Displayed if the User Enters an Invalid Security Answer](recovering-and-changing-passwords-cs/_static/image8.png)](recovering-and-changing-passwords-cs/_static/image7.png)</span></span>

<span data-ttu-id="54d11-180">**Figura 3**: uma mensagem de erro será exibida se o usuário insere uma resposta de segurança inválido ([clique para exibir a imagem em tamanho normal](recovering-and-changing-passwords-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="54d11-180">**Figure 3**: An Error Message is Displayed if the User Enters an Invalid Security Answer  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image9.png))</span></span>


<span data-ttu-id="54d11-181">Finalmente, digite a resposta de segurança correto e clique em enviar.</span><span class="sxs-lookup"><span data-stu-id="54d11-181">Finally, enter the correct security answer and click Submit.</span></span> <span data-ttu-id="54d11-182">Nos bastidores, o controle PasswordRecovery gera uma senha aleatória, atribui à conta de usuário, envia um email informando ao usuário de sua nova senha (consulte a Figura 4) e, em seguida, exibe o modo de exibição de êxito.</span><span class="sxs-lookup"><span data-stu-id="54d11-182">Behind the scenes, the PasswordRecovery control generates a random password, assigns it to the user account, sends an email informing the user of their new password (see Figure 4), and then displays the Success view.</span></span>


<span data-ttu-id="54d11-183">[![O usuário é enviado um Email com a nova senha His](recovering-and-changing-passwords-cs/_static/image11.png)](recovering-and-changing-passwords-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="54d11-183">[![The User is Sent an Email with His New Password](recovering-and-changing-passwords-cs/_static/image11.png)](recovering-and-changing-passwords-cs/_static/image10.png)</span></span>

<span data-ttu-id="54d11-184">**Figura 4**: O usuário é enviado um Email com a nova senha His ([clique para exibir a imagem em tamanho normal](recovering-and-changing-passwords-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="54d11-184">**Figure 4**: The User is Sent an Email with His New Password  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image12.png))</span></span>


### <a name="customizing-the-email"></a><span data-ttu-id="54d11-185">Personalizando o Email</span><span class="sxs-lookup"><span data-stu-id="54d11-185">Customizing the Email</span></span>

<span data-ttu-id="54d11-186">O email padrão enviado pelo controle PasswordRecovery é bastante opaco (veja a Figura 4).</span><span class="sxs-lookup"><span data-stu-id="54d11-186">The default email sent by the PasswordRecovery control is rather dull (see Figure 4).</span></span> <span data-ttu-id="54d11-187">A mensagem é enviada da conta especificada no `<smtp>` do elemento `from` atributo com a senha de assunto e o corpo de texto sem formatação:</span><span class="sxs-lookup"><span data-stu-id="54d11-187">The message is sent from the account specified in the `<smtp>` element's `from` attribute with the subject Password and the plain-text body:</span></span>

<span data-ttu-id="54d11-188">Volte para o site e faça logon usando as informações a seguir.</span><span class="sxs-lookup"><span data-stu-id="54d11-188">Please return to the site and log in using the following information.</span></span>

<span data-ttu-id="54d11-189">Nome de usuário: *nome de usuário*</span><span class="sxs-lookup"><span data-stu-id="54d11-189">User Name: *username*</span></span>

<span data-ttu-id="54d11-190">senha: *senha*</span><span class="sxs-lookup"><span data-stu-id="54d11-190">Password: *password*</span></span>

<span data-ttu-id="54d11-191">Essa mensagem pode ser personalizada programaticamente por meio de um manipulador de eventos do controle PasswordRecovery [ `SendingMail` evento](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx), ou declarativamente por meio de [ `MailDefinition` propriedade](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx).</span><span class="sxs-lookup"><span data-stu-id="54d11-191">This message can be customized programmatically through an event handler for the PasswordRecovery control's [`SendingMail` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx), or declaratively through the [`MailDefinition` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx).</span></span> <span data-ttu-id="54d11-192">Vamos explorar essas duas opções.</span><span class="sxs-lookup"><span data-stu-id="54d11-192">Let's explore both of these options.</span></span>

<span data-ttu-id="54d11-193">O `SendingMail` evento é acionado logo antes da mensagem de email é enviada e é nossa última oportunidade de ajustar programaticamente a mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="54d11-193">The `SendingMail` event is fired right before the email message is sent and is our last chance to programmatically adjust the email message.</span></span> <span data-ttu-id="54d11-194">Quando esse evento é gerado, o manipulador de eventos é passado um objeto do tipo [ `MailMessageEventArgs` ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.mailmessageeventargs.aspx), cujo `Message` propriedade contém uma referência para o email prestes a ser enviado.</span><span class="sxs-lookup"><span data-stu-id="54d11-194">When this event is raised, the event handler is passed an object of type [`MailMessageEventArgs`](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.mailmessageeventargs.aspx), whose `Message` property contains a reference to the email about to be sent.</span></span>

<span data-ttu-id="54d11-195">Criar um manipulador de eventos para o `SendingMail` evento e adicione o código a seguir, que adiciona programaticamente `webmaster@example.com` à lista CC.</span><span class="sxs-lookup"><span data-stu-id="54d11-195">Create an event handler for the `SendingMail` event and add the following code, which programmatically adds `webmaster@example.com` to the CC list.</span></span>

[!code-csharp[Main](recovering-and-changing-passwords-cs/samples/sample2.cs)]

<span data-ttu-id="54d11-196">A mensagem de email também pode ser configurada por meio de declarativo.</span><span class="sxs-lookup"><span data-stu-id="54d11-196">The email message can also be configured through declarative means.</span></span> <span data-ttu-id="54d11-197">O PasswordRecovery `MailDefinition` propriedade é um objeto do tipo [ `MailDefinition` ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.maildefinition.aspx).</span><span class="sxs-lookup"><span data-stu-id="54d11-197">The PasswordRecovery's `MailDefinition` property is an object of type [`MailDefinition`](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.maildefinition.aspx).</span></span> <span data-ttu-id="54d11-198">O `MailDefinition` classe oferece um conjunto de propriedades relacionadas a email, incluindo `From`, `CC`, `Priority`, `Subject`, `IsBodyHtml`, `BodyFileName`e outros.</span><span class="sxs-lookup"><span data-stu-id="54d11-198">The `MailDefinition` class offers a host of email-related properties, including `From`, `CC`, `Priority`, `Subject`, `IsBodyHtml`, `BodyFileName`, and others.</span></span> <span data-ttu-id="54d11-199">Para começar, defina o [ `Subject` propriedade](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.maildefinition.subject.aspx) para algo mais descritivo do que aquele usado por padrão (senha), como sua senha foi redefinida...</span><span class="sxs-lookup"><span data-stu-id="54d11-199">For starters, set the [`Subject` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.maildefinition.subject.aspx) to something more descriptive than the one used by default ( Password ), such as Your password has been reset...</span></span>

<span data-ttu-id="54d11-200">Para personalizar o corpo da mensagem de email, precisamos criar um arquivo de modelo de email separado que contém o conteúdo do corpo.</span><span class="sxs-lookup"><span data-stu-id="54d11-200">To customize the body of the email message we need to create a separate email template file that contains the body's contents.</span></span> <span data-ttu-id="54d11-201">Comece criando uma nova pasta no site de chamada `EmailTemplates`.</span><span class="sxs-lookup"><span data-stu-id="54d11-201">Start by creating a new folder in the website named `EmailTemplates`.</span></span> <span data-ttu-id="54d11-202">Em seguida, adicione um novo arquivo de texto para essa pasta chamada `PasswordRecovery.txt` e adicione o seguinte conteúdo:</span><span class="sxs-lookup"><span data-stu-id="54d11-202">Next, add a new text file to this folder named `PasswordRecovery.txt` and add the following content:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-cs/samples/sample3.aspx)]

<span data-ttu-id="54d11-203">Observe o uso dos espaços reservados `<%UserName%>` e `<%Password%>`.</span><span class="sxs-lookup"><span data-stu-id="54d11-203">Note the use of the placeholders `<%UserName%>` and `<%Password%>`.</span></span> <span data-ttu-id="54d11-204">O controle PasswordRecovery substitui automaticamente esses espaços duas reservados com o nome de usuário e a senha recuperada antes de enviar o email do usuário.</span><span class="sxs-lookup"><span data-stu-id="54d11-204">The PasswordRecovery control automatically replaces these two placeholders with the user's username and recovered password prior to sending the email.</span></span>

<span data-ttu-id="54d11-205">Por fim, aponte o `MailDefinition`do [ `BodyFileName` propriedade](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) para o modelo de email que acabamos de criar (`~/EmailTemplates/PasswordRecovery.txt`).</span><span class="sxs-lookup"><span data-stu-id="54d11-205">Lastly, point the `MailDefinition`'s [`BodyFileName` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) to the email template we just created (`~/EmailTemplates/PasswordRecovery.txt`).</span></span>

<span data-ttu-id="54d11-206">Depois de fazer essas alterações revisitar o `RecoverPassword.aspx` página e digite sua resposta de nome de usuário e segurança.</span><span class="sxs-lookup"><span data-stu-id="54d11-206">After making these changes revisit the `RecoverPassword.aspx` page and enter your username and security answer.</span></span> <span data-ttu-id="54d11-207">Você receberá deve um email que será semelhante à mostrada na Figura 5.</span><span class="sxs-lookup"><span data-stu-id="54d11-207">You receive should an email that looks like the one in Figure 5.</span></span> <span data-ttu-id="54d11-208">Observe que `webmaster@example.com` foi seria CC e o assunto e corpo foi atualizados.</span><span class="sxs-lookup"><span data-stu-id="54d11-208">Note that `webmaster@example.com` has been CC'd and that the subject and body have been updated.</span></span>


<span data-ttu-id="54d11-209">[![Lista CC, assunto e corpo foram atualizadas](recovering-and-changing-passwords-cs/_static/image14.png)](recovering-and-changing-passwords-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="54d11-209">[![The Subject, Body, and CC List Have Been Updated](recovering-and-changing-passwords-cs/_static/image14.png)](recovering-and-changing-passwords-cs/_static/image13.png)</span></span>

<span data-ttu-id="54d11-210">**Figura 5**: O assunto, corpo e CC lista foram atualizadas ([clique para exibir a imagem em tamanho normal](recovering-and-changing-passwords-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="54d11-210">**Figure 5**: The Subject, Body, and CC List Have Been Updated  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image15.png))</span></span>


<span data-ttu-id="54d11-211">Para enviar um email formatado em HTML definido [ `IsBodyHtml` ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) como True (o padrão é falso) e atualizar o modelo de email para incluir HTML.</span><span class="sxs-lookup"><span data-stu-id="54d11-211">To send an HTML-formatted email set [`IsBodyHtml`](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) to True (the default is False) and update the email template to include HTML.</span></span>

<span data-ttu-id="54d11-212">O `MailDefinition` propriedade não é exclusiva para a classe PasswordRecovery.</span><span class="sxs-lookup"><span data-stu-id="54d11-212">The `MailDefinition` property is not unique to the PasswordRecovery class.</span></span> <span data-ttu-id="54d11-213">Como veremos na etapa 2, o controle ChangePassword também oferece um `MailDefinition` propriedade.</span><span class="sxs-lookup"><span data-stu-id="54d11-213">As we will see in Step 2, the ChangePassword control also offers a `MailDefinition` property.</span></span> <span data-ttu-id="54d11-214">Além disso, o controle CreateUserWizard inclui uma propriedade que você pode configurar para enviar uma mensagem de email de boas-vindas automaticamente para novos usuários.</span><span class="sxs-lookup"><span data-stu-id="54d11-214">Moreover, the CreateUserWizard control includes such a property that you can configure to automatically send a welcome email message to new users.</span></span>

> [!NOTE]
> <span data-ttu-id="54d11-215">Atualmente não existem links no painel de navegação esquerdo para alcançar o `RecoverPassword.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="54d11-215">Currently there are no links in the left-hand navigation for reaching the `RecoverPassword.aspx` page.</span></span> <span data-ttu-id="54d11-216">Um usuário somente gostariam de visitar essa página se ela não foi possível para fazer logon com êxito o site.</span><span class="sxs-lookup"><span data-stu-id="54d11-216">A user would only be interested in visiting this page if she was unable to successfully log on to the site.</span></span> <span data-ttu-id="54d11-217">Portanto, atualizar o `Login.aspx` página para incluir um link para o `RecoverPassword.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="54d11-217">Therefore, update the `Login.aspx` page to include a link to the `RecoverPassword.aspx` page.</span></span>


### <a name="programmatically-resetting-a-users-password"></a><span data-ttu-id="54d11-218">Programaticamente, redefinindo a senha do usuário</span><span class="sxs-lookup"><span data-stu-id="54d11-218">Programmatically Resetting a User's Password</span></span>

<span data-ttu-id="54d11-219">Quando redefinir uma senha de usuário a PasswordRecovery controlar chamadas de `MembershipUser` do objeto [ `ResetPassword` método](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.resetpassword.aspx).</span><span class="sxs-lookup"><span data-stu-id="54d11-219">When resetting a user's password the PasswordRecovery control calls the `MembershipUser` object's [`ResetPassword` method](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.resetpassword.aspx).</span></span> <span data-ttu-id="54d11-220">Esse método tem duas sobrecargas:</span><span class="sxs-lookup"><span data-stu-id="54d11-220">This method has two overloads:</span></span>

- <span data-ttu-id="54d11-221">**[`ResetPassword`](https://msdn.microsoft.com/en-us/library/d94bdzz2.aspx)**-Redefine a senha do usuário.</span><span class="sxs-lookup"><span data-stu-id="54d11-221">**[`ResetPassword`](https://msdn.microsoft.com/en-us/library/d94bdzz2.aspx)** - resets a user's password.</span></span> <span data-ttu-id="54d11-222">Use essa sobrecarga se `RequiresQuestionAndAnswer` é False.</span><span class="sxs-lookup"><span data-stu-id="54d11-222">Use this overload if `RequiresQuestionAndAnswer` is False.</span></span>
- <span data-ttu-id="54d11-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/en-us/library/d90zte4w.aspx)**-Redefine se somente de senha do usuário fornecido *securityAnswer* está correto.</span><span class="sxs-lookup"><span data-stu-id="54d11-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/en-us/library/d90zte4w.aspx)** - resets a user's password only if the supplied *securityAnswer* is correct.</span></span> <span data-ttu-id="54d11-224">Use essa sobrecarga se `RequiresQuestionAndAnswer` for True.</span><span class="sxs-lookup"><span data-stu-id="54d11-224">Use this overload if `RequiresQuestionAndAnswer` is True.</span></span>

<span data-ttu-id="54d11-225">As duas sobrecargas retornam a nova senha gerada aleatoriamente.</span><span class="sxs-lookup"><span data-stu-id="54d11-225">Both overloads return the new, randomly-generated password.</span></span>

<span data-ttu-id="54d11-226">Como com outros métodos na estrutura de associação, o `ResetPassword` delegados de método para o provedor configurado.</span><span class="sxs-lookup"><span data-stu-id="54d11-226">Like with the other methods in the Membership framework, the `ResetPassword` method delegates to the configured provider.</span></span> <span data-ttu-id="54d11-227">O `SqlMembershipProvider` invoca o `aspnet_Membership_ResetPassword` procedimento armazenado, passando o nome do usuário, a nova senha e a resposta de senha fornecida, entre outros campos.</span><span class="sxs-lookup"><span data-stu-id="54d11-227">The `SqlMembershipProvider` invokes the `aspnet_Membership_ResetPassword` stored procedure, passing in the user's username, the new password, and the supplied password answer, among other fields.</span></span> <span data-ttu-id="54d11-228">O procedimento armazenado garante que a resposta de senha corresponde e, em seguida, atualiza a senha do usuário.</span><span class="sxs-lookup"><span data-stu-id="54d11-228">The stored procedure ensures that the password answer matches and then updates the user's password.</span></span>

<span data-ttu-id="54d11-229">Algumas observações de nível baixo de implementação:</span><span class="sxs-lookup"><span data-stu-id="54d11-229">A couple of low-level implementation notes:</span></span>

- <span data-ttu-id="54d11-230">Um usuário bloqueado não pode redefinir sua senha.</span><span class="sxs-lookup"><span data-stu-id="54d11-230">A locked out user cannot reset her password.</span></span> <span data-ttu-id="54d11-231">No entanto, talvez um usuário não aprovado.</span><span class="sxs-lookup"><span data-stu-id="54d11-231">However, an unapproved user may.</span></span> <span data-ttu-id="54d11-232">Podemos discutir o bloqueado e aprovada estados mais detalhadamente o <a id="_msoanchor_3"> </a> [ *Unlocking e o usuário aprovar* ](unlocking-and-approving-user-accounts-cs.md) tutorial de contas.</span><span class="sxs-lookup"><span data-stu-id="54d11-232">We will discuss the locked out and approved states in more detail in the <a id="_msoanchor_3"></a>[*Unlocking and Approving User*](unlocking-and-approving-user-accounts-cs.md) Accounts tutorial.</span></span>
- <span data-ttu-id="54d11-233">Se a resposta da senha está incorreta, a contagem de tentativas de resposta de senha do usuário é incrementada.</span><span class="sxs-lookup"><span data-stu-id="54d11-233">If the password answer is incorrect, the user's failed password answer attempt count is incremented.</span></span> <span data-ttu-id="54d11-234">Se um número de tentativas de resposta de segurança inválido especificado ocorrer dentro de uma janela de tempo especificado, o usuário está bloqueado.</span><span class="sxs-lookup"><span data-stu-id="54d11-234">If a specified number of invalid security answer attempts occur within a specified time window, the user is locked out.</span></span>

### <a name="a-word-on-how-the-random-passwords-are-generated"></a><span data-ttu-id="54d11-235">Uma palavra em como as senhas aleatórias são gerados</span><span class="sxs-lookup"><span data-stu-id="54d11-235">A Word on How the Random Passwords are Generated</span></span>

<span data-ttu-id="54d11-236">As senhas gerado aleatoriamente que mostra as mensagens de email em figuras 4 e 5 são criadas, a classe de associação [ `GeneratePassword` método](https://msdn.microsoft.com/en-us/library/system.web.security.membership.generatepassword.aspx).</span><span class="sxs-lookup"><span data-stu-id="54d11-236">The randomly-generated passwords shown in the email messages in Figures 4 and 5 are created by the Membership class's [`GeneratePassword` method](https://msdn.microsoft.com/en-us/library/system.web.security.membership.generatepassword.aspx).</span></span> <span data-ttu-id="54d11-237">Esse método aceita dois parâmetros de entrada de inteiro - *comprimento* e *numberOfNonAlphanumericCharacters* - e retorna uma cadeia de caracteres de pelo menos *comprimento* caracteres no menos *numberOfNonAlphanumericCharacters* número de caracteres não alfanuméricos.</span><span class="sxs-lookup"><span data-stu-id="54d11-237">This method accepts two integer input paramters - *length* and *numberOfNonAlphanumericCharacters* - and returns a string at least *length* characters long with at least *numberOfNonAlphanumericCharacters* number of non-alphanumeric characters.</span></span> <span data-ttu-id="54d11-238">Quando este método é chamado de dentro de classes de associação ou controles da Web relacionadas a logon, os valores para esses dois parâmetros são determinados pela configuração de associação `MinRequiredPasswordLength` e `MinRequiredNonalphanumericCharacters` propriedades, que são definidos como 7 e 1, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="54d11-238">When this method is called from within the Membership classes or Login-related Web controls, the values for these two parameters are determined by the Membership configuration's `MinRequiredPasswordLength` and `MinRequiredNonalphanumericCharacters` properties, which we set to 7 and 1, respectively.</span></span>

<span data-ttu-id="54d11-239">O `GeneratePassword` método usa um gerador de números aleatórios criptograficamente forte para garantir que não há nenhuma diferença na qual caracteres aleatórios estão selecionados.</span><span class="sxs-lookup"><span data-stu-id="54d11-239">The `GeneratePassword` method uses a cryptographically strong random number generator to ensure that there is no bias in what random characters are selected.</span></span> <span data-ttu-id="54d11-240">Além disso, `GeneratePassword` é `public`, que significa que você pode usá-lo diretamente do seu aplicativo ASP.NET se você precisar gerar cadeias de caracteres aleatórias ou senhas.</span><span class="sxs-lookup"><span data-stu-id="54d11-240">Furthermore, `GeneratePassword` is `public`, meaning that you can use it directly from your ASP.NET application if you need to generate random strings or passwords.</span></span>

> [!NOTE]
> <span data-ttu-id="54d11-241">O `SqlMembershipProvider` classe sempre gera uma senha aleatória de no mínimo 14 caracteres, portanto, se `MinRequiredPasswordLength` for inferior a 14, seu valor é ignorado.</span><span class="sxs-lookup"><span data-stu-id="54d11-241">The `SqlMembershipProvider` class always generates a random password at least 14 characters long, so if `MinRequiredPasswordLength` is less than 14 then its value is ignored.</span></span>


## <a name="step-2-changing-passwords"></a><span data-ttu-id="54d11-242">Etapa 2: Alteração de senhas</span><span class="sxs-lookup"><span data-stu-id="54d11-242">Step 2: Changing Passwords</span></span>

<span data-ttu-id="54d11-243">As senhas gerado aleatoriamente são difíceis de lembrar.</span><span class="sxs-lookup"><span data-stu-id="54d11-243">The randomly-generated passwords are difficult to remember.</span></span> <span data-ttu-id="54d11-244">Considere a senha mostrada na Figura 4: `WWGUZv(f2yM:Bd`.</span><span class="sxs-lookup"><span data-stu-id="54d11-244">Consider the password shown in Figure 4: `WWGUZv(f2yM:Bd`.</span></span> <span data-ttu-id="54d11-245">Tente confirmando que a memória!</span><span class="sxs-lookup"><span data-stu-id="54d11-245">Try committing that to memory!</span></span> <span data-ttu-id="54d11-246">Obviamente, depois que um usuário é enviado uma senha gerada aleatoriamente desse tipo, ela vai querer alterar a senha para algo mais fácil de lembrar.</span><span class="sxs-lookup"><span data-stu-id="54d11-246">Needless to say, after a user is sent a randomly-generated password of this sort, she'll want to change the password to something more memorable.</span></span>

<span data-ttu-id="54d11-247">Use o controle de alteração de senha para criar uma interface para um usuário altere sua senha.</span><span class="sxs-lookup"><span data-stu-id="54d11-247">Use the ChangePassword control to create an interface for a user to change her password.</span></span> <span data-ttu-id="54d11-248">Bem como o controle PasswordRecovery, o controle ChangePassword consiste em dois modos de exibição: alterar a senha e o sucesso.</span><span class="sxs-lookup"><span data-stu-id="54d11-248">Much like the PasswordRecovery control, the ChangePassword control consists of two views: Change Password and Success.</span></span> <span data-ttu-id="54d11-249">O modo de exibição de alterar a senha solicita ao usuário para suas senhas antigas e novas.</span><span class="sxs-lookup"><span data-stu-id="54d11-249">The Change Password view prompts the user for their old and new passwords.</span></span> <span data-ttu-id="54d11-250">Após fornecer a senha antiga correta e uma nova senha que atenda os requisitos de caractere não alfanumérico e um comprimento mínimo, o controle ChangePassword atualiza a senha do usuário e exibe o modo de exibição de êxito.</span><span class="sxs-lookup"><span data-stu-id="54d11-250">Upon supplying the correct old password and a new password that meets the minimum length and non-alphanumeric character requirements, the ChangePassword control updates the user's password and displays the Success view.</span></span>

> [!NOTE]
> <span data-ttu-id="54d11-251">O controle ChangePassword modifica a senha do usuário chamando o `MembershipUser` do objeto [ `ChangePassword` método](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.changepassword.aspx).</span><span class="sxs-lookup"><span data-stu-id="54d11-251">The ChangePassword control modifies the user's password by invoking the `MembershipUser` object's [`ChangePassword` method](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.changepassword.aspx).</span></span> <span data-ttu-id="54d11-252">O método ChangePassword aceita dois `string` entrada parâmetros - *Senha_atual* e *newPassword*- e atualiza a conta do usuário com o *newPassword*, Supondo que a fornecida *Senha_atual* está correto.</span><span class="sxs-lookup"><span data-stu-id="54d11-252">The ChangePassword method accepts two `string` input parameters - *oldPassword* and *newPassword*- and updates the user's account with the *newPassword*, assuming the supplied *oldPassword* is correct.</span></span>


<span data-ttu-id="54d11-253">Abra o `ChangePassword.aspx` página e adicionar um controle de alteração de senha para a página, nomeando- `ChangePwd`.</span><span class="sxs-lookup"><span data-stu-id="54d11-253">Open the `ChangePassword.aspx` page and add a ChangePassword control to the page, naming it `ChangePwd`.</span></span> <span data-ttu-id="54d11-254">Neste ponto, a exibição de Design deve mostrar a alterar a senha (consulte a Figura 6).</span><span class="sxs-lookup"><span data-stu-id="54d11-254">At this point, the Design view should show the Change Password view (see Figure 6).</span></span> <span data-ttu-id="54d11-255">Como com o controle PasswordRecovery, você pode alternar entre os modos de exibição por meio de marcas inteligentes do controle.</span><span class="sxs-lookup"><span data-stu-id="54d11-255">Like with the PasswordRecovery control, you can toggle between the views via the control's Smart Tag.</span></span> <span data-ttu-id="54d11-256">Além disso, aparências essas exibições são personalizáveis através das propriedades de estilo variados ou convertê-las em um modelo.</span><span class="sxs-lookup"><span data-stu-id="54d11-256">Furthermore, these views' appearances are customizable through the assorted style properties or by converting them to a template.</span></span>


<span data-ttu-id="54d11-257">[![Adicionar um controle de alteração de senha para a página](recovering-and-changing-passwords-cs/_static/image17.png)](recovering-and-changing-passwords-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="54d11-257">[![Add a ChangePassword Control to the Page](recovering-and-changing-passwords-cs/_static/image17.png)](recovering-and-changing-passwords-cs/_static/image16.png)</span></span>

<span data-ttu-id="54d11-258">**Figura 6**: adicionar um controle de alteração de senha para a página ([clique para exibir a imagem em tamanho normal](recovering-and-changing-passwords-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="54d11-258">**Figure 6**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image18.png))</span></span>


<span data-ttu-id="54d11-259">O controle de alteração de senha pode atualizar a senha do usuário conectado no momento *ou* a senha de outro usuário especificado.</span><span class="sxs-lookup"><span data-stu-id="54d11-259">The ChangePassword control can update the currently logged in user's password *or* the password of another, specified user.</span></span> <span data-ttu-id="54d11-260">Como mostra a Figura 6, a exibição de alterar a senha padrão processa apenas três controles de caixa de texto: uma para a senha antiga e dois para a nova senha.</span><span class="sxs-lookup"><span data-stu-id="54d11-260">As Figure 6 shows, the default Change Password view renders just three TextBox controls: one for the old password and two for the new password.</span></span> <span data-ttu-id="54d11-261">Essa interface padrão é usado para atualizar a senha do usuário conectado no momento.</span><span class="sxs-lookup"><span data-stu-id="54d11-261">This default interface is used to update the currently logged on user's password.</span></span>

<span data-ttu-id="54d11-262">Para usar o controle ChangePassword para atualizar a senha de outro usuário, defina o controle [ `DisplayUserName` propriedade](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.changepassword.displayusername.aspx) como True.</span><span class="sxs-lookup"><span data-stu-id="54d11-262">To use the ChangePassword control to update another user's password, set the control's [`DisplayUserName` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.changepassword.displayusername.aspx) to True.</span></span> <span data-ttu-id="54d11-263">Isso adiciona uma quarta caixa de texto para a página, solicitar o nome do usuário cuja senha para alterar.</span><span class="sxs-lookup"><span data-stu-id="54d11-263">Doing so adds a fourth TextBox to the page, prompting for the username of the user whose password to change.</span></span>

<span data-ttu-id="54d11-264">Definindo `DisplayUserName` para True será útil se você deseja permitir que um usuário conectado out alterar sua senha sem precisar fazer logon.</span><span class="sxs-lookup"><span data-stu-id="54d11-264">Setting `DisplayUserName` to True is useful if you want to let a logged out user change her password without having to log in.</span></span> <span data-ttu-id="54d11-265">Pessoalmente, acho que não há nada errado com a necessidade de um usuário para logon antes de permitir que o a alterar sua senha.</span><span class="sxs-lookup"><span data-stu-id="54d11-265">Personally, I think there's nothing wrong with requiring a user to login before allowing her to change her password.</span></span> <span data-ttu-id="54d11-266">Portanto, deixe `DisplayUserName` definido como False (padrão).</span><span class="sxs-lookup"><span data-stu-id="54d11-266">Therefore, leave `DisplayUserName` set to False (its default).</span></span> <span data-ttu-id="54d11-267">Tomar essa decisão, no entanto, é essencialmente são bloqueio usuários anônimos acessem esta página.</span><span class="sxs-lookup"><span data-stu-id="54d11-267">In making this decision, however, we essentially are barring anonymous users from reaching this page.</span></span> <span data-ttu-id="54d11-268">Atualizar regras de autorização de URL do site para negar a usuários anônimos visitação `ChangePassword.aspx`.</span><span class="sxs-lookup"><span data-stu-id="54d11-268">Update the site's URL authorization rules so as to deny anonymous users from visiting `ChangePassword.aspx`.</span></span> <span data-ttu-id="54d11-269">Se você precisar atualizar a memória de sintaxe de regra de autorização da URL, consulte novamente o <a id="_msoanchor_4"> </a> [ *autorização baseada em usuário* ](../membership/user-based-authorization-cs.md) tutorial.</span><span class="sxs-lookup"><span data-stu-id="54d11-269">If you need to refresh your memory on the URL authorization rule syntax, refer back to the <a id="_msoanchor_4"></a>[*User-Based Authorization*](../membership/user-based-authorization-cs.md) tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="54d11-270">Pode parecer que o `DisplayUserName` propriedade é útil para os administradores podem alterar as senhas de outros usuários.</span><span class="sxs-lookup"><span data-stu-id="54d11-270">It may seem that the `DisplayUserName` property is useful for allowing administrators to change other users' passwords.</span></span> <span data-ttu-id="54d11-271">No entanto, mesmo quando `DisplayUserName` está definida como True, a senha antiga correta deve ser conhecida e inserida.</span><span class="sxs-lookup"><span data-stu-id="54d11-271">However, even when `DisplayUserName` is set to True the correct old password must be known and entered.</span></span> <span data-ttu-id="54d11-272">Falaremos sobre as técnicas para permitir que os administradores alterar as senhas dos usuários na etapa 3.</span><span class="sxs-lookup"><span data-stu-id="54d11-272">We will talk about techniques for allowing administrators to change users' passwords in Step 3.</span></span>


<span data-ttu-id="54d11-273">Visite o `ChangePassword.aspx` página através de um navegador e altere sua senha.</span><span class="sxs-lookup"><span data-stu-id="54d11-273">Visit the `ChangePassword.aspx` page through a browser and change your password.</span></span> <span data-ttu-id="54d11-274">Observe que uma mensagem de erro é exibida se você inserir uma nova senha que não atender os requisitos de caractere não alfanumérico especificados na configuração de associação e o comprimento da senha (consulte a Figura 7).</span><span class="sxs-lookup"><span data-stu-id="54d11-274">Note that an error message is displayed if you enter a new password that fails to meet the password length and non-alphanumeric character requirements specified in the Membership configuration (see Figure 7).</span></span>


<span data-ttu-id="54d11-275">[![Adicionar um controle de alteração de senha para a página](recovering-and-changing-passwords-cs/_static/image20.png)](recovering-and-changing-passwords-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="54d11-275">[![Add a ChangePassword Control to the Page](recovering-and-changing-passwords-cs/_static/image20.png)](recovering-and-changing-passwords-cs/_static/image19.png)</span></span>

<span data-ttu-id="54d11-276">**Figura 7**: adicionar um controle de alteração de senha para a página ([clique para exibir a imagem em tamanho normal](recovering-and-changing-passwords-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="54d11-276">**Figure 7**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image21.png))</span></span>


<span data-ttu-id="54d11-277">Após inserir a senha antiga correta e uma senha nova válida, o log do usuário a senha for alterada e a exibição de êxito.</span><span class="sxs-lookup"><span data-stu-id="54d11-277">Upon entering the correct old password and a valid new password, the logged on user's password is changed and the Success view displayed.</span></span>

### <a name="sending-a-confirmation-email"></a><span data-ttu-id="54d11-278">Enviar um Email de confirmação</span><span class="sxs-lookup"><span data-stu-id="54d11-278">Sending a Confirmation Email</span></span>

<span data-ttu-id="54d11-279">Por padrão, o controle ChangePassword não envia uma mensagem de email para o usuário cuja senha acabou de ser atualizada.</span><span class="sxs-lookup"><span data-stu-id="54d11-279">By default, the ChangePassword control does not send an email message to the user whose password was just updated.</span></span> <span data-ttu-id="54d11-280">Se você deseja enviar um email, basta configurar o controle `MailDefinition` propriedade.</span><span class="sxs-lookup"><span data-stu-id="54d11-280">If you'd like to send an email, simply configure the control's `MailDefinition` property.</span></span> <span data-ttu-id="54d11-281">Vamos configurar o controle de alteração de senha para que o usuário é enviado um email formatado em HTML que contém a nova senha.</span><span class="sxs-lookup"><span data-stu-id="54d11-281">Let's configure the ChangePassword control so that the user is sent an HTML-formatted email that contains their new password.</span></span>

<span data-ttu-id="54d11-282">Comece criando um novo arquivo no `EmailTemplates` pasta denominada `ChangePassword.htm`.</span><span class="sxs-lookup"><span data-stu-id="54d11-282">Start by creating a new file in the `EmailTemplates` folder named `ChangePassword.htm`.</span></span> <span data-ttu-id="54d11-283">Adicione a seguinte marcação:</span><span class="sxs-lookup"><span data-stu-id="54d11-283">Add the following markup:</span></span>

[!code-html[Main](recovering-and-changing-passwords-cs/samples/sample4.html)]

<span data-ttu-id="54d11-284">Em seguida, defina o controle de alteração de senha `MailDefinition` da propriedade `BodyFileName`, `IsBodyHtml`, e `Subject` propriedades ~ / EmailTemplates/ChangePassword.htm, True e sua senha foi alterada!, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="54d11-284">Next, set the ChangePassword control's `MailDefinition` property's `BodyFileName`, `IsBodyHtml`, and `Subject` properties to ~/EmailTemplates/ChangePassword.htm, True, and Your password has changed!, respectively.</span></span>

<span data-ttu-id="54d11-285">Depois de fazer essas alterações, revise a página e alterar sua senha novamente.</span><span class="sxs-lookup"><span data-stu-id="54d11-285">After making these changes, revisit the page and change your password again.</span></span> <span data-ttu-id="54d11-286">Neste momento, o controle ChangePassword envia um email de personalizados, formatado em HTML para o endereço de email do usuário no arquivo (consulte a Figura 8).</span><span class="sxs-lookup"><span data-stu-id="54d11-286">This time, the ChangePassword control sends a customized, HTML-formatted email to the user's email address on file (see Figure 8).</span></span>


<span data-ttu-id="54d11-287">[![Uma mensagem de Email que informa a senha do usuário que seus foi alterado](recovering-and-changing-passwords-cs/_static/image23.png)](recovering-and-changing-passwords-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="54d11-287">[![An Email Message Informs the User That Their Password has Changed](recovering-and-changing-passwords-cs/_static/image23.png)](recovering-and-changing-passwords-cs/_static/image22.png)</span></span>

<span data-ttu-id="54d11-288">**Figura 8**: uma mensagem de Email informa a senha do usuário que seus foi alterada ([clique para exibir a imagem em tamanho normal](recovering-and-changing-passwords-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="54d11-288">**Figure 8**: An Email Message Informs the User That Their Password has Changed  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image24.png))</span></span>


## <a name="step-3-allowing-administrators-to-change-users-passwords"></a><span data-ttu-id="54d11-289">Etapa 3: Os administradores podem alterar as senhas dos usuários</span><span class="sxs-lookup"><span data-stu-id="54d11-289">Step 3: Allowing Administrators to Change Users' Passwords</span></span>

<span data-ttu-id="54d11-290">Um recurso comum em aplicativos que dão suporte a contas de usuário é a capacidade de um usuário administrativo alterar senhas de outros usuários.</span><span class="sxs-lookup"><span data-stu-id="54d11-290">A common feature in applications that support user accounts is the ability for an administrative user to change other users' passwords.</span></span> <span data-ttu-id="54d11-291">Às vezes, essa funcionalidade é necessária porque o sistema não tem a capacidade dos usuários podem alterar suas próprias senhas.</span><span class="sxs-lookup"><span data-stu-id="54d11-291">Sometimes this functionality is required because the system lacks the ability for users to change their own passwords.</span></span> <span data-ttu-id="54d11-292">Nesse caso, a única maneira de um usuário para recuperar uma senha esquecida seria o administrador atribuir uma nova senha.</span><span class="sxs-lookup"><span data-stu-id="54d11-292">In such a case, the only way for a user to recover their forgotten password would be for the administrator to assign them a new password.</span></span> <span data-ttu-id="54d11-293">Com os controles PasswordRecovery e ChangePassword, no entanto, os usuários administrativos necessitam não ocupado se alterar senhas de usuários, como os usuários são capazes de fazer isso.</span><span class="sxs-lookup"><span data-stu-id="54d11-293">With the PasswordRecovery and ChangePassword controls, however, administrative users need not busy themselves with changing users' passwords, as users are capable of doing this themselves.</span></span>

<span data-ttu-id="54d11-294">Mas e se o cliente insiste para que os usuários administrativos devem ser capazes de alterar as senhas de outros usuários?</span><span class="sxs-lookup"><span data-stu-id="54d11-294">But what if your client insists that administrative users should be able to change other users' passwords?</span></span> <span data-ttu-id="54d11-295">Infelizmente, adicionar essa funcionalidade pode ser um pouco de trabalho.</span><span class="sxs-lookup"><span data-stu-id="54d11-295">Unfortunately, adding this functionality can be a bit of work.</span></span> <span data-ttu-id="54d11-296">Para alterar a senha do usuário, a senha antiga e nova deve ser fornecida para o `MembershipUser` do objeto `ChangePassword` método, mas um administrador não deve ter que saber a senha do usuário para modificá-lo.</span><span class="sxs-lookup"><span data-stu-id="54d11-296">To change a user's password, both the old and new password must be supplied to the `MembershipUser` object's `ChangePassword` method, but an administrator shouldn't have to know a user's password in order to modify it.</span></span>

<span data-ttu-id="54d11-297">Uma solução alternativa é primeiro redefinir a senha do usuário e, em seguida, altere-o para a nova senha usando código semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="54d11-297">One workaround is to first reset the user's password and then change it to the new password using code like the following:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-cs/samples/sample5.aspx)]

<span data-ttu-id="54d11-298">Esse código inicia Recuperando informações sobre *nome de usuário*, que é o usuário cuja senha que o administrador deseja alterar.</span><span class="sxs-lookup"><span data-stu-id="54d11-298">This code starts by retrieving information about *username*, which is the user whose password the administrator wishes to change.</span></span> <span data-ttu-id="54d11-299">Em seguida, o `ResetPassword` método é chamado, que atribui e o usuário uma nova senha aleatória.</span><span class="sxs-lookup"><span data-stu-id="54d11-299">Next, the `ResetPassword` method is invoked, which assigns and the user a new, random password.</span></span> <span data-ttu-id="54d11-300">Essa senha gerada aleatoriamente que é retornada pelo método e armazenada na variável `resetPwd`.</span><span class="sxs-lookup"><span data-stu-id="54d11-300">This randomly-generated password is returned by the method and stored in the variable `resetPwd`.</span></span> <span data-ttu-id="54d11-301">Agora que sabemos que a senha do usuário, pode alterá-la por meio de uma chamada para `ChangePassword`.</span><span class="sxs-lookup"><span data-stu-id="54d11-301">Now that we know the user's password, we can change it via a call to `ChangePassword`.</span></span>

<span data-ttu-id="54d11-302">O problema é que este código só funcionará se a configuração do sistema de associação é definida, de modo que `RequiresQuestionAndAnswer` é False.</span><span class="sxs-lookup"><span data-stu-id="54d11-302">The problem is that this code only works if the Membership system configuration is set such that `RequiresQuestionAndAnswer` is False.</span></span> <span data-ttu-id="54d11-303">Se `RequiresQuestionAndAnswer` for True, como em nosso aplicativo, em seguida, o `ResetPassword` método deve ser passado a resposta de segurança, caso contrário, ela irá gerar uma exceção.</span><span class="sxs-lookup"><span data-stu-id="54d11-303">If `RequiresQuestionAndAnswer` is True, as it is with our application, then the `ResetPassword` method needs to be passed the security answer, otherwise it will throw an exception.</span></span>

<span data-ttu-id="54d11-304">Se a estrutura de associação está configurada para exigir uma pergunta de segurança e uma resposta, e ainda seu cliente insiste para que os administradores poderão alterar as senhas dos usuários, você tem três opções:</span><span class="sxs-lookup"><span data-stu-id="54d11-304">If the Membership framework is configured to require a security question and answer, and yet your client insists that administrators be able to change users' passwords, you have three options:</span></span>

- <span data-ttu-id="54d11-305">Gerar suas mãos no ar e informe seu cliente que se trata de apenas uma coisa que não pode ser feita.</span><span class="sxs-lookup"><span data-stu-id="54d11-305">Throw your hands in the air and tell your client that this is just one thing that cannot be done.</span></span>
- <span data-ttu-id="54d11-306">Definir `RequiresQuestionAndAnswer` como False.</span><span class="sxs-lookup"><span data-stu-id="54d11-306">Set `RequiresQuestionAndAnswer` to False.</span></span> <span data-ttu-id="54d11-307">Isso resulta em um aplicativo menos seguro.</span><span class="sxs-lookup"><span data-stu-id="54d11-307">This results in a less secure application.</span></span> <span data-ttu-id="54d11-308">Imagine que um usuário mal-intencionado obteve acesso à caixa de entrada de email do outro usuário.</span><span class="sxs-lookup"><span data-stu-id="54d11-308">Imagine that a nefarious user has gained access to another user's email inbox.</span></span> <span data-ttu-id="54d11-309">Talvez o usuário comprometido sai para almoçar suas mesas e não bloquear sua estação de trabalho, ou talvez elas acessar seus emails de um terminal público e não sair. Em ambos os casos, o usuário mal-intencionado pode visitar o `RecoverPassword.aspx` página e digite o nome do usuário.</span><span class="sxs-lookup"><span data-stu-id="54d11-309">Perhaps the compromised user has left their desk to go to lunch and didn't lock their workstation, or maybe they accessed their email from a public terminal and didn't sign out. In either case, the nefarious user can visit the `RecoverPassword.aspx` page and enter the user's username.</span></span> <span data-ttu-id="54d11-310">O sistema, em seguida, enviar email a senha recuperada sem solicitar a resposta de segurança.</span><span class="sxs-lookup"><span data-stu-id="54d11-310">The system will then email the recovered password without prompting for the security answer.</span></span>
- <span data-ttu-id="54d11-311">Ignore a camada de abstração criada pela estrutura de associação e trabalhar diretamente com o banco de dados do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="54d11-311">Bypass the abstraction layer created by the Membership framework and work directly with the SQL Server database.</span></span> <span data-ttu-id="54d11-312">O esquema de associação inclui um procedimento armazenado chamado `aspnet_Membership_SetPassword` que define a senha do usuário e não requer a resposta de segurança ou a senha antiga para realizar sua tarefa.</span><span class="sxs-lookup"><span data-stu-id="54d11-312">The Membership schema includes a stored procedure named `aspnet_Membership_SetPassword` that sets a user's password and does not require the security answer or old password in order to accomplish its task.</span></span>

<span data-ttu-id="54d11-313">Nenhuma dessas opções é especialmente atraente, mas isso é como a vida útil de um desenvolvedor vai às vezes.</span><span class="sxs-lookup"><span data-stu-id="54d11-313">None of these options are particularly appealing, but that's how the life of a developer goes sometimes.</span></span>

<span data-ttu-id="54d11-314">Eu fui em frente e implementado a terceira abordagem, escrevendo código que ignora o `Membership` e `MembershipUser` classes e opera diretamente o `SecurityTutorials` banco de dados.</span><span class="sxs-lookup"><span data-stu-id="54d11-314">I went ahead and implemented the third approach, writing code that bypasses the `Membership` and `MembershipUser` classes and operates directly against the `SecurityTutorials` database.</span></span>

> [!NOTE]
> <span data-ttu-id="54d11-315">Trabalhando diretamente com o banco de dados, o encapsulamento fornecido pela estrutura de associação é quebrado.</span><span class="sxs-lookup"><span data-stu-id="54d11-315">By working directly with the database, the encapsulation provided by the Membership framework is shattered.</span></span> <span data-ttu-id="54d11-316">Essa decisão vincula ao `SqlMembershipProvider`, tornando o nosso código menos portátil.</span><span class="sxs-lookup"><span data-stu-id="54d11-316">This decision ties us to the `SqlMembershipProvider`, making our code less portable.</span></span> <span data-ttu-id="54d11-317">Além disso, esse código pode não funcionar conforme o esperado em futuras versões do ASP.NET se altera o esquema de associação.</span><span class="sxs-lookup"><span data-stu-id="54d11-317">Furthermore, this code may not work as expected in future versions of ASP.NET if the Membership schema changes.</span></span> <span data-ttu-id="54d11-318">Essa abordagem é uma solução alternativa e, como a maioria das soluções alternativas, não é um exemplo de práticas recomendadas.</span><span class="sxs-lookup"><span data-stu-id="54d11-318">This approach is a workaround and, like most workarounds, is not an example of best practices.</span></span>


<span data-ttu-id="54d11-319">O código tem alguns bits atraente e é muito longo.</span><span class="sxs-lookup"><span data-stu-id="54d11-319">The code has some unattractive bits and is quite lengthy.</span></span> <span data-ttu-id="54d11-320">Portanto, não desejo sobrecarregar neste tutorial com uma análise detalhada dele.</span><span class="sxs-lookup"><span data-stu-id="54d11-320">Therefore, I don't want to clutter this tutorial with an in-depth examination of it.</span></span> <span data-ttu-id="54d11-321">Se você estiver interessado em saber mais, baixe o código para este tutorial e visite o `~/Administration/ManageUsers.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="54d11-321">If you are interested in learning more, download the code for this tutorial and visit the `~/Administration/ManageUsers.aspx` page.</span></span> <span data-ttu-id="54d11-322">Nesta página, que criamos no <a id="_msoanchor_5"> </a> [tutorial anterior](building-an-interface-to-select-one-user-account-from-many-cs.md), lista cada usuário.</span><span class="sxs-lookup"><span data-stu-id="54d11-322">This page, which we created in the <a id="_msoanchor_5"></a>[preceding tutorial](building-an-interface-to-select-one-user-account-from-many-cs.md), lists each user.</span></span> <span data-ttu-id="54d11-323">Atualizei o GridView para incluir um link para o `UserInformation.aspx` página, passando o nome de usuário do usuário selecionado por meio de querystring.</span><span class="sxs-lookup"><span data-stu-id="54d11-323">I've updated the GridView to include a link to the `UserInformation.aspx` page, passing the selected user's username through the querystring.</span></span> <span data-ttu-id="54d11-324">O `UserInformation.aspx` página exibe informações sobre o usuário selecionado e caixas de texto para alterar sua senha (consulte a Figura 9).</span><span class="sxs-lookup"><span data-stu-id="54d11-324">The `UserInformation.aspx` page displays information about the selected user and TextBoxes for changing their password (see Figure 9).</span></span>

<span data-ttu-id="54d11-325">Depois de inserir a nova senha, confirmá-la na segunda caixa de texto e clique no botão de usuário de atualização, um postback tem lugar e `aspnet_Membership_SetPassword` procedimento armazenado é chamado, atualizando a senha do usuário.</span><span class="sxs-lookup"><span data-stu-id="54d11-325">After entering the new password, confirming it in the second TextBox, and clicking the Update User Button, a postback ensues and the `aspnet_Membership_SetPassword` stored procedure is invoked, updating the user's password.</span></span> <span data-ttu-id="54d11-326">Recomendo que os leitores interessados nessa funcionalidade para se familiarizar com o código e estender a funcionalidade para incluir na enviando um email para o usuário cuja senha foi alterada.</span><span class="sxs-lookup"><span data-stu-id="54d11-326">I encourage those readers interested in this functionality to become more familiar with the code and try extending the functionality to include sending an email to the user whose password was changed.</span></span>


<span data-ttu-id="54d11-327">[![Um administrador pode alterar a senha do usuário](recovering-and-changing-passwords-cs/_static/image26.png)](recovering-and-changing-passwords-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="54d11-327">[![An Administrator May Change a User's Password](recovering-and-changing-passwords-cs/_static/image26.png)](recovering-and-changing-passwords-cs/_static/image25.png)</span></span>

<span data-ttu-id="54d11-328">**Figura 9**: um administrador pode alterar a senha do usuário ([clique para exibir a imagem em tamanho normal](recovering-and-changing-passwords-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="54d11-328">**Figure 9**: An Administrator May Change a User's Password  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image27.png))</span></span>


> [!NOTE]
> <span data-ttu-id="54d11-329">O `UserInformation.aspx` página atualmente só funciona se a estrutura de associação é configurada para armazenar senhas em formato criptografado ou Hashed.</span><span class="sxs-lookup"><span data-stu-id="54d11-329">The `UserInformation.aspx` page currently only works if the Membership framework is configured to store passwords in Clear or Hashed format.</span></span> <span data-ttu-id="54d11-330">Ele não tem o código para criptografar a senha nova, embora você está convidado a adicionar essa funcionalidade.</span><span class="sxs-lookup"><span data-stu-id="54d11-330">It lacks the code to encrypt the new password, although you are invited to add this functionality.</span></span> <span data-ttu-id="54d11-331">O modo é recomendável adicionar o código necessário é usar um descompilador como [refletor](http://www.aisto.com/roeder/dotnet/) para examinar o código-fonte para os métodos do .NET Framework; iniciar examinando o `SqlMembershipProvider` da classe `ChangePassword` método.</span><span class="sxs-lookup"><span data-stu-id="54d11-331">The way I recommend adding the necessary code is to use a decompiler like [Reflector](http://www.aisto.com/roeder/dotnet/) to examine the source code for methods in the .NET Framework; start by examining the `SqlMembershipProvider` class's `ChangePassword` method.</span></span> <span data-ttu-id="54d11-332">Essa é a técnica, usado para gravar o código para criar um hash da senha.</span><span class="sxs-lookup"><span data-stu-id="54d11-332">This is the technique I used to write the code for creating a hash of the password.</span></span>


## <a name="summary"></a><span data-ttu-id="54d11-333">Resumo</span><span class="sxs-lookup"><span data-stu-id="54d11-333">Summary</span></span>

<span data-ttu-id="54d11-334">O ASP.NET oferece dois controles para ajudar os usuários a gerenciar sua senha.</span><span class="sxs-lookup"><span data-stu-id="54d11-334">ASP.NET offers two controls to help users manage their password.</span></span> <span data-ttu-id="54d11-335">O controle PasswordRecovery é útil para aqueles que esqueceram suas senhas.</span><span class="sxs-lookup"><span data-stu-id="54d11-335">The PasswordRecovery control is useful for those who have forgotten their passwords.</span></span> <span data-ttu-id="54d11-336">Dependendo da configuração da estrutura de associação, ou é um email ao usuário sua senha atual ou uma nova senha gerada aleatoriamente.</span><span class="sxs-lookup"><span data-stu-id="54d11-336">Depending on the Membership framework's configuration, the user is either emailed their existing password or a new, randomly-generated password.</span></span> <span data-ttu-id="54d11-337">O controle de alteração de senha permite que um usuário atualizar sua senha.</span><span class="sxs-lookup"><span data-stu-id="54d11-337">The ChangePassword control enables a user to update their password.</span></span>

<span data-ttu-id="54d11-338">Como os controles de logon e CreateUserWizard, os controles PasswordRecovery e ChangePassword renderizam uma interface de usuário sem precisar escrever uma linha de marcação declarativa ou a linha de código.</span><span class="sxs-lookup"><span data-stu-id="54d11-338">Like the Login and CreateUserWizard controls, the PasswordRecovery and ChangePassword controls render a rich user interface without having to write a lick of declarative markup or line of code.</span></span> <span data-ttu-id="54d11-339">Se a interface de usuário padrão não atender às suas necessidades, você pode personalizá-lo por meio de uma variedade de propriedades de estilo.</span><span class="sxs-lookup"><span data-stu-id="54d11-339">If the default user interface doesn't meet your needs, you can customize it through a variety of style properties.</span></span> <span data-ttu-id="54d11-340">Como alternativa, interfaces os controles podem ser convertidos em modelos para um grau de controle ainda mais detalhado.</span><span class="sxs-lookup"><span data-stu-id="54d11-340">Alternatively, the controls' interfaces may be converted into templates, for an even finer degree of control.</span></span> <span data-ttu-id="54d11-341">Nos bastidores esses controles usam a API de associação, invocando o `MembershipUser` do objeto `ResetPassword` e `ChangePassword` métodos.</span><span class="sxs-lookup"><span data-stu-id="54d11-341">Behind the scenes these controls use the Membership API, invoking the `MembershipUser` object's `ResetPassword` and `ChangePassword` methods.</span></span>

<span data-ttu-id="54d11-342">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="54d11-342">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="54d11-343">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="54d11-343">Further Reading</span></span>

<span data-ttu-id="54d11-344">Para obter mais informações sobre os tópicos abordados neste tutorial, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="54d11-344">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="54d11-345">Início rápido do controle de alteração de senha</span><span class="sxs-lookup"><span data-stu-id="54d11-345">ChangePassword Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/changepassword.aspx)
- [<span data-ttu-id="54d11-346">Início rápido do controle PasswordRecovery</span><span class="sxs-lookup"><span data-stu-id="54d11-346">PasswordRecovery Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/passwordrecovery.aspx)
- [<span data-ttu-id="54d11-347">Enviar o Email no ASP.NET</span><span class="sxs-lookup"><span data-stu-id="54d11-347">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="54d11-348">`System.Net.Mail`Perguntas frequentes</span><span class="sxs-lookup"><span data-stu-id="54d11-348">`System.Net.Mail` FAQs</span></span>](http://www.systemnetmail.com/)

### <a name="about-the-author"></a><span data-ttu-id="54d11-349">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="54d11-349">About the Author</span></span>

<span data-ttu-id="54d11-350">Scott Mitchell, autor de vários livros sobre ASP/ASP.NET e fundador da 4GuysFromRolla. com, trabalha com tecnologias Microsoft Web desde 1998.</span><span class="sxs-lookup"><span data-stu-id="54d11-350">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="54d11-351">Scott funciona como um consultor independente, instrutor e gravador.</span><span class="sxs-lookup"><span data-stu-id="54d11-351">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="54d11-352">Seu livro mais recente é  *[Sams ensinar por conta própria ASP.NET 2.0 nas 24 horas](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="54d11-352">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="54d11-353">Scott pode ser contatado pelo [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) ou em seu blog [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="54d11-353">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="54d11-354">Agradecimentos especiais a</span><span class="sxs-lookup"><span data-stu-id="54d11-354">Special Thanks To</span></span>

<span data-ttu-id="54d11-355">Esta série de tutoriais foi revisado por vários revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="54d11-355">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="54d11-356">Revisores levar para este tutorial incluem Michael Emmings e Suchi Banerjee.</span><span class="sxs-lookup"><span data-stu-id="54d11-356">Lead reviewers for this tutorial include Michael Emmings and Suchi Banerjee.</span></span> <span data-ttu-id="54d11-357">Interessado em examinar meu artigos futuros do MSDN?</span><span class="sxs-lookup"><span data-stu-id="54d11-357">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="54d11-358">Nesse caso, me enviar uma linha em[mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="54d11-358">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="54d11-359">[Anterior](building-an-interface-to-select-one-user-account-from-many-cs.md)
[Próximo](unlocking-and-approving-user-accounts-cs.md)</span><span class="sxs-lookup"><span data-stu-id="54d11-359">[Previous](building-an-interface-to-select-one-user-account-from-many-cs.md)
[Next](unlocking-and-approving-user-accounts-cs.md)</span></span>
