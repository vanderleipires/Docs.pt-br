---
title: Hierarquia de finalidade e a multilocação no ASP.NET Core
author: rick-anderson
description: Saiba mais sobre multilocação e hierarquia de cadeia de caracteres de finalidade, como ele se relaciona com as APIs de proteção de dados do ASP.NET Core.
ms.author: riande
ms.date: 10/14/2016
uid: security/data-protection/consumer-apis/purpose-strings-multitenancy
ms.openlocfilehash: 1133d40e7b325d58b3f70e7387494dae36ff8ac9
ms.sourcegitcommit: fd461c60b5e36c7019f81da0138cc859d0fddaa2
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/10/2018
ms.locfileid: "41825374"
---
# <a name="purpose-hierarchy-and-multi-tenancy-in-aspnet-core"></a><span data-ttu-id="f62e7-103">Hierarquia de finalidade e a multilocação no ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="f62e7-103">Purpose hierarchy and multi-tenancy in ASP.NET Core</span></span>

<span data-ttu-id="f62e7-104">Uma vez que um `IDataProtector` também é implicitamente um `IDataProtectionProvider`, fins podem ser encadeada juntos.</span><span class="sxs-lookup"><span data-stu-id="f62e7-104">Since an `IDataProtector` is also implicitly an `IDataProtectionProvider`, purposes can be chained together.</span></span> <span data-ttu-id="f62e7-105">Nesse sentido `provider.CreateProtector([ "purpose1", "purpose2" ])` é equivalente a `provider.CreateProtector("purpose1").CreateProtector("purpose2")`.</span><span class="sxs-lookup"><span data-stu-id="f62e7-105">In this sense, `provider.CreateProtector([ "purpose1", "purpose2" ])` is equivalent to `provider.CreateProtector("purpose1").CreateProtector("purpose2")`.</span></span>

<span data-ttu-id="f62e7-106">Isso permite que algumas relações hierárquicas interessantes através do sistema de proteção de dados.</span><span class="sxs-lookup"><span data-stu-id="f62e7-106">This allows for some interesting hierarchical relationships through the data protection system.</span></span> <span data-ttu-id="f62e7-107">No exemplo anterior de [Contoso.Messaging.SecureMessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose), o componente SecureMessage pode chamar `provider.CreateProtector("Contoso.Messaging.SecureMessage")` iniciais de uma vez e armazenar em cache o resultado em uma particular `_myProvider` campo.</span><span class="sxs-lookup"><span data-stu-id="f62e7-107">In the earlier example of [Contoso.Messaging.SecureMessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose), the SecureMessage component can call `provider.CreateProtector("Contoso.Messaging.SecureMessage")` once up-front and cache the result into a private `_myProvider` field.</span></span> <span data-ttu-id="f62e7-108">Protetores de futuros, em seguida, podem ser criadas por meio de chamadas para `_myProvider.CreateProtector("User: username")`, e os protetores seriam usados para proteger as mensagens individuais.</span><span class="sxs-lookup"><span data-stu-id="f62e7-108">Future protectors can then be created via calls to `_myProvider.CreateProtector("User: username")`, and these protectors would be used for securing the individual messages.</span></span>

<span data-ttu-id="f62e7-109">Isso também pode ser invertido.</span><span class="sxs-lookup"><span data-stu-id="f62e7-109">This can also be flipped.</span></span> <span data-ttu-id="f62e7-110">Considere um único aplicativo lógico que hospeda vários locatários (um CMS parece razoável) e cada locatário podem ser configurado com seu próprio sistema de gerenciamento de autenticação e o estado.</span><span class="sxs-lookup"><span data-stu-id="f62e7-110">Consider a single logical application which hosts multiple tenants (a CMS seems reasonable), and each tenant can be configured with its own authentication and state management system.</span></span> <span data-ttu-id="f62e7-111">O aplicativo guarda-chuva tem um único provedor mestre e, em seguida, chama `provider.CreateProtector("Tenant 1")` e `provider.CreateProtector("Tenant 2")` para fornecer seu próprio fatia isolada do sistema de proteção de dados de cada locatário.</span><span class="sxs-lookup"><span data-stu-id="f62e7-111">The umbrella application has a single master provider, and it calls `provider.CreateProtector("Tenant 1")` and `provider.CreateProtector("Tenant 2")` to give each tenant its own isolated slice of the data protection system.</span></span> <span data-ttu-id="f62e7-112">Os locatários, em seguida, pode derivar seus próprios protetores individuais com base em suas necessidades, mas, independentemente de como eles tentam eles não é possível criar protetores que entrem em conflito com qualquer outro locatário no sistema.</span><span class="sxs-lookup"><span data-stu-id="f62e7-112">The tenants could then derive their own individual protectors based on their own needs, but no matter how hard they try they cannot create protectors which collide with any other tenant in the system.</span></span> <span data-ttu-id="f62e7-113">Graficamente, isso é representado como abaixo.</span><span class="sxs-lookup"><span data-stu-id="f62e7-113">Graphically, this is represented as below.</span></span>

![Com várias finalidades de aluguel](purpose-strings-multitenancy/_static/purposes-multi-tenancy.png)

>[!WARNING]
> <span data-ttu-id="f62e7-115">Isso pressupõe que a cobertura do controles de aplicativo, quais APIs estão disponíveis para locatários individuais e que os locatários não podem executar código arbitrário no servidor.</span><span class="sxs-lookup"><span data-stu-id="f62e7-115">This assumes the umbrella application controls which APIs are available to individual tenants and that tenants cannot execute arbitrary code on the server.</span></span> <span data-ttu-id="f62e7-116">Se um locatário pode executar código arbitrário, eles poderiam executar a reflexão privada para quebrar as garantias de isolamento, ou pode apenas ler o material de chave mestra diretamente e derivar qualquer subchaves que desejarem.</span><span class="sxs-lookup"><span data-stu-id="f62e7-116">If a tenant can execute arbitrary code, they could perform private reflection to break the isolation guarantees, or they could just read the master keying material directly and derive whatever subkeys they desire.</span></span>

<span data-ttu-id="f62e7-117">Na verdade, o sistema de proteção de dados usa uma espécie de multilocação em sua configuração de out-of-the-box do padrão.</span><span class="sxs-lookup"><span data-stu-id="f62e7-117">The data protection system actually uses a sort of multi-tenancy in its default out-of-the-box configuration.</span></span> <span data-ttu-id="f62e7-118">Por padrão, o material de chave mestra é armazenado na pasta de perfil do usuário da conta de processo do operador (ou o registro, para identidades do pool de aplicativos IIS).</span><span class="sxs-lookup"><span data-stu-id="f62e7-118">By default master keying material is stored in the worker process account's user profile folder (or the registry, for IIS application pool identities).</span></span> <span data-ttu-id="f62e7-119">Mas é, na verdade, bastante comum usar uma única conta para executar vários aplicativos e, portanto, todos esses aplicativos seriam acabam compartilhando a material da chave mestra.</span><span class="sxs-lookup"><span data-stu-id="f62e7-119">But it's actually fairly common to use a single account to run multiple applications, and thus all these applications would end up sharing the master keying material.</span></span> <span data-ttu-id="f62e7-120">Para resolver isso, o sistema de proteção de dados insere automaticamente um identificador exclusivo por aplicativo como o primeiro elemento na cadeia de finalidade geral.</span><span class="sxs-lookup"><span data-stu-id="f62e7-120">To solve this, the data protection system automatically inserts a unique-per-application identifier as the first element in the overall purpose chain.</span></span> <span data-ttu-id="f62e7-121">Que serve para essa finalidade implícita [isolar aplicativos individuais](xref:security/data-protection/configuration/overview#per-application-isolation) uns dos outros, tratando efetivamente cada aplicativo como um locatário exclusivo no sistema e o processo de criação de protetor parece idêntico na imagem acima.</span><span class="sxs-lookup"><span data-stu-id="f62e7-121">This implicit purpose serves to [isolate individual applications](xref:security/data-protection/configuration/overview#per-application-isolation) from one another by effectively treating each application as a unique tenant within the system, and the protector creation process looks identical to the image above.</span></span>
