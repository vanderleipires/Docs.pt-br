---
title: Hospedagem de produção do ASP.NET SignalR Core e dimensionamento
author: tdykstra
description: Saiba como evitar o desempenho e dimensionamento problemas em aplicativos que usam o SignalR do ASP.NET Core.
monikerRange: '>= aspnetcore-2.1'
ms.author: tdykstra
ms.custom: mvc
ms.date: 11/28/2018
uid: signalr/scale
ms.openlocfilehash: 94791ffb73b58a9026942d632bce59773e3fda5b
ms.sourcegitcommit: e9b99854b0a8021dafabee0db5e1338067f250a9
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/28/2018
ms.locfileid: "52452907"
---
# <a name="aspnet-core-signalr-hosting-and-scaling"></a><span data-ttu-id="b871a-103">Hospedagem do ASP.NET SignalR Core e dimensionamento</span><span class="sxs-lookup"><span data-stu-id="b871a-103">ASP.NET Core SignalR hosting and scaling</span></span>

<span data-ttu-id="b871a-104">Por [Andrew Stanton-Nurse](https://twitter.com/anurse), [Brady Gaster](https://twitter.com/bradygaster), e [Tom Dykstra](https://github.com/tdykstra),</span><span class="sxs-lookup"><span data-stu-id="b871a-104">By [Andrew Stanton-Nurse](https://twitter.com/anurse), [Brady Gaster](https://twitter.com/bradygaster), and [Tom Dykstra](https://github.com/tdykstra),</span></span>

<span data-ttu-id="b871a-105">Este artigo explica as considerações para aplicativos de alto tráfego que usam o SignalR do ASP.NET Core de dimensionamento e hospedagem.</span><span class="sxs-lookup"><span data-stu-id="b871a-105">This article explains hosting and scaling considerations for high-traffic apps that use ASP.NET Core SignalR.</span></span>

## <a name="tcp-connection-resources"></a><span data-ttu-id="b871a-106">Recursos de conexão TCP</span><span class="sxs-lookup"><span data-stu-id="b871a-106">TCP connection resources</span></span>

<span data-ttu-id="b871a-107">O número de conexões TCP simultâneas que pode dar suporte a um servidor web é limitado.</span><span class="sxs-lookup"><span data-stu-id="b871a-107">The number of concurrent TCP connections that a web server can support is limited.</span></span> <span data-ttu-id="b871a-108">Os clientes HTTP padrão usam *efêmero* conexões.</span><span class="sxs-lookup"><span data-stu-id="b871a-108">Standard HTTP clients use *ephemeral* connections.</span></span> <span data-ttu-id="b871a-109">Essas conexões podem ser fechadas quando o cliente fica ocioso e reabrir posteriormente.</span><span class="sxs-lookup"><span data-stu-id="b871a-109">These connections can be closed when the client goes idle and reopened later.</span></span> <span data-ttu-id="b871a-110">Por outro lado, uma conexão SignalR é *persistente*.</span><span class="sxs-lookup"><span data-stu-id="b871a-110">On the other hand, a SignalR connection is *persistent*.</span></span> <span data-ttu-id="b871a-111">Conexões do SignalR permanecem aberta até mesmo quando o cliente vai ocioso.</span><span class="sxs-lookup"><span data-stu-id="b871a-111">SignalR connections stay open even when the client goes idle.</span></span> <span data-ttu-id="b871a-112">Em um aplicativo de alto tráfego que atende a muitos clientes, essas conexões persistentes podem causar servidores atingido o número máximo de conexões.</span><span class="sxs-lookup"><span data-stu-id="b871a-112">In a high-traffic app that serves many clients, these persistent connections can cause servers to hit their maximum number of connections.</span></span>

<span data-ttu-id="b871a-113">Conexões persistentes também consomem memória extra, para acompanhar cada conexão.</span><span class="sxs-lookup"><span data-stu-id="b871a-113">Persistent connections also consume some additional memory, to track each connection.</span></span>

<span data-ttu-id="b871a-114">O uso intenso de recursos relacionados à conexão pelo SignalR pode afetar outros aplicativos web hospedados no mesmo servidor.</span><span class="sxs-lookup"><span data-stu-id="b871a-114">The heavy use of connection-related resources by SignalR can affect other web apps that are hosted on the same server.</span></span> <span data-ttu-id="b871a-115">Quando o SignalR é aberto e mantém as último conexões TCP disponíveis, outros aplicativos web no mesmo servidor também não tem mais conexões disponíveis para eles.</span><span class="sxs-lookup"><span data-stu-id="b871a-115">When SignalR opens and holds the last available TCP connections, other web apps on the same server also have no more connections available to them.</span></span>

<span data-ttu-id="b871a-116">Se um servidor ficar sem conexões, você verá erros de soquete aleatória e erros de redefinição de conexão.</span><span class="sxs-lookup"><span data-stu-id="b871a-116">If a server runs out of connections, you'll see random socket errors and connection reset errors.</span></span> <span data-ttu-id="b871a-117">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="b871a-117">For example:</span></span>

```
An attempt was made to access a socket in a way forbidden by its access permissions...
```

<span data-ttu-id="b871a-118">Para evitar o uso de recursos do SignalR causando erros em outros aplicativos da web, execute o SignalR em servidores diferentes do que seus outros aplicativos da web.</span><span class="sxs-lookup"><span data-stu-id="b871a-118">To keep SignalR resource usage from causing errors in other web apps, run SignalR on different servers than your other web apps.</span></span>

<span data-ttu-id="b871a-119">Para evitar o uso de recursos do SignalR causando erros em um aplicativo do SignalR, escala horizontalmente para limitar o número de conexões que um servidor deve manipular.</span><span class="sxs-lookup"><span data-stu-id="b871a-119">To keep SignalR resource usage from causing errors in a SignalR app, scale out to limit the number of connections a server has to handle.</span></span>

## <a name="scale-out"></a><span data-ttu-id="b871a-120">Expansão do</span><span class="sxs-lookup"><span data-stu-id="b871a-120">Scale out</span></span>

<span data-ttu-id="b871a-121">Um aplicativo que usa o SignalR precisa manter o controle de todas as suas conexões, que cria problemas para um farm de servidores.</span><span class="sxs-lookup"><span data-stu-id="b871a-121">An app that uses SignalR needs to keep track of all its connections, which creates problems for a server farm.</span></span> <span data-ttu-id="b871a-122">Adicionar um servidor, e ele obtém novas conexões de outros servidores não conhecer.</span><span class="sxs-lookup"><span data-stu-id="b871a-122">Add a server, and it gets new connections that the other servers don't know about.</span></span> <span data-ttu-id="b871a-123">Por exemplo, o SignalR em cada servidor no diagrama a seguir desconhece as conexões nos outros servidores.</span><span class="sxs-lookup"><span data-stu-id="b871a-123">For example, SignalR on each server in the following diagram is unaware of the connections on the other servers.</span></span> <span data-ttu-id="b871a-124">Quando quiser SignalR em um dos servidores enviar uma mensagem a todos os clientes, a mensagem é apenas vai para os clientes conectados a esse servidor.</span><span class="sxs-lookup"><span data-stu-id="b871a-124">When SignalR on one of the servers wants to send a message to all clients, the message only goes to the clients connected to that server.</span></span>

![Dimensionamento SignalR sem um backplane](scale/_static/scale-no-backplane.png)

<span data-ttu-id="b871a-126">As opções para resolver esse problema são as [serviço do Azure SignalR](#azure-signalr-service) e [Redis backplane](#redis-backplane).</span><span class="sxs-lookup"><span data-stu-id="b871a-126">The options for solving this problem are the [Azure SignalR Service](#azure-signalr-service) and [Redis backplane](#redis-backplane).</span></span>

## <a name="azure-signalr-service"></a><span data-ttu-id="b871a-127">Serviço Azure SignalR</span><span class="sxs-lookup"><span data-stu-id="b871a-127">Azure SignalR Service</span></span>

<span data-ttu-id="b871a-128">O serviço do Azure SignalR é um proxy em vez de um backplane.</span><span class="sxs-lookup"><span data-stu-id="b871a-128">The Azure SignalR Service is a proxy rather than a backplane.</span></span> <span data-ttu-id="b871a-129">Cada vez que um cliente inicia uma conexão ao servidor, o cliente é redirecionado para se conectar ao serviço.</span><span class="sxs-lookup"><span data-stu-id="b871a-129">Each time a client initiates a connection to the server, the client is redirected to connect to the service.</span></span> <span data-ttu-id="b871a-130">Esse processo é ilustrado no diagrama a seguir:</span><span class="sxs-lookup"><span data-stu-id="b871a-130">That process is illustrated in the following diagram:</span></span>

![Estabelecer uma conexão ao serviço Azure SignalR](scale/_static/azure-signalr-service-one-connection.png)

<span data-ttu-id="b871a-132">O resultado é que o serviço gerencia todas as conexões de cliente, enquanto cada servidor precisa de apenas um pequeno número constante de conexões para o serviço, conforme mostrado no diagrama a seguir:</span><span class="sxs-lookup"><span data-stu-id="b871a-132">The result is that the service manages all of the client connections, while each server needs only a small constant number of connections to the service, as shown in the following diagram:</span></span>

![Clientes conectados ao serviço, servidores conectados ao serviço](scale/_static/azure-signalr-service-multiple-connections.png)

<span data-ttu-id="b871a-134">Essa abordagem de expansão tem várias vantagens em relação a alternativa de backplane do Redis:</span><span class="sxs-lookup"><span data-stu-id="b871a-134">This approach to scale-out has several advantages over the Redis backplane alternative:</span></span>

* <span data-ttu-id="b871a-135">Sessões adesivas, também conhecidas como [afinidade do cliente](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), não é necessário, pois os clientes imediatamente são redirecionados para o serviço do Azure SignalR quando eles se conectam.</span><span class="sxs-lookup"><span data-stu-id="b871a-135">Sticky sessions, also known as [client affinity](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), is not required, because clients are immediately redirected to the Azure SignalR Service when they connect.</span></span>
* <span data-ttu-id="b871a-136">Um aplicativo pode escalar horizontalmente de SignalR com base no número de mensagens enviadas, enquanto o serviço do Azure SignalR é dimensionado automaticamente para lidar com qualquer número de conexões.</span><span class="sxs-lookup"><span data-stu-id="b871a-136">A SignalR app can scale out based on the number of messages sent, while the Azure SignalR Service automatically scales to handle any number of connections.</span></span> <span data-ttu-id="b871a-137">Por exemplo, pode haver milhares de clientes, mas se apenas algumas mensagens por segundo são enviadas, o aplicativo SignalR não será necessário escalar horizontalmente em vários servidores apenas para lidar com as conexões em si.</span><span class="sxs-lookup"><span data-stu-id="b871a-137">For example, there could be thousands of clients, but if only a few messages per second are sent, the SignalR app won't need to scale out to multiple servers just to handle the connections themselves.</span></span>
* <span data-ttu-id="b871a-138">Um aplicativo de SignalR não usar significativamente mais recursos de conexão que um aplicativo web sem SignalR.</span><span class="sxs-lookup"><span data-stu-id="b871a-138">A SignalR app won't use significantly more connection resources than a web app without SignalR.</span></span>

<span data-ttu-id="b871a-139">Por esses motivos, recomendamos que o serviço do Azure SignalR para todos os aplicativos do SignalR do ASP.NET Core hospedados no Azure, incluindo o serviço de aplicativo, as VMs e contêineres.</span><span class="sxs-lookup"><span data-stu-id="b871a-139">For these reasons, we recommend the Azure SignalR Service for all ASP.NET Core SignalR apps hosted on Azure, including App Service, VMs, and containers.</span></span>

<span data-ttu-id="b871a-140">Para obter mais informações, consulte o [documentação do serviço do Azure SignalR](/azure/azure-signalr/signalr-overview).</span><span class="sxs-lookup"><span data-stu-id="b871a-140">For more information see the [Azure SignalR Service documentation](/azure/azure-signalr/signalr-overview).</span></span>

## <a name="redis-backplane"></a><span data-ttu-id="b871a-141">Backplane de redis</span><span class="sxs-lookup"><span data-stu-id="b871a-141">Redis backplane</span></span>

<span data-ttu-id="b871a-142">[Redis](https://redis.io/) é um repositório de chave-valor na memória que dá suporte a um sistema de mensagens com um modelo de publicação/assinatura.</span><span class="sxs-lookup"><span data-stu-id="b871a-142">[Redis](https://redis.io/) is an in-memory key-value store that supports a messaging system with a publish/subscribe model.</span></span> <span data-ttu-id="b871a-143">O backplane SignalR Redis usa o recurso de publicação/assinatura para encaminhar mensagens para outros servidores.</span><span class="sxs-lookup"><span data-stu-id="b871a-143">The SignalR Redis backplane uses the pub/sub feature to forward messages to other servers.</span></span> <span data-ttu-id="b871a-144">Quando um cliente faz uma conexão, as informações de conexão são passadas ao backplane.</span><span class="sxs-lookup"><span data-stu-id="b871a-144">When a client makes a connection, the connection information is passed to the backplane.</span></span> <span data-ttu-id="b871a-145">Quando um servidor deseja enviar uma mensagem a todos os clientes, ele envia ao backplane.</span><span class="sxs-lookup"><span data-stu-id="b871a-145">When a server wants to send a message to all clients, it sends to the backplane.</span></span> <span data-ttu-id="b871a-146">Backplane sabe clientes tudo conectados e quais servidores que eles estão.</span><span class="sxs-lookup"><span data-stu-id="b871a-146">The backplane knows all connected clients and which servers they're on.</span></span> <span data-ttu-id="b871a-147">Ele envia a mensagem a todos os clientes por meio de seus respectivos servidores.</span><span class="sxs-lookup"><span data-stu-id="b871a-147">It sends the message to all clients via their respective servers.</span></span> <span data-ttu-id="b871a-148">Esse processo é ilustrado no diagrama a seguir:</span><span class="sxs-lookup"><span data-stu-id="b871a-148">This process is illustrated in the following diagram:</span></span>

![Backplane de mensagem enviada de um servidor para todos os clientes de redis](scale/_static/redis-backplane.png)

<span data-ttu-id="b871a-150">O backplane do Redis é a abordagem recomendada de escalabilidade horizontal para aplicativos hospedados em sua própria infraestrutura.</span><span class="sxs-lookup"><span data-stu-id="b871a-150">The Redis backplane is the recommended scale-out approach for apps hosted on your own infrastructure.</span></span> <span data-ttu-id="b871a-151">Azure SignalR Service não é uma opção prática para uso em produção com aplicativos no local devido à latência de conexão entre seu data center e um data center do Azure.</span><span class="sxs-lookup"><span data-stu-id="b871a-151">Azure SignalR Service isn't a practical option for production use with on-premises apps due to connection latency between your data center and an Azure data center.</span></span>

<span data-ttu-id="b871a-152">As vantagens de serviço do Azure SignalR observadas anteriormente são as desvantagens para o backplane do Redis:</span><span class="sxs-lookup"><span data-stu-id="b871a-152">The Azure SignalR Service advantages noted earlier are disadvantages for the Redis backplane:</span></span>

* <span data-ttu-id="b871a-153">Sessões adesivas, também conhecidas como [afinidade do cliente](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), é necessário.</span><span class="sxs-lookup"><span data-stu-id="b871a-153">Sticky sessions, also known as [client affinity](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), is required.</span></span> <span data-ttu-id="b871a-154">Depois que uma conexão é iniciada em um servidor, a conexão deve permanecer nesse servidor.</span><span class="sxs-lookup"><span data-stu-id="b871a-154">Once a connection is initiated on a server, the connection has to stay on that server.</span></span>
* <span data-ttu-id="b871a-155">Um aplicativo de SignalR deve escalar horizontalmente com base no número de clientes, mesmo se algumas mensagens estão sendo enviadas.</span><span class="sxs-lookup"><span data-stu-id="b871a-155">A SignalR app must scale out based on number of clients even if few messages are being sent.</span></span>
* <span data-ttu-id="b871a-156">Um aplicativo de SignalR usa significativamente mais recursos de conexão que um aplicativo web sem SignalR.</span><span class="sxs-lookup"><span data-stu-id="b871a-156">A SignalR app uses significantly more connection resources than a web app without SignalR.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b871a-157">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="b871a-157">Next steps</span></span>

<span data-ttu-id="b871a-158">Para obter mais informações, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="b871a-158">For more information, see the following resources:</span></span>

* [<span data-ttu-id="b871a-159">Documentação do SignalR Service do Azure</span><span class="sxs-lookup"><span data-stu-id="b871a-159">Azure SignalR Service documentation</span></span>](/azure/azure-signalr/signalr-overview)
* [<span data-ttu-id="b871a-160">Configurar um backplane de Redis</span><span class="sxs-lookup"><span data-stu-id="b871a-160">Set up a Redis backplane</span></span>](xref:signalr/redis-backplane)
